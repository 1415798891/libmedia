"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[969],{58469:(t,e,i)=>{i.d(e,{En:()=>o,Ij:()=>d,XC:()=>h,hY:()=>s,uF:()=>n});var r=i(77231);const n={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},a={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],o=[r.N_,1,2,3,4,5,6,7];function h(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e){const{profile:i,sampleRate:n,channels:a}=function(t){let e=r.N_,i=r.N_,n=r.N_;var a,h;return t.length>=2&&(e=t[0]>>3&31,i=null!==(a=s[(7&t[0])<<1|t[1]>>7])&&void 0!==a?a:48e3,n=null!==(h=o[t[1]>>3&15])&&void 0!==h?h:2),{profile:e,sampleRate:i,channels:n}}(e);t.codecpar.profile=i,t.codecpar.sampleRate=n,t.codecpar.chLayout.nbChannels=a}}function d(t){const e=a[t.sampleRate],i=t.chLayout.nbChannels,r=new Uint8Array(2);return r[0]=(31&t.profile)<<3|(14&e)>>1,r[1]=(1&e)<<7|(15&i)<<3,r}},90412:(t,e,i)=>{i.d(e,{Ui:()=>s,XC:()=>a,zk:()=>n});var r=i(37246);const n={0:"Main",1:"High",2:"Professional"};function a(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=4){const i=s(e);t.codecpar.profile=i.profile,t.codecpar.level=i.level}}function s(t){const e=new r.A(t.length);e.appendBuffer(t),e.readU1(),e.readU(7);const i=e.readU(3),n=e.readU(5),a=e.readU1();let s=e.readU1()?10:8;return e.readU1()&&(s=12),{profile:i,level:n,tier:a,bitDepth:s,monochrome:e.readU1(),chromaSubsamplingX:e.readU1(),chromaSubsamplingY:e.readU1(),chromaSamplePosition:e.readU(2)}}},20620:(t,e,i)=>{i.d(e,{Jk:()=>y,KD:()=>B,XC:()=>A,ci:()=>k,oT:()=>I,tZ:()=>b});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),h=i(37246),d=i(4624),f=i(14686),l=i(71517),c=i(60264),u=i(37837),g=i(23991),p=i(39381),w="src/avformat/codecs/h264.ts";const U=3,b={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"};function m(t,e,i=[]){t.length>32&&(d.R8(`h264 metadata's sps max length is 32, but get ${t.length}`,w,200),t=t.slice(0,32)),t.length>256&&(d.R8(`h264 metadata's pps max length is 256, but get ${t.length}`,w,204),t=t.slice(0,256));let r=7;r=t.reduce(((t,e)=>t+2+e.length),r),r=e.reduce(((t,e)=>t+2+e.length),r);const n=t[0],o=v(n);66!==o.profile&&77!==o.profile&&88!==o.profile&&(r+=4,i.length&&(r=i.reduce(((t,e)=>t+2+e.length),r)));const h=new Uint8Array(r),f=new s.A(h);return f.writeUint8(1),f.writeUint8(n[1]),f.writeUint8(n[2]),f.writeUint8(n[3]),f.writeUint8(252|U),f.writeUint8(224|31&t.length),a.__(t,(t=>{f.writeUint16(t.length),f.writeBuffer(t)})),f.writeUint8(e.length),a.__(e,(t=>{f.writeUint16(t.length),f.writeBuffer(t)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(f.writeUint8(252|o.chromaFormatIdc),f.writeUint8(248|o.bitDepthLumaMinus8),f.writeUint8(248|o.bitDepthChromaMinus8),i.length&&a.__(i,(t=>{f.writeUint16(t.length),f.writeBuffer(t)}))),h}function I(t){let e,i=(0,c.py)(t),r=!1;if(i.length>1){const t=[],r=[],n=[];i.forEach((e=>{const i=31&e[0];7===i?t.push(e):8===i?r.push(e):13===i&&n.push(e)})),t.length&&r.length&&(e=m(t,r,n)),i=i.filter((t=>{const e=31&t[0];return 9!==e&&8!==e&&7!==e&&13!==e}))}const n=i.reduce(((t,e)=>t+U+1+e.length),0),o=(0,u.sY)(n),h=(0,f.s3)(o,n),d=new s.A(h);return a.__(i,(t=>{3===U?d.writeUint32(t.length):2===U?d.writeUint24(t.length):1===U?d.writeUint16(t.length):d.writeUint8(t.length),d.writeBuffer(t.subarray(0)),5==(31&t[0])&&(r=!0)})),{bufferPointer:o,length:n,key:r,extradata:e}}function y(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,l.iI)(t);if((0,c.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:U;let s=[],h=[],d=[],g=[];const p=new o.A(n);for(;p.remainingSize()>0;){let t=0;t=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const e=n.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=31&e[0];7===i?s.push(e):8===i?h.push(e):13===i?d.push(e):g.push(e)}if(s.length||h.length){const e=m(s,h,d),i=(0,u.sY)(e.length);(0,f.lW)(i,e.length,e),(0,l.Ow)(t,1,i,e.length)}}function k(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,l.iI)(t);if(!(0,c.Bs)(i))return;let a=(0,c.py)(i);if(a.length>1){const e=[],i=[],s=[];if(a.forEach((t=>{const r=31&t[0];7===r?e.push(t):8===r?i.push(t):13===r&&s.push(t)})),e.length&&i.length){const a=m(e,i,s),o=(0,u.sY)(a.length);(0,f.lW)(o,a.length,a),(0,l.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function A(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[4];const{spss:i}=function(t){const e=new o.A(t);e.skip(5);const i=[],r=[],n=[],a=31&e.readUint8();for(let t=0;t<a;t++){const t=e.readUint16();i.push(e.readBuffer(t))}const s=e.readUint8();for(let t=0;t<s;t++){const t=e.readUint16();r.push(e.readBuffer(t))}if(e.remainingSize()>4){e.skip(3);const t=e.readUint8();if(t>0)for(let i=0;i<t;i++){const t=e.readUint16();n.push(e.readBuffer(t))}}return{spss:i,ppss:r,spsExts:n}}(e);if(i.length){const{profile:e,level:r,width:n,height:a}=v(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function B(t,e=4){if(!(1&r.f[15](t+36)))return!1;if(2===r.f[15](t+80))return(0,c.py)((0,f.s3)(r.f[20](t+24),r.f[15](t+28))).some((t=>5==(31&t[0])));{const i=r.f[15](t+28);let n=0;for(;n<i-e;){if(5==(31&p.r8(r.f[20](t+24)+(n+e))))return!0;n+=4===e?p.Sg(r.f[20](t+24)+n):3===e?p.ht(r.f[20](t+24)+n):2===e?p.yd(r.f[20](t+24)+n):p.r8(r.f[20](t+24)+n),n+=e}return!1}}function v(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const i=(0,c.BN)(t.subarray(e)),r=new h.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const n=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const a=r.readU(8);g.xb(r);let s=1,o=0,d=0;if((100==n||110==n||122==n||244==n||44==n||83==n||86==n||118==n||128==n||138==n||139==n||134==n||135==n)&&(s=g.xb(r),3===s&&r.readU1(),o=g.xb(r),d=g.xb(r),r.readU1(),r.readU1())){const t=new Array(8);for(let e=0;e<(3!=s?8:12);e++)t[e]=r.readU1()}g.xb(r);const f=g.xb(r);if(0===f)g.xb(r);else if(1===f){r.readU1(),g.$x(r),g.$x(r);const t=g.xb(r);for(let e=0;e<t;e++)g.$x(r)}g.xb(r),r.readU1();const l=g.xb(r),u=g.xb(r),p=r.readU1();let w=16*(l+1),U=(2-p)*(u+1)*16;p||r.readU1(),r.readU1();const b=r.readU1();if(b){let t=1,e=2-b;1===s?(t=2,e=2*(2-b)):2===b&&(t=2,e=2-b),w-=t*(g.xb(r)+g.xb(r)),U-=e*(g.xb(r)+g.xb(r))}return{profile:n,level:a,width:w,height:U,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:d}}},53e3:(t,e,i)=>{i.d(e,{Jk:()=>m,KD:()=>k,XC:()=>y,ci:()=>I,dT:()=>p,oT:()=>b});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),h=i(37246),d=i(14686),f=i(60264),l=i(71517),c=i(37837),u=i(23991),g=i(39381);const p={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},w=3;function U(t,e,i){const r=e[0];let n=23;t.length&&(n+=3,n=t.reduce(((t,e)=>t+2+e.length),n)),e.length&&(n+=3,n=e.reduce(((t,e)=>t+2+e.length),n)),i.length&&(n+=3,n=i.reduce(((t,e)=>t+2+e.length),n));const o=new Uint8Array(n),h=new s.A(o,!0),d=A(r);h.writeUint8(1),h.writeUint8(r[1]),h.writeUint8(r[2]),h.writeUint8(r[3]),h.writeUint8(r[4]),h.writeUint8(r[5]),h.writeUint8(r[6]),h.writeUint8(r[7]),h.writeUint8(r[8]),h.writeUint8(r[9]),h.writeUint8(r[10]),h.writeUint8(r[11]),h.writeUint8(d.level),h.writeUint8(1020),h.writeUint8(0),h.writeUint8(16320),h.writeUint8(16320|d.chromaFormatIdc),h.writeUint8(8160|d.bitDepthLumaMinus8),h.writeUint8(8160|d.bitDepthChromaMinus8),h.writeUint16(0),h.writeUint8(8|(1&r[0])<<2|w);let f=0;return t.length&&f++,e.length&&f++,i.length&&f++,h.writeUint8(f),t.length&&(h.writeUint8(160),h.writeUint16(t.length),a.__(t,(t=>{h.writeUint16(t.length),h.writeBuffer(t)}))),e.length&&(h.writeUint8(161),h.writeUint16(e.length),a.__(e,(t=>{h.writeUint16(t.length),h.writeBuffer(t)}))),i.length&&(h.writeUint8(162),h.writeUint16(i.length),a.__(i,(t=>{h.writeUint16(t.length),h.writeBuffer(t)}))),o}function b(t){let e,i=!1,r=(0,f.py)(t);if(r.length>2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?i.push(e):34===r&&n.push(e)})),t.length&&i.length&&n.length&&(e=U(t,i,n),r=r.filter((t=>{const e=t[0]>>>1&63;return 32!==e&&33!==e&&34!==e&&35!==e})))}const n=r.reduce(((t,e)=>t+w+1+e.length),0),o=(0,c.sY)(n),h=(0,d.s3)(o,n),l=new s.A(h);return a.__(r,(t=>{3===w?l.writeUint32(t.length):2===w?l.writeUint24(t.length):1===w?l.writeUint16(t.length):l.writeUint8(t.length),l.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;19!==e&&20!==e&&21!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function m(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,l.iI)(t);if((0,f.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:w;let s=[],h=[],u=[];const g=new o.A(n);for(;g.remainingSize()>0;){let t=0;t=3===a?g.readUint32():2===a?g.readUint24():1===a?g.readUint16():g.readUint8();const e=n.subarray(0|Number(0xffffffffn&g.getPos()),(0|Number(0xffffffffn&g.getPos()))+t);g.skip(t);const i=e[0]>>>1&63;33===i?h.push(e):34===i?u.push(e):32===i&&s.push(e)}if(h.length||u.length||s.length){const e=U(s,h,u),i=(0,c.sY)(e.length);(0,d.lW)(i,e.length,e),(0,l.Ow)(t,1,i,e.length)}}function I(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,l.iI)(t);if(!(0,f.Bs)(i))return;let a=(0,f.py)(i);if(a.length>2){const e=[],i=[],s=[];if(a.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?i.push(t):34===r&&s.push(t)})),e.length&&i.length&&s.length){const a=U(e,i,s),o=(0,c.sY)(a.length);(0,d.lW)(o,a.length,a),(0,l.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function y(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[21];const{spss:i}=function(t){const e=new o.A(t,!0);e.skip(22);let i=[],r=[],n=[];const a=e.readUint8();for(let t=0;t<a;t++){const t=63&e.readUint8(),a=e.readUint16(),s=[];for(let t=0;t<a;t++){const t=e.readUint16();s.push(e.readBuffer(t))}32===t?i=s:33===t?r=s:34===t&&(n=s)}return{vpss:i,spss:r,ppss:n}}(e);if(i.length){const{profile:e,level:r,width:n,height:a}=A(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function k(t,e=4){if(!(1&r.f[15](t+36)))return!1;if(2===r.f[15](t+80))return(0,f.py)((0,d.s3)(r.f[20](t+24),r.f[15](t+28))).some((t=>{const e=t[0]>>>1&63;return 20===e||19===e}));{const i=r.f[15](t+28);let n=0;for(;n<i-e;){const i=g.r8(r.f[20](t+24)+(n+e))>>>1&63;if(20===i||19===i)return!0;n+=4===e?g.Sg(r.f[20](t+24)+n):3===e?g.ht(r.f[20](t+24)+n):2===e?g.yd(r.f[20](t+24)+n):g.r8(r.f[20](t+24)+n),n+=e}return!1}}function A(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,a=0,s=0,o=0,d=1,l=0,c=0,g=0,p=0;const w=(0,f.BN)(t.subarray(e)),U=new h.A(w.length);U.appendBuffer(w),U.readU1(),U.readU(6),U.readU(6),U.readU(3),U.readU(4);const b=U.readU(3);if(U.readU1(),b<=6){l=U.readU(2),c=U.readU1(),i=U.readU(5),g=U.readU(32),p=U.readU(48),r=U.readU(8);const t=new Array(6),e=new Array(6);for(let i=0;i<b;i++)t[i]=U.readU1(),e[i]=U.readU1();if(b>0)for(let t=b;t<8;t++)U.readU(2);for(let i=0;i<b;i++)t[i]&&(U.readU(2),U.readU(1),U.readU(5),U.readU(32),U.readU(1),U.readU(1),U.readU(1),U.readU(1),U.readU(44)),e[i]&&U.readU(8);u.xb(U),d=u.xb(U),3===d&&U.readU(1),n=u.xb(U),a=u.xb(U);let h=0,f=0,w=0,m=0;U.readU1()&&(h=u.xb(U),f=u.xb(U),w=u.xb(U),m=u.xb(U)),s=u.xb(U),o=u.xb(U);let I=2,y=2;0===d?I=y=0:2===d?(I=2,y=1):3===d&&(I=y=1),n-=I*(1<<s+1)*(h+f),a-=y*(1<<s+1)*(w+m)}return{profile:i,level:r,width:n,height:a,chromaFormatIdc:d,bitDepthLumaMinus8:s,bitDepthChromaMinus8:o,generalProfileSpace:l,generalTierFlag:c,generalProfileCompatibilityFlag:g,constraintFlags:p}}},58919:(t,e,i)=>{i.d(e,{Ui:()=>s,XC:()=>a,wN:()=>n});var r=i(37246);const n={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function a(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){const i=s(e);t.codecpar.profile=i.profile,t.codecpar.level=i.level}}function s(t){const e=new r.A(t.length);return e.appendBuffer(t),{profile:e.readU(8),level:e.readU(8),bitDepth:e.readU(4),chromaSubsampling:e.readU(3),fullRangeFlag:e.readU1(),colorPrimaries:e.readU(8),colorTrc:e.readU(8),colorSpace:e.readU(8)}}},55611:(t,e,i)=>{i.d(e,{Jk:()=>m,Ui:()=>A,XC:()=>y,ci:()=>I,oT:()=>b});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),h=i(37246),d=i(14686),f=i(60264),l=i(71517),c=i(37837),u=i(23991),g=i(83314);const p=3;function w(t){const e=t.readU(9),i=t.readU(3),r=t.readU(2),n=t.readU(2),a=t.readU(3);t.readU(5),t.readU(2);const s=t.readU(6),o=t.readU(7),h=t.readU(1),d=t.readU(8),f=t.readU(1),l=t.readU(1),c=[],u=[];if(s){for(let e=0;e<s-1;e++)c[e]=t.readU(8);c[s-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let r=i-2;r>=0;--r)e|=t.readU(1)<<r;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let r=i-2;r>=0;--r)e&1<<r&&(u[r]=t.readU(8))}const g=t.readU(8),p=[];if(g)for(let e=0;e<g;e++)p.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:a,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:h,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:f,ptlMultilayerEnabledFlag:l,generalConstraintInfo:c,sublayerLevelIdc:u,generalSubProfileIdc:p,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function U(t,e,i){const r=e[0];let n;if(r){const t=k(r),e=new g.A;if(e.writeU(9,0),e.writeU(3,t.spsMaxSublayersMinus1+1),e.writeU(2,1),e.writeU(2,t.chromaFormatIdc),e.writeU(3,t.bitDepthMinus8),e.writeU(5,31),e.writeU(2,3),e.writeU(6,t.generalConstraintInfo.length),e.writeU(7,t.profile),e.writeU1(t.tierFlag),e.writeU(8,t.level),e.writeU1(t.ptlFrameOnlyConstraintFlag),e.writeU1(t.ptlMultilayerEnabledFlag),t.generalConstraintInfo.length){for(let i=0;i<t.generalConstraintInfo.length-1;i++)e.writeU(8,t.generalConstraintInfo[i]);e.writeU(6,t.generalConstraintInfo[t.generalConstraintInfo.length-1])}else e.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let i=0;for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)i=i<<1|t.ptlSublayerLevelPresentFlag[e];e.writeU(8,i)}for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)t.ptlSublayerLevelPresentFlag[i]&&e.writeU(8,t.sublayerLevelIdc[i]);e.writeU(8,t.generalSubProfileIdc.length);for(let i=0;i<t.generalSubProfileIdc.length;i++)e.writeU(32,t.sublayerLevelIdc[i]);e.writeU(16,t.width),e.writeU(16,t.height),e.writeU(16,0),e.padding(),n=e.getBuffer().subarray(0,e.getPointer())}let o=1+(n?n.length:0);t.length&&(o+=3,o=t.reduce(((t,e)=>t+2+e.length),o)),e.length&&(o+=3,o=e.reduce(((t,e)=>t+2+e.length),o)),i.length&&(o+=3,o=i.reduce(((t,e)=>t+2+e.length),o));const h=new Uint8Array(o),d=new s.A(h,!0);d.writeUint8(p<<1|(n?1:0)|248),n&&d.writeBuffer(n);let f=0;return t.length&&f++,e.length&&f++,i.length&&f++,d.writeUint8(f),t.length&&(d.writeUint8(142),d.writeUint16(t.length),a.__(t,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),e.length&&(d.writeUint8(143),d.writeUint16(e.length),a.__(e,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),i.length&&(d.writeUint8(144),d.writeUint16(i.length),a.__(i,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),h}function b(t){let e,i=!1,r=(0,f.py)(t);if(r.length>2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[0]>>>1&63;14===r?t.push(e):15===r?i.push(e):16===r&&n.push(e)})),t.length&&i.length&&n.length&&(e=U(t,i,n),r=r.filter((t=>{const e=t[0]>>>1&63;return 14!==e&&15!==e&&16!==e&&20!==e})))}const n=r.reduce(((t,e)=>t+p+1+e.length),0),o=(0,c.sY)(n),h=(0,d.s3)(o,n),l=new s.A(h);return a.__(r,(t=>{3===p?l.writeUint32(t.length):2===p?l.writeUint24(t.length):1===p?l.writeUint16(t.length):l.writeUint8(t.length),l.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;8!==e&&7!==e&&9!==e&&10!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function m(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,l.iI)(t);if((0,f.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:p;let s=[],h=[],u=[];const g=new o.A(n);for(;g.remainingSize()>0;){let t=0;t=3===a?g.readUint32():2===a?g.readUint24():1===a?g.readUint16():g.readUint8();const e=n.subarray(0|Number(0xffffffffn&g.getPos()),(0|Number(0xffffffffn&g.getPos()))+t);g.skip(t);const i=e[0]>>>1&63;15===i?h.push(e):16===i?u.push(e):14===i&&s.push(e)}if(h.length||u.length||s.length){const e=U(s,h,u),i=(0,c.sY)(e.length);(0,d.lW)(i,e.length,e),(0,l.Ow)(t,1,i,e.length)}}function I(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,l.iI)(t);if(!(0,f.Bs)(i))return;let a=(0,f.py)(i);if(a.length>2){const e=[],i=[],s=[];if(a.forEach((t=>{const r=t[0]>>>1&63;14===r?e.push(t):15===r?i.push(t):16===r&&s.push(t)})),e.length&&i.length&&s.length){const a=U(e,i,s),o=(0,c.sY)(a.length);(0,d.lW)(o,a.length,a),(0,l.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function y(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=e[0]>>>1&3;const{spss:i}=function(t){const e=new o.A(t,!0);if(1&e.readUint8()){const i=new h.A;i.appendBuffer(t.subarray(1)),w(i),e.skip(i.getPos())}let i=[],r=[],n=[];const a=e.readUint8();for(let t=0;t<a;t++){const t=31&e.readUint8();let a=1;13!==t&&12!==t&&(a=e.readUint16());const s=[];for(let t=0;t<a;t++){const t=e.readUint16();s.push(e.readBuffer(t))}14===t?i=s:15===t?r=s:16===t&&(n=s)}return{vpss:i,spss:r,ppss:n}}(e);if(i.length){const{profile:e,level:r,width:n,height:a}=k(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function k(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,a=0,s=0,o=1,d=0,l=0,c=0;const g=[],p=[],w=[],U=[],b=(0,f.BN)(t.subarray(e)),m=new h.A(b.length);m.appendBuffer(b),m.readU1(),m.readU1(),m.readU(6),m.readU(5),m.readU(3),m.readU(8);const I=m.readU(3);o=m.readU(2);const y=m.readU(2);if(m.readU(1)){if(i=m.readU(7),d=m.readU(1),r=m.readU(8),l=m.readU(1),c=m.readU(1),m.readU(1)){for(let t=0;t<8;t++)g[t]=m.readU(8);g[8]=m.readU(7);const t=m.readU(8);m.readU(t)}m.skipPadding();for(let t=I-1;t>=0;t--)p[t]=m.readU(1);m.skipPadding();for(let t=I-1;t>=0;t--)p[t]&&(w[t]=m.readU(8));const t=m.readU(8);if(t)for(let e=0;e<t;e++)U[e]=m.readU(32)}m.readU1(),m.readU1()&&m.readU1();const k=n=u.xb(m),A=a=u.xb(m);if(m.readU1()&&(u.xb(m),u.xb(m),u.xb(m),u.xb(m)),m.readU1()){const t=u.xb(m),e=y+5,i=1<<e,r=k/(1<<e),n=A/(1<<e),a=Math.ceil(Math.log2(r)),s=Math.ceil(Math.log2(n));let o=0,h=0,d=0;t>0&&(d=m.readU1(),h=m.readU1());for(let e=0;t>0&&e<=t;e++)h&&0!=e||(e>0&&k>i&&m.readU(a),e>0&&A>i&&m.readU(s),e<t&&k>i&&m.readU(a),e<t&&A>i&&m.readU(s)),d||m.readU(2);if(o=u.xb(m)+1,m.readU(1)&&m.readU(1))for(let e=0;e<=t;e++)m.readU(o)}return s=u.xb(m),{profile:i,level:r,width:n,height:a,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:d,generalConstraintInfo:g,generalSubProfileIdc:U,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:c,spsMaxSublayersMinus1:I,ptlSublayerLevelPresentFlag:p,sublayerLevelIdc:w}}function A(t){const e=new h.A;return e.appendBuffer(t),1&e.readU(8)?w(e):{}}},28773:(t,e,i)=>{i.r(e),i.d(e,{default:()=>P});var r=i(134),n=i(63939),a=i(50932),s=i(58121),o=i(68243),h=i(4624),d=i(35028),f=i(20620),l=i(58469),c=i(53e3),u=i(55611),g=i(90412),p=i(58919),w=i(9705),U=i(85947),b=i(14686),m=i(37837),I=i(71517),y=i(65977),k=i(44328),A=i(77231),B=i(72739),v=i(52071),M="src/avformat/formats/IFlvFormat.ts";class P extends U.A{constructor(t={}){super(),(0,r.A)(this,"type",0),(0,r.A)(this,"header",void 0),(0,r.A)(this,"script",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"firstTagPos",void 0),this.header=new s.A,this.script=new o.A,this.options=t}init(t){t.ioReader&&t.ioReader.setEndian(!0)}async readHeader(t){try{if("FLV"!==await t.ioReader.peekString(3))return h.z3("the file format is not flv",M,101),w.LR;await this.header.read(t.ioReader),0!==await t.ioReader.readUint32()&&h.R8("the previousTagSize0 is not 0",M,108);let e=0;if(18===await t.ioReader.peekUint8()){await t.ioReader.skip(1);const i=await t.ioReader.readUint24();await t.ioReader.skip(7),e=await this.script.read(t.ioReader,i)}return e>=0&&(this.firstTagPos=t.ioReader.getPos()),e}catch(e){return h.z3(e.message,M,126),t.ioReader.error}}async readCodecConfigurationRecord(t,e,i){const r=(0,m.sY)(i);e.codecpar.extradata=r,e.codecpar.extradataSize=i,await t.ioReader.readBuffer(i,(0,b.JW)(r,i)),e.sideData[1]=(0,b.s3)(r,i).slice(),27===e.codecpar.codecId?f.XC(e):173===e.codecpar.codecId?c.XC(e):196===e.codecpar.codecId?u.XC(e):225===e.codecpar.codecId?g.XC(e):167===e.codecpar.codecId&&p.XC(e)}async readAVPacketData(t,e,i,r){const n=(0,m.sY)(r);(0,I.NX)(i,n,r),await t.ioReader.readBuffer(r,(0,b.JW)(n,r)),27===e.codecpar.codecId?(f.Jk(i,e),a.M[15](i+80,1)):173===e.codecpar.codecId?(c.Jk(i,e),a.M[15](i+80,1)):196===e.codecpar.codecId&&(u.Jk(i,e),a.M[15](i+80,1))}async readAVPacket_(t,e){const i=t.ioReader.getPos();a.M[17](e+56,i);const r=await t.ioReader.readUint8(),s=await t.ioReader.readUint24();let o=await t.ioReader.readUint24();const f=await t.ioReader.readUint8();if(f&&(o|=f<<24),a.M[17](e+16,BigInt(Math.floor(o))),a.M[17](e+8,BigInt(Math.floor(o))),await t.ioReader.skip(3),8===r){let i=t.getStreamByMediaType(1);i&&a.M[15](e+32,i.index);const r=await t.ioReader.readUint8();if(i)if(86018===i.codecpar.codecId){if(0===await t.ioReader.readUint8()){const i=s-2,r=(0,m.sY)(i);(0,I.Ow)(e,1,r,i),await t.ioReader.readBuffer(i,(0,b.JW)(r,i))}else await this.readAVPacketData(t,i,e,s-2);a.M[15](e+36,1|n.f[15](e+36))}else await this.readAVPacketData(t,i,e,s-1);else{i=t.createStream(),a.M[15](e+32,i.index),i.codecpar.codecType=1,i.timeBase.den=1e3,i.timeBase.num=1,i.startTime=n.f[17](e+8)||n.f[17](e+16),this.script.onMetaData.duration&&(i.duration=BigInt(Math.floor(1e3*this.script.onMetaData.duration))),i.codecpar.chLayout.nbChannels=1&~r?1:2,i.codecpar.sampleRate=44100<<((12&r)>>>2)>>3,i.codecpar.bitsPerCodedSample=2&r?16:8;const o=(240&r)>>4;if(i.codecpar.codecId=0===o||3===o?8===i.codecpar.bitsPerCodedSample?65541:65536:d.FJ[o],86018===i.codecpar.codecId){if(0===await t.ioReader.readUint8()){const e=s-2,r=(0,m.sY)(e);i.codecpar.extradata=r,i.codecpar.extradataSize=e,await t.ioReader.readBuffer(e,(0,b.JW)(r,e)),i.sideData[1]=(0,b.s3)(r,e).slice(),l.XC(i)}else await this.readAVPacketData(t,i,e,s-2);a.M[15](e+36,1|n.f[15](e+36))}else 86051===i.codecpar.codecId?(i.codecpar.sampleRate=16e3,i.codecpar.chLayout.nbChannels=1):65543!==i.codecpar.codecId&&65542!==i.codecpar.codecId||(i.codecpar.sampleRate=8e3),await this.readAVPacketData(t,i,e,s-1);this.onStreamAdd&&this.onStreamAdd(i)}}else{if(9!==r){if(18===r){let i=await this.script.read(t.ioReader,s);return i<0?i:await this.readAVPacket_(t,e)}return h.R8(`invalid tag type: ${r}, try to sync to next tag`,M,458),await this.syncTag(t),this.readAVPacket_(t,e)}{let i=t.getStreamByMediaType(0);i&&a.M[15](e+32,i.index);const r=await t.ioReader.readUint8();if(i)if((112&r)>>4==1&&a.M[15](e+36,1|n.f[15](e+36)),128&r){await t.ioReader.skip(4);const o=15&r;if(173!==i.codecpar.codecId&&196!==i.codecpar.codecId||a.M[15](e+80,1),0===o){const i=s-5,r=(0,m.sY)(i);(0,I.Ow)(e,1,r,i),await t.ioReader.readBuffer(i,(0,b.JW)(r,i))}else if(2===o)a.M[15](e+36,32|n.f[15](e+36));else if(1===o||3===o)if(1!==o||173!==i.codecpar.codecId&&196!==i.codecpar.codecId)await this.readAVPacketData(t,i,e,s-5);else{const r=await t.ioReader.readUint24();a.M[17](e+8,n.f[17](e+16)+BigInt(Math.floor(r))),await this.readAVPacketData(t,i,e,s-8)}}else if(27===i.codecpar.codecId||173===i.codecpar.codecId||12===i.codecpar.codecId){a.M[15](e+80,1);const r=await t.ioReader.readUint8(),o=await t.ioReader.readUint24();if(a.M[17](e+8,n.f[17](e+16)+BigInt(Math.floor(o))),0===r){const i=s-5,r=(0,m.sY)(i);(0,I.Ow)(e,1,r,i),await t.ioReader.readBuffer(i,(0,b.JW)(r,i))}else 2===r?a.M[15](e+36,32|n.f[15](e+36)):await this.readAVPacketData(t,i,e,s-5)}else await this.readAVPacketData(t,i,e,s-1);else{if(i=t.createStream(),a.M[15](e+32,i.index),i.codecpar.codecType=0,i.timeBase.den=1e3,i.timeBase.num=1,i.startTime=n.f[17](e+8)||n.f[17](e+16),this.script.onMetaData.duration&&(i.duration=BigInt(Math.floor(1e3*this.script.onMetaData.duration))),this.script.onMetaData.width>0&&(i.codecpar.width=this.script.onMetaData.width),this.script.onMetaData.height>0&&(i.codecpar.height=this.script.onMetaData.height),(112&r)>>4==1&&a.M[15](e+36,1|n.f[15](e+36)),128&r){const o=await t.ioReader.readUint32();o===(0,y.A)("hvc1")&&(i.codecpar.codecId=173,a.M[15](e+80,1)),o===(0,y.A)("vvc1")?(i.codecpar.codecId=196,a.M[15](e+80,1)):o===(0,y.A)("av01")?i.codecpar.codecId=225:o===(0,y.A)("vp09")&&(i.codecpar.codecId=167);const h=15&r;if(0===h)await this.readCodecConfigurationRecord(t,i,s-5);else if(2===h)a.M[15](e+36,32|n.f[15](e+36));else if(1===h||3===h)if(1!==h||173!==i.codecpar.codecId&&196!==i.codecpar.codecId)await this.readAVPacketData(t,i,e,s-5);else{const r=await t.ioReader.readUint24();a.M[17](e+8,n.f[17](e+16)+BigInt(Math.floor(r))),await this.readAVPacketData(t,i,e,s-8)}}else if(i.codecpar.codecId=d.U5[15&r],27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId||12===i.codecpar.codecId){a.M[15](e+80,1);const r=await t.ioReader.readUint8(),o=await t.ioReader.readUint24();a.M[17](e+8,n.f[17](e+16)+BigInt(Math.floor(o))),0===r?await this.readCodecConfigurationRecord(t,i,s-5):2===r?a.M[15](e+36,32|n.f[15](e+36)):await this.readAVPacketData(t,i,e,s-5)}else await this.readAVPacketData(t,i,e,s-1);this.onStreamAdd&&this.onStreamAdd(i)}}}const c=t.ioReader.getPos()-i,u=BigInt(Math.floor(await t.ioReader.readUint32()));return c!==u?(h.R8(`tag ${r} size not match, size: ${c}, previousTagSize: ${u}`,M,467),w.LR):0}async readAVPacket(t,e){try{return a.M[15](e+76,1e3),a.M[15](e+72,1),await this.readAVPacket_(t,e)}catch(e){return-1048576!==t.ioReader.error&&h.z3(e.message,M,483),t.ioReader.error}}async syncTag(t){let e=A.Dh;for(;;)try{const i=await t.ioReader.readUint8();if(8===i||9===i){e=t.ioReader.getPos()-BigInt(1);const i=await t.ioReader.readUint24();if(i>10485760){await t.ioReader.seek(e+BigInt(1));continue}await t.ioReader.skip(7+i);if(t.ioReader.getPos()-e!==BigInt(Math.floor(await t.ioReader.readUint32()))){await t.ioReader.seek(e+BigInt(1)),e=A.Dh;continue}{let i=0;for(;i<=3;){const e=t.ioReader.getPos(),r=await t.ioReader.readUint8();if(8!==r&&9!==r&&18!==r)break;{const r=await t.ioReader.readUint24();await t.ioReader.skip(7+r);if(t.ioReader.getPos()-e!==BigInt(Math.floor(await t.ioReader.readUint32())))break;i++}}if(!(i<3))break;await t.ioReader.seek(e+BigInt(1)),e=A.Dh}}}catch(t){break}e!==A.Dh&&await t.ioReader.seek(e)}async seek(t,e,i,r){const n=t.ioReader.getPos();if(2&r)return await t.ioReader.seek(i),4&r||await this.syncTag(t),n;if(e&&e.sampleIndexes.length){let r=B.El(e.sampleIndexes,(t=>t.pts>i?-1:1));if(r>0&&(0,k.k)(i-e.sampleIndexes[r-1].pts,e.timeBase,A.i0)<BigInt(1e4))return h.Yz(`seek in sampleIndexes, found index: ${r}, pts: ${e.sampleIndexes[r-1].pts}, pos: ${e.sampleIndexes[r-1].pos}`,M,581),await t.ioReader.seek(e.sampleIndexes[r-1].pos),n}if(this.script.canSeek()){const{pos:r,dts:a}=this.script.dts2Position(Number((0,k.k)(i,e.timeBase,A.i0)/BigInt(1e3)));if(r>0){h.Yz(`seek in filepositions, found pts: ${a}, pos: ${r}`,M,590),await t.ioReader.seek(BigInt(Math.floor(r)));const e=await t.ioReader.peekUint8();return 8!==e&&9!==e&&18!==e&&await this.syncTag(t),n}}return h.Yz("not found any keyframe index, try to seek in bytes",M,600),(0,v.A)(t,e,i,this.firstTagPos,this.readAVPacket.bind(this),this.syncTag.bind(this))}getAnalyzeStreamsCount(){let t=0;return this.header.hasAudio&&t++,this.header.hasVideo&&t++,t}}},85947:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}destroy(t){}}},58121:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(){(0,r.A)(this,"signature",void 0),(0,r.A)(this,"version",void 0),(0,r.A)(this,"flags",void 0),(0,r.A)(this,"dataOffset",void 0),(0,r.A)(this,"hasVideo",void 0),(0,r.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(t){this.signature=await t.readString(3),this.version=await t.readUint8(),this.flags=await t.readUint8(),this.dataOffset=await t.readUint32(),this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags)}write(t){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),t.writeString(this.signature),t.writeUint8(this.version),t.writeUint8(this.flags),t.writeUint32(this.dataOffset)}}},68243:(t,e,i)=>{i.d(e,{A:()=>c});var r=i(134),n=i(35336),a=i(67672),s=i(72739),o=i(95335),h=i(92647),d=i(4624),f=i(94889),l=i(9705);class c{constructor(){(0,r.A)(this,"onMetaData",void 0),this.onMetaData={audiocodecid:10,canSeekToEnd:!1,width:0,height:0,stereo:!0,videocodecid:7}}async parseObject(t,e){return{key:await t.readString(await t.readUint16()),value:await this.parseValue(t,e)}}async parseValue(t,e){let i;switch(await t.readUint8()){case 0:i=await t.readDouble();break;case 1:i=!!await t.readUint8();break;case 2:i=await t.readString(await t.readUint16());break;case 3:for(i={};t.getPos()<e;){const{key:r,value:n}=await this.parseObject(t,e);if(i[r]=n,9==(16777215&await t.peekUint24())){await t.skip(3);break}}break;case 8:for(i={},await t.skip(4);t.getPos()<e;){const{key:r,value:n}=await this.parseObject(t,e);if(i[r]=n,9==(16777215&await t.peekUint24())){await t.skip(3);break}}break;case 9:i=null;break;case 10:i=[];const r=await t.readUint32();for(let n=0;n<r;n++)i.push(await this.parseValue(t,e));break;case 11:const n=await t.readDouble(),a=await t.readInt16();i=new Date(n+60*a*1e3);break;case 12:i=await t.readString(await t.readUint32())}return i}async read(t,e){const i=t.getPos(),r=i+BigInt(Math.floor(e)),n=await this.parseValue(t,r),a=await this.parseValue(t,r);this[n]=a;const s=Number(t.getPos()-i),o=await t.readUint32();return s+11!==o?(d.R8(`script size not match, size: ${s+11}, previousTagSize: ${o}`,"src/avformat/formats/flv/FlvScriptTag.ts",150),l.LR):0}writeValue(t,e){a.ai(e)?(t.writeUint8(0),t.writeDouble(e)):a.o(e)?(t.writeUint8(0),t.writeDouble(Number(e))):a.zM(e)?(t.writeUint8(1),t.writeUint8(e?1:0)):a.Yj(e)?e.length>=65536?(t.writeUint8(12),t.writeUint32(e.length),t.writeString(e)):(t.writeUint8(2),t.writeUint16(e.length),t.writeString(e)):a.YO(e)?(t.writeUint8(10),t.writeUint32(e.length),s.__(e,(e=>{this.writeValue(t,e)}))):a.Ik(e)?(t.writeUint8(3),o.__(e,((e,i)=>{t.writeUint16(i.length),t.writeString(i),this.writeValue(t,e)})),t.writeUint24(9)):e instanceof Date&&(t.writeUint8(11),t.writeDouble(e.getTime()),t.writeInt16(0))}computeSize(){const t=[],e=new n.A;return e.onFlush=e=>(t.push(e.slice()),0),this.writeValue(e,"onMetaData"),this.writeValue(e,this.onMetaData),e.flush(),(0,h.A)(Uint8Array,t).length}write(t){if(this.onMetaData){const e=[],i=new n.A;i.onFlush=t=>(e.push(t.slice()),0),this.writeValue(i,"onMetaData"),this.writeValue(i,this.onMetaData),i.flush();const r=(0,h.A)(Uint8Array,e),a=t.getPos();f.xk(t,18,r.length,BigInt(0)),t.writeBuffer(r),t.writeUint32(Number(t.getPos()-a))}}dts2Position(t){if(this.canSeek()){let e=-1;const i=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let n;for(n=0;n<i.length;n++){if(i[n]===t){e=n;break}if(i[n]>t){e=Math.max(n-1,0);break}}return n&&n===i.length&&(e=i.length-1),{pos:r[e],dts:i[e]}}return{pos:-1,dts:-1}}position2DTS(t){if(this.canSeek()){let i=-1;const r=this.onMetaData.keyframes.times,n=this.onMetaData.keyframes.filepositions;let a=0;for(a=0;a<n.length;a++)if(n[a]>t){i=a;break}var e;return a===n.length?null!==(e=this.onMetaData.duration)&&void 0!==e?e:r[r.length-1]:r[i]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},35028:(t,e,i)=>{i.d(e,{FJ:()=>r,U5:()=>n});const r={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},n={7:27,12:173,13:196,9:12,2:4,3:86,4:92,5:106,6:131}},94889:(t,e,i)=>{function r(t,e,i,r){t.writeUint8(e),t.writeUint24(i),t.writeUint24(Number(r&BigInt(16777215))),t.writeUint8(Number(r>>BigInt(24)&BigInt(255))),t.writeUint24(0)}i.d(e,{xk:()=>r})},2187:(t,e,i)=>{i.d(e,{d:()=>s});var r=i(72739),n=i(44328),a=i(77231);function s(t,e,i){let s=BigInt(0);return r.__(t,(t=>{s+=t.codecpar.bitRate*(0,n.k)(e,i,a.i0)/BigInt(8e3)})),s}},65977:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(4624),n="src/avformat/function/mktag.ts";function a(t){4!==t.length&&r.R8(`tag length is not 4, tag: ${t}`,n,30);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},52071:(t,e,i)=>{i.d(e,{A:()=>u});var r=i(63939),n=i(9599),a=i(29170),s=i(77231),o=i(44328),h=i(2187),d=i(71517),f=i(9705),l=i(4624),c="src/avformat/function/seekInBytes.ts";async function u(t,e,i,u,g,p){const w=t.ioReader.getPos(),U=await t.ioReader.fileSize();let b=s.Dh,m=i;e.startTime!==s.Dh?m-=e.startTime:m-=e.firstDTS;const I=(0,o.k)(i,e.timeBase,s.i0);if(I<BigInt(1e4))return l.Yz(`seek pts is earlier then 10s, seek to first packet pos(${u}) directly`,c,63),await t.ioReader.seek(u),w;let y=(0,h.d)(t.streams,m,e.timeBase);const k=U-(0,h.d)(t.streams,BigInt(5e3),s.i0),A=(0,h.d)(t.streams,BigInt(1e4),s.i0);if(y>k&&(y=k),y<u)return await t.ioReader.seek(u),w;const B=(0,d._5)();let v=U,M=BigInt(0);for(;;){if(v-M<A){b=M;break}await t.ioReader.seek(y),await p(t);const e=t.ioReader.getPos();if(!(await g(t,B)>=0))break;{const t=(0,o.k)(r.f[17](B+8),(0,a.A)(B+72,n.P),s.i0),i=t-I;if(l.Yz(`try to seek to pos: ${y}, got packet pts: ${r.f[17](B+8)}(${t}ms), diff: ${i}ms`,c,98),i<=BigInt(0)&&-i<BigInt(1e4)){b=e;break}i>BigInt(0)?(v=y,y=M+v>>BigInt(1)):(M=y,y=M+v>>BigInt(1))}}return(0,d.Qe)(B),b!==s.Dh?(l.Yz(`finally seek to pos ${b}`,c,124),await t.ioReader.seek(b),await p(t),w):(await t.ioReader.seek(w),BigInt(f.E$))}},null:()=>{},23991:(t,e,i)=>{function r(t){let e=0,i=0;for(;i<32&&0===t.readU1();)i++;return e=t.readU(i),e+=(1<<i)-1,e}function n(t){let e=r(t);return e=1&e?(e+1)/2:-e/2,e}i.d(e,{$x:()=>n,xb:()=>r})},39381:(t,e,i)=>{i.d(e,{E3:()=>a,Sg:()=>d,Y0:()=>h,ht:()=>o,r8:()=>n,yd:()=>s});var r=i(63939);function n(t){return r.f[2](t)}function a(t){return n(t+1)<<8|n(t)}function s(t){return n(t)<<8|n(t+1)}function o(t){return n(t)<<16|n(t+1)<<8|n(t+2)}function h(t){return a(t+2)<<16|a(t)}function d(t){return s(t)<<16|s(t+2)}},60264:(t,e,i)=>{function r(t){return t.length>4&&0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])}function n(t,e){let i=0;for(let r=e;r<t.length;r++)switch(t[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function a(t){const e=[];let i=n(t,0),r={offset:-1,startCode:0};for(;r=n(t,i.offset+i.startCode),r.offset>-1;)e.push(t.subarray(i.offset+i.startCode,r.offset,!0)),i=r;return e.push(t.subarray(i.offset+i.startCode,void 0,!0)),e}function s(t,e=0,i){i||(i=t.length);const r=new Uint8Array(t.length);let n=0,a=0;for(let s=0;s<t.length;s++){if(s>=e&&s<i)if(0===t[s])n++;else if(3===t[s]&&2===n&&s+1<t.length&&t[s+1]<=3){if(s++,s===t.length)break;n=0===t[s]?1:0}else n=0;r[a++]=t[s]}return r.slice(0,a)}i.d(e,{BN:()=>s,Bs:()=>r,py:()=>a})},37246:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(134),n=i(4624);class a{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=t,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let t=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let e=this.pointer,i=this.bitsLeft;return 0===i&&(e++,i=8),t=this.buffer[e]>>i-1&1,t}readU1(){let t=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,t=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),t}readU(t){let e=0;for(let i=0;i<t;i++)e|=this.readU1()<<t-i-1;return e}remainingLength(){return this.endPointer-this.pointer}getPos(){return this.pointer}skip(t){const e=(t-t%8)/8;this.pointer+=e;const i=t%8;this.bitsLeft<=i?(this.pointer++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const t=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(t<0)throw this.error=t,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+t,this.pointer=0}else{const t=this.onFlush(this.buffer);if(this.endPointer=t,this.pointer=0,this.bitsLeft=8,t<0)throw this.error=t,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const e=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,e),this.endPointer),this.endPointer+=e,n.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",190)}}clear(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}},83314:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=t,this.error=0,this.buffer=new Uint8Array(this.size)}writeU1(t){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&t?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}writeU(t,e){for(let i=0;i<t;i++)this.writeU1(e>>t-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const t=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}clear(){this.pointer=0,this.bitPointer=0,this.error=0}getBuffer(){return this.buffer}getPointer(){return this.pointer}}},729:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(134),n=i(4624),a=i(50011);class s{constructor(t,e=!0){(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}writeUint8(t){this.data.setUint8(this.pos+++this.byteStart,t)}writeUint16(t){this.data.setUint16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeUint24(t){const e=3840&t,i=240&t,r=15&t;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(e)):(this.writeUint8(e),this.writeUint8(i),this.writeUint8(r))}writeUint32(t){this.data.setUint32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeUint64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(e)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(e)))}writeInt8(t){this.data.setInt8(this.pos+++this.byteStart,t)}writeInt16(t){this.data.setInt16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeInt32(t){this.data.setInt32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeInt64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(e)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(e)))}writeFloat(t){this.data.setFloat32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeDouble(t){this.data.setFloat64(this.pos+this.byteStart,t,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(t){t>this.size&&(t=this.size),this.pos=Math.max(0,t)}skip(t){this.seek(this.pos+t)}back(t){this.seek(this.pos-t)}remainingSize(){return this.size-this.pos}writeBuffer(t){let e=t.length;this.remainingSize()<e&&(e=this.remainingSize(),n.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${t.length}, but set ${e}`,"src/common/io/BufferWriter.ts",211)),this.buffer.set(t,this.pos),this.pos+=t.length}writeString(t){const e=a.encode(t);return this.writeBuffer(e),e.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(t,e=!0){this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}}},35336:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(134),n=i(50011);class a{constructor(t=1048576,e=!0,i){if((0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),(0,r.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=t,this.littleEndian=!e,this.error=0,i&&i.view)this.size=i.length,this.buffer=i,this.data=i.view;else if(i&&!i.byteOffset)this.size=i.length,this.buffer=i,this.data=new DataView(this.buffer.buffer);else{if(i)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(t){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,t),this.pointer++,this.pos++}writeUint16(t){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,t,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(t){this.remainingLength()<3&&this.flush();const e=(16711680&t)>>16,i=(65280&t)>>8,r=255&t;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(e)):(this.writeUint8(e),this.writeUint8(i),this.writeUint8(r))}writeUint32(t){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,t,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(t){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,t,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(t){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,t),this.pointer++,this.pos++}writeInt16(t){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,t,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt32(t){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,t,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(t){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,t,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(t){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,t,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(t){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,t,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(t){if(!t.length)return;let e=t.length;if(this.remainingLength()<e){let i=0;for(;e>0;){this.flush();const r=Math.min(this.size,e);this.buffer.set(t.subarray(i,i+r),this.pointer),this.pointer+=r,this.pos+=BigInt(r),i+=r,e-=r}}else this.buffer.set(t,this.pointer),this.pointer+=e,this.pos+=BigInt(e)}writeString(t){const e=n.encode(t);return this.writeBuffer(e),e.length}encodeString(t){return n.encode(t)}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(t){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer),t);if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}seek(t){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const e=this.onSeek(t);if(0!==e)throw this.error=e,Error("IOWriter error, seek failed");this.pos=t}seekInline(t){const e=this.pointer;this.pointer=Math.max(0,Math.min(this.size,t)),this.pos+=BigInt(this.pointer-e)}skip(t){const e=this.pointer;this.pointer=Math.min(this.size,this.pointer+t),this.pos+=BigInt(this.pointer-e)}back(t){const e=this.pointer;this.pointer=Math.max(0,this.pointer-t),this.pos+=BigInt(this.pointer-e)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(t){this.littleEndian=!t}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}}}]);