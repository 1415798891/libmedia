"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[522],{64436:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(134),a=s(63939),i=s(37837),n=s(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,i.Gy)(168),(0,n.Yi)(this.inCodecpar,e),this.inTimeBase={den:a.f[15](t+4),num:a.f[15](t)},0}destroy(){this.inCodecpar&&((0,n.dn)(this.inCodecpar),this.inCodecpar=0)}}},56397:(e,t,s)=>{s.d(t,{A:()=>y});var r=s(134),a=s(63939),i=s(50932),n=s(64436),o=s(14686),c=s(4624),d=s(9705),p=s(77231),u=s(44328),h=s(37837),l=s(71517),m=s(75294),f=s(89088),g=s(92647);class y extends n.A{constructor(...e){super(...e),(0,r.A)(this,"frameHeader",void 0),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.frameHeader=new m.Vz,0}sendAVPacket(e){let t=0,s=this.lastDts||a.f[17](e+16)||a.f[17](e+8),r=(0,o.s3)(a.f[20](e+24),a.f[15](e+28)).slice(),i=!1,n=!!this.cache;for(n&&(r=(0,g.A)(Uint8Array,[this.cache,r]),this.cache=null);t<r.length;){const o=r[t]<<4|r[t+1]>>4&14;if(4094!==o)return c.z3(`found syncWord not 0xFFE, got: 0x${o.toString(16)}`,"src/avformat/bsf/mp3/Mp32RawFilter.ts",82),d.LR;const h=r[1]>>>3&3,l=(12&r[2])>>>2,g={dts:s,buffer:null,extradata:null,duration:p.N_},y=f.Y2(h,l);m.qg(this.frameHeader,r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3]);let v=m.CM(this.frameHeader,y);if(g.buffer=r.subarray(t,t+v),t+v>r.length){this.cache=r.subarray(t),this.lastDts=s;break}const A=(0,u.k)(BigInt(Math.floor(v/y*p.SF)),p.KR,this.inTimeBase);g.duration=Number(A),this.caches.push(g),t+=v,s+=A,!i&&n&&(i=!0,s=a.f[17](e+16)||a.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,l.Up)(e);const t=this.caches.shift(),s=(0,h.sY)(t.buffer.length);return(0,o.lW)(s,t.buffer.length,t.buffer),(0,l.NX)(e,s,t.buffer.length),i.M[17](e+16,t.dts),i.M[17](e+8,t.dts),i.M[17](e+48,BigInt(Math.floor(t.duration))),i.M[15](e+36,1|a.f[15](e+36)),0}return d.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),0}}},58469:(e,t,s)=>{s.d(t,{Bq:()=>u,Ij:()=>p,XC:()=>d,f7:()=>h,uF:()=>i});var r=s(77231),a=s(37246);const i={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],c=[r.N_,1,2,3,4,5,6,7];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:s,sampleRate:a,channels:i}=function(e){let t=r.N_,s=r.N_,a=r.N_;var i,n;return e.length>=2&&(t=e[0]>>3&31,s=null!==(i=o[(7&e[0])<<1|e[1]>>7])&&void 0!==i?i:48e3,a=null!==(n=c[e[1]>>3&15])&&void 0!==n?n:2),{profile:t,sampleRate:s,channels:a}}(t);e.codecpar.profile=s,e.codecpar.sampleRate=a,e.codecpar.chLayout.nbChannels=i}}function p(e){const t=n[e.sampleRate],s=e.chLayout.nbChannels,r=new Uint8Array(2);return r[0]=(31&e.profile)<<3|(14&t)>>1,r[1]=(1&t)<<7|(15&s)<<3,r}function u(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const s=1&e[1],r=(192&e[2])>>>6,a=(60&e[2])>>>2,i=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let p=1===s?7:9,u=n-p;return{syncWord:t,profile:r+1,sampleRate:o[a],channels:c[i],aacFrameLength:n,numberOfRawDataBlocksInFrame:d,headerLength:p,framePayloadLength:u}}function h(e,t){function s(){const e=t.readU(2);let s=0;for(let r=0;r<=e;r++)s<<=8,s|=t.readU(8);return s}t||(t=new a.A).appendBuffer(e);const r=t.getPointer(),i={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;i.syncWord=n,i.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(i.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&s(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let r=e?s():0;const a=t.readU(5);r-=5;const n=t.readU(4);r-=4;const d=t.readU(4);if(r-=4,t.readU(3),r-=3,r>0&&t.readU(r),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)s();else{let e=0;for(;;){e<<=8;const s=1===t.readU1();if(e+=t.readU(8),!s)break}}1===t.readU1()&&t.readU(8),i.profile=a+1,i.sampleRate=o[n],i.channels=c[d]}let p=0;for(;;){const e=t.readU(8);if(p+=e,255!==e)break}return i.framePayloadLength=p,i.headerLength=t.getPointer()-r+(8===t.getBitLeft()?0:1),i}},89088:(e,t,s)=>{s.d(t,{Au:()=>v,He:()=>A,XC:()=>x,Y2:()=>f,hG:()=>g,oz:()=>y});var r=s(77231);const a=[44100,48e3,32e3,0],i=[22050,24e3,16e3,0],n=[11025,12e3,8e3,0],o=[0,1152,1152,384],c=[0,576,1152,384],d=[0,576,1152,384],p=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],u=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],h=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],l=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],m=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function f(e,t){switch(e){case 0:return n[t];case 2:return i[t];case 3:return a[t]}return r.N_}function g(e,t){switch(e){case 0:return d[t];case 2:return c[t];case 3:return o[t]}return r.N_}function y(e,t,s){switch(t){case 1:switch(e){case 0:case 2:return m[s];case 3:return h[s]}break;case 2:switch(e){case 0:case 2:return m[s];case 3:return u[s]}case 3:switch(e){case 0:case 2:return l[s];case 3:return p[s]}}return r.N_}function v(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return r.N_}const A={32:"Layer1",33:"Layer2",34:"Layer3"};function x(e,t){if(t&&t.length>=4){const s=t[1]>>>3&3,r=(6&t[1])>>1,a=(12&t[2])>>>2,i=3&~(t[3]>>>6)?2:1,n=v(r),o=f(s,a);e.codecpar.profile=n,e.codecpar.sampleRate=o,e.codecpar.chLayout.nbChannels=i}}},85947:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(134);class a{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},50522:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var r=s(134),a=s(73146),i=s.n(a),n=s(14686),o=s(61499),c=s(63939),d=s(50932),p=s(4624),u=s(9705),h=s(85947),l=s(37837),m=s(71517),f=s(89222),g=s(73002),y=s(41654),v=s(72739),A=s(89088),x=s(15012),k=s(48416),S=s(38183),w=s(60264),b=s(44328),I=s(77231),P=s(90764),T=s(79940),q=s(52575),C=s(39342),B=s(56397),z=s(30725),R="src/avformat/formats/IRtspFormat.ts";class M extends h.A{constructor(e){super(),(0,r.A)(this,"type",6),(0,r.A)(this,"rtspSession",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"context",void 0),(0,r.A)(this,"cacheAVPacket",void 0),this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0),this.rtspSession=new f.A(this.options.uri,e.ioReader,e.ioWriter),this.context={sessionId:"",canOutputPacket:!0},this.cacheAVPacket=0}async readHeader(e){try{let t=await this.rtspSession.options();if(200!==t.statusCode)return u.LR;if(t=await this.rtspSession.describe(),200!==t.statusCode)return p.z3(`describe failed, ${i()(t)}`,R,136),u.LR;const s=g.q(t.context);let r=1,a=0;for(let n=0;n<s.media.length;n++){if(!s.media[n].rtp.length)continue;const c=e.createStream(),d=x.fm.find((e=>e.payload===s.media[n].rtp[0].payload));if(d)c.codecpar.codecType=d.codecType,c.codecpar.codecId=d.codecId,1===d.codecType?(c.codecpar.sampleRate=s.media[n].rtp[0].rate||d.rate,c.codecpar.chLayout.nbChannels=s.media[n].rtp[0].encoding||d.encoding,c.timeBase.num=1,c.timeBase.den=c.codecpar.sampleRate):(c.timeBase.num=1,c.timeBase.den=s.media[n].rtp[0].rate||d.rate);else{"audio"===s.media[n].type?c.codecpar.codecType=1:"video"===s.media[n].type&&(c.codecpar.codecType=0);const e=s.media[n].rtp[0].codec;let t=x.xl[e]||0;c.codecpar.codecId=t,1===c.codecpar.codecType?(c.codecpar.sampleRate=s.media[n].rtp[0].rate,c.codecpar.chLayout.nbChannels=s.media[n].rtp[0].encoding,c.timeBase.num=1,c.timeBase.den=c.codecpar.sampleRate):0===c.codecpar.codecType&&(c.timeBase.num=1,c.timeBase.den=s.media[n].rtp[0].rate)}const h={ssrc:0,trackId:r++,interleaved:a,payloadContext:null,queue:null,currentDTS:BigInt(0),gopCount:0,maxPts:BigInt(0),minPts:BigInt(0),payloadType:s.media[n].rtp[0].payload,dtsDelta:(0,b.k)(BigInt(33),I.i0,c.timeBase),rangeStartOffset:BigInt(0),lastRtcpNtpTime:I.Dh,firstRtcpNtpTime:I.Dh,lastRtcpTimestamp:0,rtcpTsOffset:BigInt(0),baseTimestamp:0,timestamp:0,unwrappedTimestamp:BigInt(0),filter:null};if(s.media[n].control){let e=s.media[n].control.split(";").find((e=>e.indexOf("trackID")>-1));if(e){let t=e.split("=");h.trackId=+t[1].trim()}}if(s.media[n].fmtp.length&&z.zQ[c.codecpar.codecId]&&(h.payloadContext=z.zQ[c.codecpar.codecId](c,s.media[n].fmtp[0].config)),h.queue=new k.A(c.codecpar[o.o9],h.payloadContext),a+=2,c.privData=h,t=await this.rtspSession.setup({trackId:h.trackId,streamMode:2,interleaved:h.interleaved,multcast:!1},this.context.sessionId),200!==t.statusCode)return p.z3(`setup track ${h.trackId} failed, ${i()(t)}`,R,247),u.LR;const l=t.headers.Transport.split(";").find((e=>e.indexOf("ssrc")>-1));l&&(h.ssrc=+("0x"+l.split("=")[1].trim())),this.context.sessionId=t.headers.Session,0===c.codecpar.codecType&&(this.context.canOutputPacket=!1),86017===c.codecpar.codecId&&(h.filter=new B.A),h.filter&&h.filter.init(c.codecpar[o.o9],c.timeBase[o.o9])}return e.streams.length?(t=await this.rtspSession.play(this.context.sessionId),200!==t.statusCode?(p.z3(`play failed, ${i()(t)}`,R,277),u.LR):0):(p.z3("not found stream",R,270),u.LR)}catch(t){return p.z3(t.message,R,284),e.ioReader.error}}addPrft(e,t,s){const r=e.privData;if(r.lastRtcpNtpTime!==I.Dh){const a=(0,l.sY)(16),i=y.q(r.lastRtcpNtpTime)-I.WT,n=BigInt(s)-r.lastRtcpNtpTime,o=(0,b.k)(n,e.timeBase,I.KR);d.M[17](a,i+o),d.M[15](a+8,24),(0,m.Ow)(t,27,a,16)}}getPacketPts(e,t,s){if(-1===s)return-BigInt(1);const r=t.privData;if(r.lastRtcpNtpTime!==I.Dh&&e.streams.length>1){const e=BigInt(s-r.lastRtcpTimestamp|0),a=(r.lastRtcpNtpTime-r.firstRtcpNtpTime)*BigInt(0|t.timeBase.den)/(BigInt(0|t.timeBase.num)<<BigInt(32));return r.rangeStartOffset+r.rtcpTsOffset+a+e}return r.baseTimestamp||(r.baseTimestamp=s),r.timestamp?r.unwrappedTimestamp+=BigInt(s-r.timestamp|0):r.unwrappedTimestamp+=BigInt(s),r.timestamp=s,r.unwrappedTimestamp+r.rangeStartOffset-BigInt(r.baseTimestamp)}handleRtcpPacket(e,t,s=-1){if(200===t[1]){const r=(0,C.N)(t);let a=e.streams.find((e=>{const t=e.privData;return t.ssrc===r.ssrc||t.interleaved===s}));if(a){const t=a.privData;t.lastRtcpNtpTime=r.ntp,t.lastRtcpTimestamp=r.timestamp,t.firstRtcpNtpTime===I.Dh&&(t.firstRtcpNtpTime=r.ntp,t.baseTimestamp||(t.baseTimestamp=r.timestamp),t.rtcpTsOffset=BigInt(t.lastRtcpTimestamp-t.baseTimestamp|0),t.timestamp&&(t.currentDTS=this.getPacketPts(e,a,t.timestamp)))}}}async readAVPacket(e,t){try{for(;;){const{data:s,interleaved:r}=await this.rtspSession.readPacket();if((0,P.A)(s))this.handleRtcpPacket(e,s,r);else if((0,T.A)(s)){const a=(0,q.A)(s);let i=e.streams.find((e=>{const t=e.privData;return t.ssrc===a.header.ssrc||t.interleaved===r||t.payloadType===a.header.payloadType}));if(i){const s=i.privData;s.queue.push(a),s.ssrc||(s.ssrc=a.header.ssrc);let r=!1;const h=(s,a,p)=>{let u=r?(0,m._5)():t;d.M[15](u+32,i.index),(0,n.Mr)(u+72,i.timeBase[o.o9],8);const h=(0,l.sY)(s.length);return(0,n.lW)(h,s.length,s),(0,m.NX)(u,h,s.length),d.M[17](u+16,p),d.M[17](u+8,p),a&&(d.M[15](u+36,1|c.f[15](u+36)),this.context.canOutputPacket=!0),r?(e.interval.packetBuffer.push(u),u=0):r=!0,u},f=(s,a,p=BigInt(0))=>{if(!s.length)return;let u=r?(0,m._5)():t;d.M[15](u+32,i.index),(0,n.Mr)(u+72,i.timeBase[o.o9],8);const h=(0,l.sY)(s[0].length);(0,n.lW)(h,s[0].length,s[0]),(0,m.NX)(u,h,s[0].length),d.M[17](u+16,a),d.M[17](u+8,a),d.M[15](u+36,1|c.f[15](u+36)),r?(e.interval.packetBuffer.push(u),u=0):r=!0;for(let t=1;t<s.length;t++){const r=(0,m._5)();d.M[15](r+32,i.index),(0,n.Mr)(r+72,i.timeBase[o.o9],8),d.M[17](r+16,a+BigInt(t)*p),d.M[17](r+8,a+BigInt(t)*p),d.M[15](r+36,1|c.f[15](r+36));const u=(0,l.sY)(s[t].length);(0,n.lW)(u,s[t].length,s[t]),(0,m.NX)(r,u,s[t].length),e.interval.packetBuffer.push(r)}},g=(a,h)=>{let f=r?(0,m._5)():t;d.M[15](f+32,i.index),(0,n.Mr)(f+72,i.timeBase[o.o9],8);const g=(0,l.sY)(a.length);(0,n.lW)(g,a.length,a),(0,m.NX)(f,g,a.length),d.M[17](f+16,h),d.M[17](f+8,h);let y=s.filter.sendAVPacket(f);if(y<0)return p.h2("send avpacket to bsf failed",R,466),u.LR;if(y=s.filter.receiveAVPacket(f),y!==u.LT)for((0,n.Mr)(f+72,i.timeBase[o.o9],8),d.M[15](f+32,i.index),d.M[15](f+36,1|c.f[15](f+36)),r?(e.interval.packetBuffer.push(f),f=0):r=!0;;){const t=this.cacheAVPacket||(0,m._5)();if(y=s.filter.receiveAVPacket(t),0!==y){this.cacheAVPacket=t;break}(0,n.Mr)(t+72,i.timeBase[o.o9],8),d.M[15](t+32,i.index),e.interval.packetBuffer.push(t),this.cacheAVPacket=0}};for(;s.queue.hasFrame();){const t=s.queue.getFrame();if(!t.length)continue;const r=this.getPacketPts(e,i,t[0].header.timestamp);if(0===i.codecpar.codecType||this.context.canOutputPacket)if(27===i.codecpar.codecId||173===i.codecpar.codecId){const{nalus:e,isKey:a}=27===i.codecpar.codecId?S.Hj(t):S.pA(t,s.payloadContext);if(!e.length)continue;if(!a&&!this.context.canOutputPacket){s.currentDTS=r;continue}const n=h(w.nW(e),a,r);d.M[15](n+80,i.codecpar.bitFormat),d.M[17](n+16,s.currentDTS),s.currentDTS+=s.dtsDelta,a?(s.gopCount>1&&(s.dtsDelta=(s.maxPts-s.minPts)/BigInt(s.gopCount-1|0)),s.gopCount=1,s.minPts=r,s.maxPts=r):(s.gopCount++,s.gopCount>5&&s.gopCount<200&&(s.dtsDelta=(s.maxPts-s.minPts)/BigInt(s.gopCount-1|0))),r>s.maxPts&&(s.maxPts=r)}else if(86018===i.codecpar.codecId)f(S.kx(t,i.privData.payloadContext),r,BigInt(1024));else if(65543===i.codecpar.codecId||65542===i.codecpar.codecId||69660===i.codecpar.codecId||65537===i.codecpar.codecId||86076===i.codecpar.codecId||86051===i.codecpar.codecId)f([S.xW(t)],r);else if(86017===i.codecpar.codecId){const e=S.Jz(t,i.codecpar.codecType);if(i.codecpar.profile===I.N_){const t=(6&e[1])>>1;i.codecpar.profile=A.Au(t)}g(e,r)}}if(r)return 0}}else p.R8("received invalid data",R,587)}}catch(t){return-1048576!==e.ioReader.error?(p.z3(`read packet error, ${t}`,R,593),u.LR):e.ioReader.error}}async seek(e,t,s,r){return BigInt(u.E$)}getAnalyzeStreamsCount(){return 0}async destroy(e){await this.rtspSession.teardown(this.context.sessionId),this.cacheAVPacket&&((0,m.Qe)(this.cacheAVPacket),this.cacheAVPacket=0),v.__(e.streams,(e=>{const t=e.privData;t.filter&&(t.filter.destroy(),t.filter=null)}))}}},75294:(e,t,s)=>{s.d(t,{CM:()=>o,Vz:()=>i,qg:()=>n});var r=s(134),a=s(89088);class i{constructor(){(0,r.A)(this,"version",void 0),(0,r.A)(this,"layer",void 0),(0,r.A)(this,"protection",void 0),(0,r.A)(this,"bitrateIndex",void 0),(0,r.A)(this,"samplingFrequency",void 0),(0,r.A)(this,"padding",void 0),(0,r.A)(this,"private",void 0),(0,r.A)(this,"mode",void 0),(0,r.A)(this,"modeExtension",void 0),(0,r.A)(this,"copyright",void 0),(0,r.A)(this,"original",void 0),(0,r.A)(this,"emphasis",void 0)}}function n(e,t){e.version=t>>19&3,e.layer=t>>17&3,e.protection=t>>16&1,e.bitrateIndex=t>>12&15,e.samplingFrequency=t>>10&3,e.padding=t>>9&1,e.mode=t>>6&3,e.modeExtension=t>>4&3,e.copyright=t>>3&1,e.original=t>>2&1,e.emphasis=3&t}function o(e,t){let s=a.oz(e.version,e.layer,e.bitrateIndex);switch(e.layer){case 1:default:s=144e3*s/(t<<(3===e.version?0:1))>>>0,s+=e.padding;break;case 2:s=144e3*s/t>>>0,s+=e.padding;break;case 3:s=12e3*s/t>>>0,s=4*(s+e.padding)}return s}},77872:(e,t,s)=>{s.d(t,{lN:()=>i});const r=/(.*)/,a="%s",i={v:[{name:"version",reg:/^(\d*)$/,format:a}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name",reg:r,format:a}],i:[{name:"description",reg:r,format:a}],u:[{name:"uri",reg:r,format:a}],e:[{name:"email",reg:r,format:a}],p:[{name:"phone",reg:r,format:a}],z:[{name:"timezones",reg:r,format:a}],r:[{name:"repeats",reg:r,format:a}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/,format:a},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:a},{name:"icelite",reg:/^(ice-lite)/,format:a},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){let t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/,format:a},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){let t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/,format:a},{name:"rtcpRsize",reg:/^(rtcp-rsize)/,format:a},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/,format:a},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){let t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",reg:r,names:["value"],format:a}]}},73002:(e,t,s)=>{s.d(t,{q:()=>o});var r=s(77872);const a=e=>/^([a-z])=(.*)/.test(e);function i(e){return String(Number(e))===e?Number(e):e}function n(e,t,s){const r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});const a=e.push?{}:r?t[e.name]:t;!function(e,t,s,r){if(r&&!s)t[r]=i(e[1]);else for(let r=0;r<s.length;r+=1)null!=e[r+1]&&(t[s[r]]=i(e[r+1]))}(s.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)}function o(e){const t={},s=[];let i=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach((e=>{const t=e[0],a=e.slice(2);"m"===t&&(s.push({rtp:[],fmtp:[]}),i=s[s.length-1]);for(let e=0;e<(r.lN[t]||[]).length;e+=1){const s=r.lN[t][e];if(s.reg.test(a))return n(s,i,a)}})),t.media=s,t}},91712:(e,t,s)=>{s.d(t,{K:()=>n,pl:()=>i});var r=s(134);class a{constructor(){(0,r.A)(this,"version",void 0),(0,r.A)(this,"padding",void 0),(0,r.A)(this,"count",void 0),(0,r.A)(this,"payloadType",void 0),(0,r.A)(this,"length",void 0)}}class i{constructor(){(0,r.A)(this,"ssrc",void 0),(0,r.A)(this,"fractionLost",void 0),(0,r.A)(this,"packetLost",void 0),(0,r.A)(this,"highestSequence",void 0),(0,r.A)(this,"interArrivalJitter",void 0),(0,r.A)(this,"lsr",void 0),(0,r.A)(this,"dlsr",void 0)}}class n extends a{constructor(...e){super(...e),(0,r.A)(this,"ssrc",void 0),(0,r.A)(this,"ntp",void 0),(0,r.A)(this,"timestamp",void 0),(0,r.A)(this,"senderPacketCount",void 0),(0,r.A)(this,"senderOctetCount",void 0),(0,r.A)(this,"reports",[])}}},90764:(e,t,s)=>{function r(e){return e.length>4&&e[0]>127&&e[0]<192&&e[0]>>>6==2&&e[1]>=192&&e[1]<=223}s.d(t,{A:()=>r})},39342:(e,t,s)=>{s.d(t,{N:()=>i});var r=s(31865),a=s(91712);function i(e){const t=new r.A(e),s=new a.K;!function(e,t){let s=t.readUint8();e.version=s>>>6,e.padding=s>>>5&1,e.count=31&s,e.payloadType=t.readUint8(),e.length=t.readUint16()}(s,t),s.ssrc=t.readUint32(),s.ntp=t.readUint64(),s.timestamp=t.readUint32(),s.senderPacketCount=t.readUint32(),s.senderOctetCount=t.readUint32();for(let e=0;e<s.count;e++){const e=new a.pl;e.ssrc=t.readUint32(),e.fractionLost=t.readUint8(),e.packetLost=t.readUint24(),e.highestSequence=t.readUint32(),e.interArrivalJitter=t.readUint32(),e.lsr=t.readUint32(),e.dlsr=t.readUint32()}return s}},48416:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(134),a=s(63939),i=s(77231),n=s(15012);const o=i.zg>>>1;class c{constructor(e,t){(0,r.A)(this,"queue",void 0),(0,r.A)(this,"frameQueue",void 0),(0,r.A)(this,"codecpar",void 0),(0,r.A)(this,"firstKeyFramePopped",void 0),(0,r.A)(this,"currentSeqStart",void 0),(0,r.A)(this,"readyPos",void 0),(0,r.A)(this,"maskerQueue",void 0),(0,r.A)(this,"payloadContext",void 0),this.codecpar=e,this.queue=[],this.frameQueue=[],this.firstKeyFramePopped=!1,this.currentSeqStart=0,this.readyPos=0,this.maskerQueue=[],this.payloadContext=t}judeSeqIncreaseOne(e,t){return e+1===t||e===i.zg&&0===t}seqAMoreThenB(e,t){return e>t&&e-t<o||e<t&&t-e>o}isFirstStart(){if(this.firstKeyFramePopped)return this.judeSeqIncreaseOne(this.currentSeqStart,this.queue[0].header.sequence);if(this.queue.length>5){if(1===a.f[15](this.codecpar))return!0;if(27===a.f[15](this.codecpar+4))switch(31&this.queue[0].payload[0]){case 24:for(let e=1;e<this.queue[0].payload.length-2;){const t=this.queue[0].payload[e]<<8|this.queue[0].payload[e+1],s=31&this.queue[0].payload[e+2];if(7===s||8===s||5===s||9===s)return!0;e+=2+t}break;case 28:if(128&this.queue[0].payload[1])return!0;break;case 5:case 7:case 8:case 9:return!0}else if(173===a.f[15](this.codecpar+4))switch(this.queue[0].payload[0]>>>1&63){case 48:let e=n.Dm+(this.payloadContext.usingDonlField?n.hE:0);for(;e<this.queue[0].payload.length-n.Dm;){const t=this.queue[0].payload[e]<<8|this.queue[0].payload[e+1],s=this.queue[0].payload[e+2]>>>1&63;if(34===s||32===s||33===s||20===s||19===s||35===s)return!0;e+=2+t,this.payloadContext.usingDonlField&&(e+=n.hQ)}break;case 49:if(128&this.queue[0].payload[2])return!0;break;case 34:case 33:case 32:case 20:case 19:case 35:return!0}else if(139===a.f[15](this.codecpar+4)){if(16&this.queue[0].payload[0])return!0}else if(167===a.f[15](this.codecpar+4)){if(1==(8&this.queue[0].payload[0]))return!0}else if(225===a.f[15](this.codecpar+4)){if(!(1&~this.queue[0].payload[0]))return!0}else if(2===a.f[15](this.codecpar+4)&&1==(this.queue[0].payload[2]>>>5&1))return!0;return this.readyPos>200}return!1}push(e){if(e.header.sequence<this.currentSeqStart&&this.currentSeqStart-e.header.sequence<o)return;if(!this.queue.length)return this.queue.push(e),void(e.header.masker&&this.maskerQueue.push(0));const t=()=>{for(;this.readyPos<this.queue.length-1&&this.judeSeqIncreaseOne(this.queue[this.readyPos].header.sequence,this.queue[this.readyPos+1].header.sequence);)this.readyPos++,(this.queue[this.readyPos].header.masker||65543===a.f[15](this.codecpar+4)||65542===a.f[15](this.codecpar+4)||86017===a.f[15](this.codecpar+4)||69660===a.f[15](this.codecpar+4)||65537===a.f[15](this.codecpar+4))&&this.maskerQueue.push(this.readyPos)};let s=!1;for(let r=this.readyPos;r<this.queue.length;r++)if(this.seqAMoreThenB(this.queue[r].header.sequence,e.header.sequence)){this.queue.splice(r,0,e),s=!0,r===this.readyPos+1&&t();break}s||(this.queue.push(e),this.readyPos+2===this.queue.length&&t());let r=0;for(;this.isFirstStart()&&this.maskerQueue.length;){const e=this.maskerQueue.shift()+1,t=this.queue.slice(r,e);this.frameQueue.push(t),r=e,this.firstKeyFramePopped=!0,this.currentSeqStart=t[t.length-1].header.sequence}if(r){this.queue=this.queue.slice(r),this.readyPos=Math.max(0,this.readyPos-r);for(let e=0;e<this.maskerQueue.length;e++)this.maskerQueue[e]-=r}}hasFrame(){return this.frameQueue.length}getFrame(){return this.frameQueue.shift()}}},67088:(e,t,s)=>{s.d(t,{El:()=>n,N8:()=>c,tW:()=>o});var r=s(134),a=s(80662),i=s.n(a);class n{constructor(){(0,r.A)(this,"version",void 0),(0,r.A)(this,"padding",void 0),(0,r.A)(this,"extension",void 0),(0,r.A)(this,"csrc",void 0),(0,r.A)(this,"masker",void 0),(0,r.A)(this,"payloadType",void 0),(0,r.A)(this,"sequence",void 0),(0,r.A)(this,"timestamp",void 0),(0,r.A)(this,"ssrc",void 0),(0,r.A)(this,"csrcList",[])}}class o{constructor(){(0,r.A)(this,"id",void 0),(0,r.A)(this,"length",void 0),(0,r.A)(this,"extension",void 0),(0,r.A)(this,"headers",new(i()))}hasOneByteExtensions(){return 48862===this.id}hasTwoBytesExtensions(){return 4096==(65520&this.id)}parse(){if(this.hasOneByteExtensions())for(let e=0;e<this.extension.length;e++){const t=(240&this.extension[e])>>>4,s=1+(15&this.extension[e]);if(15===t)break;0!==t?(this.headers.set(t,this.extension.subarray(e+1,e+1+s)),e+=1+s):e++}else if(this.hasTwoBytesExtensions())for(let e=0;e<this.extension.length;e++){const t=this.extension[e],s=this.extension[e+1];0!==t?(this.headers.set(t,this.extension.subarray(e+2,e+2+s)),e+=2+s):e++}}}class c{constructor(){(0,r.A)(this,"header",void 0),(0,r.A)(this,"headerExtension",void 0),(0,r.A)(this,"payload",void 0)}}},38183:(e,t,s)=>{s.d(t,{Hj:()=>c,Jz:()=>u,kx:()=>p,pA:()=>d,xW:()=>h});var r=s(4624),a=s(15012),i=s(92647),n=s(37246),o="src/avprotocol/rtp/depacketizer.ts";function c(e){const t=[];let s=!1;for(let a=0;a<e.length;a++){const n=e[a].payload,c=31&n[0];switch(c){case 24:for(let e=1;e<n.length-2;){const a=n[e]<<8|n[e+1];if(e+2+a>n.length)return r.z3("pack h264 STAP-A failed",o,50),{nalus:[],isKey:s};t.push(n.subarray(e+2,e+2+a)),5==(31&n[e+2])&&(s=!0),e+=2+a}break;case 25:case 26:case 27:case 29:return r.z3("not support nalu pack",o,73),{nalus:[],isKey:s};case 28:const d=n[1];if(1&~(d>>>7))return r.z3("not the first FU-A packet",o,82),{nalus:[],isKey:s};const p=31&d,u=224&n[0]|p;5===p&&(s=!0);const h=[new Uint8Array([u])];for(h.push(n.subarray(2)),a++;a<e.length&&(h.push(e[a].payload.subarray(2)),!(e[a].payload[1]>>>6&1));a++);t.push((0,i.A)(Uint8Array,h));break;default:5===c&&(s=!0),t.push(n)}}return{nalus:t,isKey:s}}function d(e,t){const s=[];let n=!1;for(let c=0;c<e.length;c++){const d=e[c].payload,p=d[0]>>>1&63;switch(p>50&&r.z3("not support nalu pack",o,129),p){case 48:for(let e=a.Dm+(t.usingDonlField?a.hE:0);e<d.length-2;){const i=d[e]<<8|d[e+1];if(e+2+i>d.length)return r.z3("pack hevc STAP-A failed",o,138),{nalus:[],isKey:n};s.push(d.subarray(e+2,e+2+i));const c=d[e+2]>>>1&63;20!==c&&19!==c||(n=!0),e+=2+i,t.usingDonlField&&(e+=a.hQ)}break;case 49:const u=63&d[2];20!==u&&19!==u||(n=!0);const h=[new Uint8Array([129&d[0]|u<<1,d[1]])];for(h.push(d.subarray(3+(t.usingDonlField?a.hE:0))),c++;c<e.length&&(h.push(e[c].payload.subarray(3+(t.usingDonlField?a.hE:0))),!(e[c].payload[2]>>>6&1));c++);s.push((0,i.A)(Uint8Array,h));break;case 50:return r.z3("not support nalu pack",o,182),{nalus:[],isKey:n};default:20!==p&&19!==p||(n=!0),s.push(d)}}return{nalus:s,isKey:n}}function p(e,t){const s=[],c=[],d=new n.A(a.MO);for(let n=0;n<e.length;n++){const p=e[n].payload;if(p.length<2)return void r.z3("invalid mpeg4 payload length",o,210);const u=p[0]<<8|p[1];if(u>a.MO)return void r.z3("invalid mpeg4 payload au header length",o,215);const h=(u+7)/8>>>0;if(p.length-2<h)return void r.z3("invalid mpeg4 payload au length",o,220);const l=t.sizeLength+t.indexLength;if(u%l!=0)return void r.z3("not support mpeg4 payload au format",o,227);const m=u/l,f=[],g=[];d.reset(),d.appendBuffer(p.subarray(2));for(let e=0;e<m;e++)f.push(d.readU(t.sizeLength)),g.push(d.readU(t.indexLength));if(1===f.length&&f[0]+h+2>p.length)c.push(p.subarray(2+h));else if(f.length>1){let e=h+2;for(let t=0;t<f.length;t++)!g[t]&&c.length&&(s.push((0,i.A)(Uint8Array,c)),c.length=0),s.push(p.subarray(e,e+f[t])),e+=f[t]}}return c.length&&s.push((0,i.A)(Uint8Array,c)),s}function u(e,t){const s=[];for(let r=0;r<e.length;r++){let a=4;0===t&&1==(e[r].payload[0]>>>2&1)&&(a=8),s.push(e[r].payload.subarray(a))}return 1===s.length?s[0]:(0,i.A)(Uint8Array,s)}function h(e){if(1===e.length)return e[0].payload;const t=[];for(let s=0;s<e.length;s++)t.push(e[s].payload);return(0,i.A)(Uint8Array,t)}},30725:(e,t,s)=>{s.d(t,{zQ:()=>u});var r=s(37837),a=s(14686),i=s(4919),n=s(20620),o=s(53e3),c=s(58469),d=s(60264);function p(e,t){const s={},i=t.split(";");for(let t=0;t<i.length;t++){const n=i[t].split("="),o=n[0].trim().toLocaleLowerCase();n.shift();const d=n.join("=").trim();switch(o){case"streamtype":s.streamType=+d;break;case"profile-level-id":s.profileLevelId=+d;break;case"mode":s.mode=d;break;case"sizelength":s.sizeLength=+d;break;case"indexlength":s.indexLength=+d;break;case"indexdeltalength":s.indexDeltaLength=+d;break;case"config":e.codecpar.extradata=(0,r.sY)(d.length/2),e.codecpar.extradataSize=d.length/2;const t=(0,a.s3)(e.codecpar.extradata,e.codecpar.extradataSize);let i=0;for(let e=0;e<d.length;e+=2)t[i++]=+("0x"+d.substring(e,e+2));86018===e.codecpar.codecId&&c.XC(e,(0,a.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}}return s}const u={27:function(e,t){e.codecpar.bitFormat=2;const s={},o=t.split(";");for(let t=0;t<o.length;t++){const c=o[t].split("="),p=c[0].trim();c.shift();const u=c.join("=").trim();switch(p){case"profile-level-id":s.profile=+("0x"+u.substring(0,2)),s.level=+("0x"+u.substring(4,6));break;case"packetization-mode":s.packetizationMode=+u;break;case"sprop-parameter-sets":const t=u.split(",").map((e=>i.E_(e))),o=n.S1(d.nW(t));e.codecpar.extradata=(0,r.sY)(o.length),e.codecpar.extradataSize=o.length,(0,a.lW)(e.codecpar.extradata,o.length,o),n.XC(e,(0,a.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}}return s},173:function(e,t){const s={},n=t.split(";"),c=[];e.codecpar.bitFormat=2;for(let e=0;e<n.length;e++){const t=n[e].split("="),r=t[0].trim();t.shift();const a=t.join("=").trim();switch(r){case"profile-id":s.profile=+a;break;case"sprop-vps":case"sprop-sps":case"sprop-pps":case"sprop-sei":c.push(i.E_(a))}}if(c.length){const t=o.S1(d.nW(c));e.codecpar.extradata=(0,r.sY)(t.length),e.codecpar.extradataSize=t.length,(0,a.lW)(e.codecpar.extradata,t.length,t),o.XC(e,(0,a.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}return s},86018:p,12:p}},79940:(e,t,s)=>{function r(e){return e.length>12&&e[0]>127&&e[0]<192&&e[0]>>>6==2}s.d(t,{A:()=>r})},52575:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(67088);function a(e){const t=new r.N8,s=t.header=new r.El;let a=0;s.version=e[a]>>6,s.padding=e[a]>>5&1,s.extension=e[a]>>4&1,s.csrc=15&e[a],a++,s.masker=e[a]>>7&1,s.payloadType=127&e[a],a++,s.sequence=e[a]<<8|e[a+1],a+=2,s.timestamp=(e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3])>>>0,a+=4,s.ssrc=(e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3])>>>0,a+=4;for(let t=0;t<s.csrc;t++)s.csrcList.push((e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3])>>>0),a+=4;return s.extension&&(t.headerExtension=t.headerExtension=new r.tW,t.headerExtension.id=e[a]<<8|e[a+1],a+=2,t.headerExtension.length=e[a]<<8|e[a+1],a+=2,t.headerExtension.extension=e.subarray(a,4*t.headerExtension.length),a+=4*t.headerExtension.length),t.payload=e.subarray(a,e.length-(s.padding?e[e.length-1]:0)),t}},15012:(e,t,s)=>{s.d(t,{Dm:()=>a,MO:()=>r,fm:()=>c,hE:()=>n,hQ:()=>i,xl:()=>o});const r=8192,a=2,i=1,n=2,o={PCMU:65542,PCMA:65543,G723:86068,G722:69660,L16:65537,MPA:86017,MPV:2,MP2T:131072,H264:27,H265:173,HEVC:173,VP8:139,VP9:167,AV1:225,opus:86076,speex:86051,vorbis:86021,theora:30,"MP4A-LATM":86018,"MP4V-ES":12,"mpeg4-generic":86018},c=[{payload:0,name:"PCMU",codecType:1,codecId:65542,rate:8e3,encoding:1},{payload:4,name:"G723",codecType:1,codecId:86068,rate:8e3,encoding:1},{payload:8,name:"PCMA",codecType:1,codecId:65543,rate:8e3,encoding:1},{payload:9,name:"G722",codecType:1,codecId:69660,rate:8e3,encoding:1},{payload:10,name:"L16",codecType:1,codecId:65537,rate:44100,encoding:2},{payload:11,name:"L16",codecType:1,codecId:65537,rate:44100,encoding:1},{payload:14,name:"MPA",codecType:1,codecId:86016,rate:-1,encoding:-1},{payload:14,name:"MPA",codecType:1,codecId:86017,rate:-1,encoding:-1},{payload:31,name:"H261",codecType:0,codecId:3,rate:9e4,encoding:-1},{payload:32,name:"MPV",codecType:0,codecId:2,rate:9e4,encoding:-1},{payload:33,name:"MPV",codecType:2,codecId:131072,rate:9e4,encoding:-1},{payload:34,name:"H263",codecType:0,codecId:4,rate:9e4,encoding:-1}]},89222:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(134),a=s(95434);class i extends a.zo{constructor(e,t,s){super(t,s),(0,r.A)(this,"seq",void 0),(0,r.A)(this,"version","RTSP/1.0"),(0,r.A)(this,"uri",void 0),(0,r.A)(this,"authorization",void 0),this.seq=1,this.uri=e}async options(){const e=new a.yz("OPTIONS",this.uri,this.version,{CSeq:""+this.seq++});return super.request(e)}async describe(){const e=new a.yz("DESCRIBE",this.uri,this.version,{CSeq:""+this.seq++,Accept:"application/sdp",Authorization:this.authorization});return super.request(e)}async setup(e,t=""){let s="";2===e.streamMode&&(s="/TCP");let r="",i="";1===e.streamMode?i=`;${e.clientPort}-${e.clientPort+1}`:2===e.streamMode&&(r=`;${e.interleaved}-${e.interleaved+1}`);const n=new a.yz("SETUP",this.uri+`/trackID=${e.trackId}`,this.version,{CSeq:""+this.seq++,Session:t,Authorization:this.authorization,Transport:`RTP/AVP${s};${e.multcast?"multcast":"unicast"}${r}${i}`});return super.request(n)}async play(e,t={from:0,to:-1}){const s=new a.yz("PLAY",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization,Range:`npt=${t.from>=0?t.from:0}-${t.to>0?t.to:""}`});return super.request(s)}async pause(e){const t=new a.yz("PAUSE",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization});return super.request(t)}async teardown(e){const t=new a.yz("TEARDOWN",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization});await super.notify(t)}async readPacket(){for(;;){36!==await this.ioReader.peekUint8()&&await this.readResponse(),await this.ioReader.skip(1);const e=await this.ioReader.readUint8(),t=await this.ioReader.readUint16();return{interleaved:e,data:await this.ioReader.readBuffer(t)}}}}},41654:(e,t,s)=>{function r(e){const t=e>>BigInt(32),s=(e&BigInt(4294967295))*BigInt(1e6)/BigInt(4294967295);return t*BigInt(1e6)+s}s.d(t,{q:()=>r})},95434:(e,t,s)=>{s.d(t,{yz:()=>i,zo:()=>o});var r=s(134),a=s(95335);class i{constructor(e,t,s,a={},i=""){(0,r.A)(this,"method",void 0),(0,r.A)(this,"uri",void 0),(0,r.A)(this,"protocol",void 0),(0,r.A)(this,"headers",void 0),(0,r.A)(this,"context",void 0),this.method=e,this.uri=t,this.protocol=s,this.headers=a,this.context=i}setHeader(e,t){this.headers[e]=t}encode(){let e=`${this.method} ${this.uri} ${this.protocol}\r\n`;return this.headers["Content-Length"]=this.context.length+"",a.__(this.headers,((t,s)=>{t&&(e+=`${s}: ${t}\r\n`)})),e+="\r\n",this.context&&(e+=this.context),e}}class n{constructor(e,t,s,a,i){(0,r.A)(this,"protocol",void 0),(0,r.A)(this,"statusCode",void 0),(0,r.A)(this,"statusText",void 0),(0,r.A)(this,"headers",void 0),(0,r.A)(this,"context",void 0),this.protocol=e,this.statusCode=t,this.statusText=s,this.headers=a,this.context=i}}class o{constructor(e,t){(0,r.A)(this,"ioReader",void 0),(0,r.A)(this,"ioWriter",void 0),this.ioReader=e,this.ioWriter=t}async readResponse(){let e=(await this.ioReader.readLine()).trim().split(" "),t="",s={};for(;;){const e=(await this.ioReader.readLine()).trim();if(!e)break;const t=e.split(":");s[t[0].trim()]=t[1].trim()}return s["Content-Length"]&&(t=await this.ioReader.readString(+s["Content-Length"])),new n(e[0].trim(),+e[1].trim(),e[2].trim(),s,t)}async request(e){return this.ioWriter.reset(),this.ioWriter.writeString(e.encode()),this.ioWriter.flush(),this.readResponse()}async notify(e){this.ioWriter.reset(),this.ioWriter.writeString(e.encode()),await this.ioWriter.flush()}}}}]);