"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[758],{5947:(t,i,e)=>{e.d(i,{A:()=>n});var s=e(1026);class n{constructor(){(0,s.A)(this,"type",-1),(0,s.A)(this,"onStreamAdd",void 0)}destroy(t){}}},1934:(t,i,e)=>{e.r(i),e.d(i,{default:()=>A});var s=e(1026),n=e(3939),r=e(932),h=e(7231);class a{constructor(){(0,s.A)(this,"capturePattern",void 0),(0,s.A)(this,"streamStructureVersion",void 0),(0,s.A)(this,"headerTypeFlag",void 0),(0,s.A)(this,"granulePosition",void 0),(0,s.A)(this,"serialNumber",void 0),(0,s.A)(this,"pageSequenceNumber",void 0),(0,s.A)(this,"crcCheckSum",void 0),(0,s.A)(this,"numberPageSegments",void 0),(0,s.A)(this,"segmentTable",void 0),(0,s.A)(this,"payload",void 0),this.reset()}reset(){this.capturePattern="OggS",this.streamStructureVersion=0,this.headerTypeFlag=0,this.granulePosition=h.Dh,this.serialNumber=0,this.pageSequenceNumber=0,this.crcCheckSum=0,this.numberPageSegments=0,this.segmentTable=[]}async read(t){await this.readPageHeader(t);const i=this.segmentTable.reduce(((t,i)=>t+i),0);i&&(this.payload=await t.readBuffer(i))}async readPageHeader(t){if(this.capturePattern=await t.readString(4),this.streamStructureVersion=await t.readUint8(),this.headerTypeFlag=await t.readUint8(),this.granulePosition=await t.readUint64(),this.serialNumber=await t.readUint32(),this.pageSequenceNumber=await t.readUint32(),this.crcCheckSum=await t.readUint32(),this.numberPageSegments=await t.readUint8(),this.numberPageSegments)for(let i=0;i<this.numberPageSegments;i++){const i=await t.readUint8();this.segmentTable.push(i)}}write(t){if(t.writeString(this.capturePattern),t.writeUint8(this.streamStructureVersion),t.writeUint8(this.headerTypeFlag),t.writeUint64(this.granulePosition),t.writeUint32(this.serialNumber),t.writeUint32(this.pageSequenceNumber),t.writeUint32(this.crcCheckSum),this.payload){this.numberPageSegments=Math.ceil(this.payload.length/255);const i=this.payload.length%255;t.writeUint8(this.numberPageSegments);for(let i=0;i<this.numberPageSegments-1;i++)t.writeUint8(255);t.writeUint8(i),t.writeBuffer(this.payload)}else t.writeUint8(0)}}var o=e(4624);class d{constructor(){(0,s.A)(this,"streamCount",void 0),(0,s.A)(this,"coupledStreamCount",void 0),(0,s.A)(this,"mapping",void 0),this.streamCount=1,this.coupledStreamCount=0,this.mapping=null}read(t){this.streamCount=t.readUint8(),this.coupledStreamCount=t.readUint8(),this.mapping=t.readBuffer(this.streamCount+this.coupledStreamCount)}write(t){t.writeUint8(this.streamCount),t.writeUint8(this.coupledStreamCount),t.writeBuffer(this.mapping)}}class g{constructor(){(0,s.A)(this,"streamIndex",void 0),(0,s.A)(this,"signature",void 0),(0,s.A)(this,"version",void 0),(0,s.A)(this,"channels",void 0),(0,s.A)(this,"preSkip",void 0),(0,s.A)(this,"sampleRate",void 0),(0,s.A)(this,"outputGain",void 0),(0,s.A)(this,"channelMappingFamily",void 0),(0,s.A)(this,"channelMappingTable",void 0),this.signature="OpusHead",this.version=1,this.channels=1,this.preSkip=0,this.sampleRate=48e3,this.outputGain=0,this.channelMappingFamily=0,this.channelMappingTable=new d}read(t){this.signature=t.readString(8),this.version=t.readUint8(),this.channels=t.readUint8(),this.preSkip=t.readUint16(),this.sampleRate=t.readUint32(),this.outputGain=t.readInt16(),this.channelMappingFamily=t.readUint8(),0!==this.channelMappingFamily&&this.channelMappingTable.read(t)}write(t){t.writeString(this.signature),t.writeUint8(this.version),t.writeUint8(this.channels),t.writeUint16(this.preSkip),t.writeUint32(this.sampleRate),t.writeInt16(this.outputGain),t.writeUint8(this.channelMappingFamily),0!==this.channelMappingFamily&&this.channelMappingTable.write(t)}setCodec(t){this.sampleRate=t.sampleRate,this.channels=t.chLayout.nbChannels}}class l{constructor(){(0,s.A)(this,"list",void 0),this.list=[]}read(t,i){for(let e=0;e<i;e++){const i=t.readUint32();this.list.push(t.readString(i))}}write(t){for(let i=0;i<this.list.length;i++){const e=t.encodeString(this.list[i]);t.writeUint32(e.length),t.writeBuffer(e)}}addComment(t){this.list.push(t)}}class u{constructor(){(0,s.A)(this,"streamIndex",void 0),(0,s.A)(this,"signature",void 0),(0,s.A)(this,"vendorStringLength",void 0),(0,s.A)(this,"vendorString",void 0),(0,s.A)(this,"userCommentListLength",void 0),(0,s.A)(this,"comments",void 0),this.signature="OpusTags",this.vendorString="libmedia.0.0.1",this.vendorStringLength=this.vendorString.length,this.userCommentListLength=0,this.comments=new l}read(t){this.signature=t.readString(8),this.vendorStringLength=t.readUint32(),this.vendorString=t.readString(this.vendorStringLength),this.userCommentListLength=t.readUint32(),this.userCommentListLength&&this.comments.read(t,this.userCommentListLength)}write(t){t.writeString(this.signature);const i=t.encodeString(this.vendorString);t.writeUint32(i.length),t.writeBuffer(i),t.writeUint32(this.comments.list.length),this.comments.write(t)}addComment(t){this.comments.addComment(t)}setCodec(t){}}var p=e(9705),f=e(2647),c=e(5947),m=e(4686),b=e(7837),S=e(1517),y=e(11),U="src/common/io/IOReaderSync.ts";class w{constructor(t=1048576,i=!0,e){(0,s.A)(this,"data",void 0),(0,s.A)(this,"buffer",void 0),(0,s.A)(this,"pointer",void 0),(0,s.A)(this,"endPointer",void 0),(0,s.A)(this,"pos",void 0),(0,s.A)(this,"size",void 0),(0,s.A)(this,"littleEndian",void 0),(0,s.A)(this,"fileSize_",void 0),(0,s.A)(this,"error",void 0),(0,s.A)(this,"onFlush",void 0),(0,s.A)(this,"onSeek",void 0),(0,s.A)(this,"onSize",void 0),(0,s.A)(this,"flags",void 0),this.pos=BigInt(0),this.pointer=0,this.error=0,this.endPointer=0,this.littleEndian=!i,this.flags=0,e?(this.size=t,this.buffer=e,this.data=e.view):(this.size=Math.max(t,102400),this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer))}readUint8(){this.remainingLength()<1&&this.flush(1);const t=this.data.getUint8(this.pointer);return this.pointer++,this.pos++,t}peekUint8(){return this.remainingLength()<1&&this.flush(1),this.data.getUint8(this.pointer)}readUint16(){this.remainingLength()<2&&this.flush(2);const t=this.data.getUint16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),t}peekUint16(){return this.remainingLength()<2&&this.flush(2),this.data.getUint16(this.pointer,this.littleEndian)}readUint24(){return this.readUint16()<<8|this.readUint8()}peekUint24(){this.remainingLength()<3&&this.flush(3);const t=this.pointer,i=this.pos,e=this.readUint16()<<8|this.readUint8();return this.pointer=t,this.pos=i,e}readUint32(){this.remainingLength()<4&&this.flush(4);const t=this.data.getUint32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),t}peekUint32(){return this.remainingLength()<4&&this.flush(4),this.data.getUint32(this.pointer,this.littleEndian)}readUint64(){this.remainingLength()<8&&this.flush(8);const t=this.data.getBigUint64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),t}peekUint64(){return this.remainingLength()<8&&this.flush(8),this.data.getBigUint64(this.pointer,this.littleEndian)}readInt8(){this.remainingLength()<1&&this.flush(1);const t=this.data.getInt8(this.pointer);return this.pointer++,this.pos++,t}peekInt8(){return this.remainingLength()<1&&this.flush(1),this.data.getInt8(this.pointer)}readInt16(){this.remainingLength()<2&&this.flush(2);const t=this.data.getInt16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),t}peekInt16(){return this.remainingLength()<2&&this.flush(2),this.data.getInt16(this.pointer,this.littleEndian)}readInt32(){this.remainingLength()<4&&this.flush(4);const t=this.data.getInt32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),t}peekInt32(){return this.remainingLength()<4&&this.flush(4),this.data.getInt32(this.pointer,this.littleEndian)}readInt64(){this.remainingLength()<8&&this.flush(8);const t=this.data.getBigInt64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),t}peekInt64(){return this.remainingLength()<8&&this.flush(8),this.data.getBigInt64(this.pointer,this.littleEndian)}readFloat(){this.remainingLength()<4&&this.flush(4);const t=this.data.getFloat32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),t}peekFloat(){return this.remainingLength()<4&&this.flush(4),this.data.getFloat32(this.pointer,this.littleEndian)}readDouble(){this.remainingLength()<8&&this.flush(8);const t=this.data.getFloat64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),t}peekDouble(){return this.remainingLength()<8&&this.flush(8),this.data.getFloat64(this.pointer,this.littleEndian)}readHex(t=1){let i="";for(let e=0;e<t;e++){const t=this.readUint8().toString(16);i+=1===t.length?"0"+t:t}return i}peekHex(t=1){t>this.size&&(this.error=-1048575,o.h2("peekHex, length too large",U,331)),this.remainingLength()<t&&this.flush(t);const i=this.pointer,e=this.pos;let s="";for(let i=0;i<t;i++){const t=this.readUint8().toString(16);s+=1===t.length?"0"+t:t}return this.pointer=i,this.pos=e,s}readBuffer(t,i){if(!t)return new Uint8Array(0);if(i||(i=new Uint8Array(t)),this.remainingLength()<t){let e=0;if(this.remainingLength()>0){const s=this.remainingLength();i.set(this.buffer.subarray(this.pointer,this.pointer+s),e),e+=s,this.pointer+=s,this.pos+=BigInt(s),t-=s}for(;t>0;){this.flush();const s=Math.min(this.endPointer-this.pointer,t);i.set(this.buffer.subarray(this.pointer,this.pointer+s),e),e+=s,this.pointer+=s,this.pos+=BigInt(s),t-=s}}else i.set(this.buffer.subarray(this.pointer,this.pointer+t),0),this.pointer+=t,this.pos+=BigInt(t);return i}peekBuffer(t,i){return t?(t>this.size&&(this.error=-1048575,o.h2("peekBuffer, length too large",U,415)),this.remainingLength()<t&&this.flush(t),i||(i=new Uint8Array(t)),i.set(this.buffer.subarray(this.pointer,this.pointer+t),0),i):new Uint8Array(0)}readString(t=1){const i=this.readBuffer(t);return y.D(i)}peekString(t=1){const i=this.peekBuffer(t);return y.D(i)}readLine(){let t="";for(;;){let i=!1;for(let e=this.pointer;e<this.endPointer;e++)if(10===this.buffer[e]||13===this.buffer[e]){t+=this.readString(e-this.pointer),i=!0;break}if(i)break;t+=this.readString(this.remainingLength()),this.flush()}for(;;){const t=this.peekUint8();if(10!==t&&13!==t)break;this.readUint8()}return t}peekLine(){this.remainingLength()<this.size&&this.flush();let t="",i=!1;for(let e=this.pointer;e<this.endPointer;e++)if(10===this.buffer[e]||13===this.buffer[e]){t+=this.peekString(e-this.pointer),i=!0;break}return i||(this.error=-1048575,o.h2("peekLine, out of buffer",U,502)),t}getPointer(){return this.pointer}getPos(){return this.pos}skip(t){const i=t;for(;this.remainingLength()<t;)t-=this.remainingLength(),this.pointer=this.endPointer,this.flush();this.remainingLength()>=t&&(this.pointer+=t),this.pos+=BigInt(i)}remainingLength(){return this.endPointer-this.pointer}flush(t=0){if(this.onFlush||(this.error=-1048575,o.h2("IOReader error, flush failed because of no flush callback",U,560)),!(this.size-this.remainingLength()<=0))if(t=Math.min(t,this.size),this.pointer<this.endPointer?(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer):this.endPointer=0,this.pointer=0,t)for(;this.remainingLength()<t;){const t=this.onFlush(this.buffer.subarray(this.endPointer));if(t<0)throw this.error=t,new Error(`IOReader error, flush ${-1048576===t?"ended":"failed"}, ret: ${t}`);this.endPointer+=t}else{const t=this.onFlush(this.buffer.subarray(this.endPointer));if(t<0)throw this.error=t,new Error(`IOReader error, flush ${-1048576===t?"ended":"failed"}, ret: ${t}`);this.endPointer+=t}}seek(t,i=!1,e=!0){if(!i){const i=Number(t-this.pos);if(i<0&&Math.abs(i)<this.pointer)return this.pointer+=i,void(this.pos=t);if(i>0&&this.pointer+i<this.endPointer)return this.pointer+=i,void(this.pos=t);if(0===i)return}this.onSeek||(this.error=-1048575,o.h2("IOReader error, seek failed because of no seek callback",U,620)),this.pointer=this.endPointer=0,this.pos=t;const s=this.onSeek(t);0!==s&&(this.error=s,o.h2("IOReader error, seek failed",U,629)),e&&this.flush()}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const i=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,i),this.endPointer),this.endPointer+=i,o.R8("IOReader, call appendBuffer but the buffer's size is lagger then the remaining size",U,660)}}reset(){this.pointer=this.endPointer=0,this.pos=BigInt(0),this.error=0}setEndian(t){this.littleEndian=!t}fileSize(){return this.fileSize_||(this.onSize||(this.error=-1048575,o.h2("IOReader error, fileSize failed because of no onSize callback",U,681)),this.fileSize_=this.onSize()),this.fileSize_}getBufferSize(){return this.size}pipe(t,i){if(i)if(this.remainingLength()<i){if(this.remainingLength()>0){const e=this.remainingLength();t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+e)),this.pointer+=e,this.pos+=BigInt(e),i-=e}for(;i>0;){this.flush();const e=Math.min(this.endPointer-this.pointer,i);t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+e)),this.pointer+=e,this.pos+=BigInt(e),i-=e}}else t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+i)),this.pointer+=i,this.pos+=BigInt(i);else{if(this.remainingLength()>0){const i=this.remainingLength();t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+i)),this.pointer+=i,this.pos+=BigInt(i)}for(;this.onFlush(this.buffer.subarray(0))>0;){const i=this.remainingLength();t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+i)),this.pointer+=i,this.pos+=BigInt(i)}}}}var v="src/avformat/formats/IOggsFormat.ts";class A extends c.A{constructor(){super(),(0,s.A)(this,"type",3),(0,s.A)(this,"headerPagesPayload",void 0),(0,s.A)(this,"page",void 0),this.page=new a,this.headerPagesPayload=[]}init(t){t.ioReader&&t.ioReader.setEndian(!1),t.ioReader&&t.ioReader.setEndian(!1)}async readHeader(t){try{let i=await t.ioReader.peekString(4);if("OggS"!==i)return o.z3("the file format is not oggs",v,76),p.LR;await this.page.read(t.ioReader);let e=new w(this.page.payload.length,!1);if(e.appendBuffer(this.page.payload),i=e.peekString(8),"OpusHead"===i){const i=new g;i.read(e);const s=new u;this.page.reset(),await this.page.read(t.ioReader),e=new w(this.page.payload.length,!1),e.appendBuffer(this.page.payload),s.read(e),this.headerPagesPayload=[i,s];const n=t.createStream();n.codecpar.codecType=1,n.codecpar.codecId=86076,n.codecpar.sampleRate=this.headerPagesPayload[0].sampleRate,n.codecpar.chLayout.nbChannels=this.headerPagesPayload[0].channels,n.codecpar.channels=this.headerPagesPayload[0].channels,n.timeBase.den=n.codecpar.sampleRate,n.timeBase.num=1,n.privData={serialNumber:this.page.serialNumber},this.onStreamAdd&&this.onStreamAdd(n)}return 0}catch(i){return o.z3(i.message,v,128),t.ioReader.error}}async readAVPacket(t,i){if(!this.headerPagesPayload.length||"OpusHead"!==this.headerPagesPayload[0].signature)return p.E$;r.M[17](i+56,t.ioReader.getPos());let e=!1;try{this.page.reset(),await this.page.read(t.ioReader),r.M[17](i+16,this.page.granulePosition),r.M[17](i+8,this.page.granulePosition);const s=this.page.payload.length,h=(0,b.sY)(s);(0,m.lW)(h,s,this.page.payload),(0,S.NX)(i,h,s);let a=t.streams.find((t=>t.privData.serialNumber===this.page.serialNumber));a&&(r.M[15](i+32,a.index),r.M[15](i+76,a.timeBase.den),r.M[15](i+72,a.timeBase.num),86076===a.codecpar.codecId&&r.M[15](i+36,1|n.f[15](i+36))),e=!0;let o=await t.ioReader.peekBuffer(6);for(;1&o[5];){this.page.reset(),await this.page.read(t.ioReader),r.M[17](i+16,this.page.granulePosition),r.M[17](i+8,this.page.granulePosition);const e=(0,f.A)(Uint8Array,[(0,S.iI)(i),this.page.payload]);(0,b.Eb)(n.f[20](i+24));const s=(0,b.sY)(e.length);(0,m.lW)(s,e.length,e),r.M[20](i+24,s),r.M[15](i+28,e.length),o=await t.ioReader.peekBuffer(6)}return 0}catch(i){return-1048576!==t.ioReader.error&&o.z3(i.message,v,192),e?0:t.ioReader.error}}async seek(t,i,e,s){return BigInt(p.E$)}getAnalyzeStreamsCount(){return 1}}},2647:(t,i,e)=>{function s(t,i){if(!i.length)return null;if(1===i.length)return i[0];let e,s=0;for(e of i)s+=e.length;let n=new t(s),r=0;for(e of i)n.set(e,r),r+=e.length;return n}e.d(i,{A:()=>s})},6795:(t,i,e)=>{e.d(i,{A:()=>h});var s=e(1026),n=e(2647),r=e(11);class h{constructor(t,i=!0){(0,s.A)(this,"data",void 0),(0,s.A)(this,"buffer",void 0),(0,s.A)(this,"byteStart",void 0),(0,s.A)(this,"pos",void 0),(0,s.A)(this,"size",void 0),(0,s.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!i}readUint8(){return this.data.getUint8(this.pos+++this.byteStart)}readUint16(){const t=this.data.getUint16(this.pos+this.byteStart,this.littleEndian);return this.pos+=2,t}readUint24(){return this.readUint16()<<8|this.readUint8()}readUint32(){const t=this.data.getUint32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,t}readUint64(){const t=BigInt(this.readUint32()),i=BigInt(this.readUint32());return this.littleEndian?i<<BigInt(32)|t:t<<BigInt(32)|i}readInt8(){return this.data.getInt8(this.pos+++this.byteStart)}readInt16(){const t=this.data.getInt16(this.pos+this.byteStart,this.littleEndian);return this.pos+=2,t}readInt32(){const t=this.data.getInt32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,t}readInt64(){const t=BigInt(this.readInt32()),i=BigInt(this.readInt32());return this.littleEndian?i<<BigInt(32)|t:t<<BigInt(32)|i}readFloat(){const t=this.data.getFloat32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,t}readDouble(){const t=this.data.getFloat64(this.pos+this.byteStart,this.littleEndian);return this.pos+=8,t}readHex(t=1){let i="";for(let e=0;e<t;e++){const t=this.readUint8().toString(16);i+=1===t.length?"0"+t:t}return i}readString(t=1){let i="";if(t){let e=this.pos;for(let i=0;i<t&&0===this.buffer[this.pos+i];i++)e++;i=r.D(this.buffer.subarray(e,e+t))}return this.pos+=t,i}readLine(){let t="";for(let i=this.pos;i<this.size;i++)if(10===this.buffer[i]||13===this.buffer[i]){t+=this.readString(i-this.pos);break}for(let t=this.pos;t<this.size&&(10===this.buffer[t]||13===this.buffer[t]);t++)this.readUint8();return t}getPos(){return BigInt(this.pos)}seek(t){t>this.size&&(t=this.size),this.pos=Math.max(0,t)}skip(t){this.seek(this.pos+t)}back(t){this.seek(this.pos-t)}remainingSize(){return this.size-this.pos}readBuffer(t){t=Math.min(t,this.remainingSize());const i=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,i}appendBuffer(t){this.buffer=(0,n.A)(Uint8Array,[this.buffer.slice(),t.slice()]),this.data=new DataView(this.buffer.buffer),this.size+=t.byteLength,this.byteStart=0}resetBuffer(t,i=!0){this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!i}}}}]);