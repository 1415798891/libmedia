"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[47],{58469:(t,e,i)=>{i.d(e,{En:()=>o,Hm:()=>n,Ij:()=>c,XC:()=>l,_5:()=>d,hY:()=>s,uF:()=>r});var a=i(77231);const r={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,a.N_,a.N_,a.N_],o=[a.N_,1,2,3,4,5,6,7];function d(t){let e=a.N_,i=a.N_,r=a.N_;var n,d;return t.length>=2&&(e=t[0]>>3&31,i=null!==(n=s[(7&t[0])<<1|t[1]>>7])&&void 0!==n?n:48e3,r=null!==(d=o[t[1]>>3&15])&&void 0!==d?d:2),{profile:e,sampleRate:i,channels:r}}function l(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e){const{profile:i,sampleRate:a,channels:r}=d(e);t.codecpar.profile=i,t.codecpar.sampleRate=a,t.codecpar.chLayout.nbChannels=r}}function c(t){const e=n[t.sampleRate],i=t.chLayout.nbChannels,a=new Uint8Array(2);return a[0]=(31&t.profile)<<3|(14&e)>>1,a[1]=(1&e)<<7|(15&i)<<3,a}},90412:(t,e,i)=>{i.d(e,{Ui:()=>h,XC:()=>u,Yj:()=>m,k9:()=>f,zk:()=>d});var a=i(63939),r=i(37246),n=i(11573),s=i(83314),o=i(97317);const d={0:"Main",1:"High",2:"Professional"},l=[{level:20,maxResolution:2359296},{level:21,maxResolution:4460544},{level:30,maxResolution:10653696},{level:31,maxResolution:17040384},{level:40,maxResolution:21233664},{level:41,maxResolution:21233664},{level:50,maxResolution:35651584},{level:51,maxResolution:35651584},{level:52,maxResolution:35651584},{level:53,maxResolution:35651584},{level:60,maxResolution:142606336},{level:61,maxResolution:142606336},{level:62,maxResolution:142606336},{level:63,maxResolution:142606336}],c=[20,21,22,23,30,31,32,33,40,41,42,43,50,51,52,53,60,61,62,63,70,71,72,73];function f(t,e,i){const a=t*e;for(const t of l)if(a<=t.maxResolution)return t.level}function u(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=4){const i=h(e);t.codecpar.profile=i.profile,t.codecpar.level=i.level}}function h(t){const e=new r.A(t.length);e.appendBuffer(t),e.readU1(),e.readU(7);const i=e.readU(3),a=e.readU(5),n=e.readU1();let s=e.readU1()?10:8;return e.readU1()&&(s=12),{profile:i,level:a,tier:n,bitDepth:s,monochrome:e.readU1(),chromaSubsamplingX:e.readU1(),chromaSubsamplingY:e.readU1(),chromaSamplePosition:e.readU(2)}}function m(t,e){const i=new s.A(4);i.writeU1(1),i.writeU(7,1);const d=function(t){const e=new r.A;e.appendBuffer(t);const i=[];for(;e.remainingLength();){const a=e.getPos();e.readU1(),e.readU(4);const r=e.readU1(),s=e.readU1();e.readU1(),r&&e.readU(8);const o=s?n.v(e):t.length-1-r,d=e.getPos()-a;i.push(t.subarray(a,a+d+o)),e.skip(8*o)}return i}(e).find((t=>1==(t[0]>>>3&15)));if(d){const t=function(t){const e=new r.A(t.length);e.appendBuffer(t),e.readU1(),e.readU(4);const i=e.readU1(),a=e.readU1();e.readU1(),i&&e.readU(8),a&&n.v(e);const s=n.f(e,3),o=(n.f(e,1),n.f(e,1));let d=0,l=0,f=[0],u=[0],h=[0],m=[0],p=[0],w=[0],g=0,U=[0],v=[0],b=[0];if(o)u[0]=n.f(e,5);else{d=n.f(e,1),d?(n.f(e,32),n.f(e,32),n.f(e,1)&&n.d(e),n.f(e,1)&&(g=n.f(e,5),n.f(e,32),n.f(e,5),n.f(e,5))):l=0;let t=n.f(e,1),i=n.f(e,5);for(let a=0;a<=i;a++){if(f[a]=n.f(e,12),u[a]=n.f(e,5),u[a]>7?h[a]=n.f(e,1):h[a]=0,l){if(m[a]=n.f(e,1),m[a]){let t=g+1;U[a]=n.f(e,t),v[a]=n.f(e,t),b[a]=n.f(e,1)}}else m[a]=0;t&&(p[a]=n.f(e,1),p[a]&&(w[a]=n.f(e,4)))}}let z=n.f(e,4),x=n.f(e,4),k=z+1,A=n.f(e,k);k=x+1;let P=n.f(e,k),I=0,S=0,B=0;I=o?0:n.f(e,1),I&&(n.f(e,4),n.f(e,3)),n.f(e,1),n.f(e,1),n.f(e,1);let y=0,R=0,M=0,D=0,F=0,C=0,N=2,L=2,_=0;o||(n.f(e,1),n.f(e,1),n.f(e,1),n.f(e,1),D=n.f(e,1),D?(F=n.f(e,1),C=n.f(e,1)):(F=0,C=0),N=n.f(e,1)?2:n.f(e,1),N>0?n.f(e,1)?2:n.f(e,1):2,D&&n.f(e,3)),n.f(e,1),n.f(e,1),n.f(e,1);let $=n.f(e,1),E=0,T=0,O=0;2==s&&$?(E=n.f(e,1),T=E?12:10):s<=2&&(T=$?10:8),O=1==s?0:n.f(e,1);let W=0,Y=0,X=0;n.f(e,1)?(W=n.f(e,8),Y=n.f(e,8),X=n.f(e,8)):(W=2,Y=2,X=2);let H=0,J=0,V=0,j=0,G=0;return O?(H=n.f(e,1),J=1,V=1,j=0,G=0):1==W&&13==Y&&0==X?(H=1,J=0,V=0,G=n.f(e,1)):(H=n.f(e,1),0==s?(J=1,V=1):1==s?(J=0,V=0):12==T?(J=n.f(e,1),V=J?n.f(e,1):0):(J=1,V=0),J&&V&&(j=n.f(e,2)),G=n.f(e,1)),n.f(e,1),{width:A+1,height:P+1,profile:s,level:c[u[0]],tier:h[0],bitDepth:T,monoChrome:O,colorRange:H,colorPrimaries:W,transferCharacteristics:Y,matrixCoefficients:X,subsamplingX:J,subsamplingY:V,chromaSamplePosition:j}}(d);i.writeU(3,t.profile),i.writeU(5,t.level),i.writeU(1,t.tier),i.writeU(1,t.bitDepth>8?1:0),i.writeU(1,12===t.bitDepth?1:0),i.writeU(1,t.monoChrome),i.writeU(1,t.subsamplingX),i.writeU(1,t.subsamplingY),i.writeU(1,t.chromaSamplePosition)}else{const e=o.g[a.f[15](t+28)];i.writeU(3,a.f[15](t+48)),i.writeU(5,a.f[15](t+52)),i.writeU(1,0),i.writeU(1,e.comp[0].depth>8?1:0),i.writeU(1,12===e.comp[0].depth?1:0),i.writeU(1,0),i.writeU(1,1),i.writeU(1,1),i.writeU(1,0)}return i.writeU(8,0),i.getBuffer()}},20620:(t,e,i)=>{i.d(e,{Jk:()=>A,OD:()=>k,XC:()=>I,ci:()=>P,k9:()=>v,oT:()=>x,tZ:()=>g});var a=i(63939),r=i(50932),n=i(72739),s=i(729),o=i(31865),d=i(37246),l=i(4624),c=i(14686),f=i(71517),u=i(60264),h=i(37837),m=i(23991),p="src/avformat/codecs/h264.ts";const w=3,g={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"},U=[{level:10,maxResolution:25344,maxFrameRate:15},{level:11,maxResolution:25344,maxFrameRate:30},{level:12,maxResolution:101376,maxFrameRate:30},{level:13,maxResolution:101376,maxFrameRate:30},{level:20,maxResolution:101376,maxFrameRate:30},{level:21,maxResolution:202752,maxFrameRate:30},{level:22,maxResolution:414720,maxFrameRate:30},{level:30,maxResolution:414720,maxFrameRate:30},{level:31,maxResolution:921600,maxFrameRate:30},{level:32,maxResolution:1310720,maxFrameRate:60},{level:40,maxResolution:2097152,maxFrameRate:30},{level:41,maxResolution:2097152,maxFrameRate:60},{level:42,maxResolution:2228224,maxFrameRate:60},{level:50,maxResolution:8912896,maxFrameRate:30},{level:51,maxResolution:8912896,maxFrameRate:60},{level:52,maxResolution:8912896,maxFrameRate:120},{level:60,maxResolution:35651584,maxFrameRate:30},{level:61,maxResolution:35651584,maxFrameRate:60},{level:62,maxResolution:35651584,maxFrameRate:120}];function v(t,e,i){const a=t*e;for(const t of U)if(a<=t.maxResolution&&i<=t.maxFrameRate)return t.level}function b(t){const e=new o.A(t);e.skip(5);const i=[],a=[],r=[],n=31&e.readUint8();for(let t=0;t<n;t++){const t=e.readUint16();i.push(e.readBuffer(t))}const s=e.readUint8();for(let t=0;t<s;t++){const t=e.readUint16();a.push(e.readBuffer(t))}if(e.remainingSize()>4){e.skip(3);const t=e.readUint8();if(t>0)for(let i=0;i<t;i++){const t=e.readUint16();r.push(e.readBuffer(t))}}return{spss:i,ppss:a,spsExts:r}}function z(t,e,i=[]){t.length>32&&(l.R8(`h264 metadata's sps max length is 32, but get ${t.length}`,p,199),t=t.slice(0,32)),t.length>256&&(l.R8(`h264 metadata's pps max length is 256, but get ${t.length}`,p,203),t=t.slice(0,256));let a=7;a=t.reduce(((t,e)=>t+2+e.length),a),a=e.reduce(((t,e)=>t+2+e.length),a);const r=t[0],o=S(r);66!==o.profile&&77!==o.profile&&88!==o.profile&&(a+=4,i.length&&(a=i.reduce(((t,e)=>t+2+e.length),a)));const d=new Uint8Array(a),c=new s.A(d);return c.writeUint8(1),c.writeUint8(r[1]),c.writeUint8(r[2]),c.writeUint8(r[3]),c.writeUint8(252|w),c.writeUint8(224|31&t.length),n.__(t,(t=>{c.writeUint16(t.length),c.writeBuffer(t)})),c.writeUint8(e.length),n.__(e,(t=>{c.writeUint16(t.length),c.writeBuffer(t)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(c.writeUint8(252|o.chromaFormatIdc),c.writeUint8(248|o.bitDepthLumaMinus8),c.writeUint8(248|o.bitDepthChromaMinus8),i.length&&n.__(i,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),d}function x(t){let e,i=(0,u.py)(t),a=!1;if(i.length>1){const t=[],a=[],r=[];i.forEach((e=>{const i=31&e[0];7===i?t.push(e):8===i?a.push(e):13===i&&r.push(e)})),t.length&&a.length&&(e=z(t,a,r)),i=i.filter((t=>{const e=31&t[0];return 9!==e&&8!==e&&7!==e&&13!==e}))}const r=i.reduce(((t,e)=>t+w+1+e.length),0),o=(0,h.sY)(r),d=(0,c.s3)(o,r),l=new s.A(d);return n.__(i,(t=>{3===w?l.writeUint32(t.length):2===w?l.writeUint24(t.length):1===w?l.writeUint16(t.length):l.writeUint8(t.length),l.writeBuffer(t.subarray(0)),5==(31&t[0])&&(a=!0)})),{bufferPointer:o,length:r,key:a,extradata:e}}function k(t,e){const i=e?3&e[4]:w;let a=[],r=[],d=[],l=!1;if(e){const t=b(e);a=t.spss,r=t.ppss,d=t.spsExts,l=!0}const f=[],u=[],m=new o.A(t);for(;m.remainingSize()>0;){let e=0;e=3===i?m.readUint32():2===i?m.readUint24():1===i?m.readUint16():m.readUint8();const a=t.subarray(0|Number(0xffffffffn&m.getPos()),(0|Number(0xffffffffn&m.getPos()))+e);m.skip(e);const r=31&a[0];6===r?u.push(a):9!==r&&f.push(a)}let p=a.reduce(((t,e)=>t+4+e.length),0);p=r.reduce(((t,e)=>t+4+e.length),p),p=d.reduce(((t,e)=>t+4+e.length),p),p=u.reduce(((t,e)=>t+4+e.length),p),p=f.reduce(((t,e,i)=>t+(i?3:4)+e.length),p);const g=(0,h.sY)(p+6),U=new s.A((0,c.s3)(g,p+6));return U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeUint8(9),U.writeUint8(240),n.__(u,(t=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(t)})),n.__(a,(t=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(t)})),n.__(r,(t=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(t)})),n.__(d,(t=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(t)})),n.__(f,((t,e)=>{U.writeUint8(0),U.writeUint8(0),e||U.writeUint8(0),U.writeUint8(1),U.writeBuffer(t),5==(31&t[0])&&(l=!0)})),{bufferPointer:g,length:p+6,key:l}}function A(t,e){var i;if(!(1&a.f[15](t+36)))return;const r=(0,f.iI)(t);if((0,u.Bs)(r))return;const n=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:w;let s=[],d=[],l=[],m=[];const p=new o.A(r);for(;p.remainingSize()>0;){let t=0;t=3===n?p.readUint32():2===n?p.readUint24():1===n?p.readUint16():p.readUint8();const e=r.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=31&e[0];7===i?s.push(e):8===i?d.push(e):13===i?l.push(e):m.push(e)}if(s.length||d.length){const e=z(s,d,l),i=(0,h.sY)(e.length);(0,c.lW)(i,e.length,e),(0,f.Ow)(t,1,i,e.length)}}function P(t,e=!1){if(!(1&a.f[15](t+36)||e))return;const i=(0,f.iI)(t);if(!(0,u.Bs)(i))return;let n=(0,u.py)(i);if(n.length>1){const e=[],i=[],s=[];if(n.forEach((t=>{const a=31&t[0];7===a?e.push(t):8===a?i.push(t):13===a&&s.push(t)})),e.length&&i.length){const n=z(e,i,s),o=(0,h.sY)(n.length);(0,c.lW)(o,n.length,n),(0,f.Ow)(t,1,o,n.length),r.M[15](t+36,1|a.f[15](t+36))}}}function I(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[4];const{spss:i}=b(e);if(i.length){const{profile:e,level:a,width:r,height:n}=S(i[0]);t.codecpar.profile=e,t.codecpar.level=a,t.codecpar.width=r,t.codecpar.height=n}}}function S(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const i=(0,u.BN)(t.subarray(e)),a=new d.A(i.length);a.appendBuffer(i),a.readU1(),a.readU(2),a.readU(5);const r=a.readU(8);a.readU1(),a.readU1(),a.readU1(),a.readU1(),a.readU1(),a.readU1(),a.readU(2);const n=a.readU(8);m.xb(a);let s=1,o=0,l=0;if((100==r||110==r||122==r||244==r||44==r||83==r||86==r||118==r||128==r||138==r||139==r||134==r||135==r)&&(s=m.xb(a),3===s&&a.readU1(),o=m.xb(a),l=m.xb(a),a.readU1(),a.readU1())){const t=new Array(8);for(let e=0;e<(3!=s?8:12);e++)t[e]=a.readU1()}m.xb(a);const c=m.xb(a);if(0===c)m.xb(a);else if(1===c){a.readU1(),m.$x(a),m.$x(a);const t=m.xb(a);for(let e=0;e<t;e++)m.$x(a)}m.xb(a),a.readU1();const f=m.xb(a),h=m.xb(a),p=a.readU1();let w=16*(f+1),g=(2-p)*(h+1)*16;p||a.readU1(),a.readU1();const U=a.readU1();if(U){let t=1,e=2-U;1===s?(t=2,e=2*(2-U)):2===U&&(t=2,e=2-U),w-=t*(m.xb(a)+m.xb(a)),g-=e*(m.xb(a)+m.xb(a))}return{profile:r,level:n,width:w,height:g,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:l}}},53e3:(t,e,i)=>{i.d(e,{Jk:()=>x,OD:()=>z,XC:()=>A,ci:()=>k,dT:()=>m,k9:()=>w,oT:()=>b});var a=i(63939),r=i(50932),n=i(72739),s=i(729),o=i(31865),d=i(37246),l=i(14686),c=i(60264),f=i(71517),u=i(37837),h=i(23991);const m={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},p=[{level:10,maxLumaSamplesPerSecond:552960,maxLumaPictureSize:36864,maxBitRate:{main:128,main10:150}},{level:20,maxLumaSamplesPerSecond:3686400,maxLumaPictureSize:122880,maxBitRate:{main:1500,main10:1875}},{level:21,maxLumaSamplesPerSecond:7372800,maxLumaPictureSize:245760,maxBitRate:{main:3e3,main10:3750}},{level:30,maxLumaSamplesPerSecond:16588800,maxLumaPictureSize:552960,maxBitRate:{main:6e3,main10:7500}},{level:31,maxLumaSamplesPerSecond:33177600,maxLumaPictureSize:983040,maxBitRate:{main:1e4,main10:12500}},{level:40,maxLumaSamplesPerSecond:66846720,maxLumaPictureSize:2228224,maxBitRate:{main:12e3,main10:15e3}},{level:41,maxLumaSamplesPerSecond:133693440,maxLumaPictureSize:2228224,maxBitRate:{main:2e4,main10:25e3}},{level:50,maxLumaSamplesPerSecond:267386880,maxLumaPictureSize:8912896,maxBitRate:{main:25e3,main10:4e4}},{level:51,maxLumaSamplesPerSecond:534773760,maxLumaPictureSize:8912896,maxBitRate:{main:4e4,main10:6e4}},{level:52,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:60,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:61,maxLumaSamplesPerSecond:2139095040,maxLumaPictureSize:89128960,maxBitRate:{main:12e4,main10:24e4}},{level:62,maxLumaSamplesPerSecond:4278190080,maxLumaPictureSize:356515840,maxBitRate:{main:24e4,main10:48e4}}];function w(t,e,i,a,r){const n=1===t?"main":"main10",s=e*i*a;for(const t of p)if(s<=t.maxLumaSamplesPerSecond&&e*i<=t.maxLumaPictureSize&&r<=t.maxBitRate[n])return t.level}const g=3;function U(t){const e=new o.A(t,!0);e.skip(22);let i=[],a=[],r=[];const n=e.readUint8();for(let t=0;t<n;t++){const t=63&e.readUint8(),n=e.readUint16(),s=[];for(let t=0;t<n;t++){const t=e.readUint16();s.push(e.readBuffer(t))}32===t?i=s:33===t?a=s:34===t&&(r=s)}return{vpss:i,spss:a,ppss:r}}function v(t,e,i){const a=e[0];let r=23;t.length&&(r+=3,r=t.reduce(((t,e)=>t+2+e.length),r)),e.length&&(r+=3,r=e.reduce(((t,e)=>t+2+e.length),r)),i.length&&(r+=3,r=i.reduce(((t,e)=>t+2+e.length),r));const o=new Uint8Array(r),d=new s.A(o,!0),l=P(a);d.writeUint8(1),d.writeUint8(a[1]),d.writeUint8(a[2]),d.writeUint8(a[3]),d.writeUint8(a[4]),d.writeUint8(a[5]),d.writeUint8(a[6]),d.writeUint8(a[7]),d.writeUint8(a[8]),d.writeUint8(a[9]),d.writeUint8(a[10]),d.writeUint8(a[11]),d.writeUint8(l.level),d.writeUint8(1020),d.writeUint8(0),d.writeUint8(16320),d.writeUint8(16320|l.chromaFormatIdc),d.writeUint8(8160|l.bitDepthLumaMinus8),d.writeUint8(8160|l.bitDepthChromaMinus8),d.writeUint16(0),d.writeUint8(8|(1&a[0])<<2|g);let c=0;return t.length&&c++,e.length&&c++,i.length&&c++,d.writeUint8(c),t.length&&(d.writeUint8(160),d.writeUint16(t.length),n.__(t,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),e.length&&(d.writeUint8(161),d.writeUint16(e.length),n.__(e,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),i.length&&(d.writeUint8(162),d.writeUint16(i.length),n.__(i,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),o}function b(t){let e,i=!1,a=(0,c.py)(t);if(a.length>2){const t=[],i=[],r=[];a.forEach((e=>{const a=e[0]>>>1&63;32===a?t.push(e):33===a?i.push(e):34===a&&r.push(e)})),t.length&&i.length&&r.length&&(e=v(t,i,r),a=a.filter((t=>{const e=t[0]>>>1&63;return 32!==e&&33!==e&&34!==e&&35!==e})))}const r=a.reduce(((t,e)=>t+g+1+e.length),0),o=(0,u.sY)(r),d=(0,l.s3)(o,r),f=new s.A(d);return n.__(a,(t=>{3===g?f.writeUint32(t.length):2===g?f.writeUint24(t.length):1===g?f.writeUint16(t.length):f.writeUint8(t.length),f.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;19!==e&&20!==e&&21!==e||(i=!0)})),{bufferPointer:o,length:r,extradata:e,key:i}}function z(t,e){const i=e?3&e[21]:g;let a=[],r=[],d=[],c=!1;if(e){const t=U(e);a=t.vpss,r=t.spss,d=t.ppss,c=!0}const f=[],h=new o.A(t);for(;h.remainingSize()>0;){let t=0;t=3===i?h.readUint32():2===i?h.readUint24():1===i?h.readUint16():h.readUint8(),f.push(h.readBuffer(t))}let m=a.reduce(((t,e)=>t+4+e.length),0);m=r.reduce(((t,e)=>t+4+e.length),m),m=d.reduce(((t,e)=>t+4+e.length),m),m=f.reduce(((t,e,i)=>t+(i?3:4)+e.length),m);const p=(0,u.sY)(m+7),w=(0,l.s3)(p,m+7),v=new s.A(w);return v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeUint8(70),v.writeUint8(0),v.writeUint8(240),n.__(a,(t=>{v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t)})),n.__(r,(t=>{v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t)})),n.__(d,(t=>{v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t)})),n.__(f,((t,e)=>{v.writeUint8(0),v.writeUint8(0),e||v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t);const i=t[0]>>>1&63;19!==i&&20!==i&&21!==i||(c=!0)})),{bufferPointer:p,length:m+7,key:c}}function x(t,e){var i;if(!(1&a.f[15](t+36)))return;const r=(0,f.iI)(t);if((0,c.Bs)(r))return;const n=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:g;let s=[],d=[],h=[];const m=new o.A(r);for(;m.remainingSize()>0;){let t=0;t=3===n?m.readUint32():2===n?m.readUint24():1===n?m.readUint16():m.readUint8();const e=r.subarray(0|Number(0xffffffffn&m.getPos()),(0|Number(0xffffffffn&m.getPos()))+t);m.skip(t);const i=e[0]>>>1&63;33===i?d.push(e):34===i?h.push(e):32===i&&s.push(e)}if(d.length||h.length||s.length){const e=v(s,d,h),i=(0,u.sY)(e.length);(0,l.lW)(i,e.length,e),(0,f.Ow)(t,1,i,e.length)}}function k(t,e=!1){if(!(1&a.f[15](t+36)||e))return;const i=(0,f.iI)(t);if(!(0,c.Bs)(i))return;let n=(0,c.py)(i);if(n.length>2){const e=[],i=[],s=[];if(n.forEach((t=>{const a=t[0]>>>1&63;32===a?e.push(t):33===a?i.push(t):34===a&&s.push(t)})),e.length&&i.length&&s.length){const n=v(e,i,s),o=(0,u.sY)(n.length);(0,l.lW)(o,n.length,n),(0,f.Ow)(t,1,o,n.length),r.M[15](t+36,1|a.f[15](t+36))}}}function A(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[21];const{spss:i}=U(e);if(i.length){const{profile:e,level:a,width:r,height:n}=P(i[0]);t.codecpar.profile=e,t.codecpar.level=a,t.codecpar.width=r,t.codecpar.height=n}}}function P(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,a=0,r=0,n=0,s=0,o=0,l=1,f=0,u=0,m=0,p=0;const w=(0,c.BN)(t.subarray(e)),g=new d.A(w.length);g.appendBuffer(w),g.readU1(),g.readU(6),g.readU(6),g.readU(3),g.readU(4);const U=g.readU(3);if(g.readU1(),U<=6){f=g.readU(2),u=g.readU1(),i=g.readU(5),m=g.readU(32),p=g.readU(48),a=g.readU(8);const t=new Array(6),e=new Array(6);for(let i=0;i<U;i++)t[i]=g.readU1(),e[i]=g.readU1();if(U>0)for(let t=U;t<8;t++)g.readU(2);for(let i=0;i<U;i++)t[i]&&(g.readU(2),g.readU(1),g.readU(5),g.readU(32),g.readU(1),g.readU(1),g.readU(1),g.readU(1),g.readU(44)),e[i]&&g.readU(8);h.xb(g),l=h.xb(g),3===l&&g.readU(1),r=h.xb(g),n=h.xb(g);let d=0,c=0,w=0,v=0;g.readU1()&&(d=h.xb(g),c=h.xb(g),w=h.xb(g),v=h.xb(g)),s=h.xb(g),o=h.xb(g);let b=2,z=2;0===l?b=z=0:2===l?(b=2,z=1):3===l&&(b=z=1),r-=b*(1<<s+1)*(d+c),n-=z*(1<<s+1)*(w+v)}return{profile:i,level:a,width:r,height:n,chromaFormatIdc:l,bitDepthLumaMinus8:s,bitDepthChromaMinus8:o,generalProfileSpace:f,generalTierFlag:u,generalProfileCompatibilityFlag:m,constraintFlags:p}}},65451:(t,e,i)=>{i.d(e,{Ij:()=>l,XC:()=>d,kt:()=>o});var a=i(31865),r=i(729),n=i(44328);const s=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(t){let e=0,i=0,a=0;if(t.length<1)return 0;switch(e=t[0],i=s[e>>3],3&e){case 0:a=1;break;case 1:case 2:a=2;break;case 3:if(t.length<2)return 0;a=63&t[1]}return a*i}function d(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=19){const i=new a.A(e,!1);i.skip(9),t.codecpar.chLayout.nbChannels=i.readUint8(),t.codecpar.initialPadding=i.readUint16(),t.codecpar.sampleRate=i.readUint32(),t.codecpar.seekPreroll=Number((0,n.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function l(t){const e=new Uint8Array(19),i=new r.A(e,!1);return i.writeString("OpusHead"),i.writeUint8(1),i.writeUint8(t.chLayout.nbChannels),i.writeUint16(t.initialPadding),i.writeUint32(t.sampleRate),e}},58919:(t,e,i)=>{i.d(e,{Ui:()=>p,XC:()=>m,Yj:()=>w,k9:()=>h,wN:()=>f});var a=i(63939),r=i(9599),n=i(29170),s=i(37246),o=i(77231),d=i(97317),l=i(44328),c=i(729);const f={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"},u=[{level:10,maxResolution:196608,maxFrameRate:30},{level:11,maxResolution:196608,maxFrameRate:60},{level:20,maxResolution:518400,maxFrameRate:30},{level:21,maxResolution:518400,maxFrameRate:60},{level:30,maxResolution:2073600,maxFrameRate:30},{level:31,maxResolution:2073600,maxFrameRate:60},{level:40,maxResolution:3686400,maxFrameRate:30},{level:41,maxResolution:3686400,maxFrameRate:60},{level:50,maxResolution:8294400,maxFrameRate:30},{level:51,maxResolution:8294400,maxFrameRate:60},{level:60,maxResolution:8847360,maxFrameRate:30},{level:61,maxResolution:8847360,maxFrameRate:60},{level:70,maxResolution:35389440,maxFrameRate:30},{level:71,maxResolution:35389440,maxFrameRate:60}];function h(t,e,i){const a=t*e;for(const t of u)if(a<=t.maxResolution&&i<=t.maxFrameRate)return t.level}function m(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){const i=p(e);t.codecpar.profile=i.profile,t.codecpar.level=i.level}}function p(t){const e=new s.A(t.length);return e.appendBuffer(t),{profile:e.readU(8),level:e.readU(8),bitDepth:e.readU(4),chromaSubsampling:e.readU(3),fullRangeFlag:e.readU1(),colorPrimaries:e.readU(8),colorTrc:e.readU(8),colorSpace:e.readU(8)}}function w(t){const e=new c.A(new Uint8Array(8)),i=function(t){let e=a.f[15](t+48),i=a.f[15](t+52);i===o.N_&&(i=h(a.f[15](t+56),a.f[15](t+60),(0,l.lb)((0,n.A)(t+72,r.P))));const s=d.g[a.f[15](t+28)];let c=a.f[15](t+40),f=1;s&&(c=s.comp[0].depth,1===s.log2ChromaW&&1===s.log2ChromaH?1===a.f[15](t+100)&&(f=0):1===s.log2ChromaW&&0===s.log2ChromaH?f=2:0===s.log2ChromaW&&0===s.log2ChromaH&&(f=3));const u=2===a.f[15](t+84)?1:0;return e===o.N_&&c&&(e=0==f||1==f?8==c?0:2:8==c?1:3),{profile:e,level:i,bitDepth:c,chromaSubsampling:f,fullRange:u}}(t);return e.writeUint8(i.profile),e.writeUint8(i.level),e.writeUint8(i.bitDepth<<4|i.chromaSubsampling<<1|i.fullRange),e.writeUint8(a.f[15](t+88)),e.writeUint8(a.f[15](t+92)),e.writeUint8(a.f[15](t+96)),e.writeUint16(0),e.getWroteBuffer()}},55611:(t,e,i)=>{i.d(e,{Jk:()=>z,OD:()=>b,Ui:()=>P,XC:()=>k,ci:()=>x,oT:()=>v});var a=i(63939),r=i(50932),n=i(72739),s=i(729),o=i(31865),d=i(37246),l=i(14686),c=i(60264),f=i(71517),u=i(37837),h=i(23991),m=i(83314);const p=3;function w(t){const e=t.readU(9),i=t.readU(3),a=t.readU(2),r=t.readU(2),n=t.readU(3);t.readU(5),t.readU(2);const s=t.readU(6),o=t.readU(7),d=t.readU(1),l=t.readU(8),c=t.readU(1),f=t.readU(1),u=[],h=[];if(s){for(let e=0;e<s-1;e++)u[e]=t.readU(8);u[s-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let a=i-2;a>=0;--a)e|=t.readU(1)<<a;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let a=i-2;a>=0;--a)e&1<<a&&(h[a]=t.readU(8))}const m=t.readU(8),p=[];if(m)for(let e=0;e<m;e++)p.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:n,chromaFormatIdc:r,constantFrameRate:a,generalProfileIdc:o,generalTierFlag:d,generalLevelIdc:l,ptlFrameOnlyConstraintFlag:c,ptlMultilayerEnabledFlag:f,generalConstraintInfo:u,sublayerLevelIdc:h,generalSubProfileIdc:p,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function g(t){const e=new o.A(t,!0);if(1&e.readUint8()){const i=new d.A;i.appendBuffer(t.subarray(1)),w(i),e.skip(i.getPos())}let i=[],a=[],r=[];const n=e.readUint8();for(let t=0;t<n;t++){const t=31&e.readUint8();let n=1;13!==t&&12!==t&&(n=e.readUint16());const s=[];for(let t=0;t<n;t++){const t=e.readUint16();s.push(e.readBuffer(t))}14===t?i=s:15===t?a=s:16===t&&(r=s)}return{vpss:i,spss:a,ppss:r}}function U(t,e,i){const a=e[0];let r;if(a){const t=A(a),e=new m.A;if(e.writeU(9,0),e.writeU(3,t.spsMaxSublayersMinus1+1),e.writeU(2,1),e.writeU(2,t.chromaFormatIdc),e.writeU(3,t.bitDepthMinus8),e.writeU(5,31),e.writeU(2,3),e.writeU(6,t.generalConstraintInfo.length),e.writeU(7,t.profile),e.writeU1(t.tierFlag),e.writeU(8,t.level),e.writeU1(t.ptlFrameOnlyConstraintFlag),e.writeU1(t.ptlMultilayerEnabledFlag),t.generalConstraintInfo.length){for(let i=0;i<t.generalConstraintInfo.length-1;i++)e.writeU(8,t.generalConstraintInfo[i]);e.writeU(6,t.generalConstraintInfo[t.generalConstraintInfo.length-1])}else e.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let i=0;for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)i=i<<1|t.ptlSublayerLevelPresentFlag[e];e.writeU(8,i)}for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)t.ptlSublayerLevelPresentFlag[i]&&e.writeU(8,t.sublayerLevelIdc[i]);e.writeU(8,t.generalSubProfileIdc.length);for(let i=0;i<t.generalSubProfileIdc.length;i++)e.writeU(32,t.sublayerLevelIdc[i]);e.writeU(16,t.width),e.writeU(16,t.height),e.writeU(16,0),e.padding(),r=e.getBuffer().subarray(0,e.getPointer())}let o=1+(r?r.length:0);t.length&&(o+=3,o=t.reduce(((t,e)=>t+2+e.length),o)),e.length&&(o+=3,o=e.reduce(((t,e)=>t+2+e.length),o)),i.length&&(o+=3,o=i.reduce(((t,e)=>t+2+e.length),o));const d=new Uint8Array(o),l=new s.A(d,!0);l.writeUint8(p<<1|(r?1:0)|248),r&&l.writeBuffer(r);let c=0;return t.length&&c++,e.length&&c++,i.length&&c++,l.writeUint8(c),t.length&&(l.writeUint8(142),l.writeUint16(t.length),n.__(t,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),e.length&&(l.writeUint8(143),l.writeUint16(e.length),n.__(e,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),i.length&&(l.writeUint8(144),l.writeUint16(i.length),n.__(i,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),d}function v(t){let e,i=!1,a=(0,c.py)(t);if(a.length>2){const t=[],i=[],r=[];a.forEach((e=>{const a=e[0]>>>1&63;14===a?t.push(e):15===a?i.push(e):16===a&&r.push(e)})),t.length&&i.length&&r.length&&(e=U(t,i,r),a=a.filter((t=>{const e=t[0]>>>1&63;return 14!==e&&15!==e&&16!==e&&20!==e})))}const r=a.reduce(((t,e)=>t+p+1+e.length),0),o=(0,u.sY)(r),d=(0,l.s3)(o,r),f=new s.A(d);return n.__(a,(t=>{3===p?f.writeUint32(t.length):2===p?f.writeUint24(t.length):1===p?f.writeUint16(t.length):f.writeUint8(t.length),f.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;8!==e&&7!==e&&9!==e&&10!==e||(i=!0)})),{bufferPointer:o,length:r,extradata:e,key:i}}function b(t,e){const i=e?e[0]>>>1&3:p;let a=[],r=[],d=[],c=!1;if(e){const t=g(e);a=t.vpss,r=t.spss,d=t.ppss,c=!0}const f=[],h=new o.A(t);for(;h.remainingSize()>0;){let t=0;t=3===i?h.readUint32():2===i?h.readUint24():1===i?h.readUint16():h.readUint8(),f.push(h.readBuffer(t))}let m=a.reduce(((t,e)=>t+4+e.length),0);m=r.reduce(((t,e)=>t+4+e.length),m),m=d.reduce(((t,e)=>t+4+e.length),m),m=f.reduce(((t,e,i)=>t+(i?3:4)+e.length),m);const w=(0,u.sY)(m+7),U=(0,l.s3)(w,m+7),v=new s.A(U);return v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeUint8(0),v.writeUint8(160),v.writeUint8(240),n.__(a,(t=>{v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t)})),n.__(r,(t=>{v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t)})),n.__(d,(t=>{v.writeUint8(0),v.writeUint8(0),v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t)})),n.__(f,((t,e)=>{v.writeUint8(0),v.writeUint8(0),e||v.writeUint8(0),v.writeUint8(1),v.writeBuffer(t);const i=t[0]>>>1&63;8!==i&&7!==i&&9!==i&&10!==i||(c=!0)})),{bufferPointer:w,length:m+7,key:c}}function z(t,e){var i;if(!(1&a.f[15](t+36)))return;const r=(0,f.iI)(t);if((0,c.Bs)(r))return;const n=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:p;let s=[],d=[],h=[];const m=new o.A(r);for(;m.remainingSize()>0;){let t=0;t=3===n?m.readUint32():2===n?m.readUint24():1===n?m.readUint16():m.readUint8();const e=r.subarray(0|Number(0xffffffffn&m.getPos()),(0|Number(0xffffffffn&m.getPos()))+t);m.skip(t);const i=e[0]>>>1&63;15===i?d.push(e):16===i?h.push(e):14===i&&s.push(e)}if(d.length||h.length||s.length){const e=U(s,d,h),i=(0,u.sY)(e.length);(0,l.lW)(i,e.length,e),(0,f.Ow)(t,1,i,e.length)}}function x(t,e=!1){if(!(1&a.f[15](t+36)||e))return;const i=(0,f.iI)(t);if(!(0,c.Bs)(i))return;let n=(0,c.py)(i);if(n.length>2){const e=[],i=[],s=[];if(n.forEach((t=>{const a=t[0]>>>1&63;14===a?e.push(t):15===a?i.push(t):16===a&&s.push(t)})),e.length&&i.length&&s.length){const n=U(e,i,s),o=(0,u.sY)(n.length);(0,l.lW)(o,n.length,n),(0,f.Ow)(t,1,o,n.length),r.M[15](t+36,1|a.f[15](t+36))}}}function k(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=e[0]>>>1&3;const{spss:i}=g(e);if(i.length){const{profile:e,level:a,width:r,height:n}=A(i[0]);t.codecpar.profile=e,t.codecpar.level=a,t.codecpar.width=r,t.codecpar.height=n}}}function A(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,a=0,r=0,n=0,s=0,o=1,l=0,f=0,u=0;const m=[],p=[],w=[],g=[],U=(0,c.BN)(t.subarray(e)),v=new d.A(U.length);v.appendBuffer(U),v.readU1(),v.readU1(),v.readU(6),v.readU(5),v.readU(3),v.readU(8);const b=v.readU(3);o=v.readU(2);const z=v.readU(2);if(v.readU(1)){if(i=v.readU(7),l=v.readU(1),a=v.readU(8),f=v.readU(1),u=v.readU(1),v.readU(1)){for(let t=0;t<8;t++)m[t]=v.readU(8);m[8]=v.readU(7);const t=v.readU(8);v.readU(t)}v.skipPadding();for(let t=b-1;t>=0;t--)p[t]=v.readU(1);v.skipPadding();for(let t=b-1;t>=0;t--)p[t]&&(w[t]=v.readU(8));const t=v.readU(8);if(t)for(let e=0;e<t;e++)g[e]=v.readU(32)}v.readU1(),v.readU1()&&v.readU1();const x=r=h.xb(v),k=n=h.xb(v);if(v.readU1()&&(h.xb(v),h.xb(v),h.xb(v),h.xb(v)),v.readU1()){const t=h.xb(v),e=z+5,i=1<<e,a=x/(1<<e),r=k/(1<<e),n=Math.ceil(Math.log2(a)),s=Math.ceil(Math.log2(r));let o=0,d=0,l=0;t>0&&(l=v.readU1(),d=v.readU1());for(let e=0;t>0&&e<=t;e++)d&&0!=e||(e>0&&x>i&&v.readU(n),e>0&&k>i&&v.readU(s),e<t&&x>i&&v.readU(n),e<t&&k>i&&v.readU(s)),l||v.readU(2);if(o=h.xb(v)+1,v.readU(1)&&v.readU(1))for(let e=0;e<=t;e++)v.readU(o)}return s=h.xb(v),{profile:i,level:a,width:r,height:n,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:l,generalConstraintInfo:m,generalSubProfileIdc:g,ptlFrameOnlyConstraintFlag:f,ptlMultilayerEnabledFlag:u,spsMaxSublayersMinus1:b,ptlSublayerLevelPresentFlag:p,sublayerLevelIdc:w}}function P(t){const e=new d.A;return e.appendBuffer(t),1&e.readU(8)?w(e):{}}},85947:(t,e,i)=>{i.d(e,{A:()=>r});var a=i(134);class r{constructor(){(0,a.A)(this,"type",-1),(0,a.A)(this,"onStreamAdd",void 0)}destroy(t){}}},92047:(t,e,i)=>{i.r(e),i.d(e,{default:()=>b});var a=i(134),r=i(63939),n=i(50932),s=i(4624),o=i(9705),d=i(65977),l=i(74963),c=i(85947),f=i(85428),u=i(9690),h=i(72739),m=i(14686),p=i(37837),w=i(71517),g=i(44328),U=i(77231),v="src/avformat/formats/IMovFormat.ts";class b extends c.A{constructor(t={}){super(),(0,a.A)(this,"type",1),(0,a.A)(this,"context",void 0),(0,a.A)(this,"options",void 0),this.options=t,this.context=(0,u.A)()}init(t){t.ioReader&&t.ioReader.setEndian(!0)}async readHeader(t){try{let e=0,i=await t.ioReader.readUint32(),a=await t.ioReader.readUint32();if(a!==(0,d.A)("ftyp"))return s.z3("the file format is not mp4",v,82),o.LR;await l.E6(t.ioReader,this.context,{type:a,size:i-8});let r=BigInt(0);for(;!this.context.foundMoov;){const e=t.ioReader.getPos();if(i=await t.ioReader.readUint32(),a=await t.ioReader.readUint32(),i<8)return s.z3(`invalid box size ${i}`,v,99),o.LR;a===(0,d.A)("mdat")?(this.context.foundMdat||(r=e),this.context.foundMdat=!0,await t.ioReader.seek(e+BigInt(Math.floor(i)))):a===(0,d.A)("moov")?(await l.wB(t.ioReader,t,this.context,{size:i-8,type:a}),this.context.foundMoov=!0):await t.ioReader.seek(e+BigInt(Math.floor(i)))}if(!this.context.fragment&&!this.context.foundMdat){const e=await t.ioReader.peekUint64()>>BigInt(32);Number(e)===(0,d.A)("moof")&&(this.context.fragment=!0)}if(this.context.fragment&&1&t.ioReader.flags){const e=t.ioReader.getPos(),i=await t.ioReader.fileSize();if(i>BigInt(16)){await t.ioReader.seek(i-BigInt(12));let a=await t.ioReader.readUint32();if(a===(0,d.A)("mfro")){await t.ioReader.skip(4);const e=await t.ioReader.readUint32();await t.ioReader.seek(i-BigInt(Math.floor(e)));const r=await t.ioReader.readUint32();a=await t.ioReader.readUint32(),a===(0,d.A)("mfra")&&await l.t9(t.ioReader,t,this.context,{size:r-8,type:a})}await t.ioReader.seek(e)}}return!this.context.fragment&&this.context.foundMdat&&await t.ioReader.seek(r),e}catch(e){return s.z3(e.message,v,161),this.context.foundMoov||s.z3("moov not found",v,164),t.ioReader.error}}async readAVPacket_(t,e){const{sample:i,stream:a}=(0,f.G)(t,this.context);if(!i)return-1048576;{n.M[15](e+32,a.index),n.M[17](e+16,i.dts),n.M[17](e+8,i.pts),n.M[17](e+48,BigInt(Math.floor(i.duration))),n.M[15](e+36,r.f[15](e+36)|i.flags),n.M[17](e+56,i.pos),n.M[15](e+76,a.timeBase.den),n.M[15](e+72,a.timeBase.num),a.startTime===U.Dh&&(a.startTime=r.f[17](e+8)||r.f[17](e+16)),await t.ioReader.seek(r.f[17](e+56));const s=i.size,o=(0,p.sY)(s);if((0,w.NX)(e,o,s),await t.ioReader.readBuffer(s,(0,m.JW)(o,s)),27!==a.codecpar.codecId&&173!==a.codecpar.codecId&&196!==a.codecpar.codecId||n.M[15](e+80,1),a.sideData[1]){const t=a.sideData[1].length,i=(0,p.sY)(t);(0,w.Ow)(e,1,i,t),(0,m.lW)(i,t,a.sideData[1]),delete a.sideData[1]}}return 0}async readAVPacket(t,e){try{if(this.context.fragment&&!this.context.currentFragment)for(;!this.context.currentFragment;){const e=t.ioReader.getPos(),i=await t.ioReader.readUint32(),a=await t.ioReader.readUint32();a===(0,d.A)("moof")?(this.context.currentFragment={pos:e,size:i,sequence:0,tracks:[],currentTrack:null},await l.wZ(t.ioReader,t,this.context,{type:a,size:i-8})):a===(0,d.A)("moov")?await l.wB(t.ioReader,t,this.context,{size:i-8,type:a}):await t.ioReader.skip(i-8)}return await this.readAVPacket_(t,e)}catch(e){return-1048576!==t.ioReader.error&&s.z3(e.message,v,262),t.ioReader.error}}async seek(t,e,i,a){const r=i,n=e.privData;if(16&a&&this.context.fragment){const a=(0,g.k)(i,e.timeBase,U.i0);return await t.ioReader.seek(a,!0),this.context.currentFragment=null,BigInt(0)}if(this.context.fragment){if(n.fragIndexes.length){let e=h.El(n.fragIndexes,(t=>t.time>r?-1:t.time===r?0:1));if(e>-1)return await t.ioReader.seek(n.fragIndexes[e].pos,!0),this.context.currentFragment=null,BigInt(0)}return BigInt(o.E$)}let s=h.El(n.samplesIndex,(t=>t.pts>r?-1:t.pts===r?0:1));if(s>-1&&0===e.codecpar.codecType){let t=s;for(;t>=0;t--)if(1&n.samplesIndex[t].flags){s=t;break}t<0&&(s=-1)}return s>-1?(n.currentSample=s,n.sampleEnd=!1,h.__(t.streams,(t=>{if(t!==e){const i=t.privData;let a=!1,r=(0,g.k)(n.samplesIndex[n.currentSample].pts,e.timeBase,t.timeBase);h.__(i.samplesIndex,((t,e)=>{if(t.pts>=r)return i.currentSample=e,a=!0,!1})),a?i.sampleEnd=!1:(i.sampleEnd=!0,i.currentSample=i.samplesIndex.length)}})),BigInt(0)):BigInt(o.LR)}getAnalyzeStreamsCount(){return 0}}},21071:(t,e,i)=>{i.d(e,{_l:()=>a,gQ:()=>r});const a=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],r=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco"]},61179:(t,e,i)=>{function a(t,e,i){const a=t.privData,r=i.trexs.find((t=>t.trackId===e.trackId));let n=e.baseDataOffset+BigInt(Math.floor(e.dataOffset));e.baseIsMoof&&(n+=i.currentFragment.pos);let s=e.baseMediaDecodeTime;const o=e.sampleSizes,d=e.sampleDurations,l=e.sampleFlags,c=e.sampleCompositionTimeOffset;if(!o.length)for(let t=0;t<e.sampleCount;t++)o.push(e.defaultSampleSize||r.size);if(!d.length)for(let t=0;t<e.sampleCount;t++)d.push(e.defaultSampleDuration||r.duration);if(!l.length)for(let t=0;t<e.sampleCount;t++)l.push(e.defaultSampleFlags||r.flags);if(!c.length)for(let t=0;t<e.sampleCount;t++)c.push(0);const f=[];for(let t=0;t<e.sampleCount;t++){const i={dts:s,pts:s+BigInt(Math.floor(c[t])),pos:n,size:o[t],duration:d[t],flags:0};s+=BigInt(Math.floor(i.duration)),n+=BigInt(Math.floor(i.size));let a=l[t];0===t&&e.firstSampleFlags&&(a=e.firstSampleFlags),16842752&a||(i.flags|=1),f.push(i)}a.samplesIndex=f}i.d(e,{p:()=>a})},98859:(t,e,i)=>{function a(t){const e=t.privData,i=e.chunkOffsets,a=e.sampleSizes,r=e.cttsSampleCounts,n=e.cttsSampleOffsets,s=e.stscFirstChunk,o=e.stscSamplesPerChunk,d=e.stssSampleNumbersMap,l=e.sttsSampleCounts,c=e.sttsSampleDeltas;if(!i.length)return;let f=0,u=0,h=0,m=0,p=0,w=0,g=BigInt(0),U=0,v=BigInt(0);const b=[];for(let e=0;e<i.length;e++)for(g=i[e],f<s.length-1&&s[f+1]===e+1&&f++,w=o[f];w>0;){const e={dts:v,pts:v,pos:g,size:a[U],duration:0,flags:0};(d&&d.has(U+1)||1===t.codecpar.codecType)&&(e.flags|=1),n&&(e.pts=e.dts+BigInt(Math.floor(n[m])),p++,p===r[m]&&(m++,p=0)),U&&(b[U-1].duration=Number(e.dts-b[U-1].dts)),g+=BigInt(Math.floor(e.size)),v+=BigInt(Math.floor(c[u])),h++,h===l[u]&&(u++,h=0),U++,b.push(e),w--}b[U-1].duration=b[U-2].duration,e.samplesIndex=b}i.d(e,{X:()=>a})},3384:(t,e,i)=>{function a(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[]}}i.d(e,{A:()=>a})},9690:(t,e,i)=>{i.d(e,{A:()=>r});var a=i(77231);function r(){return{isom:!1,timescale:a.N_,duration:a.Dh,foundMoov:!1,foundMdat:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:a.N_,volume:a.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},38106:(t,e,i)=>{i.d(e,{A:()=>r});var a=i(77231);function r(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,timescale:0,duration:BigInt(0),trackId:a.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],fragIndexes:[],lastPts:BigInt(0),lastDts:BigInt(0),startDts:BigInt(0),startCT:0,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},85428:(t,e,i)=>{i.d(e,{G:()=>n});var a=i(77231),r=i(44328);function n(t,e){let i,n,s,o,d,l,c=BigInt(0);if(t.streams.forEach((t=>{const e=t.privData;if(!e.samplesIndex||!e.samplesIndex.length)return e.sampleEnd=!0,!0;e.sampleEnd||s&&!(e.samplesIndex[e.currentSample].pos<s.pos)||(s=e.samplesIndex[e.currentSample],o=t),e.sampleEnd||d&&!((0,r.k)(e.samplesIndex[e.currentSample].dts,t.timeBase,a.KR)<c)||(d=e.samplesIndex[e.currentSample],c=(0,r.k)(d.dts,t.timeBase,a.KR),l=t)})),s&&d){const e=(0,r.k)(s.dts,o.timeBase,a.KR),c=(0,r.k)(d.dts,l.timeBase,a.KR);Math.abs(Number(e-c))<1e6||2&t.ioReader.flags?(i=s,n=o):(i=d,n=l)}else s?(i=s,n=o):d&&(i=d,n=l);if(n&&(n.privData.currentSample++,n.privData.currentSample>=n.privData.samplesIndex.length&&(n.privData.sampleEnd=!0)),e.fragment){const i=!!t.streams.find((t=>!1===t.privData.sampleEnd));i||(e.currentFragment=null)}return{sample:i,stream:n}}},74963:(t,e,i)=>{i.d(e,{E6:()=>p,t9:()=>v,wB:()=>g,wZ:()=>U});var a=i(65977),r=i(21071),n=i(68361),s=i(4624),o=i(61179),d=i(98859),l=i(3384),c=i(38106),f=i(37837),u=i(14686),h=i(77231),m="src/avformat/formats/mov/imov.ts";async function p(t,e,i){const r=t.getPos()+BigInt(Math.floor(i.size));for(e.majorBrand=await t.readUint32(),e.minorVersion=await t.readUint32(),e.majorBrand===(0,a.A)("qt  ")&&(e.isom=!0);t.getPos()<r;)e.compatibleBrand.push(await t.readUint32())}async function w(t,e,i,o){const d=t.getPos()+BigInt(Math.floor(i.size));for(;t.getPos()<d;){const i=await t.readUint32(),d=await t.readUint32();if(i<8)return void s.z3(`invalid box size ${i}`,m,76);n.A[d]?await n.A[d](t,e,{type:d,size:i-8},o):r.gQ.some((t=>(0,a.A)(t)===d))?await w(t,e,{type:d,size:i-8},o):await t.skip(i-8)}}async function g(t,e,i,r){const o=t.getPos()+BigInt(Math.floor(r.size));for(;t.getPos()<o;){const r=await t.readUint32(),o=await t.readUint32();if(r<8)return void s.z3(`invalid box, type: ${o}, size ${r}`,m,124);if(n.A[o])await n.A[o](t,null,{type:o,size:r-8},i);else if(o===(0,a.A)("trak"))if(!i.foundMoov||i.fragment){const a=e.createStream();if(a.privData=(0,c.A)(),await w(t,a,{type:o,size:r-8},i),i.fragment){const t=a.privData,i=e.streams.find((e=>{const i=e.privData;if(e.index!==a.index&&i.trackId===t.trackId)return!0}));i?(a.sideData[1]&&(i.sideData[1]=a.sideData[1],i.codecpar.extradata&&(0,f.Eb)(i.codecpar.extradata),i.codecpar.extradataSize=i.sideData[1].length,i.codecpar.extradata=(0,f.sY)(i.codecpar.extradataSize),(0,u.lW)(i.codecpar.extradata,i.codecpar.extradataSize,i.sideData[1]),a.codecpar.width===h.N_&&t.width>0&&(i.codecpar.width=t.width),a.codecpar.width===h.N_&&t.height>0&&(i.codecpar.height=t.height)),e.removeStream(a),e.streamIndex--):(a.codecpar.width===h.N_&&t.width>0&&(a.codecpar.width=t.width),a.codecpar.width===h.N_&&t.height>0&&(a.codecpar.height=t.height))}else(0,d.X)(a)}else await t.skip(r-8);else o===(0,a.A)("mvex")?(i.fragment=!0,await w(t,null,{type:o,size:r-8},i)):await t.skip(r-8)}}async function U(t,e,i,r){const d=t.getPos()+BigInt(Math.floor(r.size));for(;t.getPos()<d;){const r=await t.readUint32(),d=await t.readUint32();if(r<8)return void s.z3(`invalid box, type: ${d}, size ${r}`,m,229);if(n.A[d])await n.A[d](t,null,{type:d,size:r-8},i);else if(d===(0,a.A)("traf")){const a=(0,l.A)();i.currentFragment.currentTrack=a,await w(t,null,{type:d,size:r-8},i),i.currentFragment.tracks.push(a),i.currentFragment.currentTrack=null;const n=e.streams.find((t=>t.privData.trackId===a.trackId));if(n){const t=n.privData;a.streamIndex=n.index,(0,o.p)(n,a,i),t.currentSample=0,t.sampleEnd=!1}}else await t.skip(r-8)}}async function v(t,e,i,r){const n=t.getPos()+BigInt(Math.floor(r.size));for(;t.getPos()<n;){const r=await t.fileSize(),n=await t.readUint32();if(await t.readUint32()!==(0,a.A)("tfra"))return void s.z3("invalid tfra box data",m,293);const o=await t.readUint8();await t.skip(3);const d=await t.readUint32(),l=await t.readUint32(),c=await t.readUint32(),f=e.streams.find((t=>t.privData.trackId===d));if(f){const r=f.privData;let n,s;for(let e=0;e<c;e++){1===o?(n=await t.readUint64(),s=await t.readUint64()):(n=BigInt(Math.floor(await t.readUint32())),s=BigInt(Math.floor(await t.readUint32()))),r.fragIndexes.push({pos:s,time:n});for(let e=0;e<1+(l>>4&3);e++)await t.skip(1);for(let e=0;e<1+(l>>2&3);e++)await t.skip(1);for(let e=0;e<1+(3&l);e++)await t.skip(1)}if(r.fragIndexes.length){await t.seek(r.fragIndexes[r.fragIndexes.length-1].pos);const n=await t.readUint32(),s=await t.readUint32();if(s===(0,a.A)("moof")&&(i.currentFragment={pos:BigInt(0),size:n,sequence:0,tracks:[],currentTrack:null},await U(t,e,i,{size:n,type:s}),r.samplesIndex.length)){const t=r.samplesIndex[r.samplesIndex.length-1];f.duration=t.pts+BigInt(Math.floor(t.duration))}}}await t.seek(r+BigInt(Math.floor(n)),!1,!1)}i.currentFragment=null}},6660:(t,e,i)=>{i.d(e,{Q9:()=>n,f3:()=>s,uf:()=>o,zs:()=>r});var a=i(65977);const r={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},n={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},s={vide:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,a.A)("mp4a")]:86018,1836253269:86017,[(0,a.A)("Opus")]:86076,[(0,a.A)("fLaC")]:86028,[(0,a.A)("spex")]:86051,[(0,a.A)("SPXN")]:86051,[(0,a.A)("ac-3")]:86019,[(0,a.A)("sac3")]:86019,[a.A.mp4v]:12,[(0,a.A)("av01")]:225,[(0,a.A)("vp08")]:139,[(0,a.A)("vp09")]:167,[(0,a.A)("avc1")]:27,[(0,a.A)("hev1")]:173,[(0,a.A)("hvc1")]:173,[(0,a.A)("vvc1")]:196,[(0,a.A)("vvi1")]:196,[(0,a.A)("text")]:94213,[(0,a.A)("tx3g")]:94213}},38582:(t,e,i)=>{i.d(e,{A:()=>d});var a=i(4624),r=i(14686),n=i(37837),s=i(90412),o="src/avformat/formats/mov/parsing/av1c.ts";async function d(t,e,i,d){const l=t.getPos();e.codecpar.codecId=225;const c=(0,n.sY)(i.size),f=await t.readBuffer(i.size,(0,r.JW)(c,i.size));d.foundMoov?(e.sideData[1]=f.slice(),(0,n.Eb)(c)):(e.codecpar.extradata=c,e.codecpar.extradataSize=i.size,e.sideData[1]=f.slice()),s.XC(e,e.sideData[1]);const u=i.size-Number(t.getPos()-l);u>0?await t.skip(u):u<0&&a.z3(`read avcc error, size: ${i.size}, read: ${i.size-u}`,o,63)}},73840:(t,e,i)=>{i.d(e,{A:()=>d});var a=i(37837),r=i(14686),n=i(4624),s=i(20620),o="src/avformat/formats/mov/parsing/avcc.ts";async function d(t,e,i,d){const l=t.getPos();e.codecpar.codecId=27;const c=(0,a.sY)(i.size),f=await t.readBuffer(i.size,(0,r.JW)(c,i.size));d.foundMoov?(e.sideData[1]=f.slice(),(0,a.Eb)(c)):(e.codecpar.extradata=c,e.codecpar.extradataSize=i.size,e.sideData[1]=f.slice()),s.XC(e,e.sideData[1]);const u=i.size-Number(t.getPos()-l);u>0?await t.skip(u):u<0&&n.z3(`read avcc error, size: ${i.size}, read: ${i.size-u}`,o,63)}},37213:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/co64.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[],l=await t.readUint32();if(0===o)for(let e=0;e<l;e++)d.push(await t.readUint64());e.privData.chunkOffsets=d;const c=i.size-Number(t.getPos()-s);c>0?await t.skip(c):c<0&&a.z3(`read co64 error, size: ${i.size}, read: ${i.size-c}`,r,56)}},12869:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/colr.ts";async function n(t,e,i,n){const s=t.getPos();let o=await t.readString(4);if("nclx"===o||"nclc"===o||"prof"===o)if("prof"===o){const a=await t.readBuffer(i.size-4);e.sideData[28]=a}else{let i=await t.readUint16(),a=await t.readUint16(),r=await t.readUint16();if("nclx"===o){const i=await t.readUint8()>>7;e.codecpar.colorRange=i?2:1}i>=23&&(i=2),a>=19&&(a=2),r>=15&&(r=2),e.codecpar.colorPrimaries=i,e.codecpar.colorTrc=a,e.codecpar.colorSpace=r}else a.R8(`unsupported color_parameter_type: ${o}`,r,79);const d=i.size-Number(t.getPos()-s);d>0?await t.skip(d):d<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-d}`,r,87)}},59299:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/ctts.ts";async function n(t,e,i,n){const s=t.getPos(),o=e.privData;await t.skip(4);const d=[],l=[],c=await t.readUint32();for(let e=0;e<c;e++)d.push(await t.readUint32()),l.push(await t.readInt32());o.cttsSampleCounts=d,o.cttsSampleOffsets=l;const f=i.size-Number(t.getPos()-s);f>0?await t.skip(f):f<0&&a.z3(`read ctts error, size: ${i.size}, read: ${i.size-f}`,r,59)}},86528:(t,e,i)=>{i.d(e,{A:()=>o});var a=i(4624),r=i(37837),n=i(14686),s="src/avformat/formats/mov/parsing/dfla.ts";async function o(t,e,i,o){const d=t.getPos();e.codecpar.codecId=86028,await t.skip(1),await t.skip(3);const l=await t.readUint8(),c=128&l,f=127&l,u=await t.readUint24();if(0===f&&34===u){const i=(0,r.sY)(u),a=await t.readBuffer(u,(0,n.JW)(i,u));o.foundMoov?(e.sideData[1]=a.slice(),(0,r.Eb)(i)):(e.codecpar.extradata=i,e.codecpar.extradataSize=u)}else a.z3("streaminfo must be first FLACMetadataBlock",s,67);c||a.R8("non streaminfo FLACMetadataBlock(s) ignored",s,71);const h=i.size-Number(t.getPos()-d);h>0?await t.skip(h):h<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-h}`,s,79)}},41781:(t,e,i)=>{i.d(e,{A:()=>c});var a=i(4624),r=i(37837),n=i(14686),s=i(65451),o=i(31865),d=i(729),l="src/avformat/formats/mov/parsing/dops.ts";async function c(t,e,i,c){const f=t.getPos();e.codecpar.codecId=86076,await t.skip(1);const u=(0,r.sY)(i.size+8),h=(0,n.JW)(u,i.size+8),m=new o.A(h),p=new d.A(h,!1);p.writeString("OpusHead"),p.writeUint8(1),await t.readBuffer(i.size-1,(0,n.JW)(u+9,i.size-1)),m.seek(10),p.seek(10),p.writeUint16(m.readUint16()),p.writeUint32(m.readUint32()),p.writeUint16(m.readUint16()),c.foundMoov?(e.sideData[1]=h.slice(),(0,r.Eb)(u)):(e.codecpar.extradata=u,e.codecpar.extradataSize=h.length,s.XC(e,h.slice()));const w=i.size-Number(t.getPos()-f);w>0?await t.skip(w):w<0&&a.z3(`read dops error, size: ${i.size}, read: ${i.size-w}`,l,81)}},28412:(t,e,i)=>{i.d(e,{A:()=>f});var a=i(4624),r=i(6660),n=i(37837),s=i(14686),o=i(58469),d=i(65451),l="src/avformat/formats/mov/parsing/esds.ts";async function c(t){let e=0;for(let i=0;i<4;i++){const i=await t.readUint8();if(e=e<<7|127&i,!(128&i))break}return e}async function f(t,e,i,f){const u=t.getPos();await t.skip(4);let h=t.getPos()+BigInt(Math.floor(i.size-4));for(;t.getPos()<h;){let i=await t.readUint8(),u=await c(t);if(0!==u)if(3===i){let h=t.getPos()+BigInt(Math.floor(u));if(await t.skip(2),await t.skip(1),i=await t.readUint8(),u=await c(t),0===u){a.R8("esds invalid ES descriptor size 0, skip",l,85),await t.skip(Number(h-t.getPos()));continue}if(4===i)if(e.codecpar.codecId=r.Q9[await t.readUint8()],await t.skip(1),await t.skip(3),await t.skip(4),await t.skip(4),t.getPos()<h-BigInt(5))if(i=await t.readUint8(),u=await c(t),5===i){const i=(0,n.sY)(u),a=await t.readBuffer(u,(0,s.JW)(i,u));f.foundMoov?(e.sideData[1]=a.slice(),(0,n.Eb)(i)):(e.codecpar.extradata=i,e.codecpar.extradataSize=u,86018===e.codecpar.codecId?o.XC(e,a.slice()):86076===e.codecpar.codecId&&d.XC(e,a.slice()))}else await t.skip(Number(h-t.getPos()));else await t.skip(Number(h-t.getPos()));else await t.skip(Math.min(u,Number(h-t.getPos())))}else await t.skip(Math.min(u,Number(h-t.getPos())));else a.R8("esds invalid descriptor size 0, skip",l,68),await t.skip(Number(h-t.getPos()))}const m=i.size-Number(t.getPos()-u);m>0?await t.skip(m):m<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-m}`,l,153)}},40179:(t,e,i)=>{i.d(e,{A:()=>o});var a=i(4624),r=i(34677),n=i(6660),s="src/avformat/formats/mov/parsing/hdlr.ts";async function o(t,e,i,o){const d=t.getPos(),l=await t.readUint8();if(await t.skip(3),0===l){await t.skip(4);const a=await t.readString(4),s=n.f3[a];(0,r.A)(s)&&(e.codecpar.codecType=s),await t.skip(4),await t.skip(4),await t.skip(4);const d=i.size-24;if(d>0){const i=!o.isom&&await t.peekUint8()===d-1;i&&await t.skip(1),e.metadata.handlerName=await t.readString(d-(i?1:0))}}const c=i.size-Number(t.getPos()-d);c>0?await t.skip(c):c<0&&a.z3(`read hdlr error, size: ${i.size}, read: ${i.size-c}`,s,77)}},31421:(t,e,i)=>{i.d(e,{A:()=>d});var a=i(37837),r=i(14686),n=i(4624),s=i(53e3),o="src/avformat/formats/mov/parsing/hvcc.ts";async function d(t,e,i,d){const l=t.getPos();e.codecpar.codecId=173;const c=(0,a.sY)(i.size),f=await t.readBuffer(i.size,(0,r.JW)(c,i.size));d.foundMoov?(e.sideData[1]=f.slice(),(0,a.Eb)(c)):(e.codecpar.extradata=c,e.codecpar.extradataSize=i.size,e.sideData[1]=f.slice()),s.XC(e,e.sideData[1]);const u=i.size-Number(t.getPos()-l);u>0?await t.skip(u):u<0&&n.z3(`read hevc error, size: ${i.size}, read: ${i.size-u}`,o,63)}},45248:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/mdhd.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);let d=BigInt(0),l=BigInt(0),c=0,f=BigInt(0);1===o?(d=await t.readUint64(),l=await t.readUint64(),c=await t.readUint32(),f=await t.readUint64()):(d=BigInt(Math.floor(await t.readUint32())),l=BigInt(Math.floor(await t.readUint32())),c=await t.readUint32(),f=BigInt(Math.floor(await t.readUint32()))),e.duration=f,e.timeBase.den=c,e.timeBase.num=1,e.metadata.creationTime=d,e.metadata.modificationTime=l;const u=await t.readUint16(),h=[];h[0]=u>>10&31,h[1]=u>>5&31,h[2]=31&u;const m=String.fromCharCode(h[0]+96,h[1]+96,h[2]+96);e.metadata.language=u,e.metadata.languageString=m,await t.skip(2);const p=i.size-Number(t.getPos()-s);p>0?await t.skip(p):p<0&&a.z3(`read mdhd error, size: ${i.size}, read: ${i.size-p}`,r,83)}},7018:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/mfhd.ts";async function n(t,e,i,n){const s=t.getPos();await t.readUint8(),await t.skip(3),n.currentFragment.sequence=await t.readUint32();const o=i.size-Number(t.getPos()-s);o>0?await t.skip(o):o<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-o}`,r,49)}},19354:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/mvhd.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3),1===o?(n.creationTime=await t.readUint64(),n.modificationTime=await t.readUint64(),n.timescale=await t.readUint32(),n.duration=await t.readUint64()):(n.creationTime=BigInt(Math.floor(await t.readUint32())),n.modificationTime=BigInt(Math.floor(await t.readUint32())),n.timescale=await t.readUint32(),n.duration=BigInt(Math.floor(await t.readUint32()))),n.rate=await t.readUint32(),n.volume=await t.readUint16()>>>8,await t.skip(10),n.matrix=new Uint32Array(9);for(let e=0;e<9;e++)n.matrix[e]=await t.readUint32();await t.skip(24),n.nextTrackId=await t.readUint32();const d=i.size-Number(t.getPos()-s);d>0?await t.skip(d):d<0&&a.z3(`read mvhd error, size: ${i.size}, read: ${i.size-d}`,r,70)}},68361:(t,e,i)=>{i.d(e,{A:()=>x});var a=i(91635),r=i(59299),n=i(63080),s=i(62831),o=i(6570),d=i(34136),l=i(15692),c=i(37213),f=i(45248),u=i(19354),h=i(27436),m=i(40179),p=i(35173),w=i(25778),g=i(7018),U=i(61807),v=i(67523),b=i(58996),z=i(65977);const x={[(0,z.A)("stts")]:a.A,[(0,z.A)("ctts")]:r.A,[(0,z.A)("stss")]:n.A,[(0,z.A)("stsz")]:s.A,[(0,z.A)("stz2")]:o.A,[(0,z.A)("stsc")]:d.A,[(0,z.A)("stco")]:l.A,[(0,z.A)("co64")]:c.A,[(0,z.A)("mdhd")]:f.A,[(0,z.A)("mvhd")]:u.A,[(0,z.A)("tkhd")]:h.A,[(0,z.A)("hdlr")]:m.A,[(0,z.A)("stsd")]:p.A,[(0,z.A)("trex")]:w.A,[(0,z.A)("mfhd")]:g.A,[(0,z.A)("tfhd")]:U.A,[(0,z.A)("tfdt")]:v.A,[(0,z.A)("trun")]:b.A}},15692:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/stco.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[],l=await t.readUint32();if(0===o)for(let e=0;e<l;e++)d.push(BigInt(Math.floor(await t.readUint32())));e.privData.chunkOffsets=d;const c=i.size-Number(t.getPos()-s);c>0?await t.skip(c):c<0&&a.z3(`read stco error, size: ${i.size}, read: ${i.size-c}`,r,56)}},34136:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/stsc.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);const d=e.privData,l=[],c=[],f=[],u=await t.readUint32();if(0===o)for(let e=0;e<u;e++)l.push(await t.readUint32()),c.push(await t.readUint32()),f.push(await t.readUint32());d.stscFirstChunk=l,d.stscSamplesPerChunk=c,d.stscSampleDescriptionIndex=f;const h=i.size-Number(t.getPos()-s);h>0?await t.skip(h):h<0&&a.z3(`read stsc error, size: ${i.size}, read: ${i.size-h}`,r,65)}},35173:(t,e,i)=>{i.d(e,{A:()=>g});var a=i(4624),r=i(65977),n=i(6660),s=i(73840),o=i(31421),d=i(60703),l=i(83561),c=i(38582),f=i(28412),u=i(28460),h=i(86528),m=i(41781),p=i(12869),w="src/avformat/formats/mov/parsing/stsd.ts";async function g(t,e,i,g){const U=t.getPos(),v=await t.readUint8();await t.skip(3);const b=e.privData,z=await t.readUint32();for(let i=0;i<z;i++){const i=await t.readUint32(),U=await t.readUint32(),z=t.getPos()+BigInt(Math.floor(i-8));if(n.uf[U]&&(e.codecpar.codecId=n.uf[U]),0===i){a.R8("stsd entry invalid box size 0, skip",w,70),await t.skip(Number(z-t.getPos()));break}if(i>=16?(await t.skip(6),await t.skip(2)):i<=7&&a.h2(`invalid size: ${i} in stsd`,w,83),0===e.codecpar.codecType){await t.skip(2),await t.skip(2),e.metadata.vendorId=await t.readString(4),await t.skip(4),await t.skip(4),e.codecpar.width=await t.readUint16(),e.codecpar.height=await t.readUint16(),await t.skip(4),await t.skip(4),await t.skip(4),await t.skip(2);let i=await t.readUint8();for(i>31&&(i=31),e.metadata.encoder=await t.readString(i),i<31&&await t.skip(31-i),await t.skip(2),await t.skip(2);t.getPos()<z;){const i=await t.readUint32(),n=await t.readUint32();0!==i?n===(0,r.A)("avcC")?await(0,s.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("hvcC")?await(0,o.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("vvcC")?await(0,d.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("av1C")?await(0,c.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("vpcC")?await(0,l.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("esds")?await(0,f.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("wave")?await(0,u.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("colr")?await(0,p.A)(t,e,{type:n,size:i-8},g):await t.skip(Math.min(i-8,Number(z-t.getPos()))):(a.R8("stsd video invalid box size 0, skip",w,132),await t.skip(Number(z-t.getPos())))}}else if(1===e.codecpar.codecType){const i=await t.readUint16();for(await t.skip(2),e.metadata.vendorId=await t.readString(4),e.codecpar.chLayout.nbChannels=await t.readUint16(),e.codecpar.bitsPerCodedSample=await t.readUint16(),b.audioCid=await t.readUint16(),await t.skip(2),e.codecpar.sampleRate=await t.readUint32()>>>16,(!g.isom||0===v&&i>0)&&(1===i?(b.samplesPerFrame=await t.readUint32(),await t.skip(4),b.bytesPerFrame=await t.readUint32(),await t.skip(4)):2===i&&(await t.skip(4),e.codecpar.sampleRate=Number(await t.readUint64()),e.codecpar.chLayout.nbChannels=await t.readUint32(),await t.skip(4),e.codecpar.bitsPerCodedSample=await t.readUint32(),await t.skip(4),b.bytesPerFrame=await t.readUint32(),b.samplesPerFrame=await t.readUint32()));t.getPos()<z;){const i=await t.readUint32(),n=await t.readUint32();0!==i?n===(0,r.A)("esds")?await(0,f.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("dfLa")?await(0,h.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("dOps")?await(0,m.A)(t,e,{type:n,size:i-8},g):n===(0,r.A)("wave")?await(0,u.A)(t,e,{type:n,size:i-8},g):await t.skip(Math.min(i-8,Number(z-t.getPos()))):(a.R8("stsd audio invalid box size 0, skip",w,279),await t.skip(Number(z-t.getPos())))}}else 3===e.codecpar.codecType?((U===(0,r.A)("stpp")||U===(0,r.A)("wvtt")||U===(0,r.A)("tx3g")||U===(0,r.A)("text")||U===(0,r.A)("c608"))&&e.codecpar.codecId,await t.skip(Math.min(i-8,Number(z-t.getPos())))):await t.skip(Math.min(i-8,Number(z-t.getPos())))}const x=i.size-Number(t.getPos()-U);x>0?await t.skip(x):x<0&&a.z3(`read stsd error, size: ${i.size}, read: ${i.size-x}`,w,358)}},63080:(t,e,i)=>{i.d(e,{A:()=>o});var a=i(80662),r=i.n(a),n=i(4624),s="src/avformat/formats/mov/parsing/stss.ts";async function o(t,e,i,a){const o=t.getPos(),d=await t.readUint8();await t.skip(3);const l=new(r()),c=await t.readUint32();if(0===d)for(let e=0;e<c;e++)l.set(await t.readUint32(),!0);e.privData.stssSampleNumbersMap=l;const f=i.size-Number(t.getPos()-o);f>0?await t.skip(f):f<0&&n.z3(`read stss error, size: ${i.size}, read: ${i.size-f}`,s,57)}},62831:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/stsz.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[];let l=0,c=0;if(0===o){l=await t.readUint32(),c=await t.readUint32();for(let e=0;e<c;e++)0===l?d.push(await t.readUint32()):d[e]=l}e.privData.sampleSizes=d;const f=i.size-Number(t.getPos()-s);f>0?await t.skip(f):f<0&&a.z3(`read stsz error, size: ${i.size}, read: ${i.size-f}`,r,65)}},91635:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/stts.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);const d=e.privData,l=[],c=[],f=await t.readUint32();let u=1;if(0===o)for(let e=0;e<f;e++)l.push(await t.readUint32()),u=await t.readInt32(),u<0&&a.R8("File uses negative stts sample delta, using value 1 instead, sync may be lost!",r,53),c.push(u);d.sttsSampleCounts=l,d.sttsSampleDeltas=c;const h=i.size-Number(t.getPos()-s);h>0?await t.skip(h):h<0&&a.z3(`read stts error, size: ${i.size}, read: ${i.size-h}`,r,67)}},6570:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/stz2.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[];let l=0,c=0;if(0===o)if(await t.skip(3),c=await t.readUint8(),l=await t.readUint32(),4===c)for(let e=0;e<l;e+=2){const i=await t.readUint8();d[e]=i>>4&15,d[e+1]=15&i}else if(8===c)for(let e=0;e<l;e++)d[e]=await t.readUint8();else if(16===c)for(let e=0;e<l;e++)d[e]=await t.readUint16();else a.z3("Error in length field in stz2 box",r,67);e.privData.sampleSizes=d;const f=i.size-Number(t.getPos()-s);f>0?await t.skip(f):f<0&&a.z3(`read stz2 error, size: ${i.size}, read: ${i.size-f}`,r,78)}},67523:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/tfdt.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8();await t.skip(3);const d=n.currentFragment.currentTrack;d&&(d.baseMediaDecodeTime=1===o?await t.readUint64():BigInt(Math.floor(await t.readUint32())));const l=i.size-Number(t.getPos()-s);l>0?await t.skip(l):l<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-l}`,r,57)}},61807:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/tfhd.ts";async function n(t,e,i,n){const s=t.getPos(),o=(await t.readUint8(),await t.readUint24()),d=await t.readUint32(),l=n.currentFragment.currentTrack;l.trackId=d,l&&(1&o&&(l.baseDataOffset=await t.readUint64()),2&o&&await t.skip(4),8&o&&(l.defaultSampleDuration=await t.readUint32()),16&o&&(l.defaultSampleSize=await t.readUint32()),32&o&&(l.defaultSampleFlags=await t.readUint32()),131072&o&&(l.baseIsMoof=!0));const c=i.size-Number(t.getPos()-s);c>0?await t.skip(c):c<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-c}`,r,75)}},27436:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/tkhd.ts";async function n(t,e,i,n){const s=e.privData,o=t.getPos(),d=await t.readUint8();s.flags=await t.readUint24(),1===d?(e.metadata.creationTime=await t.readUint64(),e.metadata.modificationTime=await t.readUint64(),s.trackId=await t.readUint32(),await t.skip(4),s.duration=await t.readUint64()):(e.metadata.creationTime=BigInt(Math.floor(await t.readUint32())),e.metadata.modificationTime=BigInt(Math.floor(await t.readUint32())),s.trackId=await t.readUint32(),await t.skip(4),s.duration=BigInt(Math.floor(await t.readUint32()))),await t.skip(8),s.layer=await t.readInt16(),s.alternateGroup=await t.readInt16(),s.volume=await t.readInt16()>>8,await t.skip(2),s.matrix=new Uint32Array(9);for(let e=0;e<9;e++)s.matrix[e]=await t.readUint32();s.width=await t.readUint32()>>16,s.height=await t.readUint32()>>16;const l=i.size-Number(t.getPos()-o);l>0?await t.skip(l):l<0&&a.z3(`read tkhd error, size: ${i.size}, read: ${i.size-l}`,r,77)}},25778:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/trex.ts";async function n(t,e,i,n){const s=t.getPos();await t.readUint8(),await t.skip(3);const o=await t.readUint32();await t.skip(4);const d=await t.readUint32(),l=await t.readUint32(),c=await t.readUint32();n.trexs.push({trackId:o,duration:d,size:l,flags:c});const f=i.size-Number(t.getPos()-s);f>0?await t.skip(f):f<0&&a.z3(`read trex error, size: ${i.size}, read: ${i.size-f}`,r,61)}},58996:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/formats/mov/parsing/trun.ts";async function n(t,e,i,n){const s=t.getPos(),o=await t.readUint8(),d=await t.readUint24(),l=n.currentFragment.currentTrack;if(l){l.sampleCount=await t.readUint32(),1&d&&(l.dataOffset=await t.readInt32()),4&d&&(l.firstSampleFlags=await t.readUint32());for(let e=0;e<l.sampleCount;e++)256&d&&l.sampleDurations.push(await t.readUint32()),512&d&&l.sampleSizes.push(await t.readUint32()),1024&d&&l.sampleFlags.push(await t.readUint32()),2048&d&&(0===o?l.sampleCompositionTimeOffset.push(await t.readUint32()):l.sampleCompositionTimeOffset.push(await t.readInt32()))}const c=i.size-Number(t.getPos()-s);c>0?await t.skip(c):c<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-c}`,r,79)}},83561:(t,e,i)=>{i.d(e,{A:()=>d});var a=i(37837),r=i(14686),n=i(4624),s=i(58919),o="src/avformat/formats/mov/parsing/vpcc.ts";async function d(t,e,i,d){const l=t.getPos();await t.readUint8(),await t.skip(3),e.codecpar.codecId=167;const c=(0,a.sY)(i.size-4),f=await t.readBuffer(i.size-4,(0,r.JW)(c,i.size-4));d.foundMoov?(e.sideData[1]=f.slice(),(0,a.Eb)(c)):(e.codecpar.extradata=c,e.codecpar.extradataSize=i.size-4,e.sideData[1]=f.slice()),s.XC(e,e.sideData[1]);const u=i.size-Number(t.getPos()-l);u>0?await t.skip(u):u<0&&n.z3(`read vpcc error, size: ${i.size}, read: ${i.size-u}`,o,67)}},60703:(t,e,i)=>{i.d(e,{A:()=>d});var a=i(37837),r=i(14686),n=i(4624),s=i(55611),o="src/avformat/formats/mov/parsing/vvcc.ts";async function d(t,e,i,d){const l=t.getPos();await t.readUint8(),await t.skip(3),e.codecpar.codecId=196;const c=(0,a.sY)(i.size-4),f=await t.readBuffer(i.size-4,(0,r.JW)(c,i.size-4));d.foundMoov?(e.sideData[1]=f.slice(),(0,a.Eb)(c)):(e.codecpar.extradata=c,e.codecpar.extradataSize=i.size-4,e.sideData[1]=f.slice()),s.XC(e,e.sideData[1]);const u=i.size-Number(t.getPos()-l);u>0?await t.skip(u):u<0&&n.z3(`read vvcc error, size: ${i.size}, read: ${i.size-u}`,o,67)}},28460:(t,e,i)=>{i.d(e,{A:()=>o});var a=i(4624),r=i(65977),n=i(28412),s="src/avformat/formats/mov/parsing/wave.ts";async function o(t,e,i,o){const d=t.getPos(),l=d+BigInt(Math.floor(i.size));for(;t.getPos()<l;){const i=await t.readUint32(),d=await t.readUint32();0!==i?d===(0,r.A)("esds")?await(0,n.A)(t,e,{type:d,size:i-8},o):await t.skip(Math.min(i-8,Number(l-t.getPos()))):(a.R8("wave invalid box size 0, skip",s,47),await t.skip(Number(l-t.getPos())))}const c=i.size-Number(t.getPos()-d);c>0?await t.skip(c):c<0&&a.z3(`read vpcc error, size: ${i.size}, read: ${i.size-c}`,s,73)}},65977:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624),r="src/avformat/function/mktag.ts";function n(t){4!==t.length&&a.R8(`tag length is not 4, tag: ${t}`,r,30);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},11573:(t,e,i)=>{function a(t,e){let i=0;for(let a=0;a<e;a++)i=2*i+t.readU1();return i}function r(t){let e=0;for(;!a(t,1);)e++;return e>=32?0:a(t,e)+(1<<e)-1}function n(t){let e=0,i=0;for(let r=0;r<8;r++){let n=a(t,8);if(e|=(127&n)<<7*r,i+=1,!(128&n))break}return e}i.d(e,{d:()=>r,f:()=>a,v:()=>n})},23991:(t,e,i)=>{function a(t){let e=0,i=0;for(;i<32&&0===t.readU1();)i++;return e=t.readU(i),e+=(1<<i)-1,e}function r(t){let e=a(t);return e=1&e?(e+1)/2:-e/2,e}i.d(e,{$x:()=>r,xb:()=>a})},60264:(t,e,i)=>{function a(t){return t.length>4&&0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])}function r(t,e){let i=0;for(let a=e;a<t.length;a++)switch(t[a]){case 0:i++;break;case 1:if(i>=2)return{offset:a-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function n(t){const e=[];let i=r(t,0),a={offset:-1,startCode:0};for(;a=r(t,i.offset+i.startCode),a.offset>-1;)e.push(t.subarray(i.offset+i.startCode,a.offset,!0)),i=a;return e.push(t.subarray(i.offset+i.startCode,void 0,!0)),e}function s(t,e=0,i){i||(i=t.length);const a=new Uint8Array(t.length);let r=0,n=0;for(let s=0;s<t.length;s++){if(s>=e&&s<i)if(0===t[s])r++;else if(3===t[s]&&2===r&&s+1<t.length&&t[s+1]<=3){if(s++,s===t.length)break;r=0===t[s]?1:0}else r=0;a[n++]=t[s]}return a.slice(0,n)}i.d(e,{BN:()=>s,Bs:()=>a,py:()=>n})},37246:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(134),r=i(4624);class n{constructor(t=1048576){(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"pointer",void 0),(0,a.A)(this,"bitsLeft",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"endPointer",void 0),(0,a.A)(this,"error",void 0),(0,a.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=t,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let t=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let e=this.pointer,i=this.bitsLeft;return 0===i&&(e++,i=8),t=this.buffer[e]>>i-1&1,t}readU1(){let t=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,t=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),t}readU(t){let e=0;for(let i=0;i<t;i++)e|=this.readU1()<<t-i-1;return e}remainingLength(){return this.endPointer-this.pointer}getPos(){return this.pointer}skip(t){const e=(t-t%8)/8;this.pointer+=e;const i=t%8;this.bitsLeft<=i?(this.pointer++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const t=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(t<0)throw this.error=t,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+t,this.pointer=0}else{const t=this.onFlush(this.buffer);if(this.endPointer=t,this.pointer=0,this.bitsLeft=8,t<0)throw this.error=t,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const e=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,e),this.endPointer),this.endPointer+=e,r.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",190)}}clear(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}},83314:(t,e,i)=>{i.d(e,{A:()=>r});var a=i(134);class r{constructor(t=1048576){(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"pointer",void 0),(0,a.A)(this,"bitPointer",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"error",void 0),(0,a.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=t,this.error=0,this.buffer=new Uint8Array(this.size)}writeU1(t){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&t?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}writeU(t,e){for(let i=0;i<t;i++)this.writeU1(e>>t-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const t=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}clear(){this.pointer=0,this.bitPointer=0,this.error=0}getBuffer(){return this.buffer}getPointer(){return this.pointer}}},729:(t,e,i)=>{i.d(e,{A:()=>s});var a=i(134),r=i(4624),n=i(50011);class s{constructor(t,e=!0){(0,a.A)(this,"data",void 0),(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"byteStart",void 0),(0,a.A)(this,"pos",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}writeUint8(t){this.data.setUint8(this.pos+++this.byteStart,t)}writeUint16(t){this.data.setUint16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeUint24(t){const e=3840&t,i=240&t,a=15&t;this.littleEndian?(this.writeUint8(a),this.writeUint8(i),this.writeUint8(e)):(this.writeUint8(e),this.writeUint8(i),this.writeUint8(a))}writeUint32(t){this.data.setUint32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeUint64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(e)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(e)))}writeInt8(t){this.data.setInt8(this.pos+++this.byteStart,t)}writeInt16(t){this.data.setInt16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeInt32(t){this.data.setInt32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeInt64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(e)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(e)))}writeFloat(t){this.data.setFloat32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeDouble(t){this.data.setFloat64(this.pos+this.byteStart,t,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(t){t>this.size&&(t=this.size),this.pos=Math.max(0,t)}skip(t){this.seek(this.pos+t)}back(t){this.seek(this.pos-t)}remainingSize(){return this.size-this.pos}writeBuffer(t){let e=t.length;this.remainingSize()<e&&(e=this.remainingSize(),r.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${t.length}, but set ${e}`,"src/common/io/BufferWriter.ts",211)),this.buffer.set(t,this.pos),this.pos+=t.length}writeString(t){const e=n.l(t);return this.writeBuffer(e),e.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(t,e=!0){this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}}}}]);