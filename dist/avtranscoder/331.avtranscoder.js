"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[331],{64436:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(134),n=i(63939),a=i(37837),s=i(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,a.Gy)(168),(0,s.Yi)(this.inCodecpar,e),this.inTimeBase={den:n.f[15](t+4),num:n.f[15](t)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},50848:(e,t,i)=>{i.d(t,{A:()=>w});var r=i(134),n=i(63939),a=i(50932),s=i(77162),o=i(29170),c=i(64436),d=i(14686),l=i(4624),h=i(9705),f=i(77231),u=i(58469),p=i(44328),g=i(37837),m=i(71517),U=i(67672);class w extends c.A{constructor(...e){super(...e),(0,r.A)(this,"streamMuxConfig",void 0),(0,r.A)(this,"caches",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.streamMuxConfig={profile:f.N_,sampleRate:f.N_,channels:f.N_},0}sendAVPacket(e){let t=0,i=n.f[17](e+16)||n.f[17](e+8);const r=(0,d.s3)(n.f[20](e+24),n.f[15](e+28)).slice();for(;t<r.length;){const e=u.Bq(r.subarray(t));if(U.ai(e))return l.z3("AACADTSParser parse failed","src/avformat/bsf/aac/ADTS2RawFilter.ts",81),h.LR;const c={dts:i,buffer:null,extradata:null,duration:f.N_};c.buffer=r.subarray(t+e.headerLength,t+e.headerLength+e.framePayloadLength),this.streamMuxConfig.profile=e.profile,this.streamMuxConfig.sampleRate=e.sampleRate,this.streamMuxConfig.channels=e.channels;const m=n.f[15](this.inCodecpar+48)!==this.streamMuxConfig.profile||n.f[15](this.inCodecpar+136)!==this.streamMuxConfig.sampleRate||n.f[15](this.inCodecpar+116)!==this.streamMuxConfig.channels,w=(0,p.k)(BigInt(Math.floor(1024*(e.numberOfRawDataBlocksInFrame+1)/this.streamMuxConfig.sampleRate*f.SF)),f.KR,this.inTimeBase);if(c.duration=Number(w),m){a.M[15](this.inCodecpar+48,this.streamMuxConfig.profile),a.M[15](this.inCodecpar+136,this.streamMuxConfig.sampleRate),a.M[15](this.inCodecpar+116,this.streamMuxConfig.channels);const e=(0,u.Ij)((0,o.A)(this.inCodecpar,s.A));n.f[20](this.inCodecpar+12)&&(0,g.Eb)(n.f[20](this.inCodecpar+12)),a.M[20](this.inCodecpar+12,(0,g.sY)(e.length)),(0,d.lW)(n.f[20](this.inCodecpar+12),e.length,e),a.M[15](this.inCodecpar+16,e.length),c.extradata=e}this.caches.push(c),t+=e.aacFrameLength,i+=w}return 0}receiveAVPacket(e){if(this.caches.length){(0,m.Up)(e);const t=this.caches.shift(),i=(0,g.sY)(t.buffer.length);if((0,d.lW)(i,t.buffer.length,t.buffer),(0,m.NX)(e,i,t.buffer.length),a.M[17](e+16,t.dts),a.M[17](e+8,t.dts),a.M[17](e+48,BigInt(Math.floor(t.duration))),a.M[15](e+36,1|n.f[15](e+36)),t.extradata){const i=(0,g.sY)(t.extradata.length);(0,d.lW)(i,t.extradata.length,t.extradata),(0,m.Ow)(e,1,i,t.extradata.length)}return 0}return h.LT}reset(){return 0}}},36488:(e,t,i)=>{i.d(t,{A:()=>b});var r=i(134),n=i(63939),a=i(50932),s=i(77162),o=i(29170),c=i(64436),d=i(14686),l=i(4624),h=i(9705),f=i(77231),u=i(58469),p=i(44328),g=i(37837),m=i(71517),U=i(37246),w=i(67672);class b extends c.A{constructor(...e){super(...e),(0,r.A)(this,"bitReader",void 0),(0,r.A)(this,"streamMuxConfig",void 0),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"refSampleDuration",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.refSampleDuration=BigInt(0),this.bitReader=new U.A,this.streamMuxConfig={profile:f.N_,sampleRate:f.N_,channels:f.N_},0}sendAVPacket(e){const t=(0,d.s3)(n.f[20](e+24),n.f[15](e+28));this.bitReader.appendBuffer(t);let i=n.f[17](e+16)||n.f[17](e+8);for(;this.bitReader.remainingLength()>=20;){const e=this.bitReader.getPointer(),t=u.f7(null,this.bitReader);if(w.ai(t))return l.z3("AACLATMParser parse failed","src/avformat/bsf/aac/LATM2RawFilter.ts",94),this.bitReader.reset(),h.LR;if(t.framePayloadLength>=this.bitReader.remainingLength()){this.bitReader.skipPadding(),this.bitReader.setPointer(e);break}t.useSameStreamMux||(this.streamMuxConfig.profile=t.profile,this.streamMuxConfig.sampleRate=t.sampleRate,this.streamMuxConfig.channels=t.channels);const r=t.framePayloadLength,c=new Uint8Array(r);for(let e=0;e<r;e++)c[e]=this.bitReader.readU(8);const m={dts:i,buffer:c,extradata:null};if(n.f[15](this.inCodecpar+48)!==this.streamMuxConfig.profile||n.f[15](this.inCodecpar+136)!==this.streamMuxConfig.sampleRate||n.f[15](this.inCodecpar+116)!==this.streamMuxConfig.channels){this.refSampleDuration=(0,p.k)(BigInt(Math.floor(1024/this.streamMuxConfig.sampleRate*f.SF)),f.KR,this.inTimeBase),a.M[15](this.inCodecpar+48,this.streamMuxConfig.profile),a.M[15](this.inCodecpar+136,this.streamMuxConfig.sampleRate),a.M[15](this.inCodecpar+116,this.streamMuxConfig.channels);const e=(0,u.Ij)((0,o.A)(this.inCodecpar,s.A));n.f[20](this.inCodecpar+12)&&(0,g.Eb)(n.f[20](this.inCodecpar+12)),a.M[20](this.inCodecpar+12,(0,g.sY)(e.length)),(0,d.lW)(n.f[20](this.inCodecpar+12),e.length,e),a.M[15](this.inCodecpar+16,e.length),m.extradata=e}this.caches.push(m),i+=this.refSampleDuration,this.bitReader.skipPadding()}return 0}receiveAVPacket(e){if(this.caches.length){(0,m.Up)(e);const t=this.caches.shift(),i=(0,g.sY)(t.buffer.length);if((0,d.lW)(i,t.buffer.length,t.buffer),(0,m.NX)(e,i,t.buffer.length),a.M[17](e+16,t.dts),a.M[17](e+8,t.dts),a.M[15](e+36,1|n.f[15](e+36)),a.M[17](e+48,this.refSampleDuration),t.extradata){const i=(0,g.sY)(t.extradata.length);(0,d.lW)(i,t.extradata.length,t.extradata),(0,m.Ow)(e,1,i,t.extradata.length)}return 0}return h.LT}reset(){return this.bitReader.reset(),0}}},61702:(e,t,i)=>{i.d(t,{A:()=>g});var r=i(134),n=i(63939),a=i(50932),s=i(64436),o=i(77231),c=i(44328),d=i(65451),l=i(4624),h=i(9705),f=i(71517),u=i(37837),p=i(14686);class g extends s.A{constructor(...e){super(...e),(0,r.A)(this,"caches",void 0)}init(e,t){return super.init(e,t),this.caches=[],0}sendAVPacket(e){let t=0,i=n.f[17](e+16)||n.f[17](e+8);const r=(0,f.iI)(e);for(;t<r.length;){const e=r[t]<<3|r[t+1]>>5;if(1023!==e)return l.z3(`MpegtsOpusParser found syncWord not 0x3ff, got: 0x${e.toString(16)}`,"src/avformat/bsf/opus/Mpegts2RawFilter.ts",67),h.LR;const a=!!(16&r[t+1]),s=!!(8&r[t+1]);let f=t+2,u=0;for(;255===r[f];)u+=255,f++;u+=r[f],f++,f+=a?2:0,f+=s?2:0;let p=r.subarray(f,f+u);const g=n.f[15](this.inCodecpar+136)>0?n.f[15](this.inCodecpar+136):48e3,m=(0,c.k)(BigInt(Math.floor(d.kt(p)/g*o.SF)),o.KR,this.inTimeBase);this.caches.push({dts:i,buffer:p.slice(),duration:Number(m)}),i+=m,t=f+u}}receiveAVPacket(e){if(this.caches.length){(0,f.Up)(e);const t=this.caches.shift(),i=(0,u.sY)(t.buffer.length);return(0,p.lW)(i,t.buffer.length,t.buffer),(0,f.NX)(e,i,t.buffer.length),a.M[17](e+16,t.dts),a.M[17](e+8,t.dts),a.M[15](e+36,1|n.f[15](e+36)),a.M[17](e+48,BigInt(Math.floor(t.duration))),0}return h.LR}reset(){return 0}}},58469:(e,t,i)=>{i.d(t,{Bq:()=>f,Hm:()=>s,Ij:()=>h,XC:()=>l,_5:()=>d,f7:()=>u,uF:()=>a});var r=i(77231),n=i(37246);const a={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},s={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],c=[r.N_,1,2,3,4,5,6,7];function d(e){let t=r.N_,i=r.N_,n=r.N_;var a,s;return e.length>=2&&(t=e[0]>>3&31,i=null!==(a=o[(7&e[0])<<1|e[1]>>7])&&void 0!==a?a:48e3,n=null!==(s=c[e[1]>>3&15])&&void 0!==s?s:2),{profile:t,sampleRate:i,channels:n}}function l(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:i,sampleRate:r,channels:n}=d(t);e.codecpar.profile=i,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=n}}function h(e){const t=s[e.sampleRate],i=e.chLayout.nbChannels,r=new Uint8Array(2);return r[0]=(31&e.profile)<<3|(14&t)>>1,r[1]=(1&t)<<7|(15&i)<<3,r}function f(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const i=1&e[1],r=(192&e[2])>>>6,n=(60&e[2])>>>2,a=(1&e[2])<<2|(192&e[3])>>>6,s=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let l=1===i?7:9,h=s-l;return{syncWord:t,profile:r+1,sampleRate:o[n],channels:c[a],aacFrameLength:s,numberOfRawDataBlocksInFrame:d,headerLength:l,framePayloadLength:h}}function u(e,t){function i(){const e=t.readU(2);let i=0;for(let r=0;r<=e;r++)i<<=8,i|=t.readU(8);return i}t||(t=new n.A).appendBuffer(e);const r=t.getPointer(),a={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},s=t.readU(11);if(695!==s)return-1;a.syncWord=s,a.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(a.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&i(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let r=e?i():0;const n=t.readU(5);r-=5;const s=t.readU(4);r-=4;const d=t.readU(4);if(r-=4,t.readU(3),r-=3,r>0&&t.readU(r),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)i();else{let e=0;for(;;){e<<=8;const i=1===t.readU1();if(e+=t.readU(8),!i)break}}1===t.readU1()&&t.readU(8),a.profile=n+1,a.sampleRate=o[s],a.channels=c[d]}let l=0;for(;;){const e=t.readU(8);if(l+=e,255!==e)break}return a.framePayloadLength=l,a.headerLength=t.getPointer()-r+(8===t.getBitLeft()?0:1),a}},87771:(e,t,i)=>{i.d(t,{R:()=>u,j:()=>n});var r=i(37246);const n=[3,4,3,7,259,263,1539,1543],a=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],s=[4,5,6,5],o=[4,6,7,6],c=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],h=[1,2,3,6],f=7;function u(e){const t=new r.A(e.length);t.appendBuffer(e);const i={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(i.syncWord=t.readU(16),2935!==i.syncWord)return-1;if(i.bitstreamId=31&t.peekU(29),i.bitstreamId>16)return-2;if(i.numBlocks=6,i.ac3BitrateCode=-1,i.centerMixLevel=5,i.surroundMixLevel=6,i.dolbySurroundMode=0,i.bitstreamId<=10){if(i.crc1=t.readU(16),i.srCode=t.readU(2),3===i.srCode)return-3;const e=t.readU(6);if(e>37)return-4;i.ac3BitrateCode=e>>1,t.readU(5),i.bitstreamMode=t.readU(3),i.channelMode=t.readU(3),2==i.channelMode?i.dolbySurroundMode=t.readU(2):(1&i.channelMode&&1!=i.channelMode&&(i.centerMixLevel=s[t.readU(2)]),4&i.channelMode&&(i.surroundMixLevel=o[t.readU(2)])),i.lfeOn=t.readU(1),i.srShift=Math.max(i.bitstreamId,8)-8,i.sampleRate=c[i.srCode]>>i.srShift,i.bitrate=1e3*d[i.ac3BitrateCode]>>i.srShift,i.channels=l[i.channelMode]+i.lfeOn,i.frameSize=2*a[e][i.srCode],i.frameType=2,i.substreamId=0}else{if(i.crc1=0,i.frameType=t.readU(2),3==i.frameType)return-5;if(i.substreamId=t.readU(3),i.frameSize=t.readU(11)+1<<1,i.frameSize<f)return-6;if(i.srCode=t.readU(2),3==i.srCode){const e=t.readU(2);if(3==e)return-7;i.sampleRate=c[e]/2,i.srShift=1}else i.numBlocks=h[t.readU(2)],i.sampleRate=c[i.srCode],i.srShift=0;i.channelMode=t.readU(3),i.lfeOn=t.readU(1),i.bitrate=8*i.frameSize*i.sampleRate/(256*i.numBlocks),i.channels=l[i.channelMode]+i.lfeOn}return i.channelLayout=BigInt(n[i.channelMode]),i.lfeOn&&(i.channelLayout|=BigInt(8)),i}},29347:(e,t,i)=>{i.d(t,{R:()=>d,u:()=>c});var r=i(37246),n=i(95073);const a=[1,2,2,2,2,3,3,4,4,5,6,6,6,7,8,8],s=[0,8e3,16e3,32e3,0,0,11025,22050,44100,0,0,12e3,24e3,48e3,96e3,192e3],o=[32e3,56e3,64e3,96e3,112e3,128e3,192e3,224e3,256e3,32e4,384e3,448e3,512e3,576e3,64e4,768e3,96e4,1024e3,1152e3,128e4,1344e3,1408e3,1411200,1472e3,1536e3,192e4,2048e3,3072e3,384e4,0,0,0],c=32;function d(e){const t=new r.A(e.length);t.appendBuffer(e);const i={syncWord:0,frameType:0,deficitSamples:0,crcFlag:0,sampleBlock:0,frameSize:0,channelIndex:0,sampleRateIndex:0,bitrateIndex:0,channels:0,sampleRate:0,bitrate:0};return i.syncWord=t.readU(32),2147385345!==i.syncWord&&4269736320!==i.syncWord?-1:(i.frameType=t.readU1(),i.deficitSamples=t.readU(5)+1,i.crcFlag=t.readU1(),i.sampleBlock=t.readU(7)+1,i.frameSize=(0,n.A)(t.readU(14)+1,4),i.channelIndex=t.readU(6),i.sampleRateIndex=t.readU(4),i.bitrateIndex=t.readU(5),i.channels=a[i.channelIndex],i.sampleRate=s[i.sampleRateIndex],i.bitrate=o[i.bitrateIndex],i)}},20620:(e,t,i)=>{i.d(t,{Jk:()=>_,KD:()=>M,MB:()=>y,OD:()=>S,S1:()=>P,XC:()=>B,ci:()=>v,k9:()=>x,oT:()=>I,tZ:()=>w,wf:()=>R});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),d=i(4624),l=i(14686),h=i(71517),f=i(60264),u=i(37837),p=i(23991),g=i(39381),m="src/avformat/codecs/h264.ts";const U=3,w={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"},b=[{level:10,maxResolution:25344,maxFrameRate:15},{level:11,maxResolution:25344,maxFrameRate:30},{level:12,maxResolution:101376,maxFrameRate:30},{level:13,maxResolution:101376,maxFrameRate:30},{level:20,maxResolution:101376,maxFrameRate:30},{level:21,maxResolution:202752,maxFrameRate:30},{level:22,maxResolution:414720,maxFrameRate:30},{level:30,maxResolution:414720,maxFrameRate:30},{level:31,maxResolution:921600,maxFrameRate:30},{level:32,maxResolution:1310720,maxFrameRate:60},{level:40,maxResolution:2097152,maxFrameRate:30},{level:41,maxResolution:2097152,maxFrameRate:60},{level:42,maxResolution:2228224,maxFrameRate:60},{level:50,maxResolution:8912896,maxFrameRate:30},{level:51,maxResolution:8912896,maxFrameRate:60},{level:52,maxResolution:8912896,maxFrameRate:120},{level:60,maxResolution:35651584,maxFrameRate:30},{level:61,maxResolution:35651584,maxFrameRate:60},{level:62,maxResolution:35651584,maxFrameRate:120}];function x(e,t,i){const r=e*t;for(const e of b)if(r<=e.maxResolution&&i<=e.maxFrameRate)return e.level}function y(e){const t=new o.A(e);t.skip(5);const i=[],r=[],n=[],a=31&t.readUint8();for(let e=0;e<a;e++){const e=t.readUint16();i.push(t.readBuffer(e))}const s=t.readUint8();for(let e=0;e<s;e++){const e=t.readUint16();r.push(t.readBuffer(e))}if(t.remainingSize()>4){t.skip(3);const e=t.readUint8();if(e>0)for(let i=0;i<e;i++){const e=t.readUint16();n.push(t.readBuffer(e))}}return{spss:i,ppss:r,spsExts:n}}function A(e,t,i=[]){e.length>32&&(d.R8(`h264 metadata's sps max length is 32, but get ${e.length}`,m,210),e=e.slice(0,32)),e.length>256&&(d.R8(`h264 metadata's pps max length is 256, but get ${e.length}`,m,214),e=e.slice(0,256));let r=7;r=e.reduce(((e,t)=>e+2+t.length),r),r=t.reduce(((e,t)=>e+2+t.length),r);const n=e[0],o=R(n);66!==o.profile&&77!==o.profile&&88!==o.profile&&(r+=4,i.length&&(r=i.reduce(((e,t)=>e+2+t.length),r)));const c=new Uint8Array(r),l=new s.A(c);return l.writeUint8(1),l.writeUint8(n[1]),l.writeUint8(n[2]),l.writeUint8(n[3]),l.writeUint8(252|U),l.writeUint8(224|31&e.length),a.__(e,(e=>{l.writeUint16(e.length),l.writeBuffer(e)})),l.writeUint8(t.length),a.__(t,(e=>{l.writeUint16(e.length),l.writeBuffer(e)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(l.writeUint8(252|o.chromaFormatIdc),l.writeUint8(248|o.bitDepthLumaMinus8),l.writeUint8(248|o.bitDepthChromaMinus8),i.length&&a.__(i,(e=>{l.writeUint16(e.length),l.writeBuffer(e)}))),c}function P(e){let t=(0,f.py)(e);if(t.length>1){const e=[],i=[],r=[];if(t.forEach((t=>{const n=31&t[0];7===n?e.push(t):8===n?i.push(t):13===n&&r.push(t)})),e.length&&i.length)return A(e,i,r)}}function I(e){let t,i=(0,f.py)(e),r=!1;if(i.length>1){const e=[],r=[],n=[];i.forEach((t=>{const i=31&t[0];7===i?e.push(t):8===i?r.push(t):13===i&&n.push(t)})),e.length&&r.length&&(t=A(e,r,n)),i=i.filter((e=>{const t=31&e[0];return 9!==t&&8!==t&&7!==t&&13!==t}))}const n=i.reduce(((e,t)=>e+U+1+t.length),0),o=(0,u.sY)(n),c=(0,l.s3)(o,n),d=new s.A(c);return a.__(i,(e=>{3===U?d.writeUint32(e.length):2===U?d.writeUint24(e.length):1===U?d.writeUint16(e.length):d.writeUint8(e.length),d.writeBuffer(e.subarray(0)),5==(31&e[0])&&(r=!0)})),{bufferPointer:o,length:n,key:r,extradata:t}}function S(e,t){const i=t?3&t[4]:U;let r=[],n=[],c=[],d=!1;if(t){const e=y(t);r=e.spss,n=e.ppss,c=e.spsExts,d=!0}const h=[],f=[],p=new o.A(e);for(;p.remainingSize()>0;){let t=0;t=3===i?p.readUint32():2===i?p.readUint24():1===i?p.readUint16():p.readUint8();const r=e.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+t);p.skip(t);const n=31&r[0];6===n?f.push(r):9!==n&&h.push(r)}let g=r.reduce(((e,t)=>e+4+t.length),0);g=n.reduce(((e,t)=>e+4+t.length),g),g=c.reduce(((e,t)=>e+4+t.length),g),g=f.reduce(((e,t)=>e+4+t.length),g),g=h.reduce(((e,t,i)=>e+(i?3:4)+t.length),g);const m=(0,u.sY)(g+6),w=new s.A((0,l.s3)(m,g+6));return w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeUint8(9),w.writeUint8(240),a.__(f,(e=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e)})),a.__(r,(e=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e)})),a.__(n,(e=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e)})),a.__(c,(e=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e)})),a.__(h,((e,t)=>{w.writeUint8(0),w.writeUint8(0),t||w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e),5==(31&e[0])&&(d=!0)})),{bufferPointer:m,length:g+6,key:d}}function _(e,t){var i;if(!(1&r.f[15](e+36)))return;const n=(0,h.iI)(e);if((0,f.Bs)(n))return;const a=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:U;let s=[],c=[],d=[],p=[];const g=new o.A(n);for(;g.remainingSize()>0;){let e=0;e=3===a?g.readUint32():2===a?g.readUint24():1===a?g.readUint16():g.readUint8();const t=n.subarray(Number(BigInt.asIntN(32,g.getPos())),Number(BigInt.asIntN(32,g.getPos()))+e);g.skip(e);const i=31&t[0];7===i?s.push(t):8===i?c.push(t):13===i?d.push(t):p.push(t)}if(s.length||c.length){const t=A(s,c,d),i=(0,u.sY)(t.length);(0,l.lW)(i,t.length,t),(0,h.Ow)(e,1,i,t.length)}}function v(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,h.iI)(e);if(!(0,f.Bs)(i))return;let a=(0,f.py)(i);if(a.length>1){const t=[],i=[],s=[];if(a.forEach((e=>{const r=31&e[0];7===r?t.push(e):8===r?i.push(e):13===r&&s.push(e)})),t.length&&i.length){const a=A(t,i,s),o=(0,u.sY)(a.length);(0,l.lW)(o,a.length,a),(0,h.Ow)(e,1,o,a.length),n.M[15](e+36,1|r.f[15](e+36))}}}function B(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[4];const{spss:i}=y(t);if(i.length){const{profile:t,level:r,width:n,height:a}=R(i[0]);e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=n,e.codecpar.height=a}}}function M(e,t=4){if(2===r.f[15](e+80))return(0,f.py)((0,l.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>5==(31&e[0])));{const i=r.f[15](e+28);let n=0;for(;n<i-t;){if(5==(31&g.r8(r.f[20](e+24)+(n+t))))return!0;n+=4===t?g.Sg(r.f[20](e+24)+n):3===t?g.ht(r.f[20](e+24)+n):2===t?g.yd(r.f[20](e+24)+n):g.r8(r.f[20](e+24)+n),n+=t}return!1}}function R(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=(0,f.BN)(e.subarray(t)),r=new c.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const n=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const a=r.readU(8);p.xb(r);let s=1,o=0,d=0;if((100==n||110==n||122==n||244==n||44==n||83==n||86==n||118==n||128==n||138==n||139==n||134==n||135==n)&&(s=p.xb(r),3===s&&r.readU1(),o=p.xb(r),d=p.xb(r),r.readU1(),r.readU1())){const e=new Array(8);for(let t=0;t<(3!=s?8:12);t++)e[t]=r.readU1()}const l=p.xb(r),h=p.xb(r);let u=0,g=0;if(0===h)u=p.xb(r);else if(1===h){g=r.readU1(),p.$x(r),p.$x(r);const e=p.xb(r);for(let t=0;t<e;t++)p.$x(r)}p.xb(r),r.readU1();const m=p.xb(r),U=p.xb(r),w=r.readU1();let b=16*(m+1),x=(2-w)*(U+1)*16;w||r.readU1(),r.readU1();const y=r.readU1();if(y){let e=1,t=2-y;1===s?(e=2,t=2*(2-y)):2===y&&(e=2,t=2-y),b-=e*(p.xb(r)+p.xb(r)),x-=t*(p.xb(r)+p.xb(r))}return{profile:n,level:a,width:b,height:x,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:d,frameMbsOnlyFlag:w,picOrderCntType:h,log2MaxPicOrderCntLsbMinus4:u,deltaPicOrderAlwaysZeroFlag:g,log2MaxFrameNumMinus4:l}}},53e3:(e,t,i)=>{i.d(t,{HL:()=>b,Jk:()=>I,KD:()=>v,OD:()=>P,S1:()=>y,XC:()=>_,ZU:()=>M,ci:()=>S,dT:()=>g,k9:()=>U,oT:()=>A,wf:()=>B});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),d=i(14686),l=i(60264),h=i(71517),f=i(37837),u=i(23991),p=i(39381);const g={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},m=[{level:10,maxLumaSamplesPerSecond:552960,maxLumaPictureSize:36864,maxBitRate:{main:128,main10:150}},{level:20,maxLumaSamplesPerSecond:3686400,maxLumaPictureSize:122880,maxBitRate:{main:1500,main10:1875}},{level:21,maxLumaSamplesPerSecond:7372800,maxLumaPictureSize:245760,maxBitRate:{main:3e3,main10:3750}},{level:30,maxLumaSamplesPerSecond:16588800,maxLumaPictureSize:552960,maxBitRate:{main:6e3,main10:7500}},{level:31,maxLumaSamplesPerSecond:33177600,maxLumaPictureSize:983040,maxBitRate:{main:1e4,main10:12500}},{level:40,maxLumaSamplesPerSecond:66846720,maxLumaPictureSize:2228224,maxBitRate:{main:12e3,main10:15e3}},{level:41,maxLumaSamplesPerSecond:133693440,maxLumaPictureSize:2228224,maxBitRate:{main:2e4,main10:25e3}},{level:50,maxLumaSamplesPerSecond:267386880,maxLumaPictureSize:8912896,maxBitRate:{main:25e3,main10:4e4}},{level:51,maxLumaSamplesPerSecond:534773760,maxLumaPictureSize:8912896,maxBitRate:{main:4e4,main10:6e4}},{level:52,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:60,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:61,maxLumaSamplesPerSecond:2139095040,maxLumaPictureSize:89128960,maxBitRate:{main:12e4,main10:24e4}},{level:62,maxLumaSamplesPerSecond:4278190080,maxLumaPictureSize:356515840,maxBitRate:{main:24e4,main10:48e4}}];function U(e,t,i,r,n){n/=1e3;const a=1===e?"main":"main10",s=t*i*r;for(const e of m)if(s<=e.maxLumaSamplesPerSecond&&t*i<=e.maxLumaPictureSize&&n<=e.maxBitRate[a])return e.level}const w=3;function b(e){const t=new o.A(e,!0);t.skip(22);let i=[],r=[],n=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=63&t.readUint8(),a=t.readUint16(),s=[];for(let e=0;e<a;e++){const e=t.readUint16();s.push(t.readBuffer(e))}32===e?i=s:33===e?r=s:34===e&&(n=s)}return{vpss:i,spss:r,ppss:n}}function x(e,t,i){const r=t[0];let n=23;e.length&&(n+=3,n=e.reduce(((e,t)=>e+2+t.length),n)),t.length&&(n+=3,n=t.reduce(((e,t)=>e+2+t.length),n)),i.length&&(n+=3,n=i.reduce(((e,t)=>e+2+t.length),n));const o=new Uint8Array(n),c=new s.A(o,!0),d=B(r);c.writeUint8(1),c.writeUint8(r[1]),c.writeUint8(r[2]),c.writeUint8(r[3]),c.writeUint8(r[4]),c.writeUint8(r[5]),c.writeUint8(r[6]),c.writeUint8(r[7]),c.writeUint8(r[8]),c.writeUint8(r[9]),c.writeUint8(r[10]),c.writeUint8(r[11]),c.writeUint8(d.level),c.writeUint8(1020),c.writeUint8(0),c.writeUint8(16320),c.writeUint8(16320|d.chroma_format_idc),c.writeUint8(8160|d.bit_depth_luma_minus8),c.writeUint8(8160|d.bit_depth_chroma_minus8),c.writeUint16(0),c.writeUint8(8|(1&r[0])<<2|w);let l=0;return e.length&&l++,t.length&&l++,i.length&&l++,c.writeUint8(l),e.length&&(c.writeUint8(160),c.writeUint16(e.length),a.__(e,(e=>{c.writeUint16(e.length),c.writeBuffer(e)}))),t.length&&(c.writeUint8(161),c.writeUint16(t.length),a.__(t,(e=>{c.writeUint16(e.length),c.writeBuffer(e)}))),i.length&&(c.writeUint8(162),c.writeUint16(i.length),a.__(i,(e=>{c.writeUint16(e.length),c.writeBuffer(e)}))),o}function y(e){let t=(0,l.py)(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const n=t[0]>>>1&63;32===n?e.push(t):33===n?i.push(t):34===n&&r.push(t)})),i.length&&r.length)return x(e,i,r)}}function A(e){let t,i=!1,r=(0,l.py)(e);if(r.length>=2){const e=[],i=[],n=[];r.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?i.push(t):34===r&&n.push(t)})),i.length&&n.length&&(t=x(e,i,n),r=r.filter((e=>{const t=e[0]>>>1&63;return 32!==t&&33!==t&&34!==t&&35!==t})))}const n=r.reduce(((e,t)=>e+w+1+t.length),0),o=(0,f.sY)(n),c=(0,d.s3)(o,n),h=new s.A(c);return a.__(r,(e=>{3===w?h.writeUint32(e.length):2===w?h.writeUint24(e.length):1===w?h.writeUint16(e.length):h.writeUint8(e.length),h.writeBuffer(e.subarray(0));const t=e[0]>>>1&63;19!==t&&20!==t&&21!==t||(i=!0)})),{bufferPointer:o,length:n,extradata:t,key:i}}function P(e,t){const i=t?3&t[21]:w;let r=[],n=[],c=[],l=!1;if(t){const e=b(t);r=e.vpss,n=e.spss,c=e.ppss,l=!0}const h=[],u=new o.A(e);for(;u.remainingSize()>0;){let e=0;e=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),h.push(u.readBuffer(e))}let p=r.reduce(((e,t)=>e+4+t.length),0);p=n.reduce(((e,t)=>e+4+t.length),p),p=c.reduce(((e,t)=>e+4+t.length),p),p=h.reduce(((e,t,i)=>e+(i?3:4)+t.length),p);const g=(0,f.sY)(p+7),m=(0,d.s3)(g,p+7),U=new s.A(m);return U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeUint8(70),U.writeUint8(0),U.writeUint8(240),a.__(r,(e=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e)})),a.__(n,(e=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e)})),a.__(c,(e=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e)})),a.__(h,((e,t)=>{U.writeUint8(0),U.writeUint8(0),t||U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e);const i=e[0]>>>1&63;19!==i&&20!==i&&21!==i||(l=!0)})),{bufferPointer:g,length:p+7,key:l}}function I(e,t){var i;if(!(1&r.f[15](e+36)))return;const n=(0,h.iI)(e);if((0,l.Bs)(n))return;const a=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:w;let s=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let e=0;e=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const t=n.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+e);p.skip(e);const i=t[0]>>>1&63;33===i?c.push(t):34===i?u.push(t):32===i&&s.push(t)}if(c.length||u.length||s.length){const t=x(s,c,u),i=(0,f.sY)(t.length);(0,d.lW)(i,t.length,t),(0,h.Ow)(e,1,i,t.length)}}function S(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,h.iI)(e);if(!(0,l.Bs)(i))return;let a=(0,l.py)(i);if(a.length>2){const t=[],i=[],s=[];if(a.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?i.push(e):34===r&&s.push(e)})),t.length&&i.length&&s.length){const a=x(t,i,s),o=(0,f.sY)(a.length);(0,d.lW)(o,a.length,a),(0,h.Ow)(e,1,o,a.length),n.M[15](e+36,1|r.f[15](e+36))}}}function _(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[21];const{spss:i}=b(t);if(i.length){const{profile:t,level:r,width:n,height:a}=B(i[0]);e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=n,e.codecpar.height=a}}}function v(e,t=4){if(2===r.f[15](e+80))return(0,l.py)((0,d.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[0]>>>1&63;return 20===t||19===t}));{const i=r.f[15](e+28);let n=0;for(;n<i-t;){const i=p.r8(r.f[20](e+24)+(n+t))>>>1&63;if(20===i||19===i)return!0;n+=4===t?p.Sg(r.f[20](e+24)+n):3===t?p.ht(r.f[20](e+24)+n):2===t?p.yd(r.f[20](e+24)+n):p.r8(r.f[20](e+24)+n),n+=t}return!1}}function B(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,n=0,a=0,s=0,o=0,d=1,h=0,f=0,p=0,g=0;const m=(0,l.BN)(e.subarray(t)),U=new c.A(m.length);U.appendBuffer(m),U.readU1(),U.readU(6),U.readU(6),U.readU(3),U.readU(4);const w=U.readU(3);U.readU1();let b=0;if(w<=6){h=U.readU(2),f=U.readU1(),i=U.readU(5),p=U.readU(32),g=U.readU(48),r=U.readU(8);const e=new Array(6),t=new Array(6);for(let i=0;i<w;i++)e[i]=U.readU1(),t[i]=U.readU1();if(w>0)for(let e=w;e<8;e++)U.readU(2);for(let i=0;i<w;i++)e[i]&&(U.readU(2),U.readU(1),U.readU(5),U.readU(32),U.readU(1),U.readU(1),U.readU(1),U.readU(1),U.readU(44)),t[i]&&U.readU(8);u.xb(U),d=u.xb(U),3===d&&(b=U.readU(1)),n=u.xb(U),a=u.xb(U);let c=0,l=0,m=0,x=0;U.readU1()&&(c=u.xb(U),l=u.xb(U),m=u.xb(U),x=u.xb(U)),s=u.xb(U),o=u.xb(U);let y=2,A=2;0===d?y=A=0:2===d?(y=2,A=1):3===d&&(y=A=1),n-=y*(1<<s+1)*(c+l),a-=A*(1<<s+1)*(m+x)}const x=u.xb(U)+4;for(let e=U.readU1()?0:w;e<w+1;e++)u.xb(U),u.xb(U),u.xb(U);const y=u.xb(U)+3,A=u.xb(U),P=u.xb(U)+2,I=u.xb(U),S=y+A,_=y-1,v=n+(1<<S)-1>>S,B=a+(1<<S)-1>>S;return{profile:i,level:r,width:n,height:a,chroma_format_idc:d,bit_depth_luma_minus8:s,bit_depth_chroma_minus8:o,general_profile_space:h,general_tier_flag:f,general_profile_compatibility_flags:p,constraint_flags:g,separate_colour_plane_flag:b,log2_min_cb_size:y,log2_diff_max_min_coding_block_size:A,log2_min_tb_size:P,log2_diff_max_min_transform_block_size:I,log2_max_trafo_size:I+P,log2_ctb_size:S,log2_min_pu_size:_,ctb_width:v,ctb_height:B,ctb_size:v*B,min_cb_width:n>>y,min_cb_height:a>>y,min_tb_width:n>>P,min_tb_height:a>>P,min_pu_width:n>>_,min_pu_height:a>>_,log2_max_poc_lsb:x}}function M(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=(0,l.BN)(e.subarray(t)),r=new c.A(i.length);return r.appendBuffer(i),{pps_pic_parameter_set_id:u.xb(r),pps_seq_parameter_set_id:u.xb(r),dependent_slice_segment_flag:r.readU1(),output_flag_present_flag:r.readU1(),num_extra_slice_header_bits:r.readU(3)}}},89088:(e,t,i)=>{i.d(t,{Au:()=>w,He:()=>b,XC:()=>x,Y2:()=>g,hG:()=>m,oz:()=>U});var r=i(77231);const n=[44100,48e3,32e3,0],a=[22050,24e3,16e3,0],s=[11025,12e3,8e3,0],o=[0,1152,1152,384],c=[0,576,1152,384],d=[0,576,1152,384],l=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],h=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],f=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],u=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],p=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function g(e,t){switch(e){case 0:return s[t];case 2:return a[t];case 3:return n[t]}return r.N_}function m(e,t){switch(e){case 0:return d[t];case 2:return c[t];case 3:return o[t]}return r.N_}function U(e,t,i){switch(t){case 1:switch(e){case 0:case 2:return p[i];case 3:return f[i]}break;case 2:switch(e){case 0:case 2:return p[i];case 3:return h[i]}case 3:switch(e){case 0:case 2:return u[i];case 3:return l[i]}}return r.N_}function w(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return r.N_}const b={32:"Layer1",33:"Layer2",34:"Layer3"};function x(e,t){if(t&&t.length>=4){const i=t[1]>>>3&3,r=(6&t[1])>>1,n=(12&t[2])>>>2,a=3&~(t[3]>>>6)?2:1,s=w(r),o=g(i,n);e.codecpar.profile=s,e.codecpar.sampleRate=o,e.codecpar.chLayout.nbChannels=a}}},65451:(e,t,i)=>{i.d(t,{Ij:()=>d,XC:()=>c,kt:()=>o});var r=i(31865),n=i(729),a=i(44328);const s=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(e){let t=0,i=0,r=0;if(e.length<1)return 0;switch(t=e[0],i=s[t>>3],3&t){case 0:r=1;break;case 1:case 2:r=2;break;case 3:if(e.length<2)return 0;r=63&e[1]}return r*i}function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const i=new r.A(t,!1);i.skip(9),e.codecpar.chLayout.nbChannels=i.readUint8(),e.codecpar.initialPadding=i.readUint16(),e.codecpar.sampleRate=i.readUint32(),e.codecpar.seekPreroll=Number((0,a.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(e){const t=new Uint8Array(19),i=new n.A(t,!1);return i.writeString("OpusHead"),i.writeUint8(1),i.writeUint8(e.chLayout.nbChannels),i.writeUint16(e.initialPadding),i.writeUint32(e.sampleRate),t}},55611:(e,t,i)=>{i.d(t,{Jk:()=>A,KD:()=>_,OD:()=>y,QA:()=>I,Ui:()=>B,XC:()=>S,ci:()=>P,oT:()=>x,wf:()=>v});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),d=i(14686),l=i(60264),h=i(71517),f=i(37837),u=i(23991),p=i(83314),g=i(39381);const m=3;function U(e){const t=e.readU(9),i=e.readU(3),r=e.readU(2),n=e.readU(2),a=e.readU(3);e.readU(5),e.readU(2);const s=e.readU(6),o=e.readU(7),c=e.readU(1),d=e.readU(8),l=e.readU(1),h=e.readU(1),f=[],u=[];if(s){for(let t=0;t<s-1;t++)f[t]=e.readU(8);f[s-1]=e.readU(6)}else e.readU(6);if(i>1){let t=0;for(let r=i-2;r>=0;--r)t|=e.readU(1)<<r;for(let t=i;t<=8&&i>1;++t)e.readU(1);for(let r=i-2;r>=0;--r)t&1<<r&&(u[r]=e.readU(8))}const p=e.readU(8),g=[];if(p)for(let t=0;t<p;t++)g.push(e.readU(8));return{olsIdx:t,numSublayers:i,bitDepthMinus8:a,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:c,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:h,generalConstraintInfo:f,sublayerLevelIdc:u,generalSubProfileIdc:g,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function w(e){const t=new o.A(e,!0);if(1&t.readUint8()){const i=new c.A;i.appendBuffer(e.subarray(1)),U(i),t.skip(i.getPointer())}let i=[],r=[],n=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=31&t.readUint8();let a=1;13!==e&&12!==e&&(a=t.readUint16());const s=[];for(let e=0;e<a;e++){const e=t.readUint16();s.push(t.readBuffer(e))}14===e?i=s:15===e?r=s:16===e&&(n=s)}return{vpss:i,spss:r,ppss:n}}function b(e,t,i){const r=t[0];let n;if(r){const e=v(r);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const i=new p.A;if(i.writeU(9,0),i.writeU(3,e.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,e.chromaFormatIdc),i.writeU(3,e.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,t.length),i.writeU(7,e.profile),i.writeU1(e.tierFlag),i.writeU(8,e.level),i.writeU1(e.ptlFrameOnlyConstraintFlag),i.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)i.writeU(8,t[e]);i.writeU(6,t[t.length-1])}else i.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let i=e.spsMaxSublayersMinus1-1;i>=0;i--)t=t<<1|e.ptlSublayerLevelPresentFlag[i];i.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)i.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&i.writeU(8,e.sublayerLevelIdc[t])}i.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)i.writeU(8,e.sublayerLevelIdc[t]);i.writeU(16,e.width),i.writeU(16,e.height),i.writeU(16,0),i.padding(),n=i.getBuffer().subarray(0,i.getPointer())}let o=2+(n?n.length:0);e.length&&(o+=3,o=e.reduce(((e,t)=>e+2+t.length),o)),t.length&&(o+=3,o=t.reduce(((e,t)=>e+2+t.length),o)),i.length&&(o+=3,o=i.reduce(((e,t)=>e+2+t.length),o));const c=new Uint8Array(o),d=new s.A(c,!0);d.writeUint8(m<<1|(n?1:0)|248),n&&d.writeBuffer(n);let l=0;return e.length&&l++,t.length&&l++,i.length&&l++,d.writeUint8(l),e.length&&(d.writeUint8(142),d.writeUint16(e.length),a.__(e,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),t.length&&(d.writeUint8(143),d.writeUint16(t.length),a.__(t,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),i.length&&(d.writeUint8(144),d.writeUint16(i.length),a.__(i,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),c}function x(e){let t,i=!1,r=(0,l.py)(e);if(r.length>=2){const e=[],i=[],n=[];r.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&n.push(t)})),i.length&&n.length&&(t=b(e,i,n),r=r.filter((e=>{const t=e[1]>>>3&31;return 14!==t&&15!==t&&16!==t&&20!==t})))}const n=r.reduce(((e,t)=>e+m+1+t.length),0),o=(0,f.sY)(n),c=(0,d.s3)(o,n),h=new s.A(c);return a.__(r,(e=>{3===m?h.writeUint32(e.length):2===m?h.writeUint24(e.length):1===m?h.writeUint16(e.length):h.writeUint8(e.length),h.writeBuffer(e.subarray(0));const t=e[1]>>>3&31;8!==t&&7!==t&&9!==t&&10!==t||(i=!0)})),{bufferPointer:o,length:n,extradata:t,key:i}}function y(e,t){const i=t?t[0]>>>1&3:m;let r=[],n=[],c=[],l=!1;if(t){const e=w(t);r=e.vpss,n=e.spss,c=e.ppss,l=!0}const h=[],u=new o.A(e);for(;u.remainingSize()>0;){let e=0;e=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),h.push(u.readBuffer(e))}let p=r.reduce(((e,t)=>e+4+t.length),0);p=n.reduce(((e,t)=>e+4+t.length),p),p=c.reduce(((e,t)=>e+4+t.length),p),p=h.reduce(((e,t,i)=>e+(i?3:4)+t.length),p);const g=(0,f.sY)(p+7),U=(0,d.s3)(g,p+7),b=new s.A(U);return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(0),b.writeUint8(160),b.writeUint8(240),a.__(r,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),a.__(n,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),a.__(c,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),a.__(h,((e,t)=>{b.writeUint8(0),b.writeUint8(0),t||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e);const i=e[1]>>>3&31;8!==i&&7!==i&&9!==i&&10!==i||(l=!0)})),{bufferPointer:g,length:p+7,key:l}}function A(e,t){var i;if(!(1&r.f[15](e+36)))return;const n=(0,h.iI)(e);if((0,l.Bs)(n))return;const a=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:m;let s=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let e=0;e=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const t=n.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+e);p.skip(e);const i=t[1]>>>3&31;15===i?c.push(t):16===i?u.push(t):14===i&&s.push(t)}if(c.length||u.length||s.length){const t=b(s,c,u),i=(0,f.sY)(t.length);(0,d.lW)(i,t.length,t),(0,h.Ow)(e,1,i,t.length)}}function P(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,h.iI)(e);if(!(0,l.Bs)(i))return;let a=(0,l.py)(i);if(a.length>2){const t=[],i=[],s=[];if(a.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&s.push(e)})),t.length&&i.length&&s.length){const a=b(t,i,s),o=(0,f.sY)(a.length);(0,d.lW)(o,a.length,a),(0,h.Ow)(e,1,o,a.length),n.M[15](e+36,1|r.f[15](e+36))}}}function I(e,t){const{profile:i,level:r,width:n,height:a}=v(t);e.codecpar.profile=i,e.codecpar.level=r,e.codecpar.width=n,e.codecpar.height=a}function S(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=t[0]>>>1&3;const{spss:i}=w(t);i.length&&I(e,i[0])}}function _(e,t=4){if(2===r.f[15](e+80))return(0,l.py)((0,d.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[1]>>>3&31;return 8===t||7===t}));{const i=r.f[15](e+28);let n=0;for(;n<i-t;){const i=g.r8(r.f[20](e+24)+(n+t+1))>>>3&31;if(8===i||7===i)return!0;n+=4===t?g.Sg(r.f[20](e+24)+n):3===t?g.ht(r.f[20](e+24)+n):2===t?g.yd(r.f[20](e+24)+n):g.r8(r.f[20](e+24)+n),n+=t}return!1}}function v(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,n=0,a=0,s=0,o=1,d=0,h=0,f=0;const p=[],g=[],m=[],U=[],w=(0,l.BN)(e.subarray(t)),b=new c.A(w.length);b.appendBuffer(w),b.readU1(),b.readU1(),b.readU(6),b.readU(5),b.readU(3),b.readU(8);const x=b.readU(3);o=b.readU(2);const y=b.readU(2);if(b.readU(1)){if(i=b.readU(7),d=b.readU(1),r=b.readU(8),h=b.readU(1),f=b.readU(1),b.readU(1)){for(let e=0;e<8;e++)p[e]=b.readU(8);p[8]=b.readU(7);const e=b.readU(8);b.readU(e)}b.skipPadding();for(let e=x-1;e>=0;e--)g[e]=b.readU(1);b.skipPadding();for(let e=x-1;e>=0;e--)g[e]&&(m[e]=b.readU(8));const e=b.readU(8);if(e)for(let t=0;t<e;t++)U[t]=b.readU(32)}b.readU1(),b.readU1()&&b.readU1();const A=n=u.xb(b),P=a=u.xb(b);if(b.readU1()&&(u.xb(b),u.xb(b),u.xb(b),u.xb(b)),b.readU1()){const e=u.xb(b),t=y+5,i=1<<t,r=A/(1<<t),n=P/(1<<t),a=Math.ceil(Math.log2(r)),s=Math.ceil(Math.log2(n));let o=0,c=0,d=0;e>0&&(d=b.readU1(),c=b.readU1());for(let t=0;e>0&&t<=e;t++)c&&0!=t||(t>0&&A>i&&b.readU(a),t>0&&P>i&&b.readU(s),t<e&&A>i&&b.readU(a),t<e&&P>i&&b.readU(s)),d||b.readU(2);if(o=u.xb(b)+1,b.readU(1)&&b.readU(1))for(let t=0;t<=e;t++)b.readU(o)}s=u.xb(b),b.readU(1),b.readU(1);const I=b.readU(4),S=b.readU(1);let _=0;S&&(_=u.xb(b));const v=[],B=b.readU(2);for(let e=0;e<8*B;e++)v[e]=b.readU(1);return{profile:i,level:r,width:n,height:a,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:d,generalConstraintInfo:p,generalSubProfileIdc:U,ptlFrameOnlyConstraintFlag:h,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:x,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:m,sps_log2_max_pic_order_cnt_lsb_minus4:I,sps_poc_msb_cycle_flag:S,sps_poc_msb_cycle_len_minus1:_,sps_num_extra_ph_bytes:B,sps_extra_ph_bit_present_flag:v}}function B(e){0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(e=function(e){let t=(0,l.py)(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const n=t[1]>>>3&31;14===n?e.push(t):15===n?i.push(t):16===n&&r.push(t)})),i.length&&r.length)return b(e,i,r)}}(e));const t=new c.A;return t.appendBuffer(e),1&t.readU(8)?U(t):{}}},85947:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(134);class n{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}destroy(e){}}},59331:(e,t,i)=>{i.r(t),i.d(t,{default:()=>z});var r=i(134),n=i(63939),a=i(50932),s=i(4624),o=i(19770),c=i(53783),d=i(27274),l=i(39e3),h=i(9705),f=i(51660),u=i(39144),p=i(52088),g=i(6403),m=i(85947),U=i(86191),w=i(71517),b=i(77231),x=i(52071),y=i(44328),A=i(72739),P=i(89088),I=i(20620),S=i(53e3),_=i(55611),v=i(58469),B=i(65451),M=i(87771),R=i(29347),k=i(37837),L=i(14686),C=i(67672),F="src/avformat/formats/IMpegtsFormat.ts";class z extends m.A{constructor(){super(),(0,r.A)(this,"type",2),(0,r.A)(this,"context",void 0),(0,r.A)(this,"firstTSPacketPos",void 0),(0,r.A)(this,"cacheAVPacket",void 0),this.context=(0,o.A)()}init(e){e.ioReader&&e.ioReader.setEndian(!0),this.cacheAVPacket=0}destroy(e){super.destroy(e),this.cacheAVPacket&&((0,w.Qe)(this.cacheAVPacket),this.cacheAVPacket=0),A.__(e.streams,(e=>{const t=e.privData;t.filter&&(t.filter.destroy(),t.filter=null)}))}async readHeader(e){try{let t=0,i=await c.q(e.ioReader);for(i||(i=d.ZT),this.context.tsPacketSize=i;!this.context.hasPAT||!this.context.hasPMT;){const t=await c.n(e.ioReader,this.context);t.payload&&(0!==t.pid&&t.pid!==this.context.currentPmtPid&&134!==this.context.pmt.pid2StreamType.get(t.pid)||(0,l.A)(t,this.context))}return this.context.hasPAT&&this.context.hasPMT?(this.firstTSPacketPos=e.ioReader.getPos(),t):h.LR}catch(t){return s.z3(t.message,F,141),e.ioReader.error}}checkExtradata(e,t){if(!t.codecpar.extradata){let i=(0,w.rU)(e,1);if(!i)return;t.codecpar.extradata=(0,k.sY)(n.f[15](i+4)),(0,L.Mr)(t.codecpar.extradata,n.f[20](i),n.f[15](i+4)),t.codecpar.extradataSize=n.f[15](i+4),(0,w.Is)(e,1),27===t.codecpar.codecId?I.XC(t,(0,L.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):173===t.codecpar.codecId?S.XC(t,(0,L.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):196===t.codecpar.codecId?_.XC(t,(0,L.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):86018===t.codecpar.codecId?v.XC(t,(0,L.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):86076===t.codecpar.codecId&&B.XC(t,(0,L.JW)(t.codecpar.extradata,t.codecpar.extradataSize))}}parsePESSlice(e,t,i,r){const o=(0,u.A)(i);(0,f.A)(o),(o.randomAccessIndicator||1===r.codecpar.codecType)&&a.M[15](t+36,1|n.f[15](t+36));const c=r.codecpar.codecId;27!==c&&173!==c&&196!==c||a.M[15](t+80,2),a.M[15](t+32,r.index),a.M[17](t+16,o.dts),a.M[17](t+8,o.pts),a.M[17](t+56,o.pos),a.M[15](t+76,9e4),a.M[15](t+72,1),r.startTime===b.Dh&&(r.startTime=n.f[17](t+8)||n.f[17](t+16));const d=(0,k.sY)(o.payload.length);(0,L.lW)(d,o.payload.length,o.payload),(0,w.NX)(t,d,o.payload.length),(0,p.A)(i);const l=r.privData;if(l.filter){let i=0;if(i=l.filter.sendAVPacket(t),i<0)return s.z3("send avpacket to bsf failed",F,217),h.LR;if(i=l.filter.receiveAVPacket(t),i<0)return s.z3("receive avpacket from bsf failed",F,224),h.LR;for(a.M[15](t+76,9e4),a.M[15](t+72,1),a.M[15](t+32,r.index),this.checkExtradata(t,r);;){const t=this.cacheAVPacket||(0,w._5)();if(i=l.filter.receiveAVPacket(t),0!==i){this.cacheAVPacket=t;break}a.M[15](t+76,9e4),a.M[15](t+72,1),a.M[15](t+32,r.index),this.checkExtradata(t,r),e.interval.packetBuffer.push(t),this.cacheAVPacket=0}}else{const e=this.context.pmt.pid2StreamType.get(l.pid);if(3===e||4===e){a.M[15](t+36,1|n.f[15](t+36));const e=(0,w.iI)(t),i=e[1]>>>3&3,s=(6&e[1])>>1,o=(12&e[2])>>>2,c=3&~(e[3]>>>6)?2:1,d=P.Au(s),l=P.Y2(i,o);(r.codecpar.profile!==d||r.codecpar.sampleRate!==l||r.codecpar.chLayout.nbChannels!==c)&&(r.codecpar.profile=d,r.codecpar.sampleRate=l,r.codecpar.chLayout.nbChannels=c)}else if(27===r.codecpar.codecId)r.codecpar.extradata||(I.ci(t,!0),this.checkExtradata(t,r),r.codecpar.bitFormat=2);else if(173===r.codecpar.codecId)r.codecpar.extradata||(S.ci(t,!0),this.checkExtradata(t,r),r.codecpar.bitFormat=2);else if(196===r.codecpar.codecId)r.codecpar.extradata||(_.ci(t,!0),this.checkExtradata(t,r),r.codecpar.bitFormat=2);else if(86019===r.codecpar.codecId||86056===r.codecpar.codecId){if(r.codecpar.sampleRate===b.N_){const e=M.R((0,w.iI)(t));C.ai(e)||(r.codecpar.sampleRate=e.sampleRate,r.codecpar.chLayout.nbChannels=e.channels)}}else if(86020===r.codecpar.codecId&&r.codecpar.sampleRate===b.N_){const e=R.R((0,w.iI)(t));C.ai(e)||(r.codecpar.sampleRate=e.sampleRate,r.codecpar.chLayout.nbChannels=e.channels)}}return 0}async readAVPacket_(e,t){if(this.context.ioEnd){if(!this.context.tsSliceQueueMap.size)return-1048576;const i=this.context.tsSliceQueueMap.values();let r;for(;;){const e=i.next();if(e.value&&e.value.slices.length){r=e.value;break}if(e.done)break}if(!r)return-1048576;const n=e.streams.find((e=>e.privData.pid===r.pid));return n?this.parsePESSlice(e,t,r,n):((0,p.A)(r),this.readAVPacket_(e,t))}try{for(;;){const n=await c.n(e.ioReader,this.context);if(!n.payload)continue;if(0===n.pid||n.pid===this.context.currentPmtPid||134===this.context.pmt.pid2StreamType.get(n.pid)){(0,l.A)(n,this.context);continue}const a=this.context.pmt.pid2StreamType.get(n.pid);if(!a)continue;let s=e.streams.find((e=>e.privData.pid===n.pid));s||(s=e.createStream(),(0,U.A)(n.pid,s,this.context));let o=n.payload[4]<<8|n.payload[5],d=this.context.tsSliceQueueMap.get(n.pid),h=!1;if(d){if(d.totalLength>0&&n.payloadUnitStartIndicator){const i=this.parsePESSlice(e,t,d,s);if(i<0)return i;h=!0}}else{if(!n.payloadUnitStartIndicator)continue;d=new g.pi,this.context.tsSliceQueueMap.set(n.pid,d)}var i,r;if(n.payloadUnitStartIndicator&&(d.randomAccessIndicator=null!==(i=null===(r=n.adaptationFieldInfo)||void 0===r?void 0:r.randomAccessIndicator)&&void 0!==i?i:0,d.pos=n.pos,d.pid=n.pid,d.streamType=a,d.expectedLength=0===o?0:o+6),d.slices.push(n.payload),d.totalLength+=n.payload.length,d.expectedLength>0&&d.expectedLength===d.totalLength){const i=this.parsePESSlice(e,t,d,s);if(i<0)return i;h=!0}if(h)return 0}}catch(i){return-1048576!==e.ioReader.error||this.context.ioEnd?-1048576===e.ioReader.error?-1048576:(s.z3(`read packet error, ${i}`,F,456),h.LR):(this.context.ioEnd=!0,this.readAVPacket_(e,t))}}async readAVPacket(e,t){try{return this.readAVPacket_(e,t)}catch(t){return-1048576!==e.ioReader.error&&s.z3(t.message,F,469),e.ioReader.error}}async syncTSPacket(e){let t=b.Dh;for(;;)try{if(71===await e.ioReader.readUint8()){t=this.context.tsPacketSize===d.VG?e.ioReader.getPos()-BigInt(5):e.ioReader.getPos()-BigInt(1);let i=0,r=e.ioReader.getPos();for(;i<=10&&(await e.ioReader.skip(this.context.tsPacketSize-1),71===await e.ioReader.readUint8());)i++;if(i<10){t=b.Dh,await e.ioReader.seek(r);continue}break}}catch(e){t=b.Dh;break}if(t!==b.Dh)for(await e.ioReader.seek(t);;){if((await c.n(e.ioReader,this.context)).payloadUnitStartIndicator){await e.ioReader.seek(t),e.streams.forEach((e=>{let t=this.context.tsSliceQueueMap.get(e.privData.pid);t&&(0,p.A)(t)}));break}t=e.ioReader.getPos()}}async seek(e,t,i,r){let n=e.ioReader.getPos();if(this.context.tsSliceQueueMap.forEach((e=>{e.slices.length&&e.pos<n&&(n=e.pos),(0,p.A)(e)})),this.context.pmt.pid2StreamType.forEach(((e,t)=>{this.context.tsSliceQueueMap.delete(t)})),16&r){const r=(0,y.k)(i,t.timeBase,b.i0);return await e.ioReader.seek(r,!0),this.context.ioEnd=!1,BigInt(0)}if(2&r){const t=await e.ioReader.fileSize();return t<=BigInt(0)?BigInt(h.E$):(i<BigInt(0)?i=BigInt(0):i>t&&(i=t),await e.ioReader.seek(i),4&r||await this.syncTSPacket(e),this.context.ioEnd=!1,n)}{if(t&&t.sampleIndexes.length){let r=A.El(t.sampleIndexes,(e=>e.pts>i?-1:1));if(r>0&&(0,y.k)(i-t.sampleIndexes[r-1].pts,t.timeBase,b.i0)<BigInt(1e4))return s.Yz(`seek in sampleIndexes, found index: ${r}, pts: ${t.sampleIndexes[r-1].pts}, pos: ${t.sampleIndexes[r-1].pos}`,F,605),await e.ioReader.seek(t.sampleIndexes[r-1].pos),this.context.ioEnd=!1,n}s.Yz("not found any keyframe index, try to seek in bytes",F,612);let r=await(0,x.A)(e,t,i,this.firstTSPacketPos,this.readAVPacket.bind(this),this.syncTSPacket.bind(this));return r>=0&&(this.context.ioEnd=!1),r}}getAnalyzeStreamsCount(){var e,t;return null!==(e=null===(t=this.context.pmt)||void 0===t?void 0:t.pid2StreamType.size)&&void 0!==e?e:0}}},89564:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(27274);function n(e,t,i){const n=new Uint8Array(r.GV);let a=0,s=0;for(let r=0;r<e.length-3;r++)if(71===e[r]){const o=8191&(e[r+1]<<8|e[r+2]);let c=48&e[r+3];if(!i||8191===o||c){const e=r%t;n[e]++,a++,n[e]>s&&(s=n[e])}}return s-Math.max(a-10*s,0)/10}},52088:(e,t,i)=>{function r(e){e.slices=[],e.totalLength=0,e.expectedLength=-1}i.d(t,{A:()=>r})},19770:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(80662),n=i.n(r),a=i(77231),s=i(6403);function o(){return{currentProgram:a.N_,currentPmtPid:a.N_,tsPacketSize:a.N_,hasPAT:!1,hasPMT:!1,tsSliceQueueMap:new(n()),pat:new s.Cd,pmt:new s.I4,program2Pmt:new(n()),ioEnd:!1,startPid:256,delay:BigInt(0)}}},76538:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(77231);function n(){return{pid:r.N_,filter:null,tsPacket:null,pes:null,continuityCounter:0,pesSlices:{total:0,buffers:[]},latm:!1}}},39e3:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(6403),n=i(52088),a=i(63599);function s(e,t){const i=t.tsSliceQueueMap.get(e.pid);if(e.payloadUnitStartIndicator){const c=e.payload[0];if(i&&i.totalLength>0){const r=e.payload.slice(1,Math.min(1+c,e.payload.length));i.slices.push(r),i.totalLength+=r.length,i.totalLength===i.expectedLength?((0,a.A)(e.pid,i,t),(0,n.A)(i)):((0,n.A)(i),t.tsSliceQueueMap.delete(e.pid))}for(let i=1+c;i<e.payload.length;){var s,o;if(255===e.payload[i])break;const c=(15&e.payload[i+1])<<8|e.payload[i+2],d=new r.pi;d.pid=e.pid,d.expectedLength=c+3,d.randomAccessIndicator=null!==(s=null===(o=e.adaptationFieldInfo)||void 0===o?void 0:o.randomAccessIndicator)&&void 0!==s?s:0;const l=e.payload.slice(i,Math.min(i+d.expectedLength-d.totalLength,e.payload.length));d.slices.push(l),d.totalLength+=l.length,t.tsSliceQueueMap.set(e.pid,d),d.totalLength===d.expectedLength?((0,a.A)(e.pid,d,t),(0,n.A)(d)):((0,n.A)(d),t.tsSliceQueueMap.delete(e.pid)),i+=l.length}}else if(i&&0!==i.totalLength){const r=e.payload.slice(0,Math.min(i.expectedLength-i.totalLength,e.payload.length));i.slices.push(r),i.totalLength+=r.length,i.totalLength===i.expectedLength?((0,a.A)(e.pid,i,t),(0,n.A)(i)):((0,n.A)(i),t.tsSliceQueueMap.delete(e.pid))}}},86191:(e,t,i)=>{i.d(t,{A:()=>f});var r=i(61499),n=i(76538),a=i(27274),s=i(50848),o=i(36488),c=i(61702),d=i(65451),l=i(37837),h=i(14686);function f(e,t,i){t.timeBase.den=9e4,t.timeBase.num=1;const f=(0,n.A)();f.pid=e,t.privData=f;const u=i.pmt.pid2StreamType.get(e);if(6===u){const r=i.pmt.pid2ESDescriptor.get(e);if(t.codecpar.codecType=2,r){var p;const e=r.find((e=>5===e.tag));if(e&&(null===(p=e.buffer)||void 0===p?void 0:p.length)>=4)if("O"===String.fromCharCode(e.buffer[0])||"p"===String.fromCharCode(e.buffer[1])||"u"===String.fromCharCode(e.buffer[2])||"s"===String.fromCharCode(e.buffer[3])){t.codecpar.codecType=1,t.codecpar.codecId=86076,t.codecpar.sampleRate=48e3;const e=r.find((e=>127===e.tag));if(e&&128===e.buffer[0]){t.codecpar.chLayout.nbChannels=15&e.buffer[1]?15&e.buffer[1]:2;const i=d.Ij(t.codecpar);i&&(t.codecpar.extradata=(0,l.sY)(i.length),(0,h.lW)(t.codecpar.extradata,i.length,i),t.codecpar.extradataSize=i.length)}}else if("A"===String.fromCharCode(e.buffer[0])||"V"===String.fromCharCode(e.buffer[1])||"0"===String.fromCharCode(e.buffer[2])||"1"===String.fromCharCode(e.buffer[3])){t.codecpar.codecType=0,t.codecpar.codecId=225;const e=r.find((e=>128===e.tag));e&&(t.codecpar.extradata=(0,l.sY)(e.buffer.length),(0,h.lW)(t.codecpar.extradata,e.buffer.length,e.buffer),t.codecpar.extradataSize=e.buffer.length)}}}else{const e=a.$x[u];e?(t.codecpar.codecType=e[0],t.codecpar.codecId=e[1]):t.codecpar.codecType=2}let g;switch(u){case 15:g=new s.A;break;case 17:g=new o.A;break;case 27:case 36:break;case 6:86076===t.codecpar.codecId&&(g=new c.A)}return g&&(t.privData.filter=g,g.init(t.codecpar[r.o9],t.timeBase[r.o9])),t}},52888:(e,t,i)=>{function r(e,t,i){return e>t?i>t&&(t=i>e?e:i):t>i&&(t=i>e?i:e),t}i.d(t,{y:()=>r})},31239:(e,t,i)=>{function r(e,t){let i=0,r=e[i++];if(t.adaptationFieldInfo.discontinuityIndicator=r>>7&1,t.adaptationFieldInfo.randomAccessIndicator=r>>6&1,t.adaptationFieldInfo.elementaryStreamPriorityIndicator=r>>5&1,t.adaptationFieldInfo.pcrFlag=r>>4&1,t.adaptationFieldInfo.opcrFlag=r>>3&1,t.adaptationFieldInfo.splicingPointFlag=r>>2&1,t.adaptationFieldInfo.transportPrivateDataFlag=r>>1&1,t.adaptationFieldInfo.adaptationFieldExtensionFlag=1&r,t.adaptationFieldInfo.pcrFlag){const r=BigInt(Math.floor(e[i++]<<25|e[i++]<<17|e[i++]<<9|e[i++]<<1|e[i]>>7)),n=BigInt(Math.floor((1&e[i++])<<8|e[i++]));t.adaptationFieldInfo.pcr=r*BigInt(300)+n}if(t.adaptationFieldInfo.opcrFlag){const r=BigInt(Math.floor(e[i++]<<25|e[i++]<<17|e[i++]<<9|e[i++]<<1|e[i]>>7)),n=BigInt(Math.floor((1&e[i++])<<8|e[i++]));t.adaptationFieldInfo.pcr=r*BigInt(300)+n}if(t.adaptationFieldInfo.splicingPointFlag&&(t.adaptationFieldInfo.spliceCountDown=e[i++]),t.adaptationFieldInfo.transportPrivateDataFlag){const r=e[i++];t.adaptationFieldInfo.transportPrivateData=e.subarray(i,i+r),i+=r}if(t.adaptationFieldInfo.adaptationFieldExtensionFlag){const r=e[i++];t.adaptationFieldInfo.extension=e.subarray(i,i+r),i+=r}}i.d(t,{A:()=>r})},20549:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(31865),n=i(6403),a=i(92647),s=i(4624),o="src/avformat/formats/mpegts/function/parsePAT.ts";function c(e,t){let i=0;const c=new r.A((0,a.A)(Uint8Array,e.slices),!0),d=c.readUint8();0!==d&&s.z3(`parsePAT: table_id ${d} is not corresponded to PAT!`,o,40);const l=4095&c.readUint16();c.readUint16(),i=c.readUint8();const h=i>>1&31,f=1&i,u=c.readUint8();let p;if(c.readUint8(),1===f&&0===u)p=new n.Cd,p.versionNumber=h;else if(p=t.pat,!p)return void s.z3("can not found PAT in mpegts context",o,64);const g=l-5-4,m=Number(BigInt.asIntN(32,c.getPos()))+g;let U=-1,w=-1;for(;c.getPos()<m;){const e=c.readUint16(),t=8191&c.readUint16();0===e?p.networkPid=t:(p.program2PmtPid.set(e,t),-1===U&&(U=e),-1===w&&(w=t))}1===f&&0===u&&(t.pat||s.pq("parsed first PAT",o,100),t.pat=p,t.currentProgram=U,t.currentPmtPid=w,t.hasPAT=!0)}},51660:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(77231),n=i(4624),a=i(9705),s="src/avformat/formats/mpegts/function/parsePES.ts";function o(e){const t=e.data,i=t[3],o=t[4]<<8|t[5];let c=0,d=0,l=0;if(188!==i&&190!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i){let i=r.Dh,h=r.Dh;for(;;){if(6+d>=t.length)return;if(l=t[6+d],255!==l)break;d++}if(64==(192&l)&&(d+=2,l=t[6+d]),32==(224&l))c+=5,i=i=BigInt(Math.floor(536870912*(14&t[6+d])+4194304*(255&t[7+d])+16384*(254&t[8+d])+128*(255&t[9+d])+(254&t[10+d])/2)),16&l?(h=BigInt(Math.floor(536870912*(14&t[11+d])+4194304*(255&t[12+d])+16384*(254&t[13+d])+128*(255&t[14+d])+(254&t[15+d])/2)),c+=5):h=i;else if(128==(192&l)){const e=(192&t[7+d])>>>6;c=3+t[8+d],2!==e&&3!==e||(i=BigInt(Math.floor(536870912*(14&t[9+d])+4194304*(255&t[10+d])+16384*(254&t[11+d])+128*(255&t[12+d])+(254&t[13+d])/2)),h=3===e?BigInt(Math.floor(536870912*(14&t[14+d])+4194304*(255&t[15+d])+16384*(254&t[16+d])+128*(255&t[17+d])+(254&t[18+d])/2)):i)}else{if(15!==l)return n.z3("invalid data",s,121),a.LR;c=1}e.dts=h,e.pts=i;const f=6+d+c;let u=0;if(0!==o){if(o<d+c)return void n.z3("Malformed PES: PES_packet_length < 3 + PES_header_data_length",s,133);u=o-(d+c)}else u=t.byteLength-f;e.payload=t.subarray(f,f+u)}else if((188===i||191===i||240===i||241===i||255===i||242===i||248===i)&&6===e.streamId){const i=6;let r=0;r=0!==o?o:t.byteLength-i,e.payload=t.subarray(i,i+r)}return 0}},39144:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(6403);function n(e){let t=new Uint8Array(e.totalLength);for(let i=0,r=0;i<e.slices.length;i++){let n=e.slices[i];t.set(n,r),r+=n.byteLength}const i=t[3],n=new r.xf;return n.data=t,n.pid=e.pid,n.streamId=i,n.streamType=e.streamType,n.pos=e.pos,n.randomAccessIndicator=e.randomAccessIndicator,n}},65945:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(31865),n=i(6403),a=i(92647),s=i(4624),o="src/avformat/formats/mpegts/function/parsePMT.ts";function c(e,t){let i=0;const c=new r.A((0,a.A)(Uint8Array,e.slices),!0),d=c.readUint8();2!==d&&s.z3(`parse PMT: table_id ${d} is not corresponded to PAT!`,o,40);const l=4095&c.readUint16(),h=c.readUint16();i=c.readUint8();const f=i>>1&31,u=1&i,p=c.readUint8();let g;if(c.readUint8(),1===u&&0===p)g=new n.I4,g.programNumber=h,g.versionNumber=f,t.program2Pmt.set(h,g),t.hasPMT=!0;else if(g=t.program2Pmt.get(h),!g)return void s.z3("can not found PMT in mpegts context",o,68);g.pcrPid=8191&c.readUint16();const m=4095&c.readUint16();c.skip(m);let U=Number(BigInt.asIntN(32,c.getPos()))+(l-9-m-4);for(;c.getPos()<U;){const e=c.readUint8(),t=8191&c.readUint16(),i=4095&c.readUint16();if(g.pid2StreamType.set(t,e),i>0){const e=[],r=Number(BigInt.asIntN(32,c.getPos()))+i;for(;c.getPos()<r;){const t=new n.kJ;t.tag=c.readUint8();const i=c.readUint8();i>0&&(t.buffer=c.readBuffer(i)),e.push(t)}g.pid2ESDescriptor.set(t,e)}}h===t.currentProgram&&(t.pmt||s.pq("parsed first PMT",o,111),t.pmt=g)}},43383:(e,t,i)=>{function r(e,t){}i.d(t,{A:()=>r})},63599:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(20549),n=i(65945),a=i(43383);function s(e,t,i){0===e?(0,r.A)(t,i):e===i.currentPmtPid?(0,n.A)(t,i):i.pmt&&134===i.pmt.pid2StreamType.get(e)&&(0,a.A)(t,i)}},53783:(e,t,i)=>{i.d(t,{n:()=>h,q:()=>l});var r=i(27274),n=i(89564),a=i(52888),s=i(4624),o=i(6403),c=i(31239),d="src/avformat/formats/mpegts/impegts.ts";async function l(e){let t;try{t=await e.peekBuffer(r.pm)}catch(i){-1048576!==e.error&&(t=await e.peekBuffer(e.remainingLength()))}if(t&&t.length>=r.ZT){const e=(0,n.A)(t,r.ZT,!1),i=(0,n.A)(t,r.VG,!1),o=(0,n.A)(t,r.eR,!1);let c=(0,a.y)(e,o,i);t.length<r.pm&&(c+=r.hY);let l=r.ZT;return e>c?l=r.ZT:i>c?l=r.VG:o>c&&(l=r.eR),s.Yz(`got ts packet size: ${l}`,d,72),l}return 0}async function h(e,t){const i=e.getPos();let n=0;t.tsPacketSize===r.VG&&await e.skip(4);const a=await e.readUint8();71!==a&&s.h2(`found syncByte not 0x47, value: ${a.toString(16)}`,d,94);const l=new o.am;l.pos=i,n=await e.readUint16(),l.payloadUnitStartIndicator=n>>14&1,l.transportPriority=n>>13&1,l.pid=8191&n,n=await e.readUint8(),l.adaptationFieldControl=n>>4&3,l.continuityCounter=15&n;let h=4;if(2===l.adaptationFieldControl||3===l.adaptationFieldControl){const i=await e.readUint8();if(5+i===r.ZT)return(0,c.A)(await e.readBuffer(i),l),t.tsPacketSize===r.eR&&await e.skip(16),l;i>0&&(0,c.A)(await e.readBuffer(i),l),h=5+i}return 1!==l.adaptationFieldControl&&3!==l.adaptationFieldControl||(l.payload=await e.readBuffer(r.ZT-h)),t.tsPacketSize===r.eR&&await e.skip(16),l}},27274:(e,t,i)=>{i.d(t,{$x:()=>h,GV:()=>s,OS:()=>d,VG:()=>n,ZT:()=>a,eR:()=>r,hY:()=>c,pm:()=>o,qJ:()=>l});const r=204,n=192,a=188,s=204,o=8192,c=5,d=5,l=10,h={15:[1,86018],17:[1,86018],3:[1,86017],4:[1,86017],1:[0,2],2:[0,2],27:[0,27],16:[0,12],36:[0,173],51:[0,196],129:[1,86019],135:[1,86056],130:[1,86020]}},6403:(e,t,i)=>{i.d(t,{Cd:()=>l,I4:()=>u,am:()=>c,kJ:()=>f,pi:()=>d,xf:()=>p,yU:()=>h});var r=i(134),n=i(80662),a=i.n(n),s=i(77231);class o{constructor(){(0,r.A)(this,"discontinuityIndicator",0),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"elementaryStreamPriorityIndicator",0),(0,r.A)(this,"pcrFlag",0),(0,r.A)(this,"opcrFlag",0),(0,r.A)(this,"splicingPointFlag",0),(0,r.A)(this,"transportPrivateDataFlag",0),(0,r.A)(this,"adaptationFieldExtensionFlag",0),(0,r.A)(this,"pcr",BigInt(0)),(0,r.A)(this,"opcr",BigInt(0)),(0,r.A)(this,"spliceCountDown",0),(0,r.A)(this,"transportPrivateData",null),(0,r.A)(this,"extension",null)}}class c{constructor(){(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payloadUnitStartIndicator",0),(0,r.A)(this,"transportPriority",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"adaptationFieldControl",0),(0,r.A)(this,"continuityCounter",0),(0,r.A)(this,"transportScramblingControl",0),(0,r.A)(this,"adaptationFieldInfo",new o),(0,r.A)(this,"payload",null)}}class d{constructor(){(0,r.A)(this,"slices",[]),(0,r.A)(this,"totalLength",0),(0,r.A)(this,"expectedLength",s.N_),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"pos",s.Dh)}}class l{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"networkPid",s.N_),(0,r.A)(this,"program2PmtPid",new(a()))}}class h extends c{}class f{constructor(){(0,r.A)(this,"tag",void 0),(0,r.A)(this,"buffer",void 0)}}class u{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"programNumber",0),(0,r.A)(this,"pcrPid",0),(0,r.A)(this,"pid2StreamType",new(a())),(0,r.A)(this,"pid2ESDescriptor",new(a()))}}class p{constructor(){(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"streamId",s.N_),(0,r.A)(this,"dts",s.Dh),(0,r.A)(this,"pts",s.Dh),(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payload",null),(0,r.A)(this,"data",null),(0,r.A)(this,"randomAccessIndicator",0)}}},2187:(e,t,i)=>{i.d(t,{d:()=>s});var r=i(72739),n=i(44328),a=i(77231);function s(e,t,i){let s=BigInt(0);return r.__(e,(e=>{s+=e.codecpar.bitrate*(0,n.k)(t,i,a.i0)/BigInt(8e3)})),s}},52071:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(63939),n=i(9599),a=i(29170),s=i(77231),o=i(44328),c=i(2187),d=i(71517),l=i(9705),h=i(4624),f="src/avformat/function/seekInBytes.ts";async function u(e,t,i,u,p,g){const m=e.ioReader.getPos(),U=await e.ioReader.fileSize();let w=s.Dh,b=i;t.startTime!==s.Dh?b-=t.startTime:b-=t.firstDTS;const x=(0,o.k)(i,t.timeBase,s.i0);if(x<BigInt(1e4))return h.Yz(`seek pts is earlier then 10s, seek to first packet pos(${u}) directly`,f,63),await e.ioReader.seek(u),m;let y=(0,c.d)(e.streams,b,t.timeBase);const A=U-(0,c.d)(e.streams,BigInt(1e4),s.i0),P=(0,c.d)(e.streams,BigInt(1e4),s.i0);if(y>A&&(y=A),y<u)return await e.ioReader.seek(u),m;const I=(0,d._5)();let S=U,_=BigInt(0);for(;;){if(S-_<P){w=_;break}await e.ioReader.seek(y),await g(e);const t=e.ioReader.getPos();if(!(await p(e,I)>=0)){w=s.Dh;break}{const e=(0,o.k)(r.f[17](I+8),(0,a.A)(I+72,n.P),s.i0),i=e-x;if(h.Yz(`try to seek to pos: ${y}, got packet pts: ${r.f[17](I+8)}(${e}ms), diff: ${i}ms`,f,98),i<=BigInt(0)&&-i<BigInt(1e4)){w=t;break}i>BigInt(0)?(S=y,y=_+S>>BigInt(1)):(_=y,y=_+S>>BigInt(1))}}return(0,d.Qe)(I),w!==s.Dh?(h.Yz(`finally seek to pos ${w}`,f,126),await e.ioReader.seek(w),await g(e),m):(await e.ioReader.seek(m),BigInt(l.E$))}},23991:(e,t,i)=>{function r(e){let t=0,i=0;for(;i<32&&0===e.readU1();)i++;return t=e.readU(i),t+=(1<<i)-1,t}function n(e){let t=r(e);return t=1&t?(t+1)/2:-t/2,t}i.d(t,{$x:()=>n,xb:()=>r})},39381:(e,t,i)=>{i.d(t,{E3:()=>a,Sg:()=>d,Y0:()=>c,ht:()=>o,r8:()=>n,yd:()=>s});var r=i(63939);function n(e){return r.f[2](e)}function a(e){return n(e+1)<<8|n(e)}function s(e){return n(e)<<8|n(e+1)}function o(e){return n(e)<<16|n(e+1)<<8|n(e+2)}function c(e){return a(e+2)<<16|a(e)}function d(e){return s(e)<<16|s(e+2)}},60264:(e,t,i)=>{function r(e){return e.length>4&&0===e[0]&&0===e[1]&&(1===e[2]||0===e[2]&&1===e[3])}function n(e,t){let i=0;for(let r=t;r<e.length;r++)switch(e[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function a(e){const t=[];let i=n(e,0),r={offset:-1,startCode:0};for(;r=n(e,i.offset+i.startCode),r.offset>-1;)t.push(e.subarray(i.offset+i.startCode,r.offset,!0)),i=r;return t.push(e.subarray(i.offset+i.startCode,void 0,!0)),t}function s(e,t=0,i){i||(i=e.length);const r=new Uint8Array(e.length);let n=0,a=0;for(let s=0;s<e.length;s++){if(s>=t&&s<i)if(0===e[s])n++;else if(3===e[s]&&2===n&&s+1<e.length&&e[s+1]<=3){if(s++,s===e.length)break;n=0===e[s]?1:0}else n=0;r[a++]=e[s]}return r.slice(0,a)}i.d(t,{BN:()=>s,Bs:()=>r,Ky:()=>n,py:()=>a})},37246:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(134),n=i(4624);class a{constructor(e=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.pos=BigInt(0),this.size=e,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let e=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let t=this.pointer,i=this.bitsLeft;return 0===i&&(t++,i=8),e=this.buffer[t]>>i-1&1,e}readU1(){let e=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,e=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8,this.pos++),e}readU(e){let t=0;for(let i=0;i<e;i++)t|=this.readU1()<<e-i-1;return t}peekU(e){const t=this.pointer,i=this.bitsLeft,r=this.pos,n=this.readU(e);return this.pointer=t,this.bitsLeft=i,this.pos=r,n}remainingLength(){return this.endPointer-this.pointer}getBitLeft(){return this.bitsLeft}getPointer(){return this.pointer}setPointer(e){this.pointer=e}getPos(){return this.pos}skip(e){const t=(e-e%8)/8;this.pointer+=t,this.pos+=BigInt(t);const i=e%8;this.bitsLeft<=i?(this.pointer++,this.pos++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&(this.pointer++,this.pos++),!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const e=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(e<0)throw this.error=e,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+e,this.pointer=0}else{const e=this.onFlush(this.buffer);if(this.endPointer=e,this.pointer=0,this.bitsLeft=8,e<0)throw this.error=e,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{const t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,n.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",257)}}reset(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0,this.pos=BigInt(0)}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++,this.pos++)}}},83314:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(134);class n{constructor(e=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=e,this.error=0,this.pos=BigInt(0),this.buffer=new Uint8Array(this.size)}writeU1(e){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&e?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.pos++,this.bitPointer=0)}writeU(e,t){for(let i=0;i<e;i++)this.writeU1(t>>e-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const e=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}reset(){this.pointer=0,this.bitPointer=0,this.error=0,this.pos=BigInt(0)}getBuffer(){return this.buffer}getPointer(){return this.pointer}getPos(){return this.pos}}},729:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(134),n=i(4624),a=i(50011);class s{constructor(e,t=!0){(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}writeUint8(e){this.data.setUint8(this.pos+++this.byteStart,e)}writeUint16(e){this.data.setUint16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeUint24(e){const t=3840&e,i=240&e,r=15&e;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(i),this.writeUint8(r))}writeUint32(e){this.data.setUint32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeUint64(e){const t=e&BigInt(4294967295),i=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(t)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(t)))}writeInt8(e){this.data.setInt8(this.pos+++this.byteStart,e)}writeInt16(e){this.data.setInt16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.data.setInt32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeInt64(e){const t=e&BigInt(4294967295),i=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(t)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(t)))}writeFloat(e){this.data.setFloat32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeDouble(e){this.data.setFloat64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}skip(e){this.seek(this.pos+e)}back(e){this.seek(this.pos-e)}remainingSize(){return this.size-this.pos}writeBuffer(e){let t=e.length;this.remainingSize()<t&&(t=this.remainingSize(),n.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${e.length}, but set ${t}`,"src/common/io/BufferWriter.ts",218)),this.buffer.set(e,this.pos),this.pos+=e.length}writeString(e){const t=a.encode(e);return this.writeBuffer(t),t.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(e,t=!0){this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}},95073:(e,t,i)=>{function r(e,t){return e+(t-1)&~(t-1)}i.d(t,{A:()=>r})}}]);