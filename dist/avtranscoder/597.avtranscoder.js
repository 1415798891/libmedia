"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[597],{64436:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(134),n=i(63939),a=i(37837),s=i(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,a.Gy)(168),(0,s.Yi)(this.inCodecpar,t),this.inTimeBase={den:n.f[15](e+4),num:n.f[15](e)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},9848:(t,e,i)=>{i.d(e,{A:()=>d});var r=i(134),n=i(63939),a=i(64436),s=i(58469),o=i(14686),h=i(71517),l=i(37837),c=i(9705);class d extends a.A{constructor(...t){super(...t),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0)}init(t,e){return super.init(t,e),this.cache=(0,h._5)(),0}destroy(){super.destroy(),(0,h.Qe)(this.cache),this.cache=0,this.cached=!1}sendAVPacket(t){if(!n.f[20](t+24)||!n.f[15](t+28))return;const e=7+n.f[15](t+28),i=(0,l.sY)(e),r=(0,o.s3)(i,e);r[0]=255,r[1]=240,r[1]|=8,r[1]|=1,r[2]=(n.f[15](this.inCodecpar+48)-1&3)<<6,r[2]|=(15&s.Hm[n.f[15](this.inCodecpar+136)])<<2,r[2]|=(4&n.f[15](this.inCodecpar+116))>>2,r[3]=(3&n.f[15](this.inCodecpar+116))<<6,r[3]|=r.length>>11&3,r[4]=r.length>>3&255,r[5]=(7&r.length)<<5,r[5]|=31,r[6]=252,r.set((0,o.s3)(n.f[20](t+24),n.f[15](t+28)),7),(0,h.zu)(this.cache,t),(0,h.NX)(this.cache,i,e),this.cached=!0}receiveAVPacket(t){return this.cached?((0,h.Up)(t),(0,h.rN)(t,this.cache),this.cached=!1,0):c.LT}}},60480:(t,e,i)=>{i.d(e,{A:()=>g});var r=i(134),n=i(63939),a=i(50932),s=i(64436),o=i(58469),h=i(14686),l=i(71517),c=i(37837),d=i(9705),f=i(95335),u=i(83314);const p={mod:20},U=new Uint8Array([86,224,0]);class g extends s.A{constructor(t={}){super(),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"bitWriter",void 0),(0,r.A)(this,"counter",void 0),(0,r.A)(this,"options",void 0),this.options=f.X$({},p,t)}init(t,e){return super.init(t,e),this.cache=(0,l._5)(),this.cached=!1,this.counter=0,this.bitWriter=new u.A,0}destroy(){super.destroy(),(0,l.Qe)(this.cache),this.cache=0}writeHeader(){this.bitWriter.writeU1(0===this.counter?0:1),0===this.counter&&(this.bitWriter.writeU1(0),this.bitWriter.writeU1(1),this.bitWriter.writeU(6,0),this.bitWriter.writeU(4,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(5,n.f[15](this.inCodecpar+48)-1&31),this.bitWriter.writeU(4,15&o.Hm[n.f[15](this.inCodecpar+136)]),this.bitWriter.writeU(4,15&n.f[15](this.inCodecpar+116)),this.bitWriter.writeU(3,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(8,255),this.bitWriter.writeU1(0),this.bitWriter.writeU1(0)),this.counter++,this.counter%=this.options.mod}copyBytes(t){for(let e=0;e<t.length;e++)this.bitWriter.writeU(8,t[e])}sendAVPacket(t){if(!n.f[20](t+24)||!n.f[15](t+28))return;this.bitWriter.clear();const e=(0,l.rU)(t,1);if(e){const{profile:t,sampleRate:i,channels:r}=(0,o._5)((0,h.s3)(n.f[20](e),n.f[15](e+4)));a.M[15](this.inCodecpar+48,t),a.M[15](this.inCodecpar+136,i),a.M[15](this.inCodecpar+116,r),this.counter=0}this.writeHeader();let i=0;for(;i<=n.f[15](t+28)-255;i+=255)this.bitWriter.writeU(8,255);this.bitWriter.writeU(8,n.f[15](t+28)-i);const r=(0,h.s3)(n.f[20](t+24),n.f[15](t+28));129==(225&r[0])?(this.bitWriter.writeU(8,254&r[0]),this.copyBytes(r.subarray(1))):this.copyBytes(r),this.bitWriter.padding();const s=this.bitWriter.getPointer(),d=3+s,f=(0,c.sY)(d),u=(0,h.s3)(f,d);u.set(U,0),u[1]|=s>>8&31,u[2]|=255&s,u.set(this.bitWriter.getBuffer().subarray(0,s),3),(0,l.zu)(this.cache,t),(0,l.NX)(this.cache,f,d),this.cached=!0}receiveAVPacket(t){return this.cached?((0,l.Up)(t),(0,l.rN)(t,this.cache),this.cached=!1,0):d.LT}}},52251:(t,e,i)=>{i.d(e,{A:()=>U});var r=i(134),n=i(63939),a=i(50932),s=i(64436),o=i(71517),h=i(20620),l=i(53e3),c=i(55611),d=i(9705),f=i(60264),u=i(4624),p=i(14686);class U extends s.A{constructor(...t){super(...t),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0)}init(t,e){return super.init(t,e),this.cache=(0,o._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,o.Qe)(this.cache),this.cache=0}sendAVPacket(t){const e=(0,p.JW)(n.f[20](t+24),n.f[15](t+28));if(2===n.f[15](t+80)||(0,f.Bs)(e))(0,o.rN)(this.cache,t);else{let i;(0,o.zu)(this.cache,t);const r=(0,o.rU)(t,1);let s=null;r&&(s=(0,p.JW)(n.f[20](r),n.f[15](r+4))),27===n.f[15](this.inCodecpar+4)||12===n.f[15](this.inCodecpar+4)?i=h.OD(e,s):173===n.f[15](this.inCodecpar+4)?i=l.OD(e,s):196===n.f[15](this.inCodecpar+4)?i=c.OD(e,s):u.h2(`not support for codecId: ${n.f[15](this.inCodecpar+4)}`,"src/avformat/bsf/h2645/Avcc2AnnexbFilter.ts",94),a.M[15](this.cache+80,2),(0,o.NX)(this.cache,i.bufferPointer,i.length),i.key&&a.M[15](this.cache+36,1|n.f[15](this.cache+36))}return this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,o.Up)(t),(0,o.rN)(t,this.cache),this.cached=!1,0):d.LR}}},77662:(t,e,i)=>{i.d(e,{A:()=>d});var r=i(134),n=i(63939),a=i(64436),s=i(14686),o=i(71517),h=i(37837),l=i(9705),c=i(65451);class d extends a.A{constructor(...t){super(...t),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"opusPendingTrimStart",void 0)}init(t,e){return super.init(t,e),this.cache=(0,o._5)(),this.cached=!1,this.opusPendingTrimStart=48e3*(n.f[15](this.inCodecpar+148)>0?n.f[15](this.inCodecpar+148):0)/n.f[15](this.inCodecpar+136),0}destroy(){super.destroy(),(0,o.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(!n.f[20](t+24)||!n.f[15](t+28))return;const e=(0,s.s3)(n.f[20](t+24),n.f[15](t+28)),i=c.kt(e);let r=null;const a=(0,o.rU)(t,11);a&&(r=(0,s.s3)(n.f[20](a),n.f[15](a+4)));let l=0;r&&r.length>=10&&(l=48e3*(r[4]<<24|r[5]<<16|r[6]<<8|r[9])/n.f[15](this.inCodecpar+136));let d=e.length+2+e.length/255+1;this.opusPendingTrimStart&&(d+=2),l&&(d+=2);const f=(0,h.sY)(d),u=(0,s.s3)(f,d);u[0]=127,u[1]=224,this.opusPendingTrimStart&&(u[1]|=16),l&&(u[1]|=8);let p=e.length,U=2;do{u[U]=Math.min(p,255),p-=255,U++}while(p>=0);let g=0;return this.opusPendingTrimStart&&(g=Math.min(this.opusPendingTrimStart,i),u[U]=(65280&g)>>8,u[U+1]=255&g,U+=2,this.opusPendingTrimStart-=g),l&&(l=Math.min(l,i-g),u[U]=(65280&l)>>8,u[U+1]=255&l,U+=2),u.set(e,U),(0,o.zu)(this.cache,t),(0,o.NX)(this.cache,f,d),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,o.Up)(t),(0,o.rN)(t,this.cache),this.cached=!1,0):l.LR}}},58469:(t,e,i)=>{i.d(e,{En:()=>o,Hm:()=>a,Ij:()=>c,XC:()=>l,_5:()=>h,hY:()=>s,uF:()=>n});var r=i(77231);const n={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},a={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],o=[r.N_,1,2,3,4,5,6,7];function h(t){let e=r.N_,i=r.N_,n=r.N_;var a,h;return t.length>=2&&(e=t[0]>>3&31,i=null!==(a=s[(7&t[0])<<1|t[1]>>7])&&void 0!==a?a:48e3,n=null!==(h=o[t[1]>>3&15])&&void 0!==h?h:2),{profile:e,sampleRate:i,channels:n}}function l(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e){const{profile:i,sampleRate:r,channels:n}=h(e);t.codecpar.profile=i,t.codecpar.sampleRate=r,t.codecpar.chLayout.nbChannels=n}}function c(t){const e=a[t.sampleRate],i=t.chLayout.nbChannels,r=new Uint8Array(2);return r[0]=(31&t.profile)<<3|(14&e)>>1,r[1]=(1&e)<<7|(15&i)<<3,r}},20620:(t,e,i)=>{i.d(e,{Jk:()=>v,OD:()=>y,XC:()=>F,ci:()=>I,k9:()=>b,oT:()=>x,tZ:()=>m});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),h=i(37246),l=i(4624),c=i(14686),d=i(71517),f=i(60264),u=i(37837),p=i(23991),U="src/avformat/codecs/h264.ts";const g=3,m={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"},w=[{level:10,maxResolution:25344,maxFrameRate:15},{level:11,maxResolution:25344,maxFrameRate:30},{level:12,maxResolution:101376,maxFrameRate:30},{level:13,maxResolution:101376,maxFrameRate:30},{level:20,maxResolution:101376,maxFrameRate:30},{level:21,maxResolution:202752,maxFrameRate:30},{level:22,maxResolution:414720,maxFrameRate:30},{level:30,maxResolution:414720,maxFrameRate:30},{level:31,maxResolution:921600,maxFrameRate:30},{level:32,maxResolution:1310720,maxFrameRate:60},{level:40,maxResolution:2097152,maxFrameRate:30},{level:41,maxResolution:2097152,maxFrameRate:60},{level:42,maxResolution:2228224,maxFrameRate:60},{level:50,maxResolution:8912896,maxFrameRate:30},{level:51,maxResolution:8912896,maxFrameRate:60},{level:52,maxResolution:8912896,maxFrameRate:120},{level:60,maxResolution:35651584,maxFrameRate:30},{level:61,maxResolution:35651584,maxFrameRate:60},{level:62,maxResolution:35651584,maxFrameRate:120}];function b(t,e,i){const r=t*e;for(const t of w)if(r<=t.maxResolution&&i<=t.maxFrameRate)return t.level}function P(t){const e=new o.A(t);e.skip(5);const i=[],r=[],n=[],a=31&e.readUint8();for(let t=0;t<a;t++){const t=e.readUint16();i.push(e.readBuffer(t))}const s=e.readUint8();for(let t=0;t<s;t++){const t=e.readUint16();r.push(e.readBuffer(t))}if(e.remainingSize()>4){e.skip(3);const t=e.readUint8();if(t>0)for(let i=0;i<t;i++){const t=e.readUint16();n.push(e.readBuffer(t))}}return{spss:i,ppss:r,spsExts:n}}function A(t,e,i=[]){t.length>32&&(l.R8(`h264 metadata's sps max length is 32, but get ${t.length}`,U,199),t=t.slice(0,32)),t.length>256&&(l.R8(`h264 metadata's pps max length is 256, but get ${t.length}`,U,203),t=t.slice(0,256));let r=7;r=t.reduce(((t,e)=>t+2+e.length),r),r=e.reduce(((t,e)=>t+2+e.length),r);const n=t[0],o=S(n);66!==o.profile&&77!==o.profile&&88!==o.profile&&(r+=4,i.length&&(r=i.reduce(((t,e)=>t+2+e.length),r)));const h=new Uint8Array(r),c=new s.A(h);return c.writeUint8(1),c.writeUint8(n[1]),c.writeUint8(n[2]),c.writeUint8(n[3]),c.writeUint8(252|g),c.writeUint8(224|31&t.length),a.__(t,(t=>{c.writeUint16(t.length),c.writeBuffer(t)})),c.writeUint8(e.length),a.__(e,(t=>{c.writeUint16(t.length),c.writeBuffer(t)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(c.writeUint8(252|o.chromaFormatIdc),c.writeUint8(248|o.bitDepthLumaMinus8),c.writeUint8(248|o.bitDepthChromaMinus8),i.length&&a.__(i,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),h}function x(t){let e,i=(0,f.py)(t),r=!1;if(i.length>1){const t=[],r=[],n=[];i.forEach((e=>{const i=31&e[0];7===i?t.push(e):8===i?r.push(e):13===i&&n.push(e)})),t.length&&r.length&&(e=A(t,r,n)),i=i.filter((t=>{const e=31&t[0];return 9!==e&&8!==e&&7!==e&&13!==e}))}const n=i.reduce(((t,e)=>t+g+1+e.length),0),o=(0,u.sY)(n),h=(0,c.s3)(o,n),l=new s.A(h);return a.__(i,(t=>{3===g?l.writeUint32(t.length):2===g?l.writeUint24(t.length):1===g?l.writeUint16(t.length):l.writeUint8(t.length),l.writeBuffer(t.subarray(0)),5==(31&t[0])&&(r=!0)})),{bufferPointer:o,length:n,key:r,extradata:e}}function y(t,e){const i=e?3&e[4]:g;let r=[],n=[],h=[],l=!1;if(e){const t=P(e);r=t.spss,n=t.ppss,h=t.spsExts,l=!0}const d=[],f=[],p=new o.A(t);for(;p.remainingSize()>0;){let e=0;e=3===i?p.readUint32():2===i?p.readUint24():1===i?p.readUint16():p.readUint8();const r=t.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+e);p.skip(e);const n=31&r[0];6===n?f.push(r):9!==n&&d.push(r)}let U=r.reduce(((t,e)=>t+4+e.length),0);U=n.reduce(((t,e)=>t+4+e.length),U),U=h.reduce(((t,e)=>t+4+e.length),U),U=f.reduce(((t,e)=>t+4+e.length),U),U=d.reduce(((t,e,i)=>t+(i?3:4)+e.length),U);const m=(0,u.sY)(U+6),w=new s.A((0,c.s3)(m,U+6));return w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeUint8(9),w.writeUint8(240),a.__(f,(t=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(t)})),a.__(r,(t=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(t)})),a.__(n,(t=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(t)})),a.__(h,(t=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(t)})),a.__(d,((t,e)=>{w.writeUint8(0),w.writeUint8(0),e||w.writeUint8(0),w.writeUint8(1),w.writeBuffer(t),5==(31&t[0])&&(l=!0)})),{bufferPointer:m,length:U+6,key:l}}function v(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,d.iI)(t);if((0,f.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:g;let s=[],h=[],l=[],p=[];const U=new o.A(n);for(;U.remainingSize()>0;){let t=0;t=3===a?U.readUint32():2===a?U.readUint24():1===a?U.readUint16():U.readUint8();const e=n.subarray(0|Number(0xffffffffn&U.getPos()),(0|Number(0xffffffffn&U.getPos()))+t);U.skip(t);const i=31&e[0];7===i?s.push(e):8===i?h.push(e):13===i?l.push(e):p.push(e)}if(s.length||h.length){const e=A(s,h,l),i=(0,u.sY)(e.length);(0,c.lW)(i,e.length,e),(0,d.Ow)(t,1,i,e.length)}}function I(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,d.iI)(t);if(!(0,f.Bs)(i))return;let a=(0,f.py)(i);if(a.length>1){const e=[],i=[],s=[];if(a.forEach((t=>{const r=31&t[0];7===r?e.push(t):8===r?i.push(t):13===r&&s.push(t)})),e.length&&i.length){const a=A(e,i,s),o=(0,u.sY)(a.length);(0,c.lW)(o,a.length,a),(0,d.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function F(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[4];const{spss:i}=P(e);if(i.length){const{profile:e,level:r,width:n,height:a}=S(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function S(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const i=(0,f.BN)(t.subarray(e)),r=new h.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const n=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const a=r.readU(8);p.xb(r);let s=1,o=0,l=0;if((100==n||110==n||122==n||244==n||44==n||83==n||86==n||118==n||128==n||138==n||139==n||134==n||135==n)&&(s=p.xb(r),3===s&&r.readU1(),o=p.xb(r),l=p.xb(r),r.readU1(),r.readU1())){const t=new Array(8);for(let e=0;e<(3!=s?8:12);e++)t[e]=r.readU1()}p.xb(r);const c=p.xb(r);if(0===c)p.xb(r);else if(1===c){r.readU1(),p.$x(r),p.$x(r);const t=p.xb(r);for(let e=0;e<t;e++)p.$x(r)}p.xb(r),r.readU1();const d=p.xb(r),u=p.xb(r),U=r.readU1();let g=16*(d+1),m=(2-U)*(u+1)*16;U||r.readU1(),r.readU1();const w=r.readU1();if(w){let t=1,e=2-w;1===s?(t=2,e=2*(2-w)):2===w&&(t=2,e=2-w),g-=t*(p.xb(r)+p.xb(r)),m-=e*(p.xb(r)+p.xb(r))}return{profile:n,level:a,width:g,height:m,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:l}}},53e3:(t,e,i)=>{i.d(e,{Jk:()=>x,OD:()=>A,XC:()=>v,ci:()=>y,dT:()=>p,k9:()=>g,oT:()=>P});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),h=i(37246),l=i(14686),c=i(60264),d=i(71517),f=i(37837),u=i(23991);const p={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},U=[{level:10,maxLumaSamplesPerSecond:552960,maxLumaPictureSize:36864,maxBitRate:{main:128,main10:150}},{level:20,maxLumaSamplesPerSecond:3686400,maxLumaPictureSize:122880,maxBitRate:{main:1500,main10:1875}},{level:21,maxLumaSamplesPerSecond:7372800,maxLumaPictureSize:245760,maxBitRate:{main:3e3,main10:3750}},{level:30,maxLumaSamplesPerSecond:16588800,maxLumaPictureSize:552960,maxBitRate:{main:6e3,main10:7500}},{level:31,maxLumaSamplesPerSecond:33177600,maxLumaPictureSize:983040,maxBitRate:{main:1e4,main10:12500}},{level:40,maxLumaSamplesPerSecond:66846720,maxLumaPictureSize:2228224,maxBitRate:{main:12e3,main10:15e3}},{level:41,maxLumaSamplesPerSecond:133693440,maxLumaPictureSize:2228224,maxBitRate:{main:2e4,main10:25e3}},{level:50,maxLumaSamplesPerSecond:267386880,maxLumaPictureSize:8912896,maxBitRate:{main:25e3,main10:4e4}},{level:51,maxLumaSamplesPerSecond:534773760,maxLumaPictureSize:8912896,maxBitRate:{main:4e4,main10:6e4}},{level:52,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:60,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:61,maxLumaSamplesPerSecond:2139095040,maxLumaPictureSize:89128960,maxBitRate:{main:12e4,main10:24e4}},{level:62,maxLumaSamplesPerSecond:4278190080,maxLumaPictureSize:356515840,maxBitRate:{main:24e4,main10:48e4}}];function g(t,e,i,r,n){const a=1===t?"main":"main10",s=e*i*r;for(const t of U)if(s<=t.maxLumaSamplesPerSecond&&e*i<=t.maxLumaPictureSize&&n<=t.maxBitRate[a])return t.level}const m=3;function w(t){const e=new o.A(t,!0);e.skip(22);let i=[],r=[],n=[];const a=e.readUint8();for(let t=0;t<a;t++){const t=63&e.readUint8(),a=e.readUint16(),s=[];for(let t=0;t<a;t++){const t=e.readUint16();s.push(e.readBuffer(t))}32===t?i=s:33===t?r=s:34===t&&(n=s)}return{vpss:i,spss:r,ppss:n}}function b(t,e,i){const r=e[0];let n=23;t.length&&(n+=3,n=t.reduce(((t,e)=>t+2+e.length),n)),e.length&&(n+=3,n=e.reduce(((t,e)=>t+2+e.length),n)),i.length&&(n+=3,n=i.reduce(((t,e)=>t+2+e.length),n));const o=new Uint8Array(n),h=new s.A(o,!0),l=I(r);h.writeUint8(1),h.writeUint8(r[1]),h.writeUint8(r[2]),h.writeUint8(r[3]),h.writeUint8(r[4]),h.writeUint8(r[5]),h.writeUint8(r[6]),h.writeUint8(r[7]),h.writeUint8(r[8]),h.writeUint8(r[9]),h.writeUint8(r[10]),h.writeUint8(r[11]),h.writeUint8(l.level),h.writeUint8(1020),h.writeUint8(0),h.writeUint8(16320),h.writeUint8(16320|l.chromaFormatIdc),h.writeUint8(8160|l.bitDepthLumaMinus8),h.writeUint8(8160|l.bitDepthChromaMinus8),h.writeUint16(0),h.writeUint8(8|(1&r[0])<<2|m);let c=0;return t.length&&c++,e.length&&c++,i.length&&c++,h.writeUint8(c),t.length&&(h.writeUint8(160),h.writeUint16(t.length),a.__(t,(t=>{h.writeUint16(t.length),h.writeBuffer(t)}))),e.length&&(h.writeUint8(161),h.writeUint16(e.length),a.__(e,(t=>{h.writeUint16(t.length),h.writeBuffer(t)}))),i.length&&(h.writeUint8(162),h.writeUint16(i.length),a.__(i,(t=>{h.writeUint16(t.length),h.writeBuffer(t)}))),o}function P(t){let e,i=!1,r=(0,c.py)(t);if(r.length>2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?i.push(e):34===r&&n.push(e)})),t.length&&i.length&&n.length&&(e=b(t,i,n),r=r.filter((t=>{const e=t[0]>>>1&63;return 32!==e&&33!==e&&34!==e&&35!==e})))}const n=r.reduce(((t,e)=>t+m+1+e.length),0),o=(0,f.sY)(n),h=(0,l.s3)(o,n),d=new s.A(h);return a.__(r,(t=>{3===m?d.writeUint32(t.length):2===m?d.writeUint24(t.length):1===m?d.writeUint16(t.length):d.writeUint8(t.length),d.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;19!==e&&20!==e&&21!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function A(t,e){const i=e?3&e[21]:m;let r=[],n=[],h=[],c=!1;if(e){const t=w(e);r=t.vpss,n=t.spss,h=t.ppss,c=!0}const d=[],u=new o.A(t);for(;u.remainingSize()>0;){let t=0;t=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),d.push(u.readBuffer(t))}let p=r.reduce(((t,e)=>t+4+e.length),0);p=n.reduce(((t,e)=>t+4+e.length),p),p=h.reduce(((t,e)=>t+4+e.length),p),p=d.reduce(((t,e,i)=>t+(i?3:4)+e.length),p);const U=(0,f.sY)(p+7),g=(0,l.s3)(U,p+7),b=new s.A(g);return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(70),b.writeUint8(0),b.writeUint8(240),a.__(r,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),a.__(n,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),a.__(h,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),a.__(d,((t,e)=>{b.writeUint8(0),b.writeUint8(0),e||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t);const i=t[0]>>>1&63;19!==i&&20!==i&&21!==i||(c=!0)})),{bufferPointer:U,length:p+7,key:c}}function x(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,d.iI)(t);if((0,c.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:m;let s=[],h=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let t=0;t=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const e=n.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=e[0]>>>1&63;33===i?h.push(e):34===i?u.push(e):32===i&&s.push(e)}if(h.length||u.length||s.length){const e=b(s,h,u),i=(0,f.sY)(e.length);(0,l.lW)(i,e.length,e),(0,d.Ow)(t,1,i,e.length)}}function y(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,d.iI)(t);if(!(0,c.Bs)(i))return;let a=(0,c.py)(i);if(a.length>2){const e=[],i=[],s=[];if(a.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?i.push(t):34===r&&s.push(t)})),e.length&&i.length&&s.length){const a=b(e,i,s),o=(0,f.sY)(a.length);(0,l.lW)(o,a.length,a),(0,d.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function v(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[21];const{spss:i}=w(e);if(i.length){const{profile:e,level:r,width:n,height:a}=I(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function I(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,a=0,s=0,o=0,l=1,d=0,f=0,p=0,U=0;const g=(0,c.BN)(t.subarray(e)),m=new h.A(g.length);m.appendBuffer(g),m.readU1(),m.readU(6),m.readU(6),m.readU(3),m.readU(4);const w=m.readU(3);if(m.readU1(),w<=6){d=m.readU(2),f=m.readU1(),i=m.readU(5),p=m.readU(32),U=m.readU(48),r=m.readU(8);const t=new Array(6),e=new Array(6);for(let i=0;i<w;i++)t[i]=m.readU1(),e[i]=m.readU1();if(w>0)for(let t=w;t<8;t++)m.readU(2);for(let i=0;i<w;i++)t[i]&&(m.readU(2),m.readU(1),m.readU(5),m.readU(32),m.readU(1),m.readU(1),m.readU(1),m.readU(1),m.readU(44)),e[i]&&m.readU(8);u.xb(m),l=u.xb(m),3===l&&m.readU(1),n=u.xb(m),a=u.xb(m);let h=0,c=0,g=0,b=0;m.readU1()&&(h=u.xb(m),c=u.xb(m),g=u.xb(m),b=u.xb(m)),s=u.xb(m),o=u.xb(m);let P=2,A=2;0===l?P=A=0:2===l?(P=2,A=1):3===l&&(P=A=1),n-=P*(1<<s+1)*(h+c),a-=A*(1<<s+1)*(g+b)}return{profile:i,level:r,width:n,height:a,chromaFormatIdc:l,bitDepthLumaMinus8:s,bitDepthChromaMinus8:o,generalProfileSpace:d,generalTierFlag:f,generalProfileCompatibilityFlag:p,constraintFlags:U}}},65451:(t,e,i)=>{i.d(e,{Ij:()=>l,XC:()=>h,kt:()=>o});var r=i(31865),n=i(729),a=i(44328);const s=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(t){let e=0,i=0,r=0;if(t.length<1)return 0;switch(e=t[0],i=s[e>>3],3&e){case 0:r=1;break;case 1:case 2:r=2;break;case 3:if(t.length<2)return 0;r=63&t[1]}return r*i}function h(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=19){const i=new r.A(e,!1);i.skip(9),t.codecpar.chLayout.nbChannels=i.readUint8(),t.codecpar.initialPadding=i.readUint16(),t.codecpar.sampleRate=i.readUint32(),t.codecpar.seekPreroll=Number((0,a.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function l(t){const e=new Uint8Array(19),i=new n.A(e,!1);return i.writeString("OpusHead"),i.writeUint8(1),i.writeUint8(t.chLayout.nbChannels),i.writeUint16(t.initialPadding),i.writeUint32(t.sampleRate),e}},55611:(t,e,i)=>{i.d(e,{Jk:()=>A,OD:()=>P,Ui:()=>I,XC:()=>y,ci:()=>x,oT:()=>b});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),h=i(37246),l=i(14686),c=i(60264),d=i(71517),f=i(37837),u=i(23991),p=i(83314);const U=3;function g(t){const e=t.readU(9),i=t.readU(3),r=t.readU(2),n=t.readU(2),a=t.readU(3);t.readU(5),t.readU(2);const s=t.readU(6),o=t.readU(7),h=t.readU(1),l=t.readU(8),c=t.readU(1),d=t.readU(1),f=[],u=[];if(s){for(let e=0;e<s-1;e++)f[e]=t.readU(8);f[s-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let r=i-2;r>=0;--r)e|=t.readU(1)<<r;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let r=i-2;r>=0;--r)e&1<<r&&(u[r]=t.readU(8))}const p=t.readU(8),U=[];if(p)for(let e=0;e<p;e++)U.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:a,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:h,generalLevelIdc:l,ptlFrameOnlyConstraintFlag:c,ptlMultilayerEnabledFlag:d,generalConstraintInfo:f,sublayerLevelIdc:u,generalSubProfileIdc:U,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function m(t){const e=new o.A(t,!0);if(1&e.readUint8()){const i=new h.A;i.appendBuffer(t.subarray(1)),g(i),e.skip(i.getPos())}let i=[],r=[],n=[];const a=e.readUint8();for(let t=0;t<a;t++){const t=31&e.readUint8();let a=1;13!==t&&12!==t&&(a=e.readUint16());const s=[];for(let t=0;t<a;t++){const t=e.readUint16();s.push(e.readBuffer(t))}14===t?i=s:15===t?r=s:16===t&&(n=s)}return{vpss:i,spss:r,ppss:n}}function w(t,e,i){const r=e[0];let n;if(r){const t=v(r),e=new p.A;if(e.writeU(9,0),e.writeU(3,t.spsMaxSublayersMinus1+1),e.writeU(2,1),e.writeU(2,t.chromaFormatIdc),e.writeU(3,t.bitDepthMinus8),e.writeU(5,31),e.writeU(2,3),e.writeU(6,t.generalConstraintInfo.length),e.writeU(7,t.profile),e.writeU1(t.tierFlag),e.writeU(8,t.level),e.writeU1(t.ptlFrameOnlyConstraintFlag),e.writeU1(t.ptlMultilayerEnabledFlag),t.generalConstraintInfo.length){for(let i=0;i<t.generalConstraintInfo.length-1;i++)e.writeU(8,t.generalConstraintInfo[i]);e.writeU(6,t.generalConstraintInfo[t.generalConstraintInfo.length-1])}else e.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let i=0;for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)i=i<<1|t.ptlSublayerLevelPresentFlag[e];e.writeU(8,i)}for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)t.ptlSublayerLevelPresentFlag[i]&&e.writeU(8,t.sublayerLevelIdc[i]);e.writeU(8,t.generalSubProfileIdc.length);for(let i=0;i<t.generalSubProfileIdc.length;i++)e.writeU(32,t.sublayerLevelIdc[i]);e.writeU(16,t.width),e.writeU(16,t.height),e.writeU(16,0),e.padding(),n=e.getBuffer().subarray(0,e.getPointer())}let o=1+(n?n.length:0);t.length&&(o+=3,o=t.reduce(((t,e)=>t+2+e.length),o)),e.length&&(o+=3,o=e.reduce(((t,e)=>t+2+e.length),o)),i.length&&(o+=3,o=i.reduce(((t,e)=>t+2+e.length),o));const h=new Uint8Array(o),l=new s.A(h,!0);l.writeUint8(U<<1|(n?1:0)|248),n&&l.writeBuffer(n);let c=0;return t.length&&c++,e.length&&c++,i.length&&c++,l.writeUint8(c),t.length&&(l.writeUint8(142),l.writeUint16(t.length),a.__(t,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),e.length&&(l.writeUint8(143),l.writeUint16(e.length),a.__(e,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),i.length&&(l.writeUint8(144),l.writeUint16(i.length),a.__(i,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),h}function b(t){let e,i=!1,r=(0,c.py)(t);if(r.length>2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[0]>>>1&63;14===r?t.push(e):15===r?i.push(e):16===r&&n.push(e)})),t.length&&i.length&&n.length&&(e=w(t,i,n),r=r.filter((t=>{const e=t[0]>>>1&63;return 14!==e&&15!==e&&16!==e&&20!==e})))}const n=r.reduce(((t,e)=>t+U+1+e.length),0),o=(0,f.sY)(n),h=(0,l.s3)(o,n),d=new s.A(h);return a.__(r,(t=>{3===U?d.writeUint32(t.length):2===U?d.writeUint24(t.length):1===U?d.writeUint16(t.length):d.writeUint8(t.length),d.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;8!==e&&7!==e&&9!==e&&10!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function P(t,e){const i=e?e[0]>>>1&3:U;let r=[],n=[],h=[],c=!1;if(e){const t=m(e);r=t.vpss,n=t.spss,h=t.ppss,c=!0}const d=[],u=new o.A(t);for(;u.remainingSize()>0;){let t=0;t=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),d.push(u.readBuffer(t))}let p=r.reduce(((t,e)=>t+4+e.length),0);p=n.reduce(((t,e)=>t+4+e.length),p),p=h.reduce(((t,e)=>t+4+e.length),p),p=d.reduce(((t,e,i)=>t+(i?3:4)+e.length),p);const g=(0,f.sY)(p+7),w=(0,l.s3)(g,p+7),b=new s.A(w);return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(0),b.writeUint8(160),b.writeUint8(240),a.__(r,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),a.__(n,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),a.__(h,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),a.__(d,((t,e)=>{b.writeUint8(0),b.writeUint8(0),e||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t);const i=t[0]>>>1&63;8!==i&&7!==i&&9!==i&&10!==i||(c=!0)})),{bufferPointer:g,length:p+7,key:c}}function A(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,d.iI)(t);if((0,c.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:U;let s=[],h=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let t=0;t=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const e=n.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=e[0]>>>1&63;15===i?h.push(e):16===i?u.push(e):14===i&&s.push(e)}if(h.length||u.length||s.length){const e=w(s,h,u),i=(0,f.sY)(e.length);(0,l.lW)(i,e.length,e),(0,d.Ow)(t,1,i,e.length)}}function x(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,d.iI)(t);if(!(0,c.Bs)(i))return;let a=(0,c.py)(i);if(a.length>2){const e=[],i=[],s=[];if(a.forEach((t=>{const r=t[0]>>>1&63;14===r?e.push(t):15===r?i.push(t):16===r&&s.push(t)})),e.length&&i.length&&s.length){const a=w(e,i,s),o=(0,f.sY)(a.length);(0,l.lW)(o,a.length,a),(0,d.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function y(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=e[0]>>>1&3;const{spss:i}=m(e);if(i.length){const{profile:e,level:r,width:n,height:a}=v(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function v(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,a=0,s=0,o=1,l=0,d=0,f=0;const p=[],U=[],g=[],m=[],w=(0,c.BN)(t.subarray(e)),b=new h.A(w.length);b.appendBuffer(w),b.readU1(),b.readU1(),b.readU(6),b.readU(5),b.readU(3),b.readU(8);const P=b.readU(3);o=b.readU(2);const A=b.readU(2);if(b.readU(1)){if(i=b.readU(7),l=b.readU(1),r=b.readU(8),d=b.readU(1),f=b.readU(1),b.readU(1)){for(let t=0;t<8;t++)p[t]=b.readU(8);p[8]=b.readU(7);const t=b.readU(8);b.readU(t)}b.skipPadding();for(let t=P-1;t>=0;t--)U[t]=b.readU(1);b.skipPadding();for(let t=P-1;t>=0;t--)U[t]&&(g[t]=b.readU(8));const t=b.readU(8);if(t)for(let e=0;e<t;e++)m[e]=b.readU(32)}b.readU1(),b.readU1()&&b.readU1();const x=n=u.xb(b),y=a=u.xb(b);if(b.readU1()&&(u.xb(b),u.xb(b),u.xb(b),u.xb(b)),b.readU1()){const t=u.xb(b),e=A+5,i=1<<e,r=x/(1<<e),n=y/(1<<e),a=Math.ceil(Math.log2(r)),s=Math.ceil(Math.log2(n));let o=0,h=0,l=0;t>0&&(l=b.readU1(),h=b.readU1());for(let e=0;t>0&&e<=t;e++)h&&0!=e||(e>0&&x>i&&b.readU(a),e>0&&y>i&&b.readU(s),e<t&&x>i&&b.readU(a),e<t&&y>i&&b.readU(s)),l||b.readU(2);if(o=u.xb(b)+1,b.readU(1)&&b.readU(1))for(let e=0;e<=t;e++)b.readU(o)}return s=u.xb(b),{profile:i,level:r,width:n,height:a,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:l,generalConstraintInfo:p,generalSubProfileIdc:m,ptlFrameOnlyConstraintFlag:d,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:P,ptlSublayerLevelPresentFlag:U,sublayerLevelIdc:g}}function I(t){const e=new h.A;return e.appendBuffer(t),1&e.readU(8)?g(e):{}}},51597:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(){(0,r.A)(this,"type",-1)}destroy(t){}}},15597:(t,e,i)=>{i.r(e),i.d(e,{default:()=>S});var r=i(134),n=i(61499),a=i(63939),s=i(9599),o=i(29170),h=i(19770),l=i(6403),c=i(51597),d=i(30469),f=i(72739),u=i(95335),p=i(76538),U=i(9848),g=i(60480),m=i(77662),w=i(52251),b=i(77231),P=i(14686),A=i(44328),x=i(71517),y=i(37837),v=i(4624),I="src/avformat/formats/OMpegtsFormat.ts";const F={pesMaxSize:2930,delay:1.4,latm:!1,patPeriod:.1};class S extends c.A{constructor(t={}){super(),(0,r.A)(this,"type",2),(0,r.A)(this,"context",void 0),(0,r.A)(this,"sdtPacket",void 0),(0,r.A)(this,"patPacket",void 0),(0,r.A)(this,"pmtPacket",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"firstDtsCheck",void 0),(0,r.A)(this,"firstVideoCheck",void 0),(0,r.A)(this,"lastPatDst",void 0),(0,r.A)(this,"patPeriod",void 0),this.context=(0,h.A)(),this.options=u.X$({},F,t),this.options.pesMaxSize=this.options.pesMaxSize?(this.options.pesMaxSize+14+183)/184*184-14:0,this.firstDtsCheck=!1,this.firstVideoCheck=!1,this.patPeriod=BigInt(Math.floor(this.options.patPeriod*b.SF))}init(t){return t.ioWriter.setEndian(!0),0}destroy(t){super.destroy(t),f.__(t.streams,(t=>{const e=t.privData;e.filter&&(e.filter.destroy(),e.filter=null)}))}writeHeader(t){return this.context.pat=new l.Cd,this.context.pat.program2PmtPid.set(1,4096),this.context.pmt=new l.I4,this.context.pmt.programNumber=1,f.__(t.streams,(t=>{t.timeBase.den=9e4,t.timeBase.num=1;const e=this.context.startPid++;this.context.pmt.pcrPid<=0&&(this.context.pmt.pcrPid=e);let i=d.Zp(t);const r=(0,p.A)();t.privData=r;const a=new l.am;a.pid=e,a.adaptationFieldControl=1,r.tsPacket=a,r.pid=e;let s=null;switch(i){case 15:this.options.latm?(r.latm=!0,i=17,s=new g.A):s=new U.A;break;case 27:case 36:s=new w.A;break;case 6:86076===t.codecpar.codecId&&(s=new m.A)}s&&s.init(t.codecpar[n.o9],t.timeBase[n.o9]),r.filter=s,this.context.pmt.pid2StreamType.set(e,i);const o=new l.xf;o.pid=e,o.streamType=i,o.streamId=d.kw(t),r.pes=o})),this.patPacket=new l.yU,this.pmtPacket=new l.yU,this.sdtPacket=new l.yU,this.sdtPacket.pid=17,this.sdtPacket.adaptationFieldControl=1,this.patPacket.pid=0,this.patPacket.adaptationFieldControl=1,this.pmtPacket.pid=4096,this.pmtPacket.adaptationFieldControl=1,this.sdtPacket.payload=d.Gj(),this.patPacket.payload=d.sG(this.context.pat),this.pmtPacket.payload=d.in(this.context.pmt,t.streams),d.Zn(t.ioWriter,this.sdtPacket,this.context),d.Zn(t.ioWriter,this.patPacket,this.context),d.Zn(t.ioWriter,this.pmtPacket,this.context),0}writeAVPacket(t,e){if(!a.f[15](e+28))return void v.R8(`packet's size is 0: ${a.f[15](e+32)}, ignore it`,I,211);const i=t.getStreamByIndex(a.f[15](e+32));if(!i)return void v.R8(`can not found the stream width the packet's streamIndex: ${a.f[15](e+32)}, ignore it`,I,218);this.firstDtsCheck||((0,A.k)(a.f[17](e+16),(0,o.A)(e+72,s.P),i.timeBase)<BigInt(Math.floor(9e4*this.options.delay))&&(this.context.delay=BigInt(Math.floor(9e4*this.options.delay))-(0,A.k)(a.f[17](e+16),(0,o.A)(e+72,s.P),i.timeBase)),this.firstDtsCheck=!0,this.lastPatDst=(0,A.k)(a.f[17](e+16),(0,o.A)(e+72,s.P),b.KR)),this.patPeriod>BigInt(0)&&(0,A.k)(a.f[17](e+16),(0,o.A)(e+72,s.P),b.KR)-this.lastPatDst>this.patPeriod&&(d.Zn(t.ioWriter,this.sdtPacket,this.context),d.Zn(t.ioWriter,this.patPacket,this.context),d.Zn(t.ioWriter,this.pmtPacket,this.context),this.lastPatDst=(0,A.k)(a.f[17](e+16),(0,o.A)(e+72,s.P),b.KR));const r=i.privData;let n=(0,x.iI)(e);if(r.filter){if(!this.firstVideoCheck&&!(0,x.fQ)(e,1)&&i.codecpar.extradata&&(27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId||12===i.codecpar.codecId)){this.firstVideoCheck=!0;const t=(0,y.sY)(i.codecpar.extradataSize);(0,P.Mr)(t,i.codecpar.extradata,i.codecpar.extradataSize),(0,x.Ow)(e,1,t,i.codecpar.extradataSize)}r.filter.sendAVPacket(e),r.filter.receiveAVPacket(e),n=(0,x.iI)(e)}if(!n.length)return 0;n=n.slice();let h=!1;return(r.pesSlices.total+n.length>this.options.pesMaxSize||0===i.codecpar.codecType)&&(0===r.pesSlices.total&&(r.pesSlices.total=n.length,r.pesSlices.buffers.push(n),a.f[17](e+16)!==b.Dh&&(r.pes.dts=(0,A.k)(a.f[17](e+16),(0,o.A)(e+72,s.P),i.timeBase)+this.context.delay),a.f[17](e+8)!==b.Dh&&(r.pes.pts=(0,A.k)(a.f[17](e+8),(0,o.A)(e+72,s.P),i.timeBase)+this.context.delay),h=!0),1&a.f[15](e+36)&&(r.pes.randomAccessIndicator=1),d.CE(t.ioWriter,r.pes,r.pesSlices,i,this.context),r.pesSlices.total=0,r.pesSlices.buffers=[]),h||(0===r.pesSlices.total&&(a.f[17](e+16)!==b.Dh&&(r.pes.dts=(0,A.k)(a.f[17](e+16),(0,o.A)(e+72,s.P),i.timeBase)+this.context.delay),a.f[17](e+8)!==b.Dh&&(r.pes.pts=(0,A.k)(a.f[17](e+8),(0,o.A)(e+72,s.P),i.timeBase)+this.context.delay),1&a.f[15](e+36)&&(r.pes.randomAccessIndicator=1)),r.pesSlices.total+=n.length,r.pesSlices.buffers.push(n)),0}writeTrailer(t){return f.__(t.streams,(e=>{const i=e.privData;i.pesSlices.total&&d.CE(t.ioWriter,i.pes,i.pesSlices,e,this.context),i.pesSlices.total=0,i.pesSlices.buffers=[]})),t.ioWriter.flush(),0}flush(t){return t.ioWriter.flush(),0}}},50762:(t,e,i)=>{function r(t){let e=4294967295;for(let i=0;i<t.length;i++){e^=t[i]<<24;for(let t=0;t<8;t++)2147483648&e?e=e<<1^79764919:e<<=1}return e>>>0}i.d(e,{E:()=>r})},19770:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(80662),n=i.n(r),a=i(77231),s=i(6403);function o(){return{currentProgram:a.N_,currentPmtPid:a.N_,tsPacketSize:a.N_,hasPAT:!1,hasPMT:!1,tsSliceQueueMap:new(n()),pat:new s.Cd,pmt:new s.I4,program2Pmt:new(n()),ioEnd:!1,startPid:256,delay:BigInt(0)}}},76538:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(77231);function n(){return{pid:r.N_,filter:null,tsPacket:null,pes:null,continuityCounter:0,pesSlices:{total:0,buffers:[]},latm:!1}}},27274:(t,e,i)=>{i.d(e,{$x:()=>d,GV:()=>s,OS:()=>l,VG:()=>n,ZT:()=>a,eR:()=>r,hY:()=>h,pm:()=>o,qJ:()=>c});const r=204,n=192,a=188,s=204,o=8192,h=5,l=5,c=10,d={15:[1,86018],17:[1,86018],3:[1,86017],4:[1,86017],27:[0,27],36:[0,173],51:[0,196],129:[1,86019],135:[1,86056]}},30469:(t,e,i)=>{i.d(e,{CE:()=>b,Gj:()=>g,Zn:()=>P,Zp:()=>f,in:()=>U,kw:()=>u,sG:()=>p});var r=i(63939),n=i(27274),a=i(4624),s=i(65977),o=i(92647),h=i(77231),l=i(50762),c="src/avformat/formats/mpegts/ompegts.ts";function d(t){if(2!==t.adaptationFieldControl&&3!==t.adaptationFieldControl)return 0;if(2===t.adaptationFieldControl)return n.ZT-4;let e=2;return t.adaptationFieldInfo.pcrFlag&&(e+=6),t.adaptationFieldInfo.opcrFlag&&(e+=6),t.adaptationFieldInfo.splicingPointFlag&&(e+=1),t.adaptationFieldInfo.transportPrivateDataFlag&&(e+=t.adaptationFieldInfo.transportPrivateData?t.adaptationFieldInfo.transportPrivateData.length:0),t.adaptationFieldInfo.adaptationFieldExtensionFlag&&(e+=t.adaptationFieldInfo.extension?t.adaptationFieldInfo.extension.length:0),e>256&&a.R8("adaptationField size is too large",c,68),e}function f(t){const e=t.privData||{};switch(t.codecpar.codecId){case 1:case 2:return 2;case 12:return 16;case 27:return 27;case 87:return 66;case 173:return 36;case 196:return 51;case 116:return 209;case 70:return 234;case 86016:case 86017:return t.codecpar.sampleRate<32e3?4:3;case 86018:return e.latm?17:15;case 86065:return 17;case 86019:return 129;case 86076:case 225:case 94209:case 98311:default:return 6;case 86060:return 131;case 86056:return 135;case 86020:return 130}}function u(t){return 0===t.codecpar.codecType?116===t.codecpar.codecId?253:224:1!==t.codecpar.codecType||86016!==t.codecpar.codecId&&86017!==t.codecpar.codecId&&86018!==t.codecpar.codecId?1===t.codecpar.codecType&&86019===t.codecpar.codecId?253:2===t.codecpar.codecType?252:189:192}function p(t){const e=new Uint8Array(1024);e[1]=0,e[2]=176,e[5]=1,e[6]=193;let i=9;t.networkPid>-1&&(i+=2,e[i++]=224|t.networkPid>>8&31,e[i++]=255&t.networkPid),t.program2PmtPid.forEach(((t,r)=>{e[i++]=r>>8&255,e[i++]=255&r,e[i++]=224|t>>8&31,e[i++]=255&t}));const r=i;i+=4;for(let t=i;t<n.ZT-4;t++)e[t]=255;const a=i-1-3;e[2]|=a>>8&15,e[3]=255&a;const s=(0,l.E)(e.subarray(1,r));return e[r]=s>>24&255,e[r+1]=s>>16&255,e[r+2]=s>>8&255,e[r+3]=255&s,e.slice(0,n.ZT-4)}function U(t,e){const i=new Uint8Array(1024);i[1]=2,i[2]=176,i[4]=t.programNumber>>8&15,i[5]=255&t.programNumber,i[6]=193;let a=9;i[a++]=224|t.pcrPid>>8&31,i[a++]=255&t.pcrPid;const o=a;function h(t){i[a++]=n.OS,i[a++]=4,i[a++]=t>>24,i[a++]=t>>16,i[a++]=t>>8,i[a++]=t}a+=2;let c=61440|a-o-2;i[o]=c>>8,i[o+1]=c;for(let t=0;t<e.length;t++){const o=f(e[t]);i[a++]=o;const l=e[t].privData;i[a++]=224|l.pid>>8&31,i[a++]=255&l.pid;const c=a;a+=2;const d=e[t].codecpar.codecId;switch(e[t].codecpar.codecType){case 1:86019===d&&h((0,s.A)("AC-3")),86056===d&&h((0,s.A)("EAC3")),65562===d&&h((0,s.A)("BSSD")),86076===d&&(h((0,s.A)("Opus")),i[a++]=127,i[a++]=2,i[a++]=128,i[a++]=e[t].codecpar.chLayout.nbChannels),i[a++]=n.qJ,i[a++]=4,i[a++]=117,i[a++]=110,i[a++]=100,i[a++]=0;break;case 0:if(225===d&&(h((0,s.A)("AV01")),e[t].codecpar.extradata)){i[a++]=128,i[a++]=e[t].codecpar.extradataSize;for(let n=0;n<e[t].codecpar.extradataSize;n++)i[a++]=r.f[2](e[t].codecpar.extradata+n)}}let u=61440|a-c-2;i[c]=u>>8,i[c+1]=u}const d=a;a+=4;for(let t=a;t<n.ZT-4;t++)i[t]=255;c=a-1-3,i[2]|=c>>8&15,i[3]=255&c;const u=(0,l.E)(i.subarray(1,d));return i[d]=u>>24&255,i[d+1]=u>>16&255,i[d+2]=u>>8&255,i[d+3]=255&u,i.slice(0,n.ZT-4)}function g(){const t=new Uint8Array(1024);t[1]=66,t[2]=240,t[5]=1,t[6]=193;let e=9;t[e++]=255,t[e++]=1,t[e++]=255,t[e++]=0,t[e++]=1,t[e++]=252;const i=e;e+=2,t[e++]=72;const r=e++;t[e++]=1;t[e++]=9;for(let i=0;i<9;i++)t[e]="format-js".charCodeAt(i),e++;t[e++]=9;for(let i=0;i<9;i++)t[e]="Service01".charCodeAt(i),e++;t[r]=e-r-1;let a=32768|e-i-2;t[i]=a>>8&255,t[i+1]=255&a;const s=e;e+=4;for(let i=e;i<n.ZT-4;i++)t[i]=255;const o=e-1-3;t[2]|=o>>8&15,t[3]=255&o;const h=(0,l.E)(t.subarray(1,s));return t[s]=h>>24&255,t[s+1]=h>>16&255,t[s+2]=h>>8&255,t[s+3]=255&h,t.slice(0,n.ZT-4)}function m(t,e,i){var r;i.tsPacketSize===n.VG&&t.skip(4),e.payload&&0!==e.payload.length||(e.adaptationFieldControl=2),1===e.adaptationFieldControl&&e.payload.length+4<n.ZT&&(e.adaptationFieldControl=3);const s=t.getPos();t.writeUint8(71);let o=0;e.payloadUnitStartIndicator&&(o|=64),o|=e.transportPriority<<5,o|=e.pid>>8,t.writeUint8(o),t.writeUint8(255&e.pid),o=(3&e.transportScramblingControl)<<6,o|=(3&e.adaptationFieldControl)<<4,o|=15&e.continuityCounter,t.writeUint8(o);let h=d(e),l=n.ZT-4-h;if(null!==(r=e.payload)&&void 0!==r&&r.length&&(l-=e.payload.length),2===e.adaptationFieldControl||3===e.adaptationFieldControl){const i=t.getPos();if(t.writeUint8(h-1+l),o=(1&e.adaptationFieldInfo.discontinuityIndicator)<<7,o|=(1&e.adaptationFieldInfo.randomAccessIndicator)<<6,o|=(1&e.adaptationFieldInfo.elementaryStreamPriorityIndicator)<<5,o|=(1&e.adaptationFieldInfo.pcrFlag)<<4,o|=(1&e.adaptationFieldInfo.opcrFlag)<<3,o|=(1&e.adaptationFieldInfo.splicingPointFlag)<<2,o|=(1&e.adaptationFieldInfo.transportPrivateDataFlag)<<1,o|=1&e.adaptationFieldInfo.adaptationFieldExtensionFlag,t.writeUint8(o),e.adaptationFieldInfo.pcrFlag){const i=Number(e.adaptationFieldInfo.pcr%BigInt(300)),r=Number((e.adaptationFieldInfo.pcr-BigInt(Math.floor(i)))/BigInt(300));t.writeUint8(r>>25&255),t.writeUint8(r>>17&255),t.writeUint8(r>>9&255),t.writeUint8(r>>1&255),t.writeUint8(r<<7|i>>8|126),t.writeUint8(i)}if(e.adaptationFieldInfo.opcrFlag){const i=Number(e.adaptationFieldInfo.pcr%BigInt(300)),r=Number((e.adaptationFieldInfo.pcr-BigInt(Math.floor(i)))/BigInt(300));t.writeUint8(r>>25&255),t.writeUint8(r>>17&255),t.writeUint8(r>>9&255),t.writeUint8(r>>1&255),t.writeUint8(r<<7|i>>8|126),t.writeUint8(i)}e.adaptationFieldInfo.splicingPointFlag&&t.writeUint8(e.adaptationFieldInfo.spliceCountDown),e.adaptationFieldInfo.transportPrivateDataFlag&&(e.adaptationFieldInfo.transportPrivateData&&e.adaptationFieldInfo.transportPrivateData.length?(t.writeUint8(e.adaptationFieldInfo.transportPrivateData.length),t.writeBuffer(e.adaptationFieldInfo.transportPrivateData)):t.writeUint8(0)),e.adaptationFieldInfo.adaptationFieldExtensionFlag&&(e.adaptationFieldInfo.extension&&e.adaptationFieldInfo.extension.length?(t.writeUint8(e.adaptationFieldInfo.extension.length),t.writeBuffer(e.adaptationFieldInfo.extension)):t.writeUint8(0));const r=Number(t.getPos()-i);for(r<h&&t.skip(h-r);l>0;)t.writeUint8(255),l--}var f;1!==e.adaptationFieldControl&&3!==e.adaptationFieldControl||null!==(f=e.payload)&&void 0!==f&&f.length&&t.writeBuffer(e.payload),Number(t.getPos()-s)!==n.ZT&&a.z3(`write error data size to ts packet, need ${n.ZT}, wrote: ${Number(t.getPos()-s)}`,c,641),i.tsPacketSize===n.eR&&t.skip(16)}function w(t,e,i,r){let n=i<<4|(7&Number(r>>BigInt(30)))<<1|1;t[e++]=n,n=(32767&Number(r>>BigInt(15)))<<1|1,t[e++]=n>>8&255,t[e++]=255&n,n=Number(r&BigInt(32767))<<1|1,t[e++]=n>>8&255,t[e++]=255&n}function b(t,e,i,r,a){const s=e.streamId,l=new Uint8Array(function(t){let e=6;const i=t.streamId;return 188!==i&&190!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i&&(e+=3,t.pts!==h.Dh&&(e+=5),t.dts!==h.Dh&&t.pts!==h.Dh&&t.dts!==t.pts&&(e+=5)),e}(e));l[2]=1,l[3]=s;let c=i.total;if(188!==s&&190!==s&&191!==s&&240!==s&&241!==s&&255!==s&&242!==s&&248!==s){let t=0,i=0;e.pts!==h.Dh&&(i+=5,t|=128),e.dts!==h.Dh&&e.pts!==h.Dh&&e.dts!==e.pts&&(i+=5,t|=64);let n=128;3!==r.codecpar.codecType&&2!==r.codecpar.codecType||(n|=4),l[6]=n,l[7]=t,l[8]=i,c+=i+3,e.pts!==h.Dh&&w(l,9,t>>6,e.pts),e.dts!==h.Dh&&e.pts!==h.Dh&&e.dts!==e.pts&&w(l,14,1,e.dts)}c<=h.zg&&0!==r.codecpar.codecType&&(l[4]=c>>8&255,l[5]=255&c),function(t,e,i,r,a){const s=r.privData,o=s.tsPacket;e.pid===a.pmt.pcrPid&&(o.adaptationFieldControl=3,o.adaptationFieldInfo.pcrFlag=1,o.adaptationFieldInfo.pcr=e.dts*BigInt(300)),o.adaptationFieldInfo.randomAccessIndicator=e.randomAccessIndicator,e.randomAccessIndicator&&(o.adaptationFieldControl=3);let h=d(o),l=s.continuityCounter;if(4+h+i.length<=n.ZT)return o.payloadUnitStartIndicator=1,o.payload=i,o.continuityCounter=l++%16,m(t,o,a),void(s.continuityCounter=l%16);let c=n.ZT-(4+h),f=0;for(;f<i.length;){let e=Math.min(f+c,i.length);o.payloadUnitStartIndicator=0===f?1:0,1===o.adaptationFieldControl&&e-f+4==n.ZT-1&&e--,o.payload=i.subarray(f,e),o.continuityCounter=l++%16,m(t,o,a),0===f&&(o.adaptationFieldInfo.randomAccessIndicator=0,o.adaptationFieldControl=1,o.adaptationFieldInfo.pcrFlag=0,h=d(o),c=n.ZT-(4+h)),f=e}s.continuityCounter=l%16}(t,e,(0,o.A)(Uint8Array,[l,...i.buffers]),r,a)}function P(t,e,i){const r=d(e);let a=e.continuityCounter;if(4+r+e.payload.length<=n.ZT)return e.payloadUnitStartIndicator=1,e.continuityCounter=a++%16,m(t,e,i),void(e.continuityCounter=a%16);const s=n.ZT-(4+r);let o=0;const h=e.payload;for(;o<h.length;){let l=Math.min(o+s,h.length);e.payloadUnitStartIndicator=0===o?1:0;const c=l-o;c+4===n.ZT?e.adaptationFieldControl=1:0===r&&c+4+1===n.ZT&&l--,e.payload=h.subarray(o,l),e.continuityCounter=a++%16,m(t,e,i),o=l}e.continuityCounter=a%16}},6403:(t,e,i)=>{i.d(e,{Cd:()=>c,I4:()=>u,am:()=>h,kJ:()=>f,pi:()=>l,xf:()=>p,yU:()=>d});var r=i(134),n=i(80662),a=i.n(n),s=i(77231);class o{constructor(){(0,r.A)(this,"discontinuityIndicator",0),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"elementaryStreamPriorityIndicator",0),(0,r.A)(this,"pcrFlag",0),(0,r.A)(this,"opcrFlag",0),(0,r.A)(this,"splicingPointFlag",0),(0,r.A)(this,"transportPrivateDataFlag",0),(0,r.A)(this,"adaptationFieldExtensionFlag",0),(0,r.A)(this,"pcr",BigInt(0)),(0,r.A)(this,"opcr",BigInt(0)),(0,r.A)(this,"spliceCountDown",0),(0,r.A)(this,"transportPrivateData",null),(0,r.A)(this,"extension",null)}}class h{constructor(){(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payloadUnitStartIndicator",0),(0,r.A)(this,"transportPriority",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"adaptationFieldControl",0),(0,r.A)(this,"continuityCounter",0),(0,r.A)(this,"transportScramblingControl",0),(0,r.A)(this,"adaptationFieldInfo",new o),(0,r.A)(this,"payload",null)}}class l{constructor(){(0,r.A)(this,"slices",[]),(0,r.A)(this,"totalLength",0),(0,r.A)(this,"expectedLength",s.N_),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"pos",s.Dh)}}class c{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"networkPid",s.N_),(0,r.A)(this,"program2PmtPid",new(a()))}}class d extends h{}class f{constructor(){(0,r.A)(this,"tag",void 0),(0,r.A)(this,"buffer",void 0)}}class u{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"programNumber",0),(0,r.A)(this,"pcrPid",0),(0,r.A)(this,"pid2StreamType",new(a())),(0,r.A)(this,"pid2ESDescriptor",new(a()))}}class p{constructor(){(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"streamId",s.N_),(0,r.A)(this,"dts",s.Dh),(0,r.A)(this,"pts",s.Dh),(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payload",null),(0,r.A)(this,"data",null),(0,r.A)(this,"randomAccessIndicator",0)}}},65977:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(4624),n="src/avformat/function/mktag.ts";function a(t){4!==t.length&&r.R8(`tag length is not 4, tag: ${t}`,n,30);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},23991:(t,e,i)=>{function r(t){let e=0,i=0;for(;i<32&&0===t.readU1();)i++;return e=t.readU(i),e+=(1<<i)-1,e}function n(t){let e=r(t);return e=1&e?(e+1)/2:-e/2,e}i.d(e,{$x:()=>n,xb:()=>r})},60264:(t,e,i)=>{function r(t){return t.length>4&&0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])}function n(t,e){let i=0;for(let r=e;r<t.length;r++)switch(t[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function a(t){const e=[];let i=n(t,0),r={offset:-1,startCode:0};for(;r=n(t,i.offset+i.startCode),r.offset>-1;)e.push(t.subarray(i.offset+i.startCode,r.offset,!0)),i=r;return e.push(t.subarray(i.offset+i.startCode,void 0,!0)),e}function s(t,e=0,i){i||(i=t.length);const r=new Uint8Array(t.length);let n=0,a=0;for(let s=0;s<t.length;s++){if(s>=e&&s<i)if(0===t[s])n++;else if(3===t[s]&&2===n&&s+1<t.length&&t[s+1]<=3){if(s++,s===t.length)break;n=0===t[s]?1:0}else n=0;r[a++]=t[s]}return r.slice(0,a)}i.d(e,{BN:()=>s,Bs:()=>r,py:()=>a})},37246:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(134),n=i(4624);class a{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=t,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let t=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let e=this.pointer,i=this.bitsLeft;return 0===i&&(e++,i=8),t=this.buffer[e]>>i-1&1,t}readU1(){let t=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,t=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),t}readU(t){let e=0;for(let i=0;i<t;i++)e|=this.readU1()<<t-i-1;return e}remainingLength(){return this.endPointer-this.pointer}getPos(){return this.pointer}skip(t){const e=(t-t%8)/8;this.pointer+=e;const i=t%8;this.bitsLeft<=i?(this.pointer++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const t=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(t<0)throw this.error=t,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+t,this.pointer=0}else{const t=this.onFlush(this.buffer);if(this.endPointer=t,this.pointer=0,this.bitsLeft=8,t<0)throw this.error=t,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const e=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,e),this.endPointer),this.endPointer+=e,n.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",190)}}clear(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}},83314:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=t,this.error=0,this.buffer=new Uint8Array(this.size)}writeU1(t){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&t?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}writeU(t,e){for(let i=0;i<t;i++)this.writeU1(e>>t-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const t=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}clear(){this.pointer=0,this.bitPointer=0,this.error=0}getBuffer(){return this.buffer}getPointer(){return this.pointer}}},729:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(134),n=i(4624),a=i(50011);class s{constructor(t,e=!0){(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}writeUint8(t){this.data.setUint8(this.pos+++this.byteStart,t)}writeUint16(t){this.data.setUint16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeUint24(t){const e=3840&t,i=240&t,r=15&t;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(e)):(this.writeUint8(e),this.writeUint8(i),this.writeUint8(r))}writeUint32(t){this.data.setUint32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeUint64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(e)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(e)))}writeInt8(t){this.data.setInt8(this.pos+++this.byteStart,t)}writeInt16(t){this.data.setInt16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeInt32(t){this.data.setInt32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeInt64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(e)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(e)))}writeFloat(t){this.data.setFloat32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeDouble(t){this.data.setFloat64(this.pos+this.byteStart,t,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(t){t>this.size&&(t=this.size),this.pos=Math.max(0,t)}skip(t){this.seek(this.pos+t)}back(t){this.seek(this.pos-t)}remainingSize(){return this.size-this.pos}writeBuffer(t){let e=t.length;this.remainingSize()<e&&(e=this.remainingSize(),n.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${t.length}, but set ${e}`,"src/common/io/BufferWriter.ts",211)),this.buffer.set(t,this.pos),this.pos+=t.length}writeString(t){const e=a.l(t);return this.writeBuffer(e),e.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(t,e=!0){this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}}}}]);