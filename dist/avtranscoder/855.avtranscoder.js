"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[855],{64436:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(134),n=i(63939),a=i(37837),s=i(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,a.Gy)(168),(0,s.Yi)(this.inCodecpar,e),this.inTimeBase={den:n.f[15](t+4),num:n.f[15](t)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},51113:(e,t,i)=>{i.d(t,{A:()=>U});var r=i(134),n=i(63939),a=i(50932),s=i(64436),o=i(14686),c=i(4624),h=i(9705),l=i(77231),d=i(44328),f=i(37837),u=i(71517),p=i(87771),m=i(92647),g=i(67672);class U extends s.A{constructor(...e){super(...e),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],0}sendAVPacket(e){let t=0,i=this.lastDts||n.f[17](e+16)||n.f[17](e+8),r=(0,o.s3)(n.f[20](e+24),n.f[15](e+28)).slice(),a=!1,s=!!this.cache;for(s&&(r=(0,m.A)(Uint8Array,[this.cache,r]),this.cache=null);t<r.length;){const o=p.R(r.subarray(t));if(g.ai(o))return c.z3("parse ac3 header failed","src/avformat/bsf/ac3/Ac32RawFilter.ts",78),h.LR;const f={dts:i,buffer:null,duration:l.N_};let u=o.frameSize;if(f.buffer=r.subarray(t,t+u),t+u>r.length){this.cache=r.subarray(t),this.lastDts=i;break}const m=(0,d.k)(BigInt(1536/o.sampleRate*l.SF),l.KR,this.inTimeBase);f.duration=Number(m),this.caches.push(f),t+=u,i+=m,!a&&s&&(a=!0,i=n.f[17](e+16)||n.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,u.Up)(e);const t=this.caches.shift(),i=(0,f.sY)(t.buffer.length);return(0,o.lW)(i,t.buffer.length,t.buffer),(0,u.NX)(e,i,t.buffer.length),a.M[17](e+16,t.dts),a.M[17](e+8,t.dts),a.M[17](e+48,BigInt(Math.floor(t.duration))),a.M[15](e+36,1|n.f[15](e+36)),0}return h.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),0}}},7309:(e,t,i)=>{i.d(t,{A:()=>U});var r=i(134),n=i(63939),a=i(50932),s=i(64436),o=i(14686),c=i(4624),h=i(9705),l=i(77231),d=i(44328),f=i(37837),u=i(71517),p=i(29347),m=i(92647),g=i(67672);class U extends s.A{constructor(...e){super(...e),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],0}sendAVPacket(e){let t=0,i=this.lastDts||n.f[17](e+16)||n.f[17](e+8),r=(0,o.s3)(n.f[20](e+24),n.f[15](e+28)).slice(),a=!1,s=!!this.cache;for(s&&(r=(0,m.A)(Uint8Array,[this.cache,r]),this.cache=null);t<r.length;){const o=p.R(r.subarray(t));if(g.ai(o))return c.z3("parse dts header failed","src/avformat/bsf/dts/Dts2RawFilter.ts",78),h.LR;const f={dts:i,buffer:null,duration:l.N_};let u=o.frameSize;if(f.buffer=r.subarray(t,t+u),t+u>r.length){this.cache=r.subarray(t),this.lastDts=i;break}const m=(0,d.k)(BigInt(1536/o.sampleRate*l.SF),l.KR,this.inTimeBase);f.duration=Number(m),this.caches.push(f),t+=u,i+=m,!a&&s&&(a=!0,i=n.f[17](e+16)||n.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,u.Up)(e);const t=this.caches.shift(),i=(0,f.sY)(t.buffer.length);return(0,o.lW)(i,t.buffer.length,t.buffer),(0,u.NX)(e,i,t.buffer.length),a.M[17](e+16,t.dts),a.M[17](e+8,t.dts),a.M[17](e+48,BigInt(Math.floor(t.duration))),a.M[15](e+36,1|n.f[15](e+36)),0}return h.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),0}}},56397:(e,t,i)=>{i.d(t,{A:()=>U});var r=i(134),n=i(63939),a=i(50932),s=i(64436),o=i(14686),c=i(4624),h=i(9705),l=i(77231),d=i(44328),f=i(37837),u=i(71517),p=i(75294),m=i(89088),g=i(92647);class U extends s.A{constructor(...e){super(...e),(0,r.A)(this,"frameHeader",void 0),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.frameHeader=new p.Vz,0}sendAVPacket(e){let t=0,i=this.lastDts||n.f[17](e+16)||n.f[17](e+8),r=(0,o.s3)(n.f[20](e+24),n.f[15](e+28)).slice(),a=!1,s=!!this.cache;for(s&&(r=(0,g.A)(Uint8Array,[this.cache,r]),this.cache=null);t<r.length;){const o=r[t]<<4|r[t+1]>>4&14;if(4094!==o)return c.z3(`found syncWord not 0xFFE, got: 0x${o.toString(16)}`,"src/avformat/bsf/mp3/Mp32RawFilter.ts",83),h.LR;const f=r[1]>>>3&3,u=(12&r[2])>>>2,g={dts:i,buffer:null,extradata:null,duration:l.N_},U=m.Y2(f,u);p.qg(this.frameHeader,r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3]);let b=p.CM(this.frameHeader,U);if(g.buffer=r.subarray(t,t+b),t+b>r.length){this.cache=r.subarray(t),this.lastDts=i;break}const w=(0,d.k)(BigInt(Math.floor(b/U*l.SF)),l.KR,this.inTimeBase);g.duration=Number(w),this.caches.push(g),t+=b,i+=w,!a&&s&&(a=!0,i=n.f[17](e+16)||n.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,u.Up)(e);const t=this.caches.shift(),i=(0,f.sY)(t.buffer.length);return(0,o.lW)(i,t.buffer.length,t.buffer),(0,u.NX)(e,i,t.buffer.length),a.M[17](e+16,t.dts),a.M[17](e+8,t.dts),a.M[17](e+48,BigInt(Math.floor(t.duration))),a.M[15](e+36,1|n.f[15](e+36)),0}return h.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),0}}},58469:(e,t,i)=>{i.d(t,{Bq:()=>f,Hm:()=>s,Ij:()=>d,XC:()=>l,_5:()=>h,f7:()=>u,uF:()=>a});var r=i(77231),n=i(37246);const a={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},s={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],c=[r.N_,1,2,3,4,5,6,7];function h(e){let t=r.N_,i=r.N_,n=r.N_;var a,s;return e.length>=2&&(t=e[0]>>3&31,i=null!==(a=o[(7&e[0])<<1|e[1]>>7])&&void 0!==a?a:48e3,n=null!==(s=c[e[1]>>3&15])&&void 0!==s?s:2),{profile:t,sampleRate:i,channels:n}}function l(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:i,sampleRate:r,channels:n}=h(t);e.codecpar.profile=i,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=n}}function d(e){const t=s[e.sampleRate],i=e.chLayout.nbChannels,r=new Uint8Array(2);return r[0]=(31&e.profile)<<3|(14&t)>>1,r[1]=(1&t)<<7|(15&i)<<3,r}function f(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const i=1&e[1],r=(192&e[2])>>>6,n=(60&e[2])>>>2,a=(1&e[2])<<2|(192&e[3])>>>6,s=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,h=3&e[6];let l=1===i?7:9,d=s-l;return{syncWord:t,profile:r+1,sampleRate:o[n],channels:c[a],aacFrameLength:s,numberOfRawDataBlocksInFrame:h,headerLength:l,framePayloadLength:d}}function u(e,t){function i(){const e=t.readU(2);let i=0;for(let r=0;r<=e;r++)i<<=8,i|=t.readU(8);return i}t||(t=new n.A).appendBuffer(e);const r=t.getPos(),a={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},s=t.readU(11);if(695!==s)return-1;a.syncWord=s,a.muxLengthBytes=t.readU(13);const h=1===t.readU1();if(a.useSameStreamMux=h,!h){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&i(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let r=e?i():0;const n=t.readU(5);r-=5;const s=t.readU(4);r-=4;const h=t.readU(4);if(r-=4,t.readU(3),r-=3,r>0&&t.readU(r),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)i();else{let e=0;for(;;){e<<=8;const i=1===t.readU1();if(e+=t.readU(8),!i)break}}1===t.readU1()&&t.readU(8),a.profile=n+1,a.sampleRate=o[s],a.channels=c[h]}let l=0;for(;;){const e=t.readU(8);if(l+=e,255!==e)break}return a.framePayloadLength=l,a.headerLength=t.getPos()-r+(8===t.getBitLeft()?0:1),a}},87771:(e,t,i)=>{i.d(t,{R:()=>u,j:()=>n});var r=i(37246);const n=[3,4,3,7,259,263,1539,1543],a=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],s=[4,5,6,5],o=[4,6,7,6],c=[48e3,44100,32e3,0],h=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],d=[1,2,3,6],f=7;function u(e){const t=new r.A(size);t.appendBuffer(e);const i={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(i.syncWord=t.readU(16),2935!==i.syncWord)return-1;if(i.bitstreamId=31&t.readU(29),i.bitstreamId>16)return-2;if(i.numBlocks=6,i.ac3BitrateCode=-1,i.centerMixLevel=5,i.surroundMixLevel=6,i.dolbySurroundMode=0,i.bitstreamId<=10){if(i.crc1=t.readU(16),i.srCode=t.readU(2),3===i.srCode)return-3;const e=t.readU(6);if(e>37)return-4;i.ac3BitrateCode=e>>1,t.readU(5),i.bitstreamMode=t.readU(3),i.channelMode=t.readU(3),2==i.channelMode?i.dolbySurroundMode=t.readU(2):(1&i.channelMode&&1!=i.channelMode&&(i.centerMixLevel=s[t.readU(2)]),4&i.channelMode&&(i.surroundMixLevel=o[t.readU(2)])),i.lfeOn=t.readU(1),i.srShift=Math.max(i.bitstreamId,8)-8,i.sampleRate=c[i.srCode]>>i.srShift,i.bitrate=1e3*h[i.ac3BitrateCode]>>i.srShift,i.channels=l[i.channelMode]+i.lfeOn,i.frameSize=2*a[e][i.srCode],i.frameType=2,i.substreamId=0}else{if(i.crc1=0,i.frameType=t.readU(2),3==i.frameType)return-5;if(i.substreamId=t.readU(3),i.frameSize=t.readU(11)+1<<1,i.frameSize<f)return-6;if(i.srCode=t.readU(2),3==i.srCode){const e=t.readU(2);if(3==e)return-7;i.sampleRate=c[e]/2,i.srShift=1}else i.numBlocks=d[t.readU(2)],i.sampleRate=c[i.srCode],i.srShift=0;i.channelMode=t.readU(3),i.lfeOn=t.readU(1),i.bitrate=8*i.frameSize*i.sampleRate/(256*i.numBlocks),i.channels=l[i.channelMode]+i.lfeOn}return i.channelLayout=BigInt.asUintN(64,n[i.channelMode]),i.lfeOn&&(i.channelLayout|=BigInt(8)),i}},29347:(e,t,i)=>{i.d(t,{R:()=>o});var r=i(37246);const n=[1,2,2,2,2,3,3,4,4,5,6,6,6,7,8,8],a=[0,8e3,16e3,32e3,0,0,11025,22050,44100,0,0,12e3,24e3,48e3,0,0],s=[32e3,56e3,64e3,96e3,112e3,128e3,192e3,224e3,256e3,32e4,384e3,448e3,512e3,576e3,64e4,768e3,96e4,1024e3,1152e3,128e4,1344e3,1408e3,1411200,1472e3,1536e3,192e4,2048e3,3072e3,384e4,0,0,0];function o(e){const t=new r.A(size);t.appendBuffer(e);const i={syncWord:0,frameType:0,sampleCount:0,crcFlag:0,sampleBlock:0,frameSize:0,channelIndex:0,sampleRateIndex:0,bitrateIndex:0,channels:0,sampleRate:0,bitrate:0};return i.syncWord=t.readU(32),2147385345!==i.syncWord?-1:(i.frameType=t.readU1(),i.sampleCount=t.readU(5),i.crcFlag=t.readU1(),i.sampleBlock=t.readU(7),i.frameSize=t.readU(14),i.channelIndex=t.readU(6),i.sampleRateIndex=t.readU(4),i.bitrateIndex=t.readU(5),i.channels=n[i.channelIndex],i.sampleRate=a[i.sampleRateIndex],i.bitrate=s[i.bitrateIndex],i)}},20620:(e,t,i)=>{i.d(t,{Jk:()=>B,KD:()=>P,MB:()=>y,OD:()=>v,S1:()=>_,XC:()=>k,ci:()=>S,k9:()=>x,oT:()=>I,tZ:()=>b,wf:()=>R});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),h=i(4624),l=i(14686),d=i(71517),f=i(60264),u=i(37837),p=i(23991),m=i(39381),g="src/avformat/codecs/h264.ts";const U=3,b={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"},w=[{level:10,maxResolution:25344,maxFrameRate:15},{level:11,maxResolution:25344,maxFrameRate:30},{level:12,maxResolution:101376,maxFrameRate:30},{level:13,maxResolution:101376,maxFrameRate:30},{level:20,maxResolution:101376,maxFrameRate:30},{level:21,maxResolution:202752,maxFrameRate:30},{level:22,maxResolution:414720,maxFrameRate:30},{level:30,maxResolution:414720,maxFrameRate:30},{level:31,maxResolution:921600,maxFrameRate:30},{level:32,maxResolution:1310720,maxFrameRate:60},{level:40,maxResolution:2097152,maxFrameRate:30},{level:41,maxResolution:2097152,maxFrameRate:60},{level:42,maxResolution:2228224,maxFrameRate:60},{level:50,maxResolution:8912896,maxFrameRate:30},{level:51,maxResolution:8912896,maxFrameRate:60},{level:52,maxResolution:8912896,maxFrameRate:120},{level:60,maxResolution:35651584,maxFrameRate:30},{level:61,maxResolution:35651584,maxFrameRate:60},{level:62,maxResolution:35651584,maxFrameRate:120}];function x(e,t,i){const r=e*t;for(const e of w)if(r<=e.maxResolution&&i<=e.maxFrameRate)return e.level}function y(e){const t=new o.A(e);t.skip(5);const i=[],r=[],n=[],a=31&t.readUint8();for(let e=0;e<a;e++){const e=t.readUint16();i.push(t.readBuffer(e))}const s=t.readUint8();for(let e=0;e<s;e++){const e=t.readUint16();r.push(t.readBuffer(e))}if(t.remainingSize()>4){t.skip(3);const e=t.readUint8();if(e>0)for(let i=0;i<e;i++){const e=t.readUint16();n.push(t.readBuffer(e))}}return{spss:i,ppss:r,spsExts:n}}function A(e,t,i=[]){e.length>32&&(h.R8(`h264 metadata's sps max length is 32, but get ${e.length}`,g,210),e=e.slice(0,32)),e.length>256&&(h.R8(`h264 metadata's pps max length is 256, but get ${e.length}`,g,214),e=e.slice(0,256));let r=7;r=e.reduce(((e,t)=>e+2+t.length),r),r=t.reduce(((e,t)=>e+2+t.length),r);const n=e[0],o=R(n);66!==o.profile&&77!==o.profile&&88!==o.profile&&(r+=4,i.length&&(r=i.reduce(((e,t)=>e+2+t.length),r)));const c=new Uint8Array(r),l=new s.A(c);return l.writeUint8(1),l.writeUint8(n[1]),l.writeUint8(n[2]),l.writeUint8(n[3]),l.writeUint8(252|U),l.writeUint8(224|31&e.length),a.__(e,(e=>{l.writeUint16(e.length),l.writeBuffer(e)})),l.writeUint8(t.length),a.__(t,(e=>{l.writeUint16(e.length),l.writeBuffer(e)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(l.writeUint8(252|o.chromaFormatIdc),l.writeUint8(248|o.bitDepthLumaMinus8),l.writeUint8(248|o.bitDepthChromaMinus8),i.length&&a.__(i,(e=>{l.writeUint16(e.length),l.writeBuffer(e)}))),c}function _(e){let t=(0,f.py)(e);if(t.length>1){const e=[],i=[],r=[];if(t.forEach((t=>{const n=31&t[0];7===n?e.push(t):8===n?i.push(t):13===n&&r.push(t)})),e.length&&i.length)return A(e,i,r)}}function I(e){let t,i=(0,f.py)(e),r=!1;if(i.length>1){const e=[],r=[],n=[];i.forEach((t=>{const i=31&t[0];7===i?e.push(t):8===i?r.push(t):13===i&&n.push(t)})),e.length&&r.length&&(t=A(e,r,n)),i=i.filter((e=>{const t=31&e[0];return 9!==t&&8!==t&&7!==t&&13!==t}))}const n=i.reduce(((e,t)=>e+U+1+t.length),0),o=(0,u.sY)(n),c=(0,l.s3)(o,n),h=new s.A(c);return a.__(i,(e=>{3===U?h.writeUint32(e.length):2===U?h.writeUint24(e.length):1===U?h.writeUint16(e.length):h.writeUint8(e.length),h.writeBuffer(e.subarray(0)),5==(31&e[0])&&(r=!0)})),{bufferPointer:o,length:n,key:r,extradata:t}}function v(e,t){const i=t?3&t[4]:U;let r=[],n=[],c=[],h=!1;if(t){const e=y(t);r=e.spss,n=e.ppss,c=e.spsExts,h=!0}const d=[],f=[],p=new o.A(e);for(;p.remainingSize()>0;){let t=0;t=3===i?p.readUint32():2===i?p.readUint24():1===i?p.readUint16():p.readUint8();const r=e.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+t);p.skip(t);const n=31&r[0];6===n?f.push(r):9!==n&&d.push(r)}let m=r.reduce(((e,t)=>e+4+t.length),0);m=n.reduce(((e,t)=>e+4+t.length),m),m=c.reduce(((e,t)=>e+4+t.length),m),m=f.reduce(((e,t)=>e+4+t.length),m),m=d.reduce(((e,t,i)=>e+(i?3:4)+t.length),m);const g=(0,u.sY)(m+6),b=new s.A((0,l.s3)(g,m+6));return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(9),b.writeUint8(240),a.__(f,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),a.__(r,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),a.__(n,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),a.__(c,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),a.__(d,((e,t)=>{b.writeUint8(0),b.writeUint8(0),t||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e),5==(31&e[0])&&(h=!0)})),{bufferPointer:g,length:m+6,key:h}}function B(e,t){var i;if(!(1&r.f[15](e+36)))return;const n=(0,d.iI)(e);if((0,f.Bs)(n))return;const a=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:U;let s=[],c=[],h=[],p=[];const m=new o.A(n);for(;m.remainingSize()>0;){let e=0;e=3===a?m.readUint32():2===a?m.readUint24():1===a?m.readUint16():m.readUint8();const t=n.subarray(Number(BigInt.asIntN(32,m.getPos())),Number(BigInt.asIntN(32,m.getPos()))+e);m.skip(e);const i=31&t[0];7===i?s.push(t):8===i?c.push(t):13===i?h.push(t):p.push(t)}if(s.length||c.length){const t=A(s,c,h),i=(0,u.sY)(t.length);(0,l.lW)(i,t.length,t),(0,d.Ow)(e,1,i,t.length)}}function S(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,d.iI)(e);if(!(0,f.Bs)(i))return;let a=(0,f.py)(i);if(a.length>1){const t=[],i=[],s=[];if(a.forEach((e=>{const r=31&e[0];7===r?t.push(e):8===r?i.push(e):13===r&&s.push(e)})),t.length&&i.length){const a=A(t,i,s),o=(0,u.sY)(a.length);(0,l.lW)(o,a.length,a),(0,d.Ow)(e,1,o,a.length),n.M[15](e+36,1|r.f[15](e+36))}}}function k(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[4];const{spss:i}=y(t);if(i.length){const{profile:t,level:r,width:n,height:a}=R(i[0]);e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=n,e.codecpar.height=a}}}function P(e,t=4){if(2===r.f[15](e+80))return(0,f.py)((0,l.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>5==(31&e[0])));{const i=r.f[15](e+28);let n=0;for(;n<i-t;){if(5==(31&m.r8(r.f[20](e+24)+(n+t))))return!0;n+=4===t?m.Sg(r.f[20](e+24)+n):3===t?m.ht(r.f[20](e+24)+n):2===t?m.yd(r.f[20](e+24)+n):m.r8(r.f[20](e+24)+n),n+=t}return!1}}function R(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=(0,f.BN)(e.subarray(t)),r=new c.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const n=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const a=r.readU(8);p.xb(r);let s=1,o=0,h=0;if((100==n||110==n||122==n||244==n||44==n||83==n||86==n||118==n||128==n||138==n||139==n||134==n||135==n)&&(s=p.xb(r),3===s&&r.readU1(),o=p.xb(r),h=p.xb(r),r.readU1(),r.readU1())){const e=new Array(8);for(let t=0;t<(3!=s?8:12);t++)e[t]=r.readU1()}const l=p.xb(r),d=p.xb(r);let u=0,m=0;if(0===d)u=p.xb(r);else if(1===d){m=r.readU1(),p.$x(r),p.$x(r);const e=p.xb(r);for(let t=0;t<e;t++)p.$x(r)}p.xb(r),r.readU1();const g=p.xb(r),U=p.xb(r),b=r.readU1();let w=16*(g+1),x=(2-b)*(U+1)*16;b||r.readU1(),r.readU1();const y=r.readU1();if(y){let e=1,t=2-y;1===s?(e=2,t=2*(2-y)):2===y&&(e=2,t=2-y),w-=e*(p.xb(r)+p.xb(r)),x-=t*(p.xb(r)+p.xb(r))}return{profile:n,level:a,width:w,height:x,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:h,frameMbsOnlyFlag:b,picOrderCntType:d,log2MaxPicOrderCntLsbMinus4:u,deltaPicOrderAlwaysZeroFlag:m,log2MaxFrameNumMinus4:l}}},53e3:(e,t,i)=>{i.d(t,{HL:()=>w,Jk:()=>I,KD:()=>S,OD:()=>_,S1:()=>y,XC:()=>B,ZU:()=>P,ci:()=>v,dT:()=>m,k9:()=>U,oT:()=>A,wf:()=>k});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),h=i(14686),l=i(60264),d=i(71517),f=i(37837),u=i(23991),p=i(39381);const m={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},g=[{level:10,maxLumaSamplesPerSecond:552960,maxLumaPictureSize:36864,maxBitRate:{main:128,main10:150}},{level:20,maxLumaSamplesPerSecond:3686400,maxLumaPictureSize:122880,maxBitRate:{main:1500,main10:1875}},{level:21,maxLumaSamplesPerSecond:7372800,maxLumaPictureSize:245760,maxBitRate:{main:3e3,main10:3750}},{level:30,maxLumaSamplesPerSecond:16588800,maxLumaPictureSize:552960,maxBitRate:{main:6e3,main10:7500}},{level:31,maxLumaSamplesPerSecond:33177600,maxLumaPictureSize:983040,maxBitRate:{main:1e4,main10:12500}},{level:40,maxLumaSamplesPerSecond:66846720,maxLumaPictureSize:2228224,maxBitRate:{main:12e3,main10:15e3}},{level:41,maxLumaSamplesPerSecond:133693440,maxLumaPictureSize:2228224,maxBitRate:{main:2e4,main10:25e3}},{level:50,maxLumaSamplesPerSecond:267386880,maxLumaPictureSize:8912896,maxBitRate:{main:25e3,main10:4e4}},{level:51,maxLumaSamplesPerSecond:534773760,maxLumaPictureSize:8912896,maxBitRate:{main:4e4,main10:6e4}},{level:52,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:60,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:61,maxLumaSamplesPerSecond:2139095040,maxLumaPictureSize:89128960,maxBitRate:{main:12e4,main10:24e4}},{level:62,maxLumaSamplesPerSecond:4278190080,maxLumaPictureSize:356515840,maxBitRate:{main:24e4,main10:48e4}}];function U(e,t,i,r,n){n/=1e3;const a=1===e?"main":"main10",s=t*i*r;for(const e of g)if(s<=e.maxLumaSamplesPerSecond&&t*i<=e.maxLumaPictureSize&&n<=e.maxBitRate[a])return e.level}const b=3;function w(e){const t=new o.A(e,!0);t.skip(22);let i=[],r=[],n=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=63&t.readUint8(),a=t.readUint16(),s=[];for(let e=0;e<a;e++){const e=t.readUint16();s.push(t.readBuffer(e))}32===e?i=s:33===e?r=s:34===e&&(n=s)}return{vpss:i,spss:r,ppss:n}}function x(e,t,i){const r=t[0];let n=23;e.length&&(n+=3,n=e.reduce(((e,t)=>e+2+t.length),n)),t.length&&(n+=3,n=t.reduce(((e,t)=>e+2+t.length),n)),i.length&&(n+=3,n=i.reduce(((e,t)=>e+2+t.length),n));const o=new Uint8Array(n),c=new s.A(o,!0),h=k(r);c.writeUint8(1),c.writeUint8(r[1]),c.writeUint8(r[2]),c.writeUint8(r[3]),c.writeUint8(r[4]),c.writeUint8(r[5]),c.writeUint8(r[6]),c.writeUint8(r[7]),c.writeUint8(r[8]),c.writeUint8(r[9]),c.writeUint8(r[10]),c.writeUint8(r[11]),c.writeUint8(h.level),c.writeUint8(1020),c.writeUint8(0),c.writeUint8(16320),c.writeUint8(16320|h.chroma_format_idc),c.writeUint8(8160|h.bit_depth_luma_minus8),c.writeUint8(8160|h.bit_depth_chroma_minus8),c.writeUint16(0),c.writeUint8(8|(1&r[0])<<2|b);let l=0;return e.length&&l++,t.length&&l++,i.length&&l++,c.writeUint8(l),e.length&&(c.writeUint8(160),c.writeUint16(e.length),a.__(e,(e=>{c.writeUint16(e.length),c.writeBuffer(e)}))),t.length&&(c.writeUint8(161),c.writeUint16(t.length),a.__(t,(e=>{c.writeUint16(e.length),c.writeBuffer(e)}))),i.length&&(c.writeUint8(162),c.writeUint16(i.length),a.__(i,(e=>{c.writeUint16(e.length),c.writeBuffer(e)}))),o}function y(e){let t=(0,l.py)(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const n=t[0]>>>1&63;32===n?e.push(t):33===n?i.push(t):34===n&&r.push(t)})),i.length&&r.length)return x(e,i,r)}}function A(e){let t,i=!1,r=(0,l.py)(e);if(r.length>=2){const e=[],i=[],n=[];r.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?i.push(t):34===r&&n.push(t)})),i.length&&n.length&&(t=x(e,i,n),r=r.filter((e=>{const t=e[0]>>>1&63;return 32!==t&&33!==t&&34!==t&&35!==t})))}const n=r.reduce(((e,t)=>e+b+1+t.length),0),o=(0,f.sY)(n),c=(0,h.s3)(o,n),d=new s.A(c);return a.__(r,(e=>{3===b?d.writeUint32(e.length):2===b?d.writeUint24(e.length):1===b?d.writeUint16(e.length):d.writeUint8(e.length),d.writeBuffer(e.subarray(0));const t=e[0]>>>1&63;19!==t&&20!==t&&21!==t||(i=!0)})),{bufferPointer:o,length:n,extradata:t,key:i}}function _(e,t){const i=t?3&t[21]:b;let r=[],n=[],c=[],l=!1;if(t){const e=w(t);r=e.vpss,n=e.spss,c=e.ppss,l=!0}const d=[],u=new o.A(e);for(;u.remainingSize()>0;){let e=0;e=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),d.push(u.readBuffer(e))}let p=r.reduce(((e,t)=>e+4+t.length),0);p=n.reduce(((e,t)=>e+4+t.length),p),p=c.reduce(((e,t)=>e+4+t.length),p),p=d.reduce(((e,t,i)=>e+(i?3:4)+t.length),p);const m=(0,f.sY)(p+7),g=(0,h.s3)(m,p+7),U=new s.A(g);return U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeUint8(70),U.writeUint8(0),U.writeUint8(240),a.__(r,(e=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e)})),a.__(n,(e=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e)})),a.__(c,(e=>{U.writeUint8(0),U.writeUint8(0),U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e)})),a.__(d,((e,t)=>{U.writeUint8(0),U.writeUint8(0),t||U.writeUint8(0),U.writeUint8(1),U.writeBuffer(e);const i=e[0]>>>1&63;19!==i&&20!==i&&21!==i||(l=!0)})),{bufferPointer:m,length:p+7,key:l}}function I(e,t){var i;if(!(1&r.f[15](e+36)))return;const n=(0,d.iI)(e);if((0,l.Bs)(n))return;const a=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:b;let s=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let e=0;e=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const t=n.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+e);p.skip(e);const i=t[0]>>>1&63;33===i?c.push(t):34===i?u.push(t):32===i&&s.push(t)}if(c.length||u.length||s.length){const t=x(s,c,u),i=(0,f.sY)(t.length);(0,h.lW)(i,t.length,t),(0,d.Ow)(e,1,i,t.length)}}function v(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,d.iI)(e);if(!(0,l.Bs)(i))return;let a=(0,l.py)(i);if(a.length>2){const t=[],i=[],s=[];if(a.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?i.push(e):34===r&&s.push(e)})),t.length&&i.length&&s.length){const a=x(t,i,s),o=(0,f.sY)(a.length);(0,h.lW)(o,a.length,a),(0,d.Ow)(e,1,o,a.length),n.M[15](e+36,1|r.f[15](e+36))}}}function B(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[21];const{spss:i}=w(t);if(i.length){const{profile:t,level:r,width:n,height:a}=k(i[0]);e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=n,e.codecpar.height=a}}}function S(e,t=4){if(2===r.f[15](e+80))return(0,l.py)((0,h.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[0]>>>1&63;return 20===t||19===t}));{const i=r.f[15](e+28);let n=0;for(;n<i-t;){const i=p.r8(r.f[20](e+24)+(n+t))>>>1&63;if(20===i||19===i)return!0;n+=4===t?p.Sg(r.f[20](e+24)+n):3===t?p.ht(r.f[20](e+24)+n):2===t?p.yd(r.f[20](e+24)+n):p.r8(r.f[20](e+24)+n),n+=t}return!1}}function k(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,n=0,a=0,s=0,o=0,h=1,d=0,f=0,p=0,m=0;const g=(0,l.BN)(e.subarray(t)),U=new c.A(g.length);U.appendBuffer(g),U.readU1(),U.readU(6),U.readU(6),U.readU(3),U.readU(4);const b=U.readU(3);U.readU1();let w=0;if(b<=6){d=U.readU(2),f=U.readU1(),i=U.readU(5),p=U.readU(32),m=U.readU(48),r=U.readU(8);const e=new Array(6),t=new Array(6);for(let i=0;i<b;i++)e[i]=U.readU1(),t[i]=U.readU1();if(b>0)for(let e=b;e<8;e++)U.readU(2);for(let i=0;i<b;i++)e[i]&&(U.readU(2),U.readU(1),U.readU(5),U.readU(32),U.readU(1),U.readU(1),U.readU(1),U.readU(1),U.readU(44)),t[i]&&U.readU(8);u.xb(U),h=u.xb(U),3===h&&(w=U.readU(1)),n=u.xb(U),a=u.xb(U);let c=0,l=0,g=0,x=0;U.readU1()&&(c=u.xb(U),l=u.xb(U),g=u.xb(U),x=u.xb(U)),s=u.xb(U),o=u.xb(U);let y=2,A=2;0===h?y=A=0:2===h?(y=2,A=1):3===h&&(y=A=1),n-=y*(1<<s+1)*(c+l),a-=A*(1<<s+1)*(g+x)}const x=u.xb(U)+4;for(let e=U.readU1()?0:b;e<b+1;e++)u.xb(U),u.xb(U),u.xb(U);const y=u.xb(U)+3,A=u.xb(U),_=u.xb(U)+2,I=u.xb(U),v=y+A,B=y-1,S=n+(1<<v)-1>>v,k=a+(1<<v)-1>>v;return{profile:i,level:r,width:n,height:a,chroma_format_idc:h,bit_depth_luma_minus8:s,bit_depth_chroma_minus8:o,general_profile_space:d,general_tier_flag:f,general_profile_compatibility_flags:p,constraint_flags:m,separate_colour_plane_flag:w,log2_min_cb_size:y,log2_diff_max_min_coding_block_size:A,log2_min_tb_size:_,log2_diff_max_min_transform_block_size:I,log2_max_trafo_size:I+_,log2_ctb_size:v,log2_min_pu_size:B,ctb_width:S,ctb_height:k,ctb_size:S*k,min_cb_width:n>>y,min_cb_height:a>>y,min_tb_width:n>>_,min_tb_height:a>>_,min_pu_width:n>>B,min_pu_height:a>>B,log2_max_poc_lsb:x}}function P(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=(0,l.BN)(e.subarray(t)),r=new c.A(i.length);return r.appendBuffer(i),{pps_pic_parameter_set_id:u.xb(r),pps_seq_parameter_set_id:u.xb(r),dependent_slice_segment_flag:r.readU1(),output_flag_present_flag:r.readU1(),num_extra_slice_header_bits:r.readU(3)}}},89088:(e,t,i)=>{i.d(t,{Au:()=>b,He:()=>w,XC:()=>x,Y2:()=>m,hG:()=>g,oz:()=>U});var r=i(77231);const n=[44100,48e3,32e3,0],a=[22050,24e3,16e3,0],s=[11025,12e3,8e3,0],o=[0,1152,1152,384],c=[0,576,1152,384],h=[0,576,1152,384],l=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],d=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],f=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],u=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],p=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return s[t];case 2:return a[t];case 3:return n[t]}return r.N_}function g(e,t){switch(e){case 0:return h[t];case 2:return c[t];case 3:return o[t]}return r.N_}function U(e,t,i){switch(t){case 1:switch(e){case 0:case 2:return p[i];case 3:return f[i]}break;case 2:switch(e){case 0:case 2:return p[i];case 3:return d[i]}case 3:switch(e){case 0:case 2:return u[i];case 3:return l[i]}}return r.N_}function b(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return r.N_}const w={32:"Layer1",33:"Layer2",34:"Layer3"};function x(e,t){if(t&&t.length>=4){const i=t[1]>>>3&3,r=(6&t[1])>>1,n=(12&t[2])>>>2,a=3&~(t[3]>>>6)?2:1,s=b(r),o=m(i,n);e.codecpar.profile=s,e.codecpar.sampleRate=o,e.codecpar.chLayout.nbChannels=a}}},25906:(e,t,i)=>{i.d(t,{K:()=>n});var r=i(71517);function n(e){const t=(0,r.iI)(e);for(let e=0;e<t.length-6;e++)if(0===t[e]&&0===t[e+1]&&1===t[e+2]&&0===t[e+3])return 1==(t[e+5]>>3&7);return!1}},65451:(e,t,i)=>{i.d(t,{Ij:()=>h,XC:()=>c,kt:()=>o});var r=i(31865),n=i(729),a=i(44328);const s=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(e){let t=0,i=0,r=0;if(e.length<1)return 0;switch(t=e[0],i=s[t>>3],3&t){case 0:r=1;break;case 1:case 2:r=2;break;case 3:if(e.length<2)return 0;r=63&e[1]}return r*i}function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const i=new r.A(t,!1);i.skip(9),e.codecpar.chLayout.nbChannels=i.readUint8(),e.codecpar.initialPadding=i.readUint16(),e.codecpar.sampleRate=i.readUint32(),e.codecpar.seekPreroll=Number((0,a.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function h(e){const t=new Uint8Array(19),i=new n.A(t,!1);return i.writeString("OpusHead"),i.writeUint8(1),i.writeUint8(e.chLayout.nbChannels),i.writeUint16(e.initialPadding),i.writeUint32(e.sampleRate),t}},55611:(e,t,i)=>{i.d(t,{Jk:()=>A,KD:()=>B,OD:()=>y,QA:()=>I,Ui:()=>k,XC:()=>v,ci:()=>_,oT:()=>x,wf:()=>S});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),h=i(14686),l=i(60264),d=i(71517),f=i(37837),u=i(23991),p=i(83314),m=i(39381);const g=3;function U(e){const t=e.readU(9),i=e.readU(3),r=e.readU(2),n=e.readU(2),a=e.readU(3);e.readU(5),e.readU(2);const s=e.readU(6),o=e.readU(7),c=e.readU(1),h=e.readU(8),l=e.readU(1),d=e.readU(1),f=[],u=[];if(s){for(let t=0;t<s-1;t++)f[t]=e.readU(8);f[s-1]=e.readU(6)}else e.readU(6);if(i>1){let t=0;for(let r=i-2;r>=0;--r)t|=e.readU(1)<<r;for(let t=i;t<=8&&i>1;++t)e.readU(1);for(let r=i-2;r>=0;--r)t&1<<r&&(u[r]=e.readU(8))}const p=e.readU(8),m=[];if(p)for(let t=0;t<p;t++)m.push(e.readU(8));return{olsIdx:t,numSublayers:i,bitDepthMinus8:a,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:c,generalLevelIdc:h,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:d,generalConstraintInfo:f,sublayerLevelIdc:u,generalSubProfileIdc:m,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function b(e){const t=new o.A(e,!0);if(1&t.readUint8()){const i=new c.A;i.appendBuffer(e.subarray(1)),U(i),t.skip(i.getPos())}let i=[],r=[],n=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=31&t.readUint8();let a=1;13!==e&&12!==e&&(a=t.readUint16());const s=[];for(let e=0;e<a;e++){const e=t.readUint16();s.push(t.readBuffer(e))}14===e?i=s:15===e?r=s:16===e&&(n=s)}return{vpss:i,spss:r,ppss:n}}function w(e,t,i){const r=t[0];let n;if(r){const e=S(r);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const i=new p.A;if(i.writeU(9,0),i.writeU(3,e.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,e.chromaFormatIdc),i.writeU(3,e.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,t.length),i.writeU(7,e.profile),i.writeU1(e.tierFlag),i.writeU(8,e.level),i.writeU1(e.ptlFrameOnlyConstraintFlag),i.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)i.writeU(8,t[e]);i.writeU(6,t[t.length-1])}else i.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let i=e.spsMaxSublayersMinus1-1;i>=0;i--)t=t<<1|e.ptlSublayerLevelPresentFlag[i];i.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)i.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&i.writeU(8,e.sublayerLevelIdc[t])}i.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)i.writeU(8,e.sublayerLevelIdc[t]);i.writeU(16,e.width),i.writeU(16,e.height),i.writeU(16,0),i.padding(),n=i.getBuffer().subarray(0,i.getPointer())}let o=2+(n?n.length:0);e.length&&(o+=3,o=e.reduce(((e,t)=>e+2+t.length),o)),t.length&&(o+=3,o=t.reduce(((e,t)=>e+2+t.length),o)),i.length&&(o+=3,o=i.reduce(((e,t)=>e+2+t.length),o));const c=new Uint8Array(o),h=new s.A(c,!0);h.writeUint8(g<<1|(n?1:0)|248),n&&h.writeBuffer(n);let l=0;return e.length&&l++,t.length&&l++,i.length&&l++,h.writeUint8(l),e.length&&(h.writeUint8(142),h.writeUint16(e.length),a.__(e,(e=>{h.writeUint16(e.length),h.writeBuffer(e)}))),t.length&&(h.writeUint8(143),h.writeUint16(t.length),a.__(t,(e=>{h.writeUint16(e.length),h.writeBuffer(e)}))),i.length&&(h.writeUint8(144),h.writeUint16(i.length),a.__(i,(e=>{h.writeUint16(e.length),h.writeBuffer(e)}))),c}function x(e){let t,i=!1,r=(0,l.py)(e);if(r.length>=2){const e=[],i=[],n=[];r.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&n.push(t)})),i.length&&n.length&&(t=w(e,i,n),r=r.filter((e=>{const t=e[1]>>>3&31;return 14!==t&&15!==t&&16!==t&&20!==t})))}const n=r.reduce(((e,t)=>e+g+1+t.length),0),o=(0,f.sY)(n),c=(0,h.s3)(o,n),d=new s.A(c);return a.__(r,(e=>{3===g?d.writeUint32(e.length):2===g?d.writeUint24(e.length):1===g?d.writeUint16(e.length):d.writeUint8(e.length),d.writeBuffer(e.subarray(0));const t=e[1]>>>3&31;8!==t&&7!==t&&9!==t&&10!==t||(i=!0)})),{bufferPointer:o,length:n,extradata:t,key:i}}function y(e,t){const i=t?t[0]>>>1&3:g;let r=[],n=[],c=[],l=!1;if(t){const e=b(t);r=e.vpss,n=e.spss,c=e.ppss,l=!0}const d=[],u=new o.A(e);for(;u.remainingSize()>0;){let e=0;e=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),d.push(u.readBuffer(e))}let p=r.reduce(((e,t)=>e+4+t.length),0);p=n.reduce(((e,t)=>e+4+t.length),p),p=c.reduce(((e,t)=>e+4+t.length),p),p=d.reduce(((e,t,i)=>e+(i?3:4)+t.length),p);const m=(0,f.sY)(p+7),U=(0,h.s3)(m,p+7),w=new s.A(U);return w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeUint8(0),w.writeUint8(160),w.writeUint8(240),a.__(r,(e=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e)})),a.__(n,(e=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e)})),a.__(c,(e=>{w.writeUint8(0),w.writeUint8(0),w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e)})),a.__(d,((e,t)=>{w.writeUint8(0),w.writeUint8(0),t||w.writeUint8(0),w.writeUint8(1),w.writeBuffer(e);const i=e[1]>>>3&31;8!==i&&7!==i&&9!==i&&10!==i||(l=!0)})),{bufferPointer:m,length:p+7,key:l}}function A(e,t){var i;if(!(1&r.f[15](e+36)))return;const n=(0,d.iI)(e);if((0,l.Bs)(n))return;const a=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:g;let s=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let e=0;e=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const t=n.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+e);p.skip(e);const i=t[1]>>>3&31;15===i?c.push(t):16===i?u.push(t):14===i&&s.push(t)}if(c.length||u.length||s.length){const t=w(s,c,u),i=(0,f.sY)(t.length);(0,h.lW)(i,t.length,t),(0,d.Ow)(e,1,i,t.length)}}function _(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,d.iI)(e);if(!(0,l.Bs)(i))return;let a=(0,l.py)(i);if(a.length>2){const t=[],i=[],s=[];if(a.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&s.push(e)})),t.length&&i.length&&s.length){const a=w(t,i,s),o=(0,f.sY)(a.length);(0,h.lW)(o,a.length,a),(0,d.Ow)(e,1,o,a.length),n.M[15](e+36,1|r.f[15](e+36))}}}function I(e,t){const{profile:i,level:r,width:n,height:a}=S(t);e.codecpar.profile=i,e.codecpar.level=r,e.codecpar.width=n,e.codecpar.height=a}function v(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=t[0]>>>1&3;const{spss:i}=b(t);i.length&&I(e,i[0])}}function B(e,t=4){if(2===r.f[15](e+80))return(0,l.py)((0,h.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[1]>>>3&31;return 8===t||7===t}));{const i=r.f[15](e+28);let n=0;for(;n<i-t;){const i=m.r8(r.f[20](e+24)+(n+t+1))>>>3&31;if(8===i||7===i)return!0;n+=4===t?m.Sg(r.f[20](e+24)+n):3===t?m.ht(r.f[20](e+24)+n):2===t?m.yd(r.f[20](e+24)+n):m.r8(r.f[20](e+24)+n),n+=t}return!1}}function S(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,n=0,a=0,s=0,o=1,h=0,d=0,f=0;const p=[],m=[],g=[],U=[],b=(0,l.BN)(e.subarray(t)),w=new c.A(b.length);w.appendBuffer(b),w.readU1(),w.readU1(),w.readU(6),w.readU(5),w.readU(3),w.readU(8);const x=w.readU(3);o=w.readU(2);const y=w.readU(2);if(w.readU(1)){if(i=w.readU(7),h=w.readU(1),r=w.readU(8),d=w.readU(1),f=w.readU(1),w.readU(1)){for(let e=0;e<8;e++)p[e]=w.readU(8);p[8]=w.readU(7);const e=w.readU(8);w.readU(e)}w.skipPadding();for(let e=x-1;e>=0;e--)m[e]=w.readU(1);w.skipPadding();for(let e=x-1;e>=0;e--)m[e]&&(g[e]=w.readU(8));const e=w.readU(8);if(e)for(let t=0;t<e;t++)U[t]=w.readU(32)}w.readU1(),w.readU1()&&w.readU1();const A=n=u.xb(w),_=a=u.xb(w);if(w.readU1()&&(u.xb(w),u.xb(w),u.xb(w),u.xb(w)),w.readU1()){const e=u.xb(w),t=y+5,i=1<<t,r=A/(1<<t),n=_/(1<<t),a=Math.ceil(Math.log2(r)),s=Math.ceil(Math.log2(n));let o=0,c=0,h=0;e>0&&(h=w.readU1(),c=w.readU1());for(let t=0;e>0&&t<=e;t++)c&&0!=t||(t>0&&A>i&&w.readU(a),t>0&&_>i&&w.readU(s),t<e&&A>i&&w.readU(a),t<e&&_>i&&w.readU(s)),h||w.readU(2);if(o=u.xb(w)+1,w.readU(1)&&w.readU(1))for(let t=0;t<=e;t++)w.readU(o)}s=u.xb(w),w.readU(1),w.readU(1);const I=w.readU(4),v=w.readU(1);let B=0;v&&(B=u.xb(w));const S=[],k=w.readU(2);for(let e=0;e<8*k;e++)S[e]=w.readU(1);return{profile:i,level:r,width:n,height:a,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:h,generalConstraintInfo:p,generalSubProfileIdc:U,ptlFrameOnlyConstraintFlag:d,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:x,ptlSublayerLevelPresentFlag:m,sublayerLevelIdc:g,sps_log2_max_pic_order_cnt_lsb_minus4:I,sps_poc_msb_cycle_flag:v,sps_poc_msb_cycle_len_minus1:B,sps_num_extra_ph_bytes:k,sps_extra_ph_bit_present_flag:S}}function k(e){0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(e=function(e){let t=(0,l.py)(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const n=t[1]>>>3&31;14===n?e.push(t):15===n?i.push(t):16===n&&r.push(t)})),i.length&&r.length)return w(e,i,r)}}(e));const t=new c.A;return t.appendBuffer(e),1&t.readU(8)?U(t):{}}},85947:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(134),n=i(10754);class a{constructor(){(0,r.A)(this,"type",n.P.UNKNOWN),(0,r.A)(this,"onStreamAdd",void 0)}destroy(e){}}},83855:(e,t,i)=>{i.r(t),i.d(t,{default:()=>O});var r=i(134),n=i(80662),a=i.n(n),s=i(61499),o=i(63939),c=i(50932),h=i(4624),l=i(9705),d=i(51660),f=i(6403),u=i(85947),p=i(10754),m=i(71517),g=i(77231),U=i(52071),b=i(44328),w=i(72739),x=i(89088),y=i(20620),A=i(53e3),_=i(55611),I=i(58469),v=i(65451),B=i(25906),S=i(37837),k=i(14686),P=i(10662),R=i(92647),M=i(60264),L=i(56397),z=i(75294),F=i(87771),D=i(29347),C=i(67672),N=i(51113),E=i(7309),T="src/avformat/formats/IMpegpsFormat.ts";class O extends u.A{constructor(){super(),(0,r.A)(this,"type",p.P.MPEGPS),(0,r.A)(this,"context",void 0),(0,r.A)(this,"cacheAVPacket",void 0),this.context={headerState:255,psmType:new(a()),pes:new f.xf,slices:new(a()),lastPtsMap:new(a()),imkhCctv:!1,sofdec:!1,ioEnded:!1}}init(e){e.ioReader&&e.ioReader.setEndian(!0),this.cacheAVPacket=0}destroy(e){super.destroy(e),this.cacheAVPacket&&((0,m.Qe)(this.cacheAVPacket),this.cacheAVPacket=0),w.__(e.streams,(e=>{const t=e.privData;t.filter&&(t.filter.destroy(),t.filter=null)}))}async findNextStartCode(e){let t=255,i=0;for(;i<P.V;){const r=await e.ioReader.readUint8();if(1===t){t=16777215&(t<<8|r);break}t=16777215&(t<<8|r),i++}return i===P.V&&(t=-1),this.context.headerState=t,t}async parsePSM(e){const t=await e.ioReader.readUint16();await e.ioReader.skip(2);const i=await e.ioReader.readUint16();await e.ioReader.skip(i),await e.ioReader.readUint16();let r=t-i-10;for(;r>=4;){const t=await e.ioReader.readUint8(),i=await e.ioReader.readUint8(),n=await e.ioReader.readUint16();this.context.psmType.set(i,t),await e.ioReader.skip(n),r-=n+4}await e.ioReader.readUint32()}async readPES(e){for(;;){const t=await this.findNextStartCode(e);if(t<0)return l.LR;if(442===t||443===t)continue;if(446===t||447===t){const t=await e.ioReader.readUint16();await e.ioReader.skip(t);continue}if(444===t){await this.parsePSM(e);continue}if(!(t>=448&&t<=479||t>=480&&t<=495||445==t||447==t||509==t))continue;const i=await e.ioReader.readUint16();this.context.pes.pos=e.ioReader.getPos()-BigInt(6),this.context.pes.streamId=255&t,this.context.pes.streamType=this.context.psmType[this.context.pes.streamId];const r=new Uint8Array(i+6);return r[0]=0,r[1]=0,r[2]=1,r[3]=this.context.pes.streamId,r[4]=i>>8,r[5]=255&i,await e.ioReader.readBuffer(i,r.subarray(6)),this.context.pes.data=r,t}}createStream(e,t,i,r){let n=0,a=-1;switch(i){case 226:a=0,n=27;break;case 128:a=1,n=86019;break;case 136:a=1,n=86020;break;case 160:a=1,n=65537;break;case 32:a=3,n=94208;break;default:switch(t){case 1:case 2:a=0,n=2;break;case 3:case 4:a=1,n=86017;break;case 15:a=1,n=86018;break;case 16:a=0,n=12;break;case 27:a=0,n=27;break;case 36:a=0,n=173;break;case 51:a=0,n=196;break;case 129:a=1,n=86019;break;case 144:a=1,n=65543;break;case 145:a=1,n=65542;break;case 447:a=2,n=98312;break;default:if(r>=480&&r<=495)a=0,n=87;else if(r>=448&&r<=479)a=1,n=86017;else if(r>=128&&r<=135)a=1,n=86019;else if(r>=136&&r<=143||r>=152&&r<=159)a=1,n=86020;else if(r>=176&&r<=191)a=1,n=86060;else if(r>=192&&r<=207)a=1,n=86019;else if(r>=32&&r<=63)a=3,n=94208;else{if(!(r>=64853&&r<=64863))return;a=0,n=70}}}const o=e.createStream();o.codecpar.codecType=a,o.codecpar.codecId=n,o.timeBase.den=9e4,o.timeBase.num=1;const c=o.privData={streamId:i,streamType:t,filter:null};return 65543!==n&&65542!==n||(o.codecpar.chLayout.nbChannels=1,o.codecpar.sampleRate=8e3,o.codecpar.chLayout.order=1,o.codecpar.chLayout.u.mask=BigInt(4)),86017===o.codecpar.codecId?c.filter=new L.A:86019===o.codecpar.codecId?c.filter=new N.A:86020===o.codecpar.codecId&&(c.filter=new E.A),c.filter&&c.filter.init(o.codecpar[s.o9],o.timeBase[s.o9]),o}async readHeader(e){const t=await e.ioReader.peekString(6);if("IMKH"===t.substring(0,4)?(this.context.imkhCctv=!0,await e.ioReader.skip(4)):"Sofdec"===t&&(this.context.sofdec=!0,await e.ioReader.skip(6)),442!==await e.ioReader.peekUint32())return h.z3("the file format is not mpegps",T,379),l.LR;if(1&e.ioReader.flags){const t=e.ioReader.getPos(),i=BigInt(500)*BigInt(1e3);let r=await e.ioReader.fileSize()-i;r<t&&(r=t),await e.ioReader.seek(r);try{for(this.context.pes.pts=g.Dh;;)await this.readPES(e),(0,d.A)(this.context.pes),this.context.pes.pts!==g.Dh&&this.context.lastPtsMap.set(this.context.pes.streamId,this.context.pes.pts)}catch(i){await e.ioReader.seek(t)}}return this.context.ioEnded=!1,0}checkExtradata(e,t){if(86017===t.codecpar.codecId&&t.codecpar.sampleRate===g.N_){const i=(0,m.iI)(e),r=i[1]>>>3&3,n=(6&i[1])>>1,a=(12&i[2])>>>2,s=3&~(i[3]>>>6)?2:1,o=x.Au(n),c=x.Y2(r,a);t.codecpar.profile=o,t.codecpar.sampleRate=c,t.codecpar.chLayout.nbChannels=s}else if(86019===t.codecpar.codecId&&t.codecpar.sampleRate===g.N_){const i=(0,m.iI)(e),r=F.R(i);C.ai(r)||(t.codecpar.sampleRate=r.sampleRate,t.codecpar.chLayout.nbChannels=r.channels,t.codecpar.bitrate=BigInt(r.bitrate))}else if(86020===t.codecpar.codecId&&t.codecpar.sampleRate===g.N_){const i=(0,m.iI)(e),r=D.R(i);C.ai(r)||(t.codecpar.sampleRate=r.sampleRate,t.codecpar.chLayout.nbChannels=r.channels,t.codecpar.bitrate=BigInt(0|r.bitrate))}else if(!t.codecpar.extradata){let i=(0,m.rU)(e,1);i&&(t.codecpar.extradata=(0,S.sY)(o.f[15](i+4)),(0,k.Mr)(t.codecpar.extradata,o.f[20](i),o.f[15](i+4)),t.codecpar.extradataSize=o.f[15](i+4),(0,m.Is)(e,1),27===t.codecpar.codecId?y.XC(t,(0,k.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):173===t.codecpar.codecId?A.XC(t,(0,k.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):196===t.codecpar.codecId?_.XC(t,(0,k.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):86018===t.codecpar.codecId?I.XC(t,(0,k.JW)(t.codecpar.extradata,t.codecpar.extradataSize)):86076===t.codecpar.codecId&&v.XC(t,(0,k.JW)(t.codecpar.extradata,t.codecpar.extradataSize)))}}parseSlice(e,t,i,r){const n=(0,R.A)(Uint8Array,e.buffers),a=r.privData;1===r.codecpar.codecType&&c.M[15](i+36,1|o.f[15](i+36));const s=r.codecpar.codecId;27!==s&&173!==s&&196!==s||c.M[15](i+80,2),c.M[15](i+32,r.index),c.M[17](i+16,e.dts),c.M[17](i+8,e.pts),c.M[17](i+56,e.pos),c.M[15](i+76,9e4),c.M[15](i+72,1),r.startTime===g.Dh&&(r.startTime=o.f[17](i+8)||o.f[17](i+16),this.context.lastPtsMap.has(a.streamId)&&(r.duration=this.context.lastPtsMap.get(a.streamId)-r.startTime));const d=(0,S.sY)(n.length);if((0,k.lW)(d,n.length,n),(0,m.NX)(i,d,n.length),a.filter){let e=0;if(e=a.filter.sendAVPacket(i),e<0)return h.z3("send avpacket to bsf failed",T,527),l.LR;if(e=a.filter.receiveAVPacket(i),e<0)return h.z3("receive avpacket from bsf failed",T,534),l.LR;for(c.M[15](i+76,9e4),c.M[15](i+72,1),c.M[15](i+32,r.index),this.checkExtradata(i,r);;){const i=this.cacheAVPacket||(0,m._5)();if(e=a.filter.receiveAVPacket(i),0!==e){this.cacheAVPacket=i;break}c.M[15](i+76,9e4),c.M[15](i+72,1),c.M[15](i+32,r.index),this.checkExtradata(i,r),t.interval.packetBuffer.push(i),this.cacheAVPacket=0}}else 2===r.codecpar.codecId?B.K(i)&&c.M[15](i+36,1|o.f[15](i+36)):27===r.codecpar.codecId?(r.codecpar.extradata||(y.ci(i,!0),this.checkExtradata(i,r),r.codecpar.bitFormat=2),y.KD(i)&&c.M[15](i+36,1|o.f[15](i+36))):173===r.codecpar.codecId?(r.codecpar.extradata||(A.ci(i,!0),this.checkExtradata(i,r),r.codecpar.bitFormat=2),A.KD(i)&&c.M[15](i+36,1|o.f[15](i+36))):196===r.codecpar.codecId&&(r.codecpar.extradata||(_.ci(i,!0),this.checkExtradata(i,r),r.codecpar.bitFormat=2),_.KD(i)&&c.M[15](i+36,1|o.f[15](i+36)))}async readAVPacket_(e,t){for(;;){const i=await this.readPES(e);let r=e.streams.find((e=>e.privData.streamId===this.context.pes.streamId));if(!r){const t=255&i;r=this.createStream(e,this.context.psmType.get(t),t,i)}if(r){const i=r.privData;if((0,d.A)(this.context.pes),!this.context.pes.payload)continue;let n=this.context.slices.get(i.streamId);if(n||(n={pts:-BigInt(1),dts:-BigInt(1),pos:-BigInt(1),buffers:[]},this.context.slices.set(i.streamId,n)),this.context.pes.dts!==g.Dh&&n.buffers.length){if(0===r.codecpar.codecType){const e=M.Ky(this.context.pes.payload,0);e.offset>3&&(n.buffers.push(this.context.pes.payload.subarray(0,e.offset)),this.context.pes.payload=this.context.pes.payload.subarray(e.offset))}return this.parseSlice(n,e,t,r),n.buffers.length=0,n.buffers.push(this.context.pes.payload),n.dts=this.context.pes.dts,n.pts=this.context.pes.pts,n.pos=this.context.pes.pos,0}if(this.context.pes.dts!==g.Dh)if(n.dts=this.context.pes.dts,n.pts=this.context.pes.pts,n.pos=this.context.pes.pos,0===r.codecpar.codecType){const e=M.Ky(this.context.pes.payload,0);e.offset>3&&(this.context.pes.payload=this.context.pes.payload.subarray(e.offset))}else if(86019===r.codecpar.codecId||86020===r.codecpar.codecId||86017===r.codecpar.codecId){let e=0,t=2;86019===r.codecpar.codecId?e=11:86017===r.codecpar.codecId?e=255:(e=127,t=4);for(let i=0;i<this.context.pes.payload.length-t;i++)if(this.context.pes.payload[i]===e){const e=this.context.pes.payload[i+1],t=2;if(!(86017!==r.codecpar.codecId||224&~e)){if(0!==i){let e=0,r=0;for(;;){const n=new z.Vz;z.qg(n,this.context.pes.payload[i+r]<<24|this.context.pes.payload[i+r+1]<<16|this.context.pes.payload[i+r+2]<<8|this.context.pes.payload[i+r+3]);const a=this.context.pes.payload[i+r+1]>>>3&3,s=(12&this.context.pes.payload[i+r+2])>>>2,o=x.Y2(a,s);let c=z.CM(n,o);if(!(c&&i+r+c<this.context.pes.payload.length-2&&255===this.context.pes.payload[i+r+c])||224&~this.context.pes.payload[i+r+c+1])break;if(e++,r+=c,e===t)break}if(e!==t)continue;this.context.pes.payload=this.context.pes.payload.subarray(i)}break}if(86019===r.codecpar.codecId&&119===e){if(0!==i){let e=0,r=0;for(;;){const n=F.R(this.context.pes.payload.subarray(i+r));if(C.ai(n)||!(i+r+n.frameSize<this.context.pes.payload.length-2)||11!==this.context.pes.payload[i+r+n.frameSize]||119!==this.context.pes.payload[i+r+n.frameSize+1])break;if(e++,r+=n.frameSize,e===t)break}if(e!==t)continue;this.context.pes.payload=this.context.pes.payload.subarray(i)}break}if(86020===r.codecpar.codecId&&254===e&&128===this.context.pes.payload[i+2]&&129===this.context.pes.payload[i+3]){if(0!==i){let e=0,r=0;for(;;){const n=D.R(this.context.pes.payload.subarray(i+r));if(C.ai(n)||!(i+r+n.frameSize<this.context.pes.payload.length-4)||127!==this.context.pes.payload[i+r+n.frameSize]||254!==this.context.pes.payload[i+r+n.frameSize+1]||128!==this.context.pes.payload[i+r+n.frameSize+2]||129!==this.context.pes.payload[i+r+n.frameSize+3])break;if(e++,r+=n.frameSize,e===t)break}if(e!==t)continue;this.context.pes.payload=this.context.pes.payload.subarray(i)}break}}}n.buffers.push(this.context.pes.payload)}}}async readAVPacket(e,t){try{if(this.context.ioEnded){if(this.context.slices.size){let i,r;if(this.context.slices.forEach(((t,n)=>{t.buffers.length&&(r=e.streams.find((e=>e.privData.streamId===n)),r&&(i=t))})),i)return this.parseSlice(i,e,t,r),i.buffers.length=0,i.pts=i.dts=i.pos=-BigInt(1),0}return-1048576}return await this.readAVPacket_(e,t)}catch(i){return-1048576!==e.ioReader.error?(h.z3(`read packet error, ${i}`,T,848),l.LR):(this.context.ioEnded=!0,this.readAVPacket(e,t))}}async syncPSPacket(e){let t=g.Dh;try{for(this.context.pes.pts=g.Dh;this.context.pes.pts===g.Dh;)await this.readPES(e),(0,d.A)(this.context.pes),t=this.context.pes.pos}catch(e){t=g.Dh}t!==g.Dh&&await e.ioReader.seek(t)}async seek(e,t,i,r){let n=e.ioReader.getPos();if(this.context.slices.forEach((e=>{e.buffers.length&&e.pos<n&&(n=e.pos),e.buffers.length=0,e.pts=e.dts=e.pos=-BigInt(1)})),e.streams.forEach((e=>{const t=e.privData;t.filter&&t.filter.reset()})),2&r){const t=await e.ioReader.fileSize();return t<=BigInt(0)?BigInt(l.E$):(i<BigInt(0)?i=BigInt(0):i>t&&(i=t),await e.ioReader.seek(i),4&r||await this.syncPSPacket(e),this.context.ioEnded=!1,n)}{if(t&&t.sampleIndexes.length){let r=w.El(t.sampleIndexes,(e=>e.pts>i?-1:1));if(r>0&&(0,b.k)(i-t.sampleIndexes[r-1].pts,t.timeBase,g.i0)<BigInt(1e4))return h.Yz(`seek in sampleIndexes, found index: ${r}, pts: ${t.sampleIndexes[r-1].pts}, pos: ${t.sampleIndexes[r-1].pos}`,T,933),await e.ioReader.seek(t.sampleIndexes[r-1].pos),this.context.ioEnded=!1,n}h.Yz("not found any keyframe index, try to seek in bytes",T,940);let r=await(0,U.A)(e,t,i,BigInt(0),this.readAVPacket.bind(this),this.syncPSPacket.bind(this));return r>=0&&(this.context.ioEnded=!1),r}}getAnalyzeStreamsCount(){return 1}}},75294:(e,t,i)=>{i.d(t,{CM:()=>o,Vz:()=>a,qg:()=>s});var r=i(134),n=i(89088);class a{constructor(){(0,r.A)(this,"version",void 0),(0,r.A)(this,"layer",void 0),(0,r.A)(this,"protection",void 0),(0,r.A)(this,"bitrateIndex",void 0),(0,r.A)(this,"samplingFrequency",void 0),(0,r.A)(this,"padding",void 0),(0,r.A)(this,"private",void 0),(0,r.A)(this,"mode",void 0),(0,r.A)(this,"modeExtension",void 0),(0,r.A)(this,"copyright",void 0),(0,r.A)(this,"original",void 0),(0,r.A)(this,"emphasis",void 0)}}function s(e,t){e.version=t>>19&3,e.layer=t>>17&3,e.protection=t>>16&1,e.bitrateIndex=t>>12&15,e.samplingFrequency=t>>10&3,e.padding=t>>9&1,e.mode=t>>6&3,e.modeExtension=t>>4&3,e.copyright=t>>3&1,e.original=t>>2&1,e.emphasis=3&t}function o(e,t){let i=n.oz(e.version,e.layer,e.bitrateIndex);switch(e.layer){case 1:default:i=144e3*i/(t<<(3===e.version?0:1))>>>0,i+=e.padding;break;case 2:i=144e3*i/t>>>0,i+=e.padding;break;case 3:i=12e3*i/t>>>0,i=4*(i+e.padding)}return i}},51660:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(77231),n=i(4624),a=i(9705),s="src/avformat/formats/mpegts/function/parsePES.ts";function o(e){const t=e.data,i=t[3],o=t[4]<<8|t[5];let c=0,h=0,l=0;if(188!==i&&190!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i){let i=r.Dh,d=r.Dh;for(;;){if(6+h>=t.length)return;if(l=t[6+h],255!==l)break;h++}if(64==(192&l)&&(h+=2,l=t[6+h]),32==(224&l))c+=5,i=i=BigInt(Math.floor(536870912*(14&t[6+h])+4194304*(255&t[7+h])+16384*(254&t[8+h])+128*(255&t[9+h])+(254&t[10+h])/2)),16&l?(d=BigInt(Math.floor(536870912*(14&t[11+h])+4194304*(255&t[12+h])+16384*(254&t[13+h])+128*(255&t[14+h])+(254&t[15+h])/2)),c+=5):d=i;else if(128==(192&l)){const e=(192&t[7+h])>>>6;c=3+t[8+h],2!==e&&3!==e||(i=BigInt(Math.floor(536870912*(14&t[9+h])+4194304*(255&t[10+h])+16384*(254&t[11+h])+128*(255&t[12+h])+(254&t[13+h])/2)),d=3===e?BigInt(Math.floor(536870912*(14&t[14+h])+4194304*(255&t[15+h])+16384*(254&t[16+h])+128*(255&t[17+h])+(254&t[18+h])/2)):i)}else{if(15!==l)return n.z3("invalid data",s,121),a.LR;c=1}e.dts=d,e.pts=i;const f=6+h+c;let u=0;if(0!==o){if(o<h+c)return void n.z3("Malformed PES: PES_packet_length < 3 + PES_header_data_length",s,133);u=o-(h+c)}else u=t.byteLength-f;e.payload=t.subarray(f,f+u)}else if((188===i||191===i||240===i||241===i||255===i||242===i||248===i)&&6===e.streamId){const i=6;let r=0;r=0!==o?o:t.byteLength-i,e.payload=t.subarray(i,i+r)}return 0}},10662:(e,t,i)=>{i.d(t,{V:()=>r});const r=1e5},6403:(e,t,i)=>{i.d(t,{Cd:()=>l,I4:()=>u,am:()=>c,kJ:()=>f,pi:()=>h,xf:()=>p,yU:()=>d});var r=i(134),n=i(80662),a=i.n(n),s=i(77231);class o{constructor(){(0,r.A)(this,"discontinuityIndicator",0),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"elementaryStreamPriorityIndicator",0),(0,r.A)(this,"pcrFlag",0),(0,r.A)(this,"opcrFlag",0),(0,r.A)(this,"splicingPointFlag",0),(0,r.A)(this,"transportPrivateDataFlag",0),(0,r.A)(this,"adaptationFieldExtensionFlag",0),(0,r.A)(this,"pcr",BigInt(0)),(0,r.A)(this,"opcr",BigInt(0)),(0,r.A)(this,"spliceCountDown",0),(0,r.A)(this,"transportPrivateData",null),(0,r.A)(this,"extension",null)}}class c{constructor(){(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payloadUnitStartIndicator",0),(0,r.A)(this,"transportPriority",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"adaptationFieldControl",0),(0,r.A)(this,"continuityCounter",0),(0,r.A)(this,"transportScramblingControl",0),(0,r.A)(this,"adaptationFieldInfo",new o),(0,r.A)(this,"payload",null)}}class h{constructor(){(0,r.A)(this,"slices",[]),(0,r.A)(this,"totalLength",0),(0,r.A)(this,"expectedLength",s.N_),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"pos",s.Dh)}}class l{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"networkPid",s.N_),(0,r.A)(this,"program2PmtPid",new(a()))}}class d extends c{}class f{constructor(){(0,r.A)(this,"tag",void 0),(0,r.A)(this,"buffer",void 0)}}class u{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"programNumber",0),(0,r.A)(this,"pcrPid",0),(0,r.A)(this,"pid2StreamType",new(a())),(0,r.A)(this,"pid2ESDescriptor",new(a()))}}class p{constructor(){(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"streamId",s.N_),(0,r.A)(this,"dts",s.Dh),(0,r.A)(this,"pts",s.Dh),(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payload",null),(0,r.A)(this,"data",null),(0,r.A)(this,"randomAccessIndicator",0)}}},2187:(e,t,i)=>{i.d(t,{d:()=>s});var r=i(72739),n=i(44328),a=i(77231);function s(e,t,i){let s=BigInt(0);return r.__(e,(e=>{s+=e.codecpar.bitrate*(0,n.k)(t,i,a.i0)/BigInt(8e3)})),s}},52071:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(63939),n=i(9599),a=i(29170),s=i(77231),o=i(44328),c=i(2187),h=i(71517),l=i(9705),d=i(4624),f="src/avformat/function/seekInBytes.ts";async function u(e,t,i,u,p,m){const g=e.ioReader.getPos(),U=await e.ioReader.fileSize();let b=s.Dh,w=i;t.startTime!==s.Dh?w-=t.startTime:w-=t.firstDTS;const x=(0,o.k)(i,t.timeBase,s.i0);if(x<BigInt(1e4))return d.Yz(`seek pts is earlier then 10s, seek to first packet pos(${u}) directly`,f,63),await e.ioReader.seek(u),g;let y=(0,c.d)(e.streams,w,t.timeBase);const A=U-(0,c.d)(e.streams,BigInt(5e3),s.i0),_=(0,c.d)(e.streams,BigInt(1e4),s.i0);if(y>A&&(y=A),y<u)return await e.ioReader.seek(u),g;const I=(0,h._5)();let v=U,B=BigInt(0);for(;;){if(v-B<_){b=B;break}await e.ioReader.seek(y),await m(e);const t=e.ioReader.getPos();if(!(await p(e,I)>=0))break;{const e=(0,o.k)(r.f[17](I+8),(0,a.A)(I+72,n.P),s.i0),i=e-x;if(d.Yz(`try to seek to pos: ${y}, got packet pts: ${r.f[17](I+8)}(${e}ms), diff: ${i}ms`,f,98),i<=BigInt(0)&&-i<BigInt(1e4)){b=t;break}i>BigInt(0)?(v=y,y=B+v>>BigInt(1)):(B=y,y=B+v>>BigInt(1))}}return(0,h.Qe)(I),b!==s.Dh?(d.Yz(`finally seek to pos ${b}`,f,124),await e.ioReader.seek(b),await m(e),g):(await e.ioReader.seek(g),BigInt(l.E$))}},23991:(e,t,i)=>{function r(e){let t=0,i=0;for(;i<32&&0===e.readU1();)i++;return t=e.readU(i),t+=(1<<i)-1,t}function n(e){let t=r(e);return t=1&t?(t+1)/2:-t/2,t}i.d(t,{$x:()=>n,xb:()=>r})},39381:(e,t,i)=>{i.d(t,{E3:()=>a,Sg:()=>h,Y0:()=>c,ht:()=>o,r8:()=>n,yd:()=>s});var r=i(63939);function n(e){return r.f[2](e)}function a(e){return n(e+1)<<8|n(e)}function s(e){return n(e)<<8|n(e+1)}function o(e){return n(e)<<16|n(e+1)<<8|n(e+2)}function c(e){return a(e+2)<<16|a(e)}function h(e){return s(e)<<16|s(e+2)}},60264:(e,t,i)=>{function r(e){return e.length>4&&0===e[0]&&0===e[1]&&(1===e[2]||0===e[2]&&1===e[3])}function n(e,t){let i=0;for(let r=t;r<e.length;r++)switch(e[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function a(e){const t=[];let i=n(e,0),r={offset:-1,startCode:0};for(;r=n(e,i.offset+i.startCode),r.offset>-1;)t.push(e.subarray(i.offset+i.startCode,r.offset,!0)),i=r;return t.push(e.subarray(i.offset+i.startCode,void 0,!0)),t}function s(e,t=0,i){i||(i=e.length);const r=new Uint8Array(e.length);let n=0,a=0;for(let s=0;s<e.length;s++){if(s>=t&&s<i)if(0===e[s])n++;else if(3===e[s]&&2===n&&s+1<e.length&&e[s+1]<=3){if(s++,s===e.length)break;n=0===e[s]?1:0}else n=0;r[a++]=e[s]}return r.slice(0,a)}i.d(t,{BN:()=>s,Bs:()=>r,Ky:()=>n,py:()=>a})},37246:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(134),n=i(4624);class a{constructor(e=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=e,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let e=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let t=this.pointer,i=this.bitsLeft;return 0===i&&(t++,i=8),e=this.buffer[t]>>i-1&1,e}readU1(){let e=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,e=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),e}readU(e){let t=0;for(let i=0;i<e;i++)t|=this.readU1()<<e-i-1;return t}remainingLength(){return this.endPointer-this.pointer}getBitLeft(){return this.bitsLeft}getPos(){return this.pointer}backToPos(e){this.pointer=e}skip(e){const t=(e-e%8)/8;this.pointer+=t;const i=e%8;this.bitsLeft<=i?(this.pointer++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const e=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(e<0)throw this.error=e,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+e,this.pointer=0}else{const e=this.onFlush(this.buffer);if(this.endPointer=e,this.pointer=0,this.bitsLeft=8,e<0)throw this.error=e,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{const t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,n.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",198)}}clear(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}},83314:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(134);class n{constructor(e=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=e,this.error=0,this.buffer=new Uint8Array(this.size)}writeU1(e){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&e?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}writeU(e,t){for(let i=0;i<e;i++)this.writeU1(t>>e-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const e=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}clear(){this.pointer=0,this.bitPointer=0,this.error=0}getBuffer(){return this.buffer}getPointer(){return this.pointer}}},729:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(134),n=i(4624),a=i(50011);class s{constructor(e,t=!0){(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}writeUint8(e){this.data.setUint8(this.pos+++this.byteStart,e)}writeUint16(e){this.data.setUint16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeUint24(e){const t=3840&e,i=240&e,r=15&e;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(i),this.writeUint8(r))}writeUint32(e){this.data.setUint32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeUint64(e){const t=e&BigInt(4294967295),i=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(t)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(t)))}writeInt8(e){this.data.setInt8(this.pos+++this.byteStart,e)}writeInt16(e){this.data.setInt16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeInt32(e){this.data.setInt32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeInt64(e){const t=e&BigInt(4294967295),i=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(t)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(t)))}writeFloat(e){this.data.setFloat32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeDouble(e){this.data.setFloat64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}skip(e){this.seek(this.pos+e)}back(e){this.seek(this.pos-e)}remainingSize(){return this.size-this.pos}writeBuffer(e){let t=e.length;this.remainingSize()<t&&(t=this.remainingSize(),n.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${e.length}, but set ${t}`,"src/common/io/BufferWriter.ts",211)),this.buffer.set(e,this.pos),this.pos+=e.length}writeString(e){const t=a.encode(e);return this.writeBuffer(t),t.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(e,t=!0){this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}}}]);