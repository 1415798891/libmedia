"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[765],{64436:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(134),n=i(63939),s=i(37837),a=i(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,s.Gy)(168),(0,a.Yi)(this.inCodecpar,t),this.inTimeBase={den:n.f[15](e+4),num:n.f[15](e)},0}destroy(){this.inCodecpar&&((0,a.dn)(this.inCodecpar),this.inCodecpar=0)}}},26173:(t,e,i)=>{i.d(e,{A:()=>w});var r=i(134),n=i(63939),s=i(50932),a=i(64436),o=i(71517),c=i(20620),l=i(53e3),d=i(55611),h=i(14686),f=i(9705),u=i(60264),p=i(37837),m=i(4624);class w extends a.A{constructor(...t){super(...t),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0)}init(t,e){return super.init(t,e),this.cache=(0,o._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,o.Qe)(this.cache),this.cache=0}sendAVPacket(t){const e=(0,h.JW)(n.f[20](t+24),n.f[15](t+28));if(1!==n.f[15](t+80)&&(0,u.Bs)(e)){let i;if((0,o.zu)(this.cache,t),27===n.f[15](this.inCodecpar+4)||12===n.f[15](this.inCodecpar+4)?i=c.oT(e):173===n.f[15](this.inCodecpar+4)?i=l.oT(e):196===n.f[15](this.inCodecpar+4)?i=d.oT(e):m.h2(`not support for codecId: ${n.f[15](this.inCodecpar+4)}`,"src/avformat/bsf/h2645/Annexb2AvccFilter.ts",93),s.M[15](this.cache+80,1),(0,o.NX)(this.cache,i.bufferPointer,i.length),i.key&&s.M[15](this.cache+36,1|n.f[15](this.cache+36)),i.extradata){const t=(0,p.sY)(i.extradata.length);(0,h.lW)(t,i.extradata.length,i.extradata),(0,o.Ow)(this.cache,1,t,i.extradata.length)}}else(0,o.rN)(this.cache,t);return this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,o.Up)(t),(0,o.rN)(t,this.cache),this.cached=!1,0):f.LR}}},20620:(t,e,i)=>{i.d(e,{Jk:()=>A,OD:()=>v,XC:()=>y,ci:()=>I,k9:()=>g,oT:()=>S});var r=i(63939),n=i(50932),s=i(72739),a=i(729),o=i(31865),c=i(37246),l=i(4624),d=i(14686),h=i(71517),f=i(60264),u=i(37837),p=i(23991),m="src/avformat/codecs/h264.ts";const w=3,U=[{level:10,maxResolution:25344,maxFrameRate:15},{level:11,maxResolution:25344,maxFrameRate:30},{level:12,maxResolution:101376,maxFrameRate:30},{level:13,maxResolution:101376,maxFrameRate:30},{level:20,maxResolution:101376,maxFrameRate:30},{level:21,maxResolution:202752,maxFrameRate:30},{level:22,maxResolution:414720,maxFrameRate:30},{level:30,maxResolution:414720,maxFrameRate:30},{level:31,maxResolution:921600,maxFrameRate:30},{level:32,maxResolution:1310720,maxFrameRate:60},{level:40,maxResolution:2097152,maxFrameRate:30},{level:41,maxResolution:2097152,maxFrameRate:60},{level:42,maxResolution:2228224,maxFrameRate:60},{level:50,maxResolution:8912896,maxFrameRate:30},{level:51,maxResolution:8912896,maxFrameRate:60},{level:52,maxResolution:8912896,maxFrameRate:120},{level:60,maxResolution:35651584,maxFrameRate:30},{level:61,maxResolution:35651584,maxFrameRate:60},{level:62,maxResolution:35651584,maxFrameRate:120}];function g(t,e,i){const r=t*e;for(const t of U)if(r<=t.maxResolution&&i<=t.maxFrameRate)return t.level}function b(t){const e=new o.A(t);e.skip(5);const i=[],r=[],n=[],s=31&e.readUint8();for(let t=0;t<s;t++){const t=e.readUint16();i.push(e.readBuffer(t))}const a=e.readUint8();for(let t=0;t<a;t++){const t=e.readUint16();r.push(e.readBuffer(t))}if(e.remainingSize()>4){e.skip(3);const t=e.readUint8();if(t>0)for(let i=0;i<t;i++){const t=e.readUint16();n.push(e.readBuffer(t))}}return{spss:i,ppss:r,spsExts:n}}function x(t,e,i=[]){t.length>32&&(l.R8(`h264 metadata's sps max length is 32, but get ${t.length}`,m,190),t=t.slice(0,32)),t.length>256&&(l.R8(`h264 metadata's pps max length is 256, but get ${t.length}`,m,194),t=t.slice(0,256));let r=7;r=t.reduce(((t,e)=>t+2+e.length),r),r=e.reduce(((t,e)=>t+2+e.length),r);const n=t[0],o=P(n);66!==o.profile&&77!==o.profile&&88!==o.profile&&(r+=4,i.length&&(r=i.reduce(((t,e)=>t+2+e.length),r)));const c=new Uint8Array(r),d=new a.A(c);return d.writeUint8(1),d.writeUint8(n[1]),d.writeUint8(n[2]),d.writeUint8(n[3]),d.writeUint8(252|w),d.writeUint8(224|31&t.length),s.__(t,(t=>{d.writeUint16(t.length),d.writeBuffer(t)})),d.writeUint8(e.length),s.__(e,(t=>{d.writeUint16(t.length),d.writeBuffer(t)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(d.writeUint8(252|o.chromaFormatIdc),d.writeUint8(248|o.bitDepthLumaMinus8),d.writeUint8(248|o.bitDepthChromaMinus8),i.length&&s.__(i,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),c}function S(t){let e,i=(0,f.py)(t),r=!1;if(i.length>1){const t=[],r=[],n=[];i.forEach((e=>{const i=31&e[0];7===i?t.push(e):8===i?r.push(e):13===i&&n.push(e)})),t.length&&r.length&&(e=x(t,r,n)),i=i.filter((t=>{const e=31&t[0];return 9!==e&&8!==e&&7!==e&&13!==e}))}const n=i.reduce(((t,e)=>t+w+1+e.length),0),o=(0,u.sY)(n),c=(0,d.s3)(o,n),l=new a.A(c);return s.__(i,(t=>{3===w?l.writeUint32(t.length):2===w?l.writeUint24(t.length):1===w?l.writeUint16(t.length):l.writeUint8(t.length),l.writeBuffer(t.subarray(0)),5==(31&t[0])&&(r=!0)})),{bufferPointer:o,length:n,key:r,extradata:e}}function v(t,e){const i=e?3&e[4]:w;let r=[],n=[],c=[],l=!1;if(e){const t=b(e);r=t.spss,n=t.ppss,c=t.spsExts,l=!0}const h=[],f=[],p=new o.A(t);for(;p.remainingSize()>0;){let e=0;e=3===i?p.readUint32():2===i?p.readUint24():1===i?p.readUint16():p.readUint8();const r=t.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+e);p.skip(e);const n=31&r[0];6===n?f.push(r):9!==n&&h.push(r)}let m=r.reduce(((t,e)=>t+4+e.length),0);m=n.reduce(((t,e)=>t+4+e.length),m),m=c.reduce(((t,e)=>t+4+e.length),m),m=f.reduce(((t,e)=>t+4+e.length),m),m=h.reduce(((t,e,i)=>t+(i?3:4)+e.length),m);const U=(0,u.sY)(m+6),g=new a.A((0,d.s3)(U,m+6));return g.writeUint8(0),g.writeUint8(0),g.writeUint8(0),g.writeUint8(1),g.writeUint8(9),g.writeUint8(240),s.__(f,(t=>{g.writeUint8(0),g.writeUint8(0),g.writeUint8(0),g.writeUint8(1),g.writeBuffer(t)})),s.__(r,(t=>{g.writeUint8(0),g.writeUint8(0),g.writeUint8(0),g.writeUint8(1),g.writeBuffer(t)})),s.__(n,(t=>{g.writeUint8(0),g.writeUint8(0),g.writeUint8(0),g.writeUint8(1),g.writeBuffer(t)})),s.__(c,(t=>{g.writeUint8(0),g.writeUint8(0),g.writeUint8(0),g.writeUint8(1),g.writeBuffer(t)})),s.__(h,((t,e)=>{g.writeUint8(0),g.writeUint8(0),e||g.writeUint8(0),g.writeUint8(1),g.writeBuffer(t),5==(31&t[0])&&(l=!0)})),{bufferPointer:U,length:m+6,key:l}}function A(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,h.iI)(t);if((0,f.Bs)(n))return;const s=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:w;let a=[],c=[],l=[],p=[];const m=new o.A(n);for(;m.remainingSize()>0;){let t=0;t=3===s?m.readUint32():2===s?m.readUint24():1===s?m.readUint16():m.readUint8();const e=n.subarray(0|Number(0xffffffffn&m.getPos()),(0|Number(0xffffffffn&m.getPos()))+t);m.skip(t);const i=31&e[0];7===i?a.push(e):8===i?c.push(e):13===i?l.push(e):p.push(e)}if(a.length||c.length){const e=x(a,c,l),i=(0,u.sY)(e.length);(0,d.lW)(i,e.length,e),(0,h.Ow)(t,1,i,e.length)}}function I(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,h.iI)(t);if(!(0,f.Bs)(i))return;let s=(0,f.py)(i);if(s.length>1){const e=[],i=[],a=[];if(s.forEach((t=>{const r=31&t[0];7===r?e.push(t):8===r?i.push(t):13===r&&a.push(t)})),e.length&&i.length){const s=x(e,i,a),o=(0,u.sY)(s.length);(0,d.lW)(o,s.length,s),(0,h.Ow)(t,1,o,s.length),n.M[15](t+36,1|r.f[15](t+36))}}}function y(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[4];const{spss:i}=b(e);if(i.length){const{profile:e,level:r,width:n,height:s}=P(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=s}}}function P(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const i=(0,f.BN)(t.subarray(e)),r=new c.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const n=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const s=r.readU(8);p.xb(r);let a=1,o=0,l=0;if((100==n||110==n||122==n||244==n||44==n||83==n||86==n||118==n||128==n||138==n||139==n||134==n||135==n)&&(a=p.xb(r),3===a&&r.readU1(),o=p.xb(r),l=p.xb(r),r.readU1(),r.readU1())){const t=new Array(8);for(let e=0;e<(3!=a?8:12);e++)t[e]=r.readU1()}p.xb(r);const d=p.xb(r);if(0===d)p.xb(r);else if(1===d){r.readU1(),p.$x(r),p.$x(r);const t=p.xb(r);for(let e=0;e<t;e++)p.$x(r)}p.xb(r),r.readU1();const h=p.xb(r),u=p.xb(r),m=r.readU1();let w=16*(h+1),U=(2-m)*(u+1)*16;m||r.readU1(),r.readU1();const g=r.readU1();if(g){let t=1,e=2-g;1===a?(t=2,e=2*(2-g)):2===g&&(t=2,e=2-g),w-=t*(p.xb(r)+p.xb(r)),U-=e*(p.xb(r)+p.xb(r))}return{profile:n,level:s,width:w,height:U,chromaFormatIdc:a,bitDepthLumaMinus8:o,bitDepthChromaMinus8:l}}},53e3:(t,e,i)=>{i.d(e,{Jk:()=>S,OD:()=>x,XC:()=>A,ci:()=>v,k9:()=>m,oT:()=>b});var r=i(63939),n=i(50932),s=i(72739),a=i(729),o=i(31865),c=i(37246),l=i(14686),d=i(60264),h=i(71517),f=i(37837),u=i(23991);const p=[{level:10,maxLumaSamplesPerSecond:552960,maxLumaPictureSize:36864,maxBitRate:{main:128,main10:150}},{level:20,maxLumaSamplesPerSecond:3686400,maxLumaPictureSize:122880,maxBitRate:{main:1500,main10:1875}},{level:21,maxLumaSamplesPerSecond:7372800,maxLumaPictureSize:245760,maxBitRate:{main:3e3,main10:3750}},{level:30,maxLumaSamplesPerSecond:16588800,maxLumaPictureSize:552960,maxBitRate:{main:6e3,main10:7500}},{level:31,maxLumaSamplesPerSecond:33177600,maxLumaPictureSize:983040,maxBitRate:{main:1e4,main10:12500}},{level:40,maxLumaSamplesPerSecond:66846720,maxLumaPictureSize:2228224,maxBitRate:{main:12e3,main10:15e3}},{level:41,maxLumaSamplesPerSecond:133693440,maxLumaPictureSize:2228224,maxBitRate:{main:2e4,main10:25e3}},{level:50,maxLumaSamplesPerSecond:267386880,maxLumaPictureSize:8912896,maxBitRate:{main:25e3,main10:4e4}},{level:51,maxLumaSamplesPerSecond:534773760,maxLumaPictureSize:8912896,maxBitRate:{main:4e4,main10:6e4}},{level:52,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:60,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:61,maxLumaSamplesPerSecond:2139095040,maxLumaPictureSize:89128960,maxBitRate:{main:12e4,main10:24e4}},{level:62,maxLumaSamplesPerSecond:4278190080,maxLumaPictureSize:356515840,maxBitRate:{main:24e4,main10:48e4}}];function m(t,e,i,r,n){const s=1===t?"main":"main10",a=e*i*r;for(const t of p)if(a<=t.maxLumaSamplesPerSecond&&e*i<=t.maxLumaPictureSize&&n<=t.maxBitRate[s])return t.level}const w=3;function U(t){const e=new o.A(t,!0);e.skip(22);let i=[],r=[],n=[];const s=e.readUint8();for(let t=0;t<s;t++){const t=63&e.readUint8(),s=e.readUint16(),a=[];for(let t=0;t<s;t++){const t=e.readUint16();a.push(e.readBuffer(t))}32===t?i=a:33===t?r=a:34===t&&(n=a)}return{vpss:i,spss:r,ppss:n}}function g(t,e,i){const r=e[0];let n=23;t.length&&(n+=3,n=t.reduce(((t,e)=>t+2+e.length),n)),e.length&&(n+=3,n=e.reduce(((t,e)=>t+2+e.length),n)),i.length&&(n+=3,n=i.reduce(((t,e)=>t+2+e.length),n));const o=new Uint8Array(n),c=new a.A(o,!0),l=I(r);c.writeUint8(1),c.writeUint8(r[1]),c.writeUint8(r[2]),c.writeUint8(r[3]),c.writeUint8(r[4]),c.writeUint8(r[5]),c.writeUint8(r[6]),c.writeUint8(r[7]),c.writeUint8(r[8]),c.writeUint8(r[9]),c.writeUint8(r[10]),c.writeUint8(r[11]),c.writeUint8(l.level),c.writeUint8(1020),c.writeUint8(0),c.writeUint8(16320),c.writeUint8(16320|l.chromaFormatIdc),c.writeUint8(8160|l.bitDepthLumaMinus8),c.writeUint8(8160|l.bitDepthChromaMinus8),c.writeUint16(0),c.writeUint8(8|(1&r[0])<<2|w);let d=0;return t.length&&d++,e.length&&d++,i.length&&d++,c.writeUint8(d),t.length&&(c.writeUint8(160),c.writeUint16(t.length),s.__(t,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),e.length&&(c.writeUint8(161),c.writeUint16(e.length),s.__(e,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),i.length&&(c.writeUint8(162),c.writeUint16(i.length),s.__(i,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),o}function b(t){let e,i=!1,r=(0,d.py)(t);if(r.length>2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?i.push(e):34===r&&n.push(e)})),t.length&&i.length&&n.length&&(e=g(t,i,n),r=r.filter((t=>{const e=t[0]>>>1&63;return 32!==e&&33!==e&&34!==e&&35!==e})))}const n=r.reduce(((t,e)=>t+w+1+e.length),0),o=(0,f.sY)(n),c=(0,l.s3)(o,n),h=new a.A(c);return s.__(r,(t=>{3===w?h.writeUint32(t.length):2===w?h.writeUint24(t.length):1===w?h.writeUint16(t.length):h.writeUint8(t.length),h.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;19!==e&&20!==e&&21!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function x(t,e){const i=e?3&e[21]:w;let r=[],n=[],c=[],d=!1;if(e){const t=U(e);r=t.vpss,n=t.spss,c=t.ppss,d=!0}const h=[],u=new o.A(t);for(;u.remainingSize()>0;){let t=0;t=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),h.push(u.readBuffer(t))}let p=r.reduce(((t,e)=>t+4+e.length),0);p=n.reduce(((t,e)=>t+4+e.length),p),p=c.reduce(((t,e)=>t+4+e.length),p),p=h.reduce(((t,e,i)=>t+(i?3:4)+e.length),p);const m=(0,f.sY)(p+7),g=(0,l.s3)(m,p+7),b=new a.A(g);return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(70),b.writeUint8(0),b.writeUint8(240),s.__(r,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),s.__(n,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),s.__(c,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),s.__(h,((t,e)=>{b.writeUint8(0),b.writeUint8(0),e||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t);const i=t[0]>>>1&63;19!==i&&20!==i&&21!==i||(d=!0)})),{bufferPointer:m,length:p+7,key:d}}function S(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,h.iI)(t);if((0,d.Bs)(n))return;const s=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:w;let a=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let t=0;t=3===s?p.readUint32():2===s?p.readUint24():1===s?p.readUint16():p.readUint8();const e=n.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=e[0]>>>1&63;33===i?c.push(e):34===i?u.push(e):32===i&&a.push(e)}if(c.length||u.length||a.length){const e=g(a,c,u),i=(0,f.sY)(e.length);(0,l.lW)(i,e.length,e),(0,h.Ow)(t,1,i,e.length)}}function v(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,h.iI)(t);if(!(0,d.Bs)(i))return;let s=(0,d.py)(i);if(s.length>2){const e=[],i=[],a=[];if(s.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?i.push(t):34===r&&a.push(t)})),e.length&&i.length&&a.length){const s=g(e,i,a),o=(0,f.sY)(s.length);(0,l.lW)(o,s.length,s),(0,h.Ow)(t,1,o,s.length),n.M[15](t+36,1|r.f[15](t+36))}}}function A(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[21];const{spss:i}=U(e);if(i.length){const{profile:e,level:r,width:n,height:s}=I(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=s}}}function I(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,s=0,a=0,o=0,l=1,h=0,f=0,p=0,m=0;const w=(0,d.BN)(t.subarray(e)),U=new c.A(w.length);U.appendBuffer(w),U.readU1(),U.readU(6),U.readU(6),U.readU(3),U.readU(4);const g=U.readU(3);if(U.readU1(),g<=6){h=U.readU(2),f=U.readU1(),i=U.readU(5),p=U.readU(32),m=U.readU(48),r=U.readU(8);const t=new Array(6),e=new Array(6);for(let i=0;i<g;i++)t[i]=U.readU1(),e[i]=U.readU1();if(g>0)for(let t=g;t<8;t++)U.readU(2);for(let i=0;i<g;i++)t[i]&&(U.readU(2),U.readU(1),U.readU(5),U.readU(32),U.readU(1),U.readU(1),U.readU(1),U.readU(1),U.readU(44)),e[i]&&U.readU(8);u.xb(U),l=u.xb(U),3===l&&U.readU(1),n=u.xb(U),s=u.xb(U);let c=0,d=0,w=0,b=0;U.readU1()&&(c=u.xb(U),d=u.xb(U),w=u.xb(U),b=u.xb(U)),a=u.xb(U),o=u.xb(U);let x=2,S=2;0===l?x=S=0:2===l?(x=2,S=1):3===l&&(x=S=1),n-=x*(1<<a+1)*(c+d),s-=S*(1<<a+1)*(w+b)}return{profile:i,level:r,width:n,height:s,chromaFormatIdc:l,bitDepthLumaMinus8:a,bitDepthChromaMinus8:o,generalProfileSpace:h,generalTierFlag:f,generalProfileCompatibilityFlag:p,constraintFlags:m}}},55611:(t,e,i)=>{i.d(e,{Jk:()=>S,OD:()=>x,Ui:()=>y,XC:()=>A,ci:()=>v,oT:()=>b});var r=i(63939),n=i(50932),s=i(72739),a=i(729),o=i(31865),c=i(37246),l=i(14686),d=i(60264),h=i(71517),f=i(37837),u=i(23991),p=i(83314);const m=3;function w(t){const e=t.readU(9),i=t.readU(3),r=t.readU(2),n=t.readU(2),s=t.readU(3);t.readU(5),t.readU(2);const a=t.readU(6),o=t.readU(7),c=t.readU(1),l=t.readU(8),d=t.readU(1),h=t.readU(1),f=[],u=[];if(a){for(let e=0;e<a-1;e++)f[e]=t.readU(8);f[a-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let r=i-2;r>=0;--r)e|=t.readU(1)<<r;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let r=i-2;r>=0;--r)e&1<<r&&(u[r]=t.readU(8))}const p=t.readU(8),m=[];if(p)for(let e=0;e<p;e++)m.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:s,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:c,generalLevelIdc:l,ptlFrameOnlyConstraintFlag:d,ptlMultilayerEnabledFlag:h,generalConstraintInfo:f,sublayerLevelIdc:u,generalSubProfileIdc:m,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function U(t){const e=new o.A(t,!0);if(1&e.readUint8()){const i=new c.A;i.appendBuffer(t.subarray(1)),w(i),e.skip(i.getPos())}let i=[],r=[],n=[];const s=e.readUint8();for(let t=0;t<s;t++){const t=31&e.readUint8();let s=1;13!==t&&12!==t&&(s=e.readUint16());const a=[];for(let t=0;t<s;t++){const t=e.readUint16();a.push(e.readBuffer(t))}14===t?i=a:15===t?r=a:16===t&&(n=a)}return{vpss:i,spss:r,ppss:n}}function g(t,e,i){const r=e[0];let n;if(r){const t=I(r),e=new p.A;if(e.writeU(9,0),e.writeU(3,t.spsMaxSublayersMinus1+1),e.writeU(2,1),e.writeU(2,t.chromaFormatIdc),e.writeU(3,t.bitDepthMinus8),e.writeU(5,31),e.writeU(2,3),e.writeU(6,t.generalConstraintInfo.length),e.writeU(7,t.profile),e.writeU1(t.tierFlag),e.writeU(8,t.level),e.writeU1(t.ptlFrameOnlyConstraintFlag),e.writeU1(t.ptlMultilayerEnabledFlag),t.generalConstraintInfo.length){for(let i=0;i<t.generalConstraintInfo.length-1;i++)e.writeU(8,t.generalConstraintInfo[i]);e.writeU(6,t.generalConstraintInfo[t.generalConstraintInfo.length-1])}else e.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let i=0;for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)i=i<<1|t.ptlSublayerLevelPresentFlag[e];e.writeU(8,i)}for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)t.ptlSublayerLevelPresentFlag[i]&&e.writeU(8,t.sublayerLevelIdc[i]);e.writeU(8,t.generalSubProfileIdc.length);for(let i=0;i<t.generalSubProfileIdc.length;i++)e.writeU(32,t.sublayerLevelIdc[i]);e.writeU(16,t.width),e.writeU(16,t.height),e.writeU(16,0),e.padding(),n=e.getBuffer().subarray(0,e.getPointer())}let o=1+(n?n.length:0);t.length&&(o+=3,o=t.reduce(((t,e)=>t+2+e.length),o)),e.length&&(o+=3,o=e.reduce(((t,e)=>t+2+e.length),o)),i.length&&(o+=3,o=i.reduce(((t,e)=>t+2+e.length),o));const c=new Uint8Array(o),l=new a.A(c,!0);l.writeUint8(m<<1|(n?1:0)|248),n&&l.writeBuffer(n);let d=0;return t.length&&d++,e.length&&d++,i.length&&d++,l.writeUint8(d),t.length&&(l.writeUint8(142),l.writeUint16(t.length),s.__(t,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),e.length&&(l.writeUint8(143),l.writeUint16(e.length),s.__(e,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),i.length&&(l.writeUint8(144),l.writeUint16(i.length),s.__(i,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),c}function b(t){let e,i=!1,r=(0,d.py)(t);if(r.length>2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[0]>>>1&63;14===r?t.push(e):15===r?i.push(e):16===r&&n.push(e)})),t.length&&i.length&&n.length&&(e=g(t,i,n),r=r.filter((t=>{const e=t[0]>>>1&63;return 14!==e&&15!==e&&16!==e&&20!==e})))}const n=r.reduce(((t,e)=>t+m+1+e.length),0),o=(0,f.sY)(n),c=(0,l.s3)(o,n),h=new a.A(c);return s.__(r,(t=>{3===m?h.writeUint32(t.length):2===m?h.writeUint24(t.length):1===m?h.writeUint16(t.length):h.writeUint8(t.length),h.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;8!==e&&7!==e&&9!==e&&10!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function x(t,e){const i=e?e[0]>>>1&3:m;let r=[],n=[],c=[],d=!1;if(e){const t=U(e);r=t.vpss,n=t.spss,c=t.ppss,d=!0}const h=[],u=new o.A(t);for(;u.remainingSize()>0;){let t=0;t=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),h.push(u.readBuffer(t))}let p=r.reduce(((t,e)=>t+4+e.length),0);p=n.reduce(((t,e)=>t+4+e.length),p),p=c.reduce(((t,e)=>t+4+e.length),p),p=h.reduce(((t,e,i)=>t+(i?3:4)+e.length),p);const w=(0,f.sY)(p+7),g=(0,l.s3)(w,p+7),b=new a.A(g);return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(0),b.writeUint8(160),b.writeUint8(240),s.__(r,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),s.__(n,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),s.__(c,(t=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t)})),s.__(h,((t,e)=>{b.writeUint8(0),b.writeUint8(0),e||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(t);const i=t[0]>>>1&63;8!==i&&7!==i&&9!==i&&10!==i||(d=!0)})),{bufferPointer:w,length:p+7,key:d}}function S(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,h.iI)(t);if((0,d.Bs)(n))return;const s=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:m;let a=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let t=0;t=3===s?p.readUint32():2===s?p.readUint24():1===s?p.readUint16():p.readUint8();const e=n.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=e[0]>>>1&63;15===i?c.push(e):16===i?u.push(e):14===i&&a.push(e)}if(c.length||u.length||a.length){const e=g(a,c,u),i=(0,f.sY)(e.length);(0,l.lW)(i,e.length,e),(0,h.Ow)(t,1,i,e.length)}}function v(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,h.iI)(t);if(!(0,d.Bs)(i))return;let s=(0,d.py)(i);if(s.length>2){const e=[],i=[],a=[];if(s.forEach((t=>{const r=t[0]>>>1&63;14===r?e.push(t):15===r?i.push(t):16===r&&a.push(t)})),e.length&&i.length&&a.length){const s=g(e,i,a),o=(0,f.sY)(s.length);(0,l.lW)(o,s.length,s),(0,h.Ow)(t,1,o,s.length),n.M[15](t+36,1|r.f[15](t+36))}}}function A(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=e[0]>>>1&3;const{spss:i}=U(e);if(i.length){const{profile:e,level:r,width:n,height:s}=I(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=s}}}function I(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,s=0,a=0,o=1,l=0,h=0,f=0;const p=[],m=[],w=[],U=[],g=(0,d.BN)(t.subarray(e)),b=new c.A(g.length);b.appendBuffer(g),b.readU1(),b.readU1(),b.readU(6),b.readU(5),b.readU(3),b.readU(8);const x=b.readU(3);o=b.readU(2);const S=b.readU(2);if(b.readU(1)){if(i=b.readU(7),l=b.readU(1),r=b.readU(8),h=b.readU(1),f=b.readU(1),b.readU(1)){for(let t=0;t<8;t++)p[t]=b.readU(8);p[8]=b.readU(7);const t=b.readU(8);b.readU(t)}b.skipPadding();for(let t=x-1;t>=0;t--)m[t]=b.readU(1);b.skipPadding();for(let t=x-1;t>=0;t--)m[t]&&(w[t]=b.readU(8));const t=b.readU(8);if(t)for(let e=0;e<t;e++)U[e]=b.readU(32)}b.readU1(),b.readU1()&&b.readU1();const v=n=u.xb(b),A=s=u.xb(b);if(b.readU1()&&(u.xb(b),u.xb(b),u.xb(b),u.xb(b)),b.readU1()){const t=u.xb(b),e=S+5,i=1<<e,r=v/(1<<e),n=A/(1<<e),s=Math.ceil(Math.log2(r)),a=Math.ceil(Math.log2(n));let o=0,c=0,l=0;t>0&&(l=b.readU1(),c=b.readU1());for(let e=0;t>0&&e<=t;e++)c&&0!=e||(e>0&&v>i&&b.readU(s),e>0&&A>i&&b.readU(a),e<t&&v>i&&b.readU(s),e<t&&A>i&&b.readU(a)),l||b.readU(2);if(o=u.xb(b)+1,b.readU(1)&&b.readU(1))for(let e=0;e<=t;e++)b.readU(o)}return a=u.xb(b),{profile:i,level:r,width:n,height:s,chromaFormatIdc:o,bitDepthMinus8:a,generalProfileSpace:0,tierFlag:l,generalConstraintInfo:p,generalSubProfileIdc:U,ptlFrameOnlyConstraintFlag:h,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:x,ptlSublayerLevelPresentFlag:m,sublayerLevelIdc:w}}function y(t){const e=new c.A;return e.appendBuffer(t),1&e.readU(8)?w(e):{}}},51597:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(){(0,r.A)(this,"type",-1)}destroy(t){}}},69765:(t,e,i)=>{i.r(e),i.d(e,{default:()=>k});var r=i(134),n=i(61499),s=i(63939),a=i(9599),o=i(29170),c=i(51597),l=i(9690),d=i(65977),h=i(75473),f=i(38106),u=i(3384),p=i(35336),m=i(72739),w=i(4624),U=i(92647),g=i(79804),b=i(77231),x=i(95335),S=i(20841),v=i(59989),A=i(44328),I=i(71517),y=i(26173),P="src/avformat/formats/OMovFormat.ts";const B={fragmentMode:0,movMode:0,fragment:!1,fastOpen:!1,defaultBaseIsMoof:!1};class k extends c.A{constructor(t={}){super(),(0,r.A)(this,"type",1),(0,r.A)(this,"context",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"annexb2AvccFilter",void 0),this.options=x.X$({},B,t),this.context=(0,l.A)()}init(t){t.ioWriter.setEndian(!0);const e=t.getStreamByMediaType(0);return e&&(this.annexb2AvccFilter=new y.A,this.annexb2AvccFilter.init(e.codecpar[n.o9],e.timeBase[n.o9])),0}destroy(t){super.destroy(t),this.annexb2AvccFilter&&(this.annexb2AvccFilter.destroy(),this.annexb2AvccFilter=null)}enableStreams(t){const e=[],i=[];for(let t=0;t<5;t++)e[t]=0,i[t]=-1;m.__(t.streams,((t,r)=>{if(-1===t.codecpar.codecType||t.codecpar.codecType>=5)return!0;i[t.codecpar.codecType]<0&&(i[t.codecpar.codecType]=r),1&t.disposition&&(e[t.codecpar.codecType]++,t.privData.flags|=1)}));for(let r=0;r<5;r++)switch(r){case 0:case 1:case 3:e[r]>1&&(t.streams[e[r]].privData.perStreamGrouping=!0),!e[r]&&i[r]>=0&&(t.streams[i[r]].privData.flags|=1)}}writeHeader(t){if(this.context.majorBrand=(0,d.A)("isom"),this.context.minorVersion=512,this.context.compatibleBrand=[(0,d.A)("isom")],this.context.timescale=1e3,this.options.fragment&&(this.context.compatibleBrand.push((0,d.A)("iso6")),this.context.fragment=!0),1===this.options.movMode&&(this.context.isom=!0,this.context.majorBrand=(0,d.A)("qt  "),this.context.compatibleBrand=[this.context.majorBrand]),1!==this.options.movMode){this.context.compatibleBrand.push((0,d.A)("iso2"));const e=t.getStreamByMediaType(0);e&&27===e.codecpar.codecId&&this.context.compatibleBrand.push((0,d.A)("avc1")),this.context.compatibleBrand.push((0,d.A)("mp41"))}if(h.l7(t.ioWriter,this.context),this.context.holdMoovPos=t.ioWriter.getPos(),this.options.fragment)this.context.currentFragment={pos:BigInt(0),currentTrack:null,sequence:1,tracks:[],size:0,firstWrote:!1},m.__(t.streams,((t,e)=>{const i=(0,f.A)();t.privData=i,i.chunkOffsets=[],i.cttsSampleCounts=[],i.cttsSampleOffsets=[],i.stscFirstChunk=[],i.stscSamplesPerChunk=[],i.stscSampleDescriptionIndex=[],i.stssSampleNumbers=[],i.sampleSizes=[],i.sttsSampleCounts=[],i.sttsSampleDeltas=[],i.alternateGroup=e;const r=(0,u.A)();r.baseIsMoof=this.options.defaultBaseIsMoof,r.streamIndex=t.index,r.trackId=this.context.nextTrackId++,i.trackId=r.trackId,r.ioWriter=new p.A,r.ioWriter.onFlush=t=>(r.buffers.push(t.slice()),0),this.context.currentFragment.tracks.push(r)})),this.enableStreams(t),h.dI(t.ioWriter,t,this.context),t.ioWriter.flush();else{m.__(t.streams,((t,e)=>{const i=(0,f.A)();t.privData=i,i.trackId=this.context.nextTrackId++,i.chunkOffsets=[],i.cttsSampleCounts=[],i.cttsSampleOffsets=[],i.stscFirstChunk=[],i.stscSamplesPerChunk=[],i.stscSampleDescriptionIndex=[],i.stssSampleNumbers=[],i.sampleSizes=[],i.sttsSampleCounts=[],i.sttsSampleDeltas=[],i.alternateGroup=e})),this.enableStreams(t);const e=t.ioWriter.getPos();t.ioWriter.writeUint32(0),t.ioWriter.writeUint32((0,d.A)("mdat")),this.context.boxsPositionInfo.push({pos:e,type:"mdat",size:0})}return 0}updateCurrentChunk(t){let e=this.context.currentChunk;if(!e.sampleCount)return;const i=t.streams.find((t=>t.index===e.streamIndex)).privData;i.chunkCount++,i.chunkOffsets.push(e.pos),i.stscFirstChunk.length?i.lastStscCount!==e.sampleCount&&(i.stscFirstChunk.push(i.chunkCount),i.stscSamplesPerChunk.push(e.sampleCount),i.stscSampleDescriptionIndex.push(1),i.lastStscCount=e.sampleCount):(i.stscFirstChunk.push(i.chunkCount),i.stscSamplesPerChunk.push(e.sampleCount),i.stscSampleDescriptionIndex.push(1),i.lastStscCount=e.sampleCount)}checkMdat(t,e){const i=this.context.boxsPositionInfo[this.context.boxsPositionInfo.length-1];if("mdat"!==i.type)return void w.z3("last box is not mdat",P,298);const r=t.ioWriter.getPos(),n=Number(r-i.pos);n+e>b.f7&&(i.size=n,t.ioWriter.writeUint32(0),t.ioWriter.writeUint32((0,d.A)("mdat")),this.context.boxsPositionInfo.push({pos:r,type:"mdat",size:0}))}updateCurrentFragment(t,e){if(this.context.currentFragment.firstWrote){m.__(this.context.currentFragment.tracks,(i=>{const r=t.streams.find((t=>t.index===i.streamIndex));if(!i.sampleCount||!r)return!0;const n=r.privData;var s;i.baseDataOffset=t.ioWriter.getPos(),i.sampleDurations.length?e&&i.sampleDurations.length===i.sampleSizes.length-1&&i.sampleDurations.push(Number(e-n.lastDts)):1===r.codecpar.codecType?e?i.sampleDurations.push(Number(e-n.lastDts)):r.codecpar.frameSize>0?i.sampleDurations.push(Number((0,A.k)(BigInt(r.codecpar.frameSize/r.codecpar.sampleRate*b.SF),b.KR,r.timeBase))):(r.codecpar.codecId,i.sampleDurations.push(Number((0,A.k)(BigInt(1024/r.codecpar.sampleRate*b.SF),b.KR,r.timeBase)))):0===r.codecpar.codecType?e?i.sampleDurations.push(Number(e-n.lastDts)):(0,A.lb)(r.codecpar.framerate)>0?i.sampleDurations.push(Number((0,A.k)(BigInt(Math.floor(1/(0,A.lb)(r.codecpar.framerate)*b.SF)),b.KR,r.timeBase))):i.sampleDurations.push(r.timeBase.den/(30*r.timeBase.num)>>>0):i.sampleDurations.push(0),n.lastDuration=i.sampleDurations[i.sampleSizes.length-1],(1===i.sampleFlags.length||(0,v.A)(i.sampleFlags,1))&&(i.firstSampleFlags=i.sampleFlags[0],i.defaultSampleFlags=null!==(s=i.sampleFlags[1])&&void 0!==s?s:i.firstSampleFlags,i.sampleFlags=[]),(1===i.sampleSizes.length||(0,v.A)(i.sampleSizes))&&(i.defaultSampleSize=i.sampleSizes[0],i.sampleSizes=[]),(1===i.sampleDurations.length||(0,v.A)(i.sampleDurations))&&(i.defaultSampleDuration=i.sampleDurations[0],i.sampleDurations=[]),1===r.codecpar.codecType?i.defaultSampleFlags=33554432:i.sampleFlags.length&&(i.defaultSampleFlags=i.sampleFlags[0]),i.sampleSizes.length&&(i.defaultSampleSize=i.sampleSizes[0]),i.sampleDurations.length&&(i.defaultSampleDuration=i.sampleDurations[0])})),t.ioWriter.flush(),h.Ro(t.ioWriter,t,this.context);let i=this.context.currentFragment.size+8;const r=[];let n=8;m.__(this.context.currentFragment.tracks,(e=>{if(!e.sampleCount)return!0;e.ioWriter.flush();const s=(0,U.A)(Uint8Array,e.buffers);e.dataOffset=i,i+=s.length,n+=s.length,r.push(s),(0,S.A)(t.ioWriter,e.dataOffsetPos,e.dataOffset,"int32"),e.buffers=[],e.sampleFlags=[],e.sampleSizes=[],e.sampleDurations=[],e.sampleCompositionTimeOffset=[],e.sampleCount=0,e.firstSampleFlags=0})),t.ioWriter.writeUint32(n),t.ioWriter.writeUint32((0,d.A)("mdat")),m.__(r,(e=>{t.ioWriter.writeBuffer(e)})),(0,g.A)(t.ioWriter,this.context),t.ioWriter.flush(),this.context.currentFragment.firstWrote=!1,this.context.currentFragment.sequence++}}writeAVPacket(t,e){if(!s.f[15](e+28))return w.R8(`packet's size is 0: ${s.f[15](e+32)}, ignore it`,P,465),0;const i=t.getStreamByIndex(s.f[15](e+32));if(!i)return void w.R8(`can not found the stream width the avpacket's streamIndex: ${s.f[15](e+32)}, ignore it`,P,472);const r=i.privData,n=(0,A.k)(s.f[17](e+16),(0,o.A)(e+72,a.P),i.timeBase),c=(0,A.k)(s.f[17](e+8)<BigInt(0)?s.f[17](e+16):s.f[17](e+8),(0,o.A)(e+72,a.P),i.timeBase);if(27!==i.codecpar.codecId&&12!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||1===s.f[15](e+80)||(this.annexb2AvccFilter.sendAVPacket(e),this.annexb2AvccFilter.receiveAVPacket(e)),this.context.fragment){const l=this.context.currentFragment.tracks.find((t=>t.streamIndex===s.f[15](e+32)));if(l){if((0===this.options.fragmentMode&&0===i.codecpar.codecType&&1&s.f[15](e+36)||1===this.options.fragmentMode)&&(1===this.context.currentFragment.tracks.length?this.updateCurrentFragment(t,n):this.updateCurrentFragment(t)),l.ioWriter.writeBuffer((0,I.iI)(e)),l.sampleSizes.length||(l.baseMediaDecodeTime=n),l.sampleSizes.length&&(!l.sampleDurations[l.sampleSizes.length-1]||l.sampleDurations[l.sampleSizes.length-1]<=0)&&(l.sampleDurations[l.sampleSizes.length-1]=Number(n-r.lastDts)),s.f[17](e+48)>0&&l.sampleDurations.push(Number((0,A.k)(s.f[17](e+48),(0,o.A)(e+72,a.P),i.timeBase))),l.sampleSizes.push(s.f[15](e+28)),0===i.codecpar.codecType){let t=0;1&s.f[15](e+36)?t|=33554432:t|=16842752,l.sampleCompositionTimeOffset.push(Number((c||n)-n)),l.sampleFlags.push(t)}l.sampleCount++,r.lastPts=c>r.lastPts?c:r.lastPts,r.lastDts=n,this.context.currentFragment.firstWrote=!0}else w.R8(`can not found track width streamIndex ${s.f[15](e+32)}, ignore it`,P,552)}else{this.checkMdat(t,s.f[15](e+28));const a=t.ioWriter.getPos();let o=this.context.currentChunk;if(o?o.streamIndex!==s.f[15](e+32)?(this.updateCurrentChunk(t),o.streamIndex=s.f[15](e+32),o.sampleCount=1,o.pos=a):o.sampleCount++:o=this.context.currentChunk={pos:a,streamIndex:s.f[15](e+32),sampleCount:1},t.ioWriter.writeBuffer((0,I.iI)(e)),r.sampleSizes.push(s.f[15](e+28)),0===i.codecpar.codecType&&1&s.f[15](e+36)&&r.stssSampleNumbers.push(r.sampleSizes.length),r.firstWrote){const t=Number(n-r.lastDts);r.sttsSampleCounts.length&&r.sttsSampleDeltas[r.sttsSampleDeltas.length-1]===t?r.sttsSampleCounts[r.sttsSampleCounts.length-1]++:(r.sttsSampleCounts.push(1),r.sttsSampleDeltas.push(t))}else r.startDts=n,r.startCT=Number((c||n)-n),r.firstWrote=!0;if(0===i.codecpar.codecType){const t=Number((c||n)-n);r.cttsSampleCounts.length&&r.cttsSampleOffsets[r.cttsSampleOffsets.length-1]===t?r.cttsSampleCounts[r.cttsSampleCounts.length-1]++:(r.cttsSampleCounts.push(1),r.cttsSampleOffsets.push(t))}r.lastPts=(c||n)>r.lastPts?c||n:r.lastPts,r.lastDts=n}return 0}writeTrailer(t){if(this.context.fragment)m.__(this.context.currentFragment.tracks,(e=>{const i=t.streams.find((t=>t.index===e.streamIndex)).privData;e.sampleCount&&(e.sampleDurations.length?e.sampleDurations.push(e.sampleDurations[e.sampleDurations.length-1]):e.sampleDurations=[i.lastDuration])})),this.updateCurrentFragment(t),t.ioWriter.writeUint32(8),t.ioWriter.writeString("mfra"),t.ioWriter.flush();else{this.updateCurrentChunk(t);let e,i=BigInt(0);m.__(t.streams,(t=>{const r=t.privData;r.sampleSizes.length&&(r.sttsSampleDeltas.length?r.sttsSampleCounts[r.sttsSampleCounts.length-1]++:(r.sttsSampleCounts=[1],r.sttsSampleDeltas=[0])),r.lastPts>i&&(i=r.lastPts,e=t.timeBase)})),i&&(this.context.duration=(0,A.k)(i,e,{den:1e3,num:1}));const r=this.context.boxsPositionInfo[this.context.boxsPositionInfo.length-1];if("mdat"!==r.type&&w.z3("last box is not mdat",P,668),r.size=Number(t.ioWriter.getPos()-r.pos),(0,g.A)(t.ioWriter,this.context),this.options.fastOpen){t.ioWriter.flush();let e=[];const i=t.ioWriter.onFlush;t.ioWriter.onFlush=t=>(e.push(t.slice()),0),h.dI(t.ioWriter,t,this.context),t.ioWriter.flush();let r=(0,U.A)(Uint8Array,e);m.__(t.streams,(t=>{const e=t.privData;if(e.chunkOffsets.length)for(let t=0;t<e.chunkOffsets.length;t++)e.chunkOffsets[t]+=BigInt(Math.floor(r.length))})),e=[],h.dI(t.ioWriter,t,this.context),t.ioWriter.flush(),r=(0,U.A)(Uint8Array,e),i&&i(r,this.context.holdMoovPos),t.ioWriter.onFlush=i}else h.dI(t.ioWriter,t,this.context),t.ioWriter.flush()}return 0}flush(t){return this.options.fragment&&(m.__(this.context.currentFragment.tracks,(e=>{const i=t.streams.find((t=>t.index===e.streamIndex)).privData;e.sampleCount&&(e.sampleDurations.length?e.sampleDurations.push(e.sampleDurations[e.sampleDurations.length-1]):e.sampleDurations=[i.lastDuration])})),this.updateCurrentFragment(t)),t.ioWriter.flush(),0}}},21071:(t,e,i)=>{i.d(e,{_l:()=>r,gQ:()=>n});const r=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],n=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco"]},3384:(t,e,i)=>{function r(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[]}}i.d(e,{A:()=>r})},9690:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(77231);function n(){return{isom:!1,timescale:r.N_,duration:r.Dh,foundMoov:!1,foundMdat:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:r.N_,volume:r.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},38106:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(77231);function n(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,timescale:0,duration:BigInt(0),trackId:r.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],fragIndexes:[],lastPts:BigInt(0),lastDts:BigInt(0),startDts:BigInt(0),startCT:0,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},79804:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(72739);function n(t,e){const i=t.getPos(),n=t.getPointer(),s=i-BigInt(Math.floor(n)),a=[];r.__(e.boxsPositionInfo,(e=>{e.pos<i&&e.pos>=s?(t.seekInline(n+Number(e.pos-i)),t.writeUint32(e.size)):a.push(e)})),r.__(a,(e=>{t.seek(e.pos),t.writeUint32(e.size)})),a.length?t.seek(i):t.seekInline(n),e.boxsPositionInfo=[]}},14202:(t,e,i)=>{i.d(e,{BB:()=>n,Ip:()=>s,Jl:()=>r});const r={1:function(t){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"smhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]},0:function(t){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"vmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]}},n={1:function(t){return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"smhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]},0:function(t){return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"vmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stss"},{type:"ctts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]}},s=[{type:"tfhd"},{type:"tfdt"},{type:"trun"}]},6660:(t,e,i)=>{i.d(e,{Q9:()=>s,f3:()=>a,uf:()=>o,zs:()=>n});var r=i(65977);const n={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},s={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},a={vide:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,r.A)("mp4a")]:86018,1836253269:86017,[(0,r.A)("Opus")]:86076,[(0,r.A)("fLaC")]:86028,[(0,r.A)("spex")]:86051,[(0,r.A)("SPXN")]:86051,[(0,r.A)("ac-3")]:86019,[(0,r.A)("sac3")]:86019,[r.A.mp4v]:12,[(0,r.A)("av01")]:225,[(0,r.A)("vp08")]:139,[(0,r.A)("vp09")]:167,[(0,r.A)("avc1")]:27,[(0,r.A)("hev1")]:173,[(0,r.A)("hvc1")]:173,[(0,r.A)("vvc1")]:196,[(0,r.A)("vvi1")]:196,[(0,r.A)("text")]:94213,[(0,r.A)("tx3g")]:94213}},75473:(t,e,i)=>{i.d(e,{Ro:()=>f,dI:()=>h,l7:()=>l});var r=i(65977),n=i(21071),s=i(72739),a=i(80025),o=i(14202),c=i(79804);function l(t,e){t.flush();const i=t.getPointer(),n=t.getPos();t.writeUint32(0),t.writeUint32((0,r.A)("ftyp")),t.writeUint32(e.majorBrand||(0,r.A)("isom")),t.writeUint32(e.minorVersion||512),s.__(e.compatibleBrand,(e=>{t.writeUint32(e)})),function(t,e,i){const r=t.getPointer();t.seekInline(e),t.writeUint32(i),t.seekInline(r)}(t,i,Number(t.getPos()-n)),e.isom?(t.writeUint32(8),t.writeUint32((0,r.A)("wide"))):e.fragment||(t.writeUint32(8),t.writeUint32((0,r.A)("free")))}function d(t,e,i,o){s.__(e,(e=>{if(!e)return!0;if(a.A[e.type])a.A[e.type](t,i,o);else if(e.children){const n=t.getPos();t.writeUint32(0),t.writeUint32((0,r.A)(e.type)),d(t,e.children,i,o),o.boxsPositionInfo.push({pos:n,type:e.type,size:Number(t.getPos()-n)})}else!function(t,e){const i=s.zy(n._l,e);t.writeUint32(i?12:8),t.writeUint32((0,r.A)(e)),i&&t.writeUint32(0)}(t,e.type)}))}function h(t,e,i){const n=t.getPos();if(t.writeUint32(0),t.writeUint32((0,r.A)("moov")),a.A.mvhd(t,null,i),s.__(e.streams,(e=>{const n=t.getPos();t.writeUint32(0),t.writeUint32((0,r.A)("trak")),d(t,i.fragment?o.Jl[e.codecpar.codecType](i):o.BB[e.codecpar.codecType](i),e,i),i.boxsPositionInfo.push({pos:n,type:"trak",size:Number(t.getPos()-n)})})),i.fragment){const n=t.getPos();t.writeUint32(0),t.writeUint32((0,r.A)("mvex")),s.__(e.streams,(e=>{a.A.trex(t,e,i)})),i.boxsPositionInfo.push({pos:n,type:"mvex",size:Number(t.getPos()-n)})}i.boxsPositionInfo.push({pos:n,type:"moov",size:Number(t.getPos()-n)}),(0,c.A)(t,i)}function f(t,e,i){const n=t.getPos();t.writeUint32(0),t.writeUint32((0,r.A)("moof")),a.A.mfhd(t,null,i),s.__(i.currentFragment.tracks,(n=>{if(!n.sampleCount)return!0;const s=t.getPos();t.writeUint32(0),t.writeUint32((0,r.A)("traf"));const a=e.streams.find((t=>t.privData.trackId===n.trackId));d(t,o.Ip,a,i),i.boxsPositionInfo.push({pos:s,type:"traf",size:Number(t.getPos()-s)})}));const c=Number(t.getPos()-n);i.boxsPositionInfo.push({pos:n,type:"moof",size:c}),i.currentFragment.size=c}},39878:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(14686);function n(t,e,i){var n;t.writeUint32(null!==(n=8+e.codecpar.extradataSize)&&void 0!==n?n:0),t.writeString("av1C"),i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},61600:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(14686);function n(t,e,i){var n;t.writeUint32(null!==(n=8+e.codecpar.extradataSize)&&void 0!==n?n:0),t.writeString("avcC"),i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},93861:(t,e,i)=>{function r(t,e,i){t.writeUint32(20),t.writeString("btrt"),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0)}i.d(e,{A:()=>r})},34445:(t,e,i)=>{function r(t,e,i){const r=e.privData.chunkOffsets||[];t.writeUint32(8+8*r.length),t.writeString("co64"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint64(r[e])}i.d(e,{A:()=>r})},853:(t,e,i)=>{function r(t,e,i){const r=e.sideData[28];if(r)t.writeUint32(12+r.length),t.writeString("colr"),t.writeString("prof"),t.writeBuffer(r);else{const i=2===e.codecpar.colorRange;t.writeUint32(19),t.writeString("colr"),t.writeString("nclx"),t.writeUint16(e.codecpar.colorPrimaries),t.writeUint16(e.codecpar.colorTrc),t.writeUint16(e.codecpar.colorSpace),t.writeUint8(i?128:0)}}i.d(e,{A:()=>r})},18387:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(4624),n="src/avformat/formats/mov/writing/ctts.ts";function s(t,e,i){const s=e.privData,a=s.cttsSampleCounts||[],o=s.cttsSampleOffsets||[];a.length!==o.length&&r.R8("ctts sampleCounts's length is not match sampleOffsets's length",n,39);const c=Math.min(a.length,o.length);t.writeUint32(16+8*c),t.writeString("ctts"),t.writeUint8(1),t.writeUint24(0),t.writeUint32(c);for(let e=0;e<c;e++)t.writeUint32(a[e]),t.writeInt32(o[e])}},47280:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(14686),n=i(4624),s="src/avformat/formats/mov/writing/dfla.ts";function a(t,e,i){let a;i.fragment&&e.sideData[1]?(a=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(a=(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),a?(t.writeUint32(a.length+16),t.writeString("dfLa"),t.writeUint8(0),t.writeUint24(0),t.writeUint8(128),t.writeUint24(a.length),t.writeBuffer(a)):n.z3("invalid extradata",s,56)}},82181:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(14686),n=i(31865);function s(t,e,i){let s;if(i.fragment&&e.sideData[1]?(s=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(s=(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),!s||s.length<19)t.writeUint32(19),t.writeString("dOps"),t.writeUint8(0),t.writeUint8(e.codecpar.chLayout.nbChannels),t.writeUint16(e.codecpar.initialPadding),t.writeUint32(e.codecpar.sampleRate),t.writeUint16(0),t.writeUint8(0);else{const e=new n.A(s,!1);t.writeUint32(s.length),t.writeString("dOps"),t.writeUint8(0),e.seek(9),t.writeUint8(e.readUint8()),t.writeUint16(e.readUint16()),t.writeUint32(e.readUint32()),t.writeUint16(e.readUint16()),t.writeBuffer(s.subarray(18))}}},12412:(t,e,i)=>{function r(t,e,i){t.writeUint32(28),t.writeString("dref"),t.writeUint32(0),t.writeUint32(1),t.writeUint32(12),t.writeString("url "),t.writeUint32(1)}i.d(e,{A:()=>r})},44473:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(77231),n=i(44328);function s(t,e,i){const s=e.privData;let a=(0,n.k)(s.lastPts,e.timeBase,{den:i.timescale,num:1}),o=s.startCT;const c=(0,n.k)(s.startDts+BigInt(Math.floor(o)),e.timeBase,{den:s.timescale,num:1});let l=a<r.go?0:1;l|=c<r.go?0:1;const d=1+(c>0?1:0),h=24+d*(1===l?20:12);t.writeUint32(h),t.writeString("edts"),t.writeUint32(h-8),t.writeString("elst"),t.writeUint8(l),t.writeUint24(0),t.writeUint32(d),c>0?(1===l?(t.writeUint64(c),t.writeInt64(r.Dh)):(t.writeUint32(Number(c)),t.writeInt32(-1)),t.writeUint32(65536)):(o=-Math.min(Number(s.startDts),0),a+=c),i.fragment&&(a=BigInt(0)),1===l?(t.writeUint64(a),t.writeInt64(BigInt(Math.floor(o)))):(t.writeUint32(Number(a)),t.writeInt32(o)),t.writeUint32(65536)}},4652:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(6660),n=i(14686);function s(t,e,i){t.writeUint8(e);for(let e=3;e>0;e--)t.writeUint8(i>>7*e|128);t.writeUint8(127&i)}function a(t,e,i){const a=e.privData,o=e.codecpar.extradata?5+e.codecpar.extradataSize:0,c=t.getPos();t.writeUint32(0),t.writeString("esds"),t.writeUint32(0),s(t,3,21+o+5+1),t.writeUint16(a.trackId),t.writeUint8(0),s(t,4,13+o),(86016===e.codecpar.codecId||86017===e.codecpar.codecId)&&e.codecpar.sampleRate>24e3?t.writeUint8(107):t.writeUint8(r.zs[e.codecpar.codecId]),94208===e.codecpar.codecId?t.writeUint8(225):1===e.codecpar.codecType?t.writeUint8(21):t.writeUint8(17),t.writeUint24(0),t.writeUint32(0),t.writeUint32(0),e.codecpar.extradata&&(s(t,5,e.codecpar.extradataSize),t.writeBuffer((0,n.s3)(e.codecpar.extradata,e.codecpar.extradataSize))),s(t,6,1),t.writeUint8(2),i.boxsPositionInfo.push({pos:c,type:"esds",size:Number(t.getPos()-c)})}},87384:(t,e,i)=>{function r(t,e,i,r,n,s,a){t.writeUint32(e<<16),t.writeUint32(i<<16),t.writeUint32(0),t.writeUint32(r<<16),t.writeUint32(n<<16),t.writeUint32(0),t.writeUint32(s<<16),t.writeUint32(a<<16),t.writeUint32(1073741824)}i.d(e,{A:()=>r})},17923:(t,e,i)=>{function r(t,e,i){const r=t.getPos();t.writeUint32(0),t.writeString("hdlr"),t.writeUint8(0),t.writeUint24(0);let n="dhlr",s="url ",a="DataHandler";e&&(n="mhlr",1===e.codecpar.codecType?(s="soun",a="SoundHandler"):0===e.codecpar.codecType?(s="vide",a="VideoHandler"):3===e.codecpar.codecType?(s="text",a="SubtitleHandler"):(e.metadata.handlerName&&(a=e.metadata.handlerName),e.metadata.hdlrType&&(s=e.metadata.hdlrType))),t.writeString(n),t.writeString(s),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),e&&!i.isom||t.writeUint8(a.length),t.writeString(a),e&&!i.isom&&t.writeUint8(0),i.boxsPositionInfo.push({pos:r,type:"hdlr",size:Number(t.getPos()-r)})}i.d(e,{A:()=>r})},78669:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(14686);function n(t,e,i){var n;t.writeUint32(null!==(n=8+e.codecpar.extradataSize)&&void 0!==n?n:0),t.writeString("hvcC"),i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},6e3:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(77231);function n(t,e,i){const n=e.privData.lastPts,s=e.metadata.creationTime||0,a=e.metadata.modificationTime||0,o=e.metadata.language||21956;let c=n<BigInt(r.f7)?0:1;c=s<r.f7?0:1,c=a<r.f7?0:1,t.writeUint32(1===c?44:32),t.writeString("mdhd"),t.writeUint8(c),t.writeUint24(0),1===c?(t.writeUint64(s),t.writeUint64(a)):(t.writeUint32(Number(s)),t.writeUint32(Number(a))),t.writeUint32(e.timeBase.den),1===c?t.writeUint64(n):t.writeUint32(Number(n)),t.writeUint16(o),t.writeUint16(0)}},31130:(t,e,i)=>{function r(t,e,i){t.writeUint32(16),t.writeString("mfhd"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(i.currentFragment.sequence)}i.d(e,{A:()=>r})},48669:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(17923);function n(t,e,i){(0,r.A)(t,null,i)}},7114:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(77231),n=i(87384);function s(t,e,i){const s=i.duration,a=i.creationTime||0,o=i.modificationTime||0,c=i.timescale||0;let l=i.nextTrackId||1;i.fragment&&(l=2);let d=s<BigInt(r.f7)?0:1;d=a<r.f7?0:1,d=o<r.f7?0:1,t.writeUint32(1===d?120:108),t.writeString("mvhd"),t.writeUint8(d),t.writeUint24(0),1===d?(t.writeUint64(a),t.writeUint64(o)):(t.writeUint32(Number(a)),t.writeUint32(Number(o))),t.writeUint32(c),1===d?t.writeUint64(s):t.writeUint32(Number(s)),t.writeUint32(65536),t.writeUint16(256),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),(0,n.A)(t,1,0,0,1,0,0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(l)}},65629:(t,e,i)=>{function r(t,e,i){t.writeUint32(16),t.writeString("pasp"),t.writeUint32(1),t.writeUint32(1)}i.d(e,{A:()=>r})},11573:(t,e,i)=>{function r(t,e,i){t.writeUint32(16),t.writeString("smhd"),t.writeUint32(0),t.writeUint16(0),t.writeUint16(0)}i.d(e,{A:()=>r})},2204:(t,e,i)=>{function r(t,e,i){const r=e.privData.chunkOffsets||[];t.writeUint32(16+4*r.length),t.writeString("stco"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint32(Number(r[e]))}i.d(e,{A:()=>r})},84360:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(4624),n="src/avformat/formats/mov/writing/stsc.ts";function s(t,e,i){const s=e.privData,a=s.stscFirstChunk,o=s.stscSamplesPerChunk,c=s.stscSampleDescriptionIndex;a.length===o.length&&a.length===c.length||r.R8("ctts firstChunk's length is not match samplesPerChunk's length or sampleDescriptionIndex's length",n,42);const l=Math.min(a.length,o.length,c.length);t.writeUint32(16+12*l),t.writeString("stsc"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(l);for(let e=0;e<l;e++)t.writeUint32(a[e]),t.writeUint32(o[e]),t.writeUint32(c[e])}},69301:(t,e,i)=>{i.d(e,{A:()=>b});var r=i(61600),n=i(78669),s=i(1263),a=i(99193),o=i(39878),c=i(47280),l=i(82181),d=i(4652),h=i(853),f=i(65629),u=i(93861),p=i(57756),m=i(14686),w=i(61619);const U={27:"avc1",173:"hvc1",196:"vvc1",225:"av01",167:"vp09"};function g(t){if(t.codecTag)return(0,w.A)(t.codecTag);let e=U[t.codecId];return e||(e=0===t.codecType?"mp4v":1===t.codecType?86076===t.codecId?"Opus":86028===t.codecId?"fLaC":"mp4a":3===t.codecType?"text":"none"),e}function b(t,e,i){const w=t.getPos();t.writeUint32(0),t.writeString("stsd"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(1),1===e.codecpar.codecType?function(t,e,i){const r=t.getPos(),n=g(e.codecpar),s=i.isom?1:0;t.writeUint32(0),t.writeString(n),t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),t.writeUint16(s),t.writeUint16(0),t.writeUint32(0),i.isom?(t.writeUint16(e.codecpar.chLayout.nbChannels),65541===e.codecpar.codecId||65540===e.codecpar.codecId?t.writeUint16(8):69643===e.codecpar.codecId?t.writeUint16(e.codecpar.bitsPerCodedSample):t.writeUint16(16),t.writeUint16(-2)):(86028===e.codecpar.codecId||86032===e.codecpar.codecId||86076===e.codecpar.codecId?t.writeUint16(e.codecpar.chLayout.nbChannels):t.writeUint16(2),86028===e.codecpar.codecId||86032===e.codecpar.codecId?t.writeUint16(e.codecpar.bitsPerCodedSample):t.writeUint16(16),t.writeUint16(0)),t.writeUint16(0),86076===e.codecpar.codecId?t.writeUint16(48e3):86060===e.codecpar.codecId?t.writeUint32(e.codecpar.sampleRate):t.writeUint16(e.codecpar.sampleRate),86060!==e.codecpar.codecId&&t.writeUint16(0),1===s&&(t.writeUint32(e.codecpar.frameSize),t.writeUint32(0),t.writeUint32(0),t.writeUint32(2)),!i.isom||86018!==e.codecpar.codecId&&86019!==e.codecpar.codecId&&86056!==e.codecpar.codecId&&73728!==e.codecpar.codecId&&86032!==e.codecpar.codecId&&69638!==e.codecpar.codecId&&69633!==e.codecpar.codecId&&86035!==e.codecpar.codecId?86028===e.codecpar.codecId?(0,c.A)(t,e,i):86076===e.codecpar.codecId?(0,l.A)(t,e,i):"mp4a"==n&&(0,d.A)(t,e,i):(0,p.A)(t,e,i),i.isom||(0,u.A)(t,e,i),i.boxsPositionInfo.push({pos:r,type:n,size:Number(t.getPos()-r)})}(t,e,i):0===e.codecpar.codecType?function(t,e,i){const c=t.getPos(),l=g(e.codecpar),p=13==e.codecpar.codecId&&15==e.codecpar.format||13==e.codecpar.codecId&&1==e.codecpar.format||202==e.codecpar.codecId||203==e.codecpar.codecId||156==e.codecpar.codecId||127==e.codecpar.codecId;t.writeUint32(0),t.writeString(l),t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),t.writeUint16(p?2:0),t.writeUint16(0),i.isom?(t.writeString("FFMP"),13===e.codecpar.codecId||p?(t.writeUint32(0),t.writeUint32(1024)):(t.writeUint32(512),t.writeUint32(512))):(t.writeUint32(0),t.writeUint32(0),t.writeUint32(0)),t.writeUint16(e.codecpar.width),t.writeUint16(e.codecpar.height),t.writeUint32(4718592),t.writeUint32(4718592),t.writeUint32(0),t.writeUint16(1);let m=e.metadata.compressorName||"";if(m=m.slice(0,31),t.writeUint8(m.length),t.writeString(m),m.length<31){let e=31-m.length;for(;e>0;)t.writeUint8(0),e--}i.isom&&e.codecpar.bitsPerCodedSample?t.writeUint16(e.codecpar.bitsPerCodedSample):t.writeUint16(24),t.writeUint16(65535),"mp4v"===l?(0,d.A)(t,e,i):27===e.codecpar.codecId?(0,r.A)(t,e,i):173===e.codecpar.codecId?(0,n.A)(t,e,i):196===e.codecpar.codecId?(0,s.A)(t,e,i):167===e.codecpar.codecId?(0,a.A)(t,e,i):225===e.codecpar.codecId&&(0,o.A)(t,e,i),(0,h.A)(t,e,i),(0,f.A)(t,e,i),i.isom||(0,u.A)(t,e,i),i.boxsPositionInfo.push({pos:c,type:l,size:Number(t.getPos()-c)})}(t,e,i):3===e.codecpar.codecType&&function(t,e,i){const r=t.getPos(),n=g(e.codecpar);t.writeUint32(0),t.writeString(n),t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),94208===e.codecpar.codecId?(0,d.A)(t,e,i):e.codecpar.extradata&&t.writeBuffer((0,m.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),i.isom||(0,u.A)(t,e,i),i.boxsPositionInfo.push({pos:r,type:n,size:Number(t.getPos()-r)})}(t,e,i),i.boxsPositionInfo.push({pos:w,type:"esds",size:Number(t.getPos()-w)})}},20184:(t,e,i)=>{function r(t,e,i){const r=e.privData.stssSampleNumbers;t.writeUint32(16+4*r.length),t.writeString("stss"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint32(r[e])}i.d(e,{A:()=>r})},57247:(t,e,i)=>{function r(t,e,i){const r=e.privData.sampleSizes;t.writeUint32(20+4*r.length),t.writeString("stsz"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint32(r[e])}i.d(e,{A:()=>r})},86051:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(4624),n="src/avformat/formats/mov/writing/stts.ts";function s(t,e,i){const s=e.privData,a=s.sttsSampleCounts||[],o=s.sttsSampleDeltas||[];a.length!==o.length&&r.R8("stts sampleCounts's length is not match sampleDeltas's length",n,39);const c=Math.min(a.length,o.length);t.writeUint32(16+8*c),t.writeString("stts"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(c);for(let e=0;e<c;e++)t.writeUint32(a[e]),t.writeInt32(o[e])}},11251:(t,e,i)=>{function r(t,e,i){const r=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId)),n=r?r.baseMediaDecodeTime:BigInt(0);t.writeUint32(20),t.writeString("tfdt"),t.writeUint8(1),t.writeUint24(0),t.writeUint64(n)}i.d(e,{A:()=>r})},11903:(t,e,i)=>{function r(t,e,i){const r=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId));let n=57;r.baseIsMoof&&(n&=-2,n|=131072);const s=t.getPos();t.writeUint32(0),t.writeString("tfhd"),t.writeUint8(0),t.writeUint24(n),t.writeUint32(r.trackId),1&n&&t.writeUint64(r.baseDataOffset),8&n&&t.writeUint32(r.defaultSampleDuration),16&n&&t.writeUint32(r.defaultSampleSize),32&n&&t.writeUint32(r.defaultSampleFlags),i.boxsPositionInfo.push({pos:s,type:"tfhd",size:Number(t.getPos()-s)})}i.d(e,{A:()=>r})},59868:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(77231),n=i(87384),s=i(44328);function a(t,e,i){const a=e.privData,o=(0,s.k)(a.lastPts,e.timeBase,{den:i.timescale,num:1}),c=e.metadata.creationTime||0,l=e.metadata.modificationTime||0,d=a.layer||0,h=a.alternateGroup||0;let f=e.codecpar.width>0?e.codecpar.width:0,u=e.codecpar.height>0?e.codecpar.height:0;f<r.zg&&(f<<=16),u<r.zg&&(u<<=16);let p=o<BigInt(r.f7)?0:1;p=c<r.f7?0:1,p=l<r.f7?0:1;let m=2;1&a.flags&&(m|=1),t.writeUint32(1===p?100:92),t.writeString("tkhd"),t.writeUint8(p),t.writeUint24(m),1===p?(t.writeUint64(c),t.writeUint64(l)):(t.writeUint32(Number(c)),t.writeUint32(Number(l))),t.writeUint32(a.trackId),t.writeUint32(0),1===p?t.writeUint64(o):t.writeUint32(Number(o)),t.writeUint32(0),t.writeUint32(0),t.writeInt16(d),t.writeInt16(a.perStreamGrouping?h:e.codecpar.codecType),1===e.codecpar.codecType?t.writeInt16(256):t.writeInt16(0),t.writeInt16(0),(0,n.A)(t,1,0,0,1,0,0),t.writeUint32(f),t.writeUint32(u)}},35010:(t,e,i)=>{function r(t,e,i){var r,n,s;const a=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId)),o=i.trexs.find((t=>{t.trackId,e.privData.trackId})),c=null!==(r=null==o?void 0:o.duration)&&void 0!==r?r:0,l=null!==(n=null==o?void 0:o.size)&&void 0!==n?n:0,d=null!==(s=null==o?void 0:o.flags)&&void 0!==s?s:0;t.writeUint32(32),t.writeString("trex"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(a.trackId),t.writeUint32(1),t.writeUint32(c),t.writeUint32(l),t.writeUint32(d)}i.d(e,{A:()=>r})},48516:(t,e,i)=>{function r(t,e,i){const r=e.privData,n=i.currentFragment.tracks.find((t=>t.trackId===r.trackId)),s=n.firstSampleFlags||0,a=n.dataOffset||0,o=n.sampleDurations,c=n.sampleSizes,l=n.sampleFlags,d=n.sampleCompositionTimeOffset,h=n.sampleCount,f=o.length>0,u=c.length>0,p=l.length>0,m=d.length>0,w=0!==s;let U=1;w&&(U|=4),f&&(U|=256),u&&(U|=512),p&&(U|=1024),m&&(U|=2048);const g=t.getPos();t.writeUint32(0),t.writeString("trun"),t.writeUint8(1),t.writeUint24(U),t.writeUint32(h),n.dataOffsetPos=t.getPos(),t.writeInt32(a),w&&t.writeUint32(s);for(let e=0;e<h;e++)f&&t.writeUint32(o[e]||0),u&&t.writeUint32(c[e]||0),p&&t.writeUint32(l[e]||0),m&&t.writeInt32(d[e]||0);i.boxsPositionInfo.push({pos:g,type:"trun",size:Number(t.getPos()-g)})}i.d(e,{A:()=>r})},54012:(t,e,i)=>{function r(t,e,i){t.writeUint32(20),t.writeString("vmhd"),t.writeUint8(0),t.writeUint24(1),t.writeUint64(BigInt(0))}i.d(e,{A:()=>r})},99193:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(14686);function n(t,e,i){var n;t.writeUint32(null!==(n=8+e.codecpar.extradataSize)&&void 0!==n?n:0),t.writeString("vpcC"),i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},1263:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(14686);function n(t,e,i){var n;t.writeUint32(null!==(n=8+e.codecpar.extradataSize)&&void 0!==n?n:0),t.writeString("vvcC"),t.writeUint8(0),t.writeUint24(0),i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},57756:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(14686),n=i(4652);function s(t,e,i){const s=t.getPos();t.writeUint32(0),t.writeString("wave"),86035!==e.codecpar.codecId&&(t.writeUint32(12),t.writeString("frma"),t.writeUint32(e.codecpar.codecTag)),86018===e.codecpar.codecId?(t.writeUint32(12),t.writeString("mp4a"),t.writeUint32(0),(0,n.A)(t,e,i)):i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),t.writeUint32(8),t.writeUint32(0),i.boxsPositionInfo.push({pos:s,type:"wave",size:Number(t.getPos()-s)})}},80025:(t,e,i)=>{i.d(e,{A:()=>y});var r=i(86051),n=i(18387),s=i(20184),a=i(57247),o=i(84360),c=i(2204),l=i(34445),d=i(6e3),h=i(7114),f=i(59868),u=i(17923),p=i(69301),m=i(54012),w=i(44473),U=i(11573),g=i(12412),b=i(35010),x=i(31130),S=i(11903),v=i(11251),A=i(48516),I=i(48669);const y={stts:r.A,ctts:n.A,stss:s.A,stsz:a.A,stsc:o.A,stco:c.A,co64:l.A,mdhd:d.A,mvhd:h.A,tkhd:f.A,hdlr:u.A,stsd:p.A,vmhd:m.A,edts:w.A,smhd:U.A,dref:g.A,trex:b.A,mfhd:x.A,tfhd:S.A,tfdt:v.A,trun:A.A,minf_hdlr:I.A}},59989:(t,e,i)=>{function r(t,e=0){if(!t)return!1;if(t.length<2)return!0;let i=t[e],r=e+1;for(;r<t.length&&i===t[r];r++);return r===t.length}i.d(e,{A:()=>r})},61619:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(67672);function n(t,e=4){let i="";for(let n=0;n<e;n++)r.ai(t)?(i=String.fromCharCode(255&t)+i,t>>>=8):(i=String.fromCharCode(Number(t&BigInt(255)))+i,t>>=BigInt(8));return i}},65977:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(4624),n="src/avformat/function/mktag.ts";function s(t){4!==t.length&&r.R8(`tag length is not 4, tag: ${t}`,n,30);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},20841:(t,e,i)=>{function r(t,e,i,r){const n=t.getPos(),s=t.getPointer(),a=n-BigInt(Math.floor(s));let o=!1;switch(e<n&&e>=a?(t.seekInline(s+Number(e-n)),o=!0):t.seek(e),r){case"uint8":t.writeUint8(255&i);break;case"int8":t.writeInt8(i);break;case"uint16":t.writeUint16(65535&i);break;case"int16":t.writeInt16(i);break;case"uint32":t.writeUint32(i>>>0);break;case"int32":t.writeInt32(i);break;case"uint64":t.writeUint64(BigInt.asUintN(64,i));break;case"int64":t.writeInt64(i);break;case"float":t.writeFloat(i);break;case"double":t.writeDouble(i)}o?t.seekInline(s):t.seek(n)}i.d(e,{A:()=>r})},23991:(t,e,i)=>{function r(t){let e=0,i=0;for(;i<32&&0===t.readU1();)i++;return e=t.readU(i),e+=(1<<i)-1,e}function n(t){let e=r(t);return e=1&e?(e+1)/2:-e/2,e}i.d(e,{$x:()=>n,xb:()=>r})},60264:(t,e,i)=>{function r(t){return t.length>4&&0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])}function n(t,e){let i=0;for(let r=e;r<t.length;r++)switch(t[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function s(t){const e=[];let i=n(t,0),r={offset:-1,startCode:0};for(;r=n(t,i.offset+i.startCode),r.offset>-1;)e.push(t.subarray(i.offset+i.startCode,r.offset,!0)),i=r;return e.push(t.subarray(i.offset+i.startCode,void 0,!0)),e}function a(t,e=0,i){i||(i=t.length);const r=new Uint8Array(t.length);let n=0,s=0;for(let a=0;a<t.length;a++){if(a>=e&&a<i)if(0===t[a])n++;else if(3===t[a]&&2===n&&a+1<t.length&&t[a+1]<=3){if(a++,a===t.length)break;n=0===t[a]?1:0}else n=0;r[s++]=t[a]}return r.slice(0,s)}i.d(e,{BN:()=>a,Bs:()=>r,py:()=>s})},37246:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(134),n=i(4624);class s{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=t,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let t=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let e=this.pointer,i=this.bitsLeft;return 0===i&&(e++,i=8),t=this.buffer[e]>>i-1&1,t}readU1(){let t=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,t=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),t}readU(t){let e=0;for(let i=0;i<t;i++)e|=this.readU1()<<t-i-1;return e}remainingLength(){return this.endPointer-this.pointer}getPos(){return this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const t=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(t<0)throw this.error=t,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+t,this.pointer=0}else{const t=this.onFlush(this.buffer);if(this.endPointer=t,this.pointer=0,this.bitsLeft=8,t<0)throw this.error=t,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const e=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,e),this.endPointer),this.endPointer+=e,n.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",174)}}clear(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}},83314:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=t,this.error=0,this.buffer=new Uint8Array(this.size)}writeU1(t){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&t?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}writeU(t,e){for(let i=0;i<t;i++)this.writeU1(e>>t-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const t=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}clear(){this.pointer=0,this.bitPointer=0,this.error=0}getBuffer(){return this.buffer}getPointer(){return this.pointer}}},729:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(134),n=i(4624),s=i(50011);class a{constructor(t,e=!0){(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}writeUint8(t){this.data.setUint8(this.pos+++this.byteStart,t)}writeUint16(t){this.data.setUint16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeUint24(t){const e=3840&t,i=240&t,r=15&t;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(e)):(this.writeUint8(e),this.writeUint8(i),this.writeUint8(r))}writeUint32(t){this.data.setUint32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeUint64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(e)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(e)))}writeInt8(t){this.data.setInt8(this.pos+++this.byteStart,t)}writeInt16(t){this.data.setInt16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeInt32(t){this.data.setInt32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeInt64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(e)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(e)))}writeFloat(t){this.data.setFloat32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeDouble(t){this.data.setFloat64(this.pos+this.byteStart,t,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(t){t>this.size&&(t=this.size),this.pos=Math.max(0,t)}skip(t){this.seek(this.pos+t)}back(t){this.seek(this.pos-t)}remainingSize(){return this.size-this.pos}writeBuffer(t){let e=t.length;this.remainingSize()<e&&(e=this.remainingSize(),n.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${t.length}, but set ${e}`,"src/common/io/BufferWriter.ts",211)),this.buffer.set(t,this.pos),this.pos+=t.length}writeString(t){const e=s.l(t);return this.writeBuffer(e),e.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(t,e=!0){this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}}}}]);